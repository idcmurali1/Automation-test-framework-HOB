#======================================================================================================================
#    AUTHOR: Francisco Javier Ramírez Hernández (vn53vq4)
#   CREATED: January/31/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

#----------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This flow navigates through the Onboarding pages in case they appear and selects the given banner in
  #     the Pre Home page to land on the Home page.
  #
  # PARAMS:
  #     ${zipCode}  [Optional]
  #         ZIP Code to be used in the Onboarding Page. If set to 'null', the flow will use the current device location.
  #
  #     ${banner}   [Mandatory]
  #         Banner to be selected in the Pre Home Page. Options: [ OD | EA ]
  #
  # AUTHOR: ?????
  # EDITOR: Sergio Fernandez (vn0t1qt), Rodrigo Pacheco (vn53p0i)
  - name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
    platform: ios
    flow:
      - executeFunction:
          name: mx.functions.onboarding.isOnboardingDisplayed
      - if:
          condition: ${returnedIsDisplayed} == true
          then:
              - log:
                  message: "Onboarding Displayed, flow will navigate through."
                  color: GREEN_BOLD
              - executeFunction:
                  name: mx.functions.onboarding.tapContinue
              - executeFunction:
                  name: mx.functions.onboarding.tapEnableLater
              - if:
                  condition: ${zipCode} == null
                  then:
                    - log:
                        message: "ZIP code not provided, flow will continue using current location."
                        color: GREEN_BOLD
                    - executeFunction:
                        name: mx.functions.onboarding.location.tapContinueOrEnableLocationButton
                    - executeFunction:
                        name: mx.functions.onboarding.location-popup.tapAllowWhileUsingAppIfDisplayed
                  else:
                    - executeFunction:
                        name: mx.functions.onboarding.tapEnableWithZipCode
                    - executeFunction:
                        name: mx.functions.onboarding.location.assertEnterZipCodePageDisplayed
                    - executeFunction:
                        name: mx.functions.onboarding.location.enterZipCode
                        params:
                          - name: zipCode
                            string: ${zipCode}
                    - executeFunction:
                        name: mx.functions.onboarding.location.tapSearch
              - if:
                  identifier:
                    present:
                      - identifier: mx.mappings.customized-buy-experience.pageTitle
                  then:
                    - executeFunction:
                          name: mx.functions.customized-buy-experience.assertPageDisplayed
                    - executeFunction:
                          name: mx.functions.customized-buy-experience.tapContinue
                    - executeFunction:
                          name: mx.functions.customized-buy-experience-popup.assertPopupDisplayed
                    - executeFunction:
                          name: mx.functions.customized-buy-experience.tapDontAllow
      - executeFunction:
          name: mx.functions.prehome.assertPageDisplayed
      - if:
          condition: ${banner} != 'OD' && ${banner} != 'od' && ${banner} != 'EA' && ${banner} != 'ea'
          then:
            - failTest:
                message: "Flow Failure: Incorrect Banner Provided: '${banner}'"
      - if:
          condition: ${banner} == 'OD' || ${banner} == 'od'
          then:
            - executeFunction:
                name: mx.functions.prehome.tapODBanner
            - executeFunction:
                name: mx.functions.delivery-method-selector.closeSelectorIfExpanded
            - executeFunction:
                name: mx.functions.utils.closeBlackPopupIfDisplayed
            - executeFunction:
                name: mx.functions.home.assertPageLoaded
      - if:
          condition: ${banner} == 'EA' || ${banner} == 'ea'
          then:
            - executeFunction:
                name: mx.functions.prehome.tapEABanner
            - sleep:
                duration: 5000
            - executeFunction:
                name: mx.functions.ea.home.assertPageLoaded
      - log:
          message: "End flow: global.onboarding.navigateToHomeAsGuestUser"
          color: BLUE
