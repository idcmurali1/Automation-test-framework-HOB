#======================================================================================================================
#  AUTHOR: Osmar Juárez (vn56dce)
#  CREATED: Oct/30/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # DESCRIPTION:  This function adds a new moral person's information for billing, filling up a form with all data required.
  # PARAM: ${taxCompanyName}                [Mandatory]  Company's name to enter.
  # PARAM: ${taxPayerId}                    [Mandatory]  Company's tax payer ID to enter.
  # PARAM: ${taxRegime}                     [Mandatory]  Tax regime to enter.
  # PARAM: ${cfdiType}                      [Mandatory]  CFDI type for invoice.
  # PARAM: ${invoiceEmail}                  [Mandatory]  Email for invoice.
  # PARAM: ${invoiceZipCode}                [Mandatory]  zip code for invoice.
  # PARAM: ${invoiceStreetName}             [Mandatory]  Street's name to enter.
  # PARAM: ${invoiceOutdoorNumber}          [Mandatory]  Outdoor's number to enter.
  # PARAM: ${invoiceNeighborhood}           [Mandatory]  neighborhood's name to enter.
  # PARAM: ${invoiceMunicipality}           [Mandatory]  invoice address municipality to assert.
  # PARAM: ${invoiceCity}                   [Mandatory]  invoice address city to assert.
  # PARAM: ${invoiceState}                  [Mandatory]  invoice address state to assert.
  # PARAM: ${invoiceCountryCodePhoneNumber} [Mandatory]  invoice country code of phone number to enter.
  # PARAM: ${invoicePhoneNumber}            [Mandatory]  invoice phone number to enter.
  # PARAM: ${isMainInvoiceProfile}          [Mandatory]  Set flag to 'true' or 'false' if 'Main invoice profile' checkbox should be marked.
  # PARAM: ${invoiceAddress}                [Mandatory]  Full address string
  # PARAM: ${cfdiId}                        [Mandatory]  ID of CFDI could be G01, G02, G03, etc. Depends or cfdi type and regime.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.flows.ea.invoice.addNewMoralPersonInvoiceProfile
    platform: android
    flow:
      # Validate Add New Invoice Form Displayed...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.assertPageDisplayed

      # Select Moral Person Option...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.tapMoralPerson
    
      # Enter Company Name...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterTaxCompanyName
          params:
            - name: taxCompanyName
              string: ${taxCompanyName}

      # Enter Tax Payer ID...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterTaxPayerId
          params:
            - name: taxPayerId
              string: ${taxPayerId}

      # Enter Tax Regime...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterTaxRegime
          params:
            - name: taxRegime
              string: ${taxRegime}
      
      # Enter CFDI Type...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterCfdiType
          params:
            - name: cfdiType
              string: ${cfdiType}

      # Scrolling down to the second section of the form...
      - scroll:
          direction: down
          untilIdentifier: mx.mappings.ea.add-invoice-form.neighborhoodSpinnerFiled
          scrollLimit: 3
          wait: 1000

      # Enter Email...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterEmail
          params:
            - name: invoiceEmail
              string: ${invoiceEmail}

      # Enter Zip Code...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterZipCode
          params:
            - name: invoiceZipCode
              string: ${invoiceZipCode}

      # Enter Street Name...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterStreetName
          params:
            - name: invoiceStreetName
              string: ${invoiceStreetName}

      # Enter Outdoor Number...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterOutdoorNumberAddress
          params:
            - name: invoiceOutdoorNumber
              string: ${invoiceOutdoorNumber}

      # Enter Neighborhood Name...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterNeighborhoodName
          params:
            - name: invoiceNeighborhood
              string: ${invoiceNeighborhood}
      
      # Scrolling down to the last section of the form...
      - scroll:
          direction: down
          untilIdentifier: mx.mappings.ea.add-invoice-form.saveButton
          scrollLimit: 3
          wait: 1000

      # Assert Auto filled fields (Municipality, City, State) based on Zip Code...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.assertAutoFilledFieldsAddress
      
      # Enter Phone Number's Country Code...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterCountryCodePhoneNumber
          params:
            - name: invoiceCountryCodePhoneNumber
              string: ${invoiceCountryCodePhoneNumber}

      # Enter Phone Number...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.enterPhoneNumber
          params:
            - name: invoicePhoneNumber
              string: ${invoicePhoneNumber}
      
      # Is Main Invoice Profile?
      - if:
          condition: ${isMainInvoiceProfile} == true
          then:
            - executeFunction:
                name: mx.functions.ea.add-invoice-form.tapMainInvoiceProfileCheckBox
            - executeFunction:
                name: mx.functions.ea.add-invoice-form.assertStateMainInvoiceProfileCheckbox
                params:
                  - name: isChecked
                    string: "true"
      - if:
          condition: ${isMainInvoiceProfile} == false
          then:
            - executeFunction:
                name: mx.functions.ea.add-invoice-form.assertStateMainInvoiceProfileCheckbox
                params:
                  - name: isChecked
                    string: "false"

      # Saving invoice profile and assert success message...
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.tapSave
      - executeFunction:
          name: mx.functions.ea.add-invoice-form.assertNoErrorMessageDipslayed
      - executeFunction:
          name: mx.functions.ea.invoice.assertSuccessMessageNewInvoiceAdded
      - executeFunction: 
          name:  mx.functions.ea.invoice.assertInvoiceProfileDisplayed
          params: 
            - name: invoiceType
              string: 'Organización'
            - name: invoiceName
              string: ${taxCompanyName}
            - name: taxPayerId
              string: ${taxPayerId}
            - name: cfdiId
              string: ${cfdiId}
            - name: invoiceAddress
              string: ${invoiceAddress}
            - name: email
              string: ${invoiceEmail}
            - name: isMainProfile
              string: ${isMainInvoiceProfile}
