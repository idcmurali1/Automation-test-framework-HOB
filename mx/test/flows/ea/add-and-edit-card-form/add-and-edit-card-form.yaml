#======================================================================================================================
#  AUTHOR: Isis Tolentino (vn53dge)
#  CREATED: Dec/19/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # DESCRIPTION:  This function adds a new card from add-and-edit-card-form.
  # PARAMS:       ${cardFirstName}        [Mandatory]   Users First Name to enter (Required).
  # PARAMS:       ${cardLastName}         [Mandatory]   Users Last Name to enter (Required).
  #               ${cardNumber}           [Mandatory]   Card Number to enter (Required).
  #               ${cardExpirationDate}   [Mandatory]   Card Expiration Date to enter (Required).
  #               ${cardCVV}              [Mandatory]   Card CVV to enter (Required).
  #               ${cardCountry}          [Mandatory]   Card Country to enter (Required).
  #               ${cardStreet}           [Mandatory]   Card Street to enter (Required).
  #               ${cardExteriorNumber}   [Mandatory]   Card Exterior Number to enter (Required).
  #               ${cardZipCode}          [Mandatory]   Card Zipcode to eter (Required).
  #               ${cardNeighborhood}     [Mandatory]   Card Neighborhood to enter (Required).
  #               ${cardState}            [Mandatory]   Card State to enter (Required).
  #               ${cardCity}             [Mandatory]   Card City to enter (Required).
  #               ${cardMunicipality}     [Mandatory]   Card Municipality to enter (Required).
  #
  # AUTHOR: Isis Tolentino (vn53dge)
  # EDITED: Jorge Carrillo (vn575hp)
  - name: mx.flows.ea.add-and-edit-card-form.addNewCard
    platform: android
    flow:
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterCardName
          params:
            - name: cardHolderFirstName
              string: ${cardFirstName}
            - name: cardHolderLastName
              string: ${cardLastName}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterCardNumber
          params:
            - name: cardNumber
              string: ${cardNumber}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterExpirationDate
          params:
            - name: cardExpirationDate
              string: ${cardExpirationDate}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterCVV
          params:
            - name: cardCVV
              string: ${cardCVV}
      #- executeFunction:                                                 # Commented as the form comes preloaded with the country Value
          #name: mx.functions.ea.add-and-edit-card-form.enterCountry
          #params:
            #- name: cardCountry
              #string: ${cardCountry}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterStreet
          params:
            - name: cardStreet
              string: ${cardStreet}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterExteriorNumber
          params:
            - name: cardExteriorNumber
              string: ${cardExteriorNumber}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterZipCode
          params:
            - name: cardZipCode
              string: ${cardZipCode}
      - scroll:
          direction: down
          untilIdentifier: mx.mappings.ea.add-and-edit-card-form.municipalityField
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterNeighborhood
          params:
            - name: cardNeighborhood
              string: ${cardNeighborhood}
      #- executeFunction:                                                 # Commented these three functions as the fields get populated when entering the zipcode 
          #name: mx.functions.ea.add-and-edit-card-form.enterState
          #params:
            #- name: cardState
              #string: ${cardState}
      #- executeFunction:
          #name: mx.functions.ea.add-and-edit-card-form.enterCity
          #params:
            #- name: cardCity
              #string: ${cardCity}
      #- executeFunction:
          #name: mx.functions.ea.add-and-edit-card-form.enterMunicipality
          #params:
            #- name: cardMunicipality
              #string: ${cardMunicipality}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.tapSave
      - executeFunction:
          name: mx.functions.ea.payment.assertCardAdded
      - log:
          message: "End flow: add-and-edit-card-form.addNewCard"
          color: BLUE

#--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This function adds a new card from add-and-edit-card-form and select or use the same address as delivery. 
  #               This function does not take in consideration if the card it will save as default payment or not.
  # PARAMS:       ${cardName}              [Mandatory]  Users Name to enter (Required).
  #               ${cardNumber}            [Mandatory]  Card Number to enter (Required).
  #               ${cardExpirationDate}    [Mandatory]  Card Expiration Date to enter (Required).
  #               ${cardCVV}               [Mandatory]  Card CVV to enter (Required).
  #               ${expectedCardAddress}   [Mandatory]  Full string of delivery address 
  # AUTHOR: Osmar Juarez (vn56dce)
  - name: mx.flows.ea.add-and-edit-card-form.addNewCardWithAddressSameAsDelivery
    platform: android
    flow:
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterCardName
          params:
            - name: cardName
              string: ${cardName}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterCardNumber
          params:
            - name: cardNumber
              string: ${cardNumber}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterExpirationDate
          params:
            - name: cardExpirationDate
              string: ${cardExpirationDate}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.enterCVV
          params:
            - name: cardCVV
              string: ${cardCVV}
      - try:
          flow:
            - verifyIdentifier:
                checked:
                  - identifier: mx.mappings.ea.add-and-edit-card-form.sameAsDeliveryAddressCheckbox
                    value: true
            - log:
                  message: "Checkbox to use the same delivery address for card is already marked"
                  color: GREEN_BOLD
          catch:
            flow:
              - log:
                  message: "Proceed to mark checkbox to use the same delivery address for card"
                  color: GREEN_BOLD
              - executeFunction:
                  name: mx.functions.ea.add-and-edit-card-form.tapCheckboxCardAddressSameAsDelivery
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.assertSelectedAddressForCard
          params:
            - name: expectedCardAddress
              string: ${expectedCardAddress}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.tapSave
      - executeFunction:
          name: mx.functions.ea.payment.assertCardAdded
      - log:
          message: "End flow: add-and-edit-card-form.addNewCardWithAddressSameAsDelivery"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This function validate the values of the fields already filled up of Card Form in the edition view
  # PARAMS:       ${expectedCardName}        [Mandatory]  Name On Card (Required).
  #               ${expectedCardLastDigits}  [Mandatory]  Expected last digits for Card (Required).
  #               ${expectedExpirationDate}  [Mandatory]  Expected Card Expiration Date (Required).
  #               ${expectedCardAddress}     [Mandatory]  Full string of expected address (Required). 
  # AUTHOR: Osmar Juarez (vn56dce)
  - name: mx.flows.ea.add-and-edit-card-form.assertCardInfoInEditionView
    platform: android
    flow:
      - log:
          message: "Expected Name on Card: '${expectedCardName}'"
          color: CYAN
      - verifyIdentifier:
         text:
           - identifier: mx.mappings.ea.add-and-edit-card-form.nameOnCardField
             equals: ${expectedCardName}
      - log:
          message: "Expected Card's Last Digits: '${expectedCardLastDigits}'"
          color: CYAN
      - verifyIdentifier:
         text:
           - identifier: mx.mappings.ea.add-and-edit-card-form.cardNumberField
             contains: ${expectedCardLastDigits}
      - log:
          message: "Expected Expiration Date Card: '${expectedExpirationDate}'"
          color: CYAN
      - verifyIdentifier:
         text:
           - identifier: mx.mappings.ea.add-and-edit-card-form.expirationDateField
             equals: ${expectedExpirationDate}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.assertRadioButtonSelectedAddress
          params:
            - name: expectedCardAddress
              string: ${expectedCardAddress}
      - log:
          message: "End flow: add-and-edit-card-form.assertCardInfoInEditionView"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This function deletes a card from the Wallet page, it expects that there are at least 1 card added.
  #                 it begins and ends from the Wallet page from account.
  # PARAMS:
  #   ${cardLastDigits}   [Mandatory]   Expected last 4 digits for Card (Required).
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.flows.ea.add-and-edit-card-form.deleteCardByLastDigitsFromWallet
    platform: android
    flow:
      - log:
          message: "Deleting Card with last digits: '${cardLastDigits}'"
          color: CYAN
      - executeFunction:
          name: mx.functions.ea.wallet.tapEditCardByLastDigits
          params:
            - name: cardLastDigits
              string: ${cardLastDigits}
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.tapDeleteButton
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.delete-card-popup.assertPopupDisplayed
      - executeFunction:
          name: mx.functions.ea.add-and-edit-card-form.delete-card-popup.tapConfirm
      - sleep:
          duration: 5000
      - executeFunction:
          name: mx.functions.ea.wallet.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.wallet.assertCardNotDisplayed
          params:
            - name: cardLastDigits
              string: ${cardLastDigits}
      - log:
          message: "Flow Succeeded: Desired Card has been deleted."
          color: GREEN_BOLD
      - log:
          message: "End flow: add-and-edit-card-form.deleteCardByLastDigitsFromWallet"
          color: BLUE
