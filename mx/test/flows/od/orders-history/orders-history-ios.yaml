#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Feb/20/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # DESCRIPTION: Asserts the details of the given Order displayed in the Orders History Page.
  # PARAMS:
  #
  #   ${orderNumber}  [Mandatory]  Order Number expected to be displayed and which details will be asserted.
  #
  #   ${expectedDeliveryMethod}  [Mandatory]  Expected Delivery Method. Values: [ HomeDelivery | PickupDelivery ].
  #
  #   ${expectedTotal}  [Mandatory]  Expected total. Include two decimals and no currency symbol '$'.
  #
  #   ${expectedBanner}  [Mandatory]  Expected banner. Values: [ Walmart | WalmartExpress ].
  #
  #   ${expectedDaySlot}  [Mandatory]  Expected day slot to be displayed. Value: as returned by function 'mx.functions.reserve-slot.getSelectedDaySlot'.
  #
  #   ${expectedTimeSlot}  [Mandatory]  Expected time slot to be displayed. Value: as returned by function 'mx.functions.reserve-slot.getSelectedTimeSlot'.
  #
  #   ${expectedOrderStatus}  [Mandatory]  Expected order status. Values: [ Received | Preparing | Ready4Pickup | OnTheWay | Delivered ]. 
  #
  #   ${expectedProductsCount} [Mandatory]  Expected quantity of purchased products. THIS IS NOT the same as the total
  #       products quantity. This value represents how many different products were purchased in total.
  #       i.e: If you bought 3 apples and 4 pears, there are 2 different products, not 7.
  #
  # USES FLAGS:
  #
  #   ${IOS_ORDERS_HISTORY_WORKAROUND}
  #       If set to 'true', the flow will not use the 'orderNumber' to perform the assertions on iOS, instead, it will perform
  #       them with the order that is displayed top most in the Orders History page.
  #       If set to 'false' or not set at all, it will perform the assertions with the given 'orderNumber'.
  #
  #   ${ASSERT_DELIVERY_SLOT_IN_ORDERS_HISTORY}
  #       If set to 'true', the flow will perform assertion for the Delivery Slot in Orders History page.
  #       If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
  #
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  # EDITORS: Octavio Cabrales (vn53g23), Sergio Fernandez (vn0t1qt)
  - name: mx.flows.od.orders-history.assertOrder
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Order Number: '${orderNumber}' ]"
          color: CYAN
      - if:
          condition: ${IOS_ORDERS_HISTORY_WORKAROUND} == true
          then:
            - log:
                message: "[!] Flag IOS_ORDERS_HISTORY_WORKAROUND is set to 'true'."
                color: YELLOW
            - log:
                message: "[!] The scenario will perform the Order Assertions with the Order at the top of the list."
                color: YELLOW
            - storeIn:
                key: position
                value: 1
            - executeFunction:
                name: mx.functions.orders-history.assertOrderDeliveryMethodByPosition # <--PARAMS--${expectedDeliveryMethod}--${position}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderTotalByPosition # <--PARAMS--${expectedTotal}--${position}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderBannerByPosition # <--PARAMS--${expectedBanner}--${position}
            - executeFunction:
                name: mx.functions.utils.getDeliverySlot
                params:
                  - name: forPage
                    string: 'OrderHistory'
                  - name: selectedDaySlot
                    string: ${expectedDaySlot}
                  - name: selectedTimeSlot
                    string: ${expectedTimeSlot}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderDeliverySlotByPosition # <--PARAMS--${expectedDeliverySlot}--${expectedBanner}--${position}
                params:
                  - name: expectedDeliverySlot
                    string: ${returnedDeliverySlot}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderStatusByPosition # <--PARAMS--${expectedOrderStatus}--${position}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderProductsCountByPosition # <--PARAMS--${expectedProductsCount}--${position}
          else:
            # "!!! ONCE ORDER NUMBER APPEARS ON ORDERS-HISTORY PAGE CREATE AND UN-COMMENT ORDER NUMBER ASSERTIONS !!!"
            - log:
                message: "!!! ASSERTIONS BY ORDER NUMBER NOT YET CREATED FOR IOS !!!"
                color: YELLOW
            # - executeFunction:
            #     name: mx.functions.orders-history.assertOrderDeliveryMethod # <--PARAMS--${expectedDeliveryMethod}--${orderNumber}
            # - executeFunction:
            #     name: mx.functions.orders-history.assertOrderTotal # <--PARAMS--${expectedTotal}--${orderNumber}
            # - executeFunction:
            #     name: mx.functions.orders-history.assertOrderBanner # <--PARAMS--${expectedBanner}--${orderNumber}
            # - executeFunction:
            #     name: mx.functions.utils.getDeliverySlot
            #     params:
            #       - name: forPage
            #         string: 'OrderHistory'
            #       - name: selectedDaySlot
            #         string: ${expectedDaySlot}
            #       - name: selectedTimeSlot
            #         string: ${expectedTimeSlot}
            # - executeFunction:
            #     name: mx.functions.orders-history.assertOrderDeliverySlot # <--PARAMS--${expectedDeliverySlot}--${expectedBanner}--${orderNumber}
            #     params:
            #       - name: expectedDeliverySlot
            #         string: ${returnedDeliverySlot}
            # - executeFunction:
            #     name: mx.functions.orders-history.assertOrderStatus # <--PARAMS--${expectedOrderStatus}--${orderNumber}
            # - executeFunction:
            #     name: mx.functions.orders-history.assertOrderProductsCount # <--PARAMS--${expectedProductsCount}--${orderNumber}
      - log:
          message: "End flow: od.orders-history.assertOrder"
          color: BLUE
