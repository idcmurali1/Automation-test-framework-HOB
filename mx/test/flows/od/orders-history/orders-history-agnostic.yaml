#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Feb/20/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: Asserts the information of the given Order number in the Orders History Page.
  #              The Order Number is provided in the variable ${orderInfo}.
  #
  # PARAMS: ${orderInfo}  [Mandatory]
  #             A Json string containing the Order Information displayed in the Order Confirmation/Thank You Page.
  #             This value is obtained by the function 'mx.functions.order-confirmation.getOrderInformation', see its
  #             documentation for additional details.
  #
  # AUTHOR: Sergio Fernandez (vn0t1qt)
  - name: mx.flows.od.orders-history.assertOrderInformation
    flow:
      - if:
          condition: ${platform} == 'iOS' && ${IOS_TURN_OFF_ORDER_INFO_ASSERTION_IN_ORDERS_HISTORY}
          then:
            - log:
                message: '[!!!] [ IOS_TURN_OFF_ORDER_INFO_ASSERTION_IN_ORDERS_HISTORY=true ] Order Information assertion will be omitted. Ensure to cover this assertion manually.'
                color: YELLOW
          else:
            - log:
                message: 'Order Information to be asserted: ${orderInfo}'
                color: CYAN
            # Extract the individual values to use from the ${orderInfo} Json string...
            - executeNode:
                file: mx/test/helpers/utils/getJsonValues.js
                args:
                  - value: ${orderInfo}
                getValue:
                  - key: orderNumber
                    storeIn: orderNumber
                  - key: fulfillmentType
                    storeIn: fulfillmentType
                  - key: orderTotal
                    storeIn: orderTotal
                  - key: paymentMethod
                    storeIn: paymentMethod
                  - key: itemsCount
                    storeIn: productsCount
            # Perform assertions...
            - executeFunction:
                name: mx.functions.orders-history.assertOrderDisplayed # <-- ${orderNumber}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderFulfillmentType # <-- ${orderNumber}, ${fulfillmentType}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderTotal # <-- ${orderNumber}, ${orderTotal}
            # TODO: pending to create reliable process to assert fulfillment date, meanwhile, existence of element will be the only thing to assert...
            - executeFunction:
                name: mx.functions.orders-history.assertOrderFulfillmentDateDisplayed # <-- ${orderNumber}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderTrackerDisplayed # <-- ${orderNumber}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderStatus # <-- ${orderNumber}, ${fulfillmentType}, ${paymentMethod}
            - executeFunction:
                name: mx.functions.orders-history.assertOrderProductsCount # <-- ${productsCount}
            - log:
                message: '✓ Successful Assertion: Order Information correct.'
                color: GREEN_BOLD
      - log:
          message: "End flow: mx.flows.od.orders-history.assertOrderInformation"
          color: BLUE
