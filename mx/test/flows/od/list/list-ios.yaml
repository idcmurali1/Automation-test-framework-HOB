#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Feb/08/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # Description: This flow marks as favorite a product that doesn't have any special badges from SLP.
  # NOTE:        This function does not take a product price limit into consideration.
  # RETURNS:
  #   ${returnedProductName}
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.flows.od.list.markProductAsFavoriteWithoutSpecialBadgesInSLP
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: mx.mappings.slp.unmarkedProductNameLabelWithoutSpecialBadges
          then:
            # Using only the scroll functionality on iOS, causes an infinite loop for some reason.
            - loop:
                begin: 1
                end: 15
                mode: increment
                flow:
                  - scroll:
                      direction: down
                      wait: 2000
                      position: center
                      scrollLimit: 1
                  - if:
                      identifier:
                        present:
                          # This mapping finds the first product on screen after the scroll with the name label visible. 
                          # The product container will not have any type of the special badges.
                          - identifier: mx.mappings.slp.unmarkedProductNameLabelWithoutSpecialBadges
                      then:
                        - break: true
            # This drag action will hide the bottom menu in case it ends on top of the name label or the heart icon.
            - drag:
                from:
                  x: 50%
                  y: 55%
                to:
                  x: 50%
                  y: 50%
      - getString:
          # This mapping gets the product name when the product hasn't been marked as favorite yet.
          identifier: mx.mappings.slp.unmarkedProductNameLabelWithoutSpecialBadges
          storeIn: returnedProductName
      - log:
          message: "Product Name got: ${returnedProductName}"
          color: CYAN
      - executeFunction:
          name: mx.functions.slp.markProductAsFavorite
          params:
            - name: productName
              string: ${returnedProductName}
      - log:
          message: "End flow: od.list.markProductAsFavoriteWithoutSpecialBadgesInSLP"
          color: BLUE

  #----------------------------------------------------------------------------------------------------------------------

  # Description: This flow marks as favorite a product that doesn't have any special badges from PLP.
  # NOTE:        This function does not take a product price limit into consideration.
  # RETURNS:
  #   ${returnedProductName}
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.flows.od.list.markProductAsFavoriteWithoutSpecialBadgesInPLP
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: mx.mappings.department-l3.unmarkedProductNameLabelWithoutSpecialBadges
          then:
            # Using only the scroll functionality on iOS, causes an infinite loop for some reason.
            - loop:
                begin: 1
                end: 15
                mode: increment
                flow:
                  - scroll:
                      direction: down
                      wait: 2000
                      position: center
                      scrollLimit: 1
                  - if:
                      identifier:
                        present:
                          # This mapping finds the first product on screen after the scroll with the name label visible. 
                          # The product container will not have any type of the special badges.
                          - identifier: mx.mappings.department-l3.unmarkedProductNameLabelWithoutSpecialBadges
                      then:
                        - break: true
            # This drag action will hide the bottom menu in case it ends on top of the name label or the heart icon.
            - drag:
                from:
                  x: 50%
                  y: 55%
                to:
                  x: 50%
                  y: 50%
      - getString:
          # This mapping gets the product name when the product hasn't been marked as favorite yet and doesn't have special badges.
          identifier: mx.mappings.department-l3.unmarkedProductNameLabelWithoutSpecialBadges
          storeIn: returnedProductName
      - log:
          message: "Product Name got: ${returnedProductName}"
          color: CYAN
      - executeFunction:
          name: mx.functions.department-l3.markProductAsFavorite
          params:
            - name: productName
              string: ${returnedProductName}
      - log:
          message: "End flow: od.list.markProductAsFavoriteWithoutSpecialBadgesInPLP"
          color: BLUE


