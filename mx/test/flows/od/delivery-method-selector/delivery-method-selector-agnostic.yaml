#======================================================================================================================
#    AUTHOR: Jorge Carrillo (vn575hp)
#   CREATED: May/22/2024
#  REVISION: ---
#
#  Copyright Â© 2024 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # DESCRIPTION:          This flow selects pickup delivery in OD and return selected store name
  # AUTHOR: Miguel Caballero (vn55rfi)
  # EDITED: Jorge Carrillo (vn575hp)
  # CREATED: May/20/2024
  # RETURNS:
  #   ${returnedStoreAddress}  The Address of the selected store (raw string).
  - name: mx.flows.od.delivery-method-selector.selectPickupDeliveryWithCurrentStore
    flow:
      - executeFunction:
            name: mx.functions.delivery-method-selector.expandSelectorIfCollapsed
      - executeFunction:
          name: mx.functions.delivery-method-selector.assertSelectorDisplayed
      - executeFunction:
          name: mx.functions.delivery-method-selector.tapPickupButtonIfNotSelected
      - executeFunction:
          name: mx.functions.delivery-method-selector.selection-options.tapChangeStoreButton
      - executeFunction:
          name: mx.functions.store-selector-popup.assertPageDisplayed
      - executeFunction:
          name: mx.functions.store-selector-popup.getSelectedStoreAddress
      - storeIn:
          key: returnedSelectedStoreAddress # --RETURNS-->
          value: ${returnedStoreAddress}
      - executeFunction:
          name: mx.functions.store-selector-popup.tapSave
      - executeFunction:
          name: mx.functions.delivery-method-selector.closeSelectorIfExpanded
      - log:
          message: 'End flow: delivery-method-selector.selectPickupDeliveryWithCurrentStore'
          color: BLUE

  #-------------------------------------------------------------------------------------------------
  # DESCRIPTION:          This flow selects home delivery with a random address
  # AUTHOR: Teresa Partida (vn0t1qt)
  - name: mx.flows.od.delivery-method-selector.selectRandomHomeDeliveryAddress
    flow:
      - executeFunction:
          name: mx.functions.delivery-method-selector.expandSelectorIfCollapsed
      - executeFunction:
          name: mx.functions.delivery-method-selector.assertSelectorDisplayed
      - executeFunction:
          name: mx.functions.delivery-method-selector.tapHomeDeliveryButtonIfNotSelected
      - executeFunction:
          name: mx.functions.delivery-method-selector.tapHomeDeliveryAddressSelectorIfDisplayed
      - executeFunction:
          name: mx.functions.address-selector-popup.selectVisibleRandomAddress
      - executeFunction:
          name: mx.functions.address-selector-popup.getSelectedAddress
      - executeFunction:
          name: mx.functions.address-selector-popup.tapSave
      - executeFunction:
          name: mx.functions.delivery-method-selector.closeSelector
      - log:
          message: 'End flow: delivery-method-selector.selectRandomHomeDeliveryAddress'
          color: BLUE


 #----------------------------------------------------------------------------------------------------------------------
  # DESCRIPTION:          This flow selects a store for Pickup in OD by zip code
  # AUTHOR: Miguel Caballero (vn55rfi)
  # EDITED: Jorge Carrillo (vn575hp)
  # CREATED: May/22/2024
  # PARAMS: zipCode--storeName

  - name: mx.flows.od.delivery-method-selector.selectPickupOdStoreByZipCode
    flow:
      - executeFunction:
          name: mx.functions.delivery-method-selector.expandSelectorIfCollapsed
      - executeFunction:
          name: mx.functions.delivery-method-selector.assertSelectorDisplayed
      - executeFunction:
          name: mx.functions.delivery-method-selector.tapPickupButtonIfNotSelected
      - executeFunction:
          name: mx.functions.delivery-method-selector.selection-options.tapChangeStoreButton
      - executeFunction:
          name: mx.functions.store-selector-popup.assertPageDisplayed
      - executeFunction:
          name: mx.functions.store-selector-popup.enterZipCode # <--PARAM--${zipCode}--
      - executeFunction:
          name: mx.functions.utils.waitUntilMappingDisappear
          params:
            - name: mapping
              string: mx.mappings.store-selector-popup.loadingSpinner
      - executeFunction:
          name: mx.functions.store-selector-popup.selectStore  # <--PARAM--${storeName}--
      - executeFunction:
          name: mx.functions.store-selector-popup.getSelectedStoreAddress
      - storeIn:
          key: returnedSelectedStoreAddress # --RETURNS-->
          value: ${returnedStoreAddress}
      - executeFunction:
          name: mx.functions.store-selector-popup.tapSave
      - executeFunction:
          name: mx.functions.delivery-method-selector.closeSelectorIfExpanded
      - log:
          message: 'End flow: delivery-method-selector.selectPickupOdStoreByZipCode'
          color: BLUE