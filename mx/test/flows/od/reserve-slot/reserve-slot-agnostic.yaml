#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Feb/14/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

#----------------------------------------------------------------------------------------------------------------------

  # Description: This method changes a user address by its name in reserve slot page after selecting the home delivery 
  # tab, if the 'Add delivery address' popup displays, then the address is selected from there, if nothing happens
  # this flow will click on 'Change address' and select the address by the name specified on param.
  # NOTE: If the OOS popup appears, this flow will close it and ignore it.
  # Param:   ${addressName}                 [Mandatory]  Address to select by custom name.
  - name: mx.flows.od.reserve-slot.changeDeliveryAddress
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.reserve-slot.address-message-popup.popupTitle
            timeout: 15000
          then:
            - executeFunction:
                name: mx.functions.reserve-slot.address-message-popup.assertPopupDisplayed
            - executeFunction:
                name: mx.functions.reserve-slot.address-message-popup.tapAddAddress
          else:
            - executeFunction:
                name: mx.functions.reserve-slot.tapChange
      - executeFunction:
          name: mx.functions.address-selector-popup.assertPageDisplayed
      - if:
          identifier:
            notPresent:
              - identifier: mx.mappings.address-selector-popup.selectedAddressByName
          then:
            - executeFunction:
                name: mx.functions.address-selector-popup.selectAddressByName
      - executeFunction:
          name: mx.functions.address-selector-popup.getSelectedAddress
      - executeFunction:
          name: mx.functions.address-selector-popup.tapSave
      # NOTE: If the OOS popup appears, flow will close it and ignore it.
      #       If you want to manage OOS products please create another flow instead of editing this one.
      - executeFunction:
          name: mx.functions.oos.closePopupIfDisplayed
      - sleep:
          duration: 8000
      - executeFunction:
          name: mx.functions.reserve-slot.assertPageDisplayed
      - executeFunction:
          name: mx.functions.reserve-slot.assertSelectedAddressByIndividualValues
          params:
            - name: streetName
              string: ${returnedStreetName}
            - name: exteriorNumber
              string: ${returnedExteriorNumber}
            - name: city
              string: ${returnedCity}
            - name: state
              string: ${returnedState}
            - name: zipCode
              string: ${returnedZipCode}
      - log:
          message: "End flow: reserve-slot.selectDeliveryAddress"
          color: BLUE

  #----------------------------------------------------------------------------------------------------------------------
  # DESCRIPTION: This method selects a random available date and then selects a random time slot
  # or selects a last date (if param $dateAfterTomorrow is sent) and then selects a random time slot
  # Param: ${dateAfterTomorrow} [Optional] Boolean to select date after tomorrow instead random
  # RETURNS:
  #   ${returnedSelectedTimeSlot} A string with time slot selected using the following format:(i.e. '4pm-5pm')
  #   ${returnedDeliveryFee}      A string with the value of the slot delivery fee (i.e '44.00')
  #   ${returnedSelectedDaySlot}  A string containing the index, day and date of the selected day slot
  #                               (i.e. '3, Mié., 29/5')
  # AUTHOR: Teresa Partida (vn55epy)
  - name: mx.flows.od.reserve-slot.selectDateAndRandomNormalTimeSlot
    flow:
      - if:
          condition: ${dateAfterTomorrow}
          then:
            - executeFunction:
                name: mx.functions.reserve-slot.selectDayAfterTomorrowSlot
          else:
            - executeFunction:
                name: mx.functions.reserve-slot.selectRandomDateSlot
      - sleep:
          duration: 1000
      - executeFunction:
          name: mx.functions.reserve-slot.selectRandomVisibleNormalTimeSlot
      - executeFunction:
          name: mx.functions.reserve-slot.getSelectedTimeSlot
      - executeFunction:
          name: mx.functions.reserve-slot.getSelectedTimeSlotDeliveryFee
      - executeFunction:
          name: mx.functions.reserve-slot.getSelectedDaySlot
      - executeFunction:
          name: mx.functions.reserve-slot.tapReserve
      - log:
          message: "End flow: reserve-slot.selectDateAndRandomNormalTimeSlot"
          color: BLUE