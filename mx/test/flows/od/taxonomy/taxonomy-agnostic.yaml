#======================================================================================================================
#    AUTHOR: Sergio Fernandez Aldana (vn0t1qt)
#   CREATED: Feb/16/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

#----------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: Starting from the Departments Page, opens the given Department(L1) and the Sub-department(L2) & PLP(L3)
  #   if provided.
  # PARAMS:
  #   ${L1}  [Mandatory]  Name of the Department(L1) to be opened.
  #   ${L2}  [Optional]   Name of the Sub-department(L2) to be opened. If not provided, Sub-department(L2) and PLP(L3)
  #                         will not try to open.
  #   ${L3}  [Optional]   Name of the PLP(L3) to be opened. If not provided, PLP(L3) will not try to open.
  # AUTHOR: Sergio Fernandez (vn0t1qt)
  - name: mx.flows.od.taxonomy.openDepartment
    flow:
      - log:
          message: "Department(L1): '${L1}'"
          color: CYAN
      - log:
          message: "Sub-department(L2): '${L2}'"
          color: CYAN
      - log:
          message: "PLP(L3): '${L3}'"
          color: CYAN
      - executeFunction:
          name: mx.functions.departments.assertPageDisplayed

      # Open & assert L1...
      - executeFunction:
          name: mx.functions.departments.selectDepartment
          params:
            - name: departmentName
              string: ${L1}
      - executeFunction:
          name: mx.functions.department-l1-l2.assertCorrectDepartmentOpened
          params:
            - name: departmentName
              string: ${L1}
      - log:
          message: "Department(L1) opened"
          color: CYAN
      
      - if: # Check if L2 is provided...
          condition: ${L2} != null
          then: # Open & assert L2...
            - executeFunction:
                name: mx.functions.department-l1-l2.selectCategory
                params:
                  - name: categoryName
                    string: ${L2}
            - executeFunction:
                name: mx.functions.department-l1-l2.assertPageDisplayed
            - executeFunction:
                name: mx.functions.department-l1-l2.assertCorrectDepartmentOpened
                params:
                  - name: departmentName
                    string: ${L2}
            - log:
                message: "Sub-department(L2) opened"
                color: CYAN
            
            - if: # Check if L3 is provided...
                condition: ${L3} != null
                then: # Open & assert L3...
                  - executeFunction:
                      name: mx.functions.department-l1-l2.selectCategory
                      params:
                        - name: categoryName
                          string: ${L3}
                  - executeFunction:
                      name: mx.functions.department-l3.assertPageDisplayed
                  - executeFunction:
                      name: mx.functions.department-l3.assertCorrectCategoryOpened
                      params:
                        - name: category
                          string: ${L3}
                  - log:
                      message: "PLP(L3) opened"
                      color: CYAN
                else:
                  - log:
                      message: "PLP(L3) not provided. PLP(L3) will not try to open."
                      color: CYAN
          else:
            - log:
                message: "Sub-department(L2) not provided. Sub-department(L2) & PLP(L3) will not try to open."
                color: CYAN
      - log:
          message: "End Flow: od.taxonomy.openDepartment"
          color: BLUE