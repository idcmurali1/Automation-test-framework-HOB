#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Feb/02/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

#----------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: Performs a search with the given search term from the search field in the Top Menu page and asserts
  #   the SLP page is displayed and if it's showing results.
  # PARAM:  ${searchTerm}  [Mandatory]  Search term to perform the search with.
  - name: mx.flows.od.search.performSuccessfulSearch
    flow: 
      - executeFunction:
          name: mx.functions.top-menu.tapSearchField
      - executeFunction:
          name: mx.functions.top-menu.enterSearchTerm
      - executeFunction:
          name: mx.functions.top-menu.tapSearchInKeyboard
      - executeFunction:
          name: mx.functions.delivery-methods-info-popup.dismissPopupIfDisplayed
      - executeFunction:
          name: mx.functions.slp.assertPageDisplayed
      - executeFunction:
          name: mx.functions.slp.assertResultsDisplayed
      - log:
          message: "End flow: od.search.performSuccessfulSearch"
          color: BLUE

  #----------------------------------------------------------------------------------------------------------------------
  # Description: Search product, open PDP and Add product to cart
  # PARAMS
  # ${searchTerm} [Mandatory]
  # ${productName} [Mandatory]
  # AUTHOR Guillermo Canales (g0c08aj)

  - name: mx.flows.od.search.addItemToCartFromSearch
    flow:
      - executeFunction:
          name: mx.flows.od.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: ${searchTerm}
      - executeFunction:
          name: mx.functions.slp.scrollDownToProductByName
          params:
            - name: productName
              string: ${productName}
      - executeFunction:
          name: mx.functions.slp.openProductDetailsByName
          params:
            - name: productName
              string: ${productName}
      - sleep:
          duration: 3000
      - executeFunction:
          name: mx.functions.pdp.addToCart
      - executeFunction:
          name: mx.functions.pdp.assertAddedToCart
      - executeFunction:
          name: mx.functions.pdp.getPrice
      - executeFunction:
          name: mx.functions.pdp.getProductQuantityAsPieces
      - executeFunction:
          name: mx.functions.pdp.tapClose