#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Mar/15/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  ### NOTE: ADD LOGIC FOR PICKUP DELIVERY METHOD AND THE CORRESPONDING FUNCTIONS AND PARAMETERS TO THE LIST. ###

  # Description: This flow performs all the assertions necessary for this page that are not related to individual product assertions.
  # Param:  ${expectedTotal}               [Mandatory]  Expected amount to assert. This value should not include the '$' sign.
  #                                                       and must contain two decimals.
  # Param:  ${expectedDeliveryMethod}      [Mandatory]  Expected selected delivery method Expected selected delivery method 
  #                                                       (Input: [ HomeDelivery | PickupDelivery ]).
  #          ${expectedDaySlot}            [Mandatory]  Expected day slot to be displayed.
  #                                                       Value: as returned by the function:
  #                                                       mx.functions.reserve-slot.getSelectedDaySlot
  #          ${expectedTimeSlot}           [Mandatory]  Expected time slot to be displayed.
  #                                                       Value: as returned by the function:
  #                                                       mx.functions.reserve-slot.getSelectedTimeSlot
  # Param:  ${expectedHomeAddressName}     [Mandatory]  Expected home address name to be displayed.
  # Param:  ${expectedUserStreet}          [Mandatory]  Expected user street to be displayed, obtained from:
  #                                                       mx.functions.reserve-slot.getSelectedAddress or
  #                                                       mx.functions.address-selector-popup.getSelectedAddress
  # Param:  ${expectedUserExteriorNumber}  [Mandatory]  Expected user extNum to be displayed, obtained from:
  #                                                       mx.functions.reserve-slot.getSelectedAddress or
  #                                                       mx.functions.address-selector-popup.getSelectedAddress
  # Param:  ${expectedUserCity}            [Mandatory]  Expected user city to be displayed, obtained from:
  #                                                       mx.functions.reserve-slot.getSelectedAddress or
  #                                                       mx.functions.address-selector-popup.getSelectedAddress
  # Param:  ${expectedUserState}           [Mandatory]  Expected user state to be displayed, obtained from:
  #                                                       mx.functions.reserve-slot.getSelectedAddress or
  #                                                       mx.functions.address-selector-popup.getSelectedAddress
  # Param:  ${expectedUserZipCode}         [Mandatory]  Expected user ZIP Code to be displayed, obtained from:
  #                                                       mx.functions.reserve-slot.getSelectedAddress or
  #                                                       mx.functions.address-selector-popup.getSelectedAddress
  # Param:  ${expectedProductsCount}       [Mandatory]  Expected products count quantity to be displayed.
  - name: mx.flows.od.order-confirmation.assertConfirmation
    flow:
      - log:
          message: "Performing Confirmation Page Assertions..."
          color: CYAN
      - executeFunction:
          name: mx.functions.order-confirmation.assertPageDisplayed
      - executeFunction:
          name: mx.functions.order-confirmation.assertTotal
      - executeFunction:
          name: mx.functions.utils.getDeliverySlot
          params:
            - name: forPage
              string: 'OrderConfirmation'
            - name: selectedDaySlot
              string: ${expectedDaySlot}
            - name: selectedTimeSlot
              string: ${expectedTimeSlot}
      - executeFunction:
          name: mx.functions.order-confirmation.assertDeliverySlot
          params:
            - name: expectedDeliverySlot
              string: ${returnedDeliverySlot}
      - executeFunction:
          name: mx.functions.order-confirmation.assertProductsCount
      - executeFunction:
          name: mx.functions.order-confirmation.assertDeliveryMethod
      - if:
          condition: ${expectedDeliveryMethod} != 'HomeDelivery' && ${expectedDeliveryMethod} != 'PickupDelivery'
          then:
            - failTest:
                message: "Wrong input, verify delivery method supplied: ${expectedDeliveryMethod}"
      - if:
          condition: ${expectedDeliveryMethod} == 'HomeDelivery'
          then:
            - executeFunction:
                name: mx.functions.order-confirmation.assertHomeDeliveryAddressName
            - executeFunction:
                name: mx.functions.order-confirmation.assertHomeDeliveryAddressByIndividualValues
                params:
                  - name: streetName
                    string: ${expectedUserStreet}
                  - name: exteriorNumber
                    string: ${expectedUserExteriorNumber}
                  - name: city
                    string: ${expectedUserCity}
                  - name: state
                    string: ${expectedUserState}
                  - name: zipCode
                    string: ${expectedUserZipCode}
      - if:
          condition: ${expectedDeliveryMethod} == 'PickupDelivery'
          then:
          ################ TO DO: ADD PICKUP LOGIC WHEN NEEDED!!!
            - log:
                message: "ADD LOGIC FOR PICKUP DELIVERY METHOD"
                color: YELLOW
      - log: 
          message: "End flow: order-confirmation.assertConfirmation"
          color: BLUE