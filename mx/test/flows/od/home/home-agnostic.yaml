#======================================================================================================================
#    AUTHOR: Osmar Juárez (vn56dce)
#   CREATED: Apr/29/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

functions:
#----------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This flow click on the CTA button  from the promotion carousel displayed in home (also known as "Hero POV")
  #              verifiying that the promotion opened it is some PLP screen.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.flows.od.home.openPlpFromPromotionCarousel
    flow:
      - scroll:
         direction: down
         untilIdentifier: mx.mappings.home.promotionsCarouselContainer
         position: center
      - executeFunction:
          name: mx.functions.home.promotions-carousel.tapPlayPauseButton
      - if:
          condition: ${APP_PLATFORM} == 'android'
          then:
            - executeFunction:
                name: mx.functions.home.promotions-carousel.getTotalNumberOfPromotions # RETURN--${totalNumberOfPromotionsCarousel}--
            - scroll:
                direction: right
                withinIdentifier: mx.mappings.home.promotionsCarouselContainer
                untilIdentifier: mx.mappings.home.promotionsCarouselFirstCardView
                scrollLimit: ${totalNumberOfPromotionsCarousel}
          else:
            - storeIn:
                key: totalNumberOfPromotionsCarousel
                value: 9
            - log: 
                message: "DEFAULT: total number of promotions in carousel: ${totalNumberOfPromotionsCarousel} -  set by default only for iOS"
                color: GREEN_BOLD
            - scroll:
                direction: right
                withinIdentifier: mx.mappings.home.promotionsCarouselContainer
                untilIdentifier: mx.mappings.home.promotionsCarouselFirstCardView
      - loop:
          begin: 0
          end: ${totalNumberOfPromotionsCarousel}
          storeIndex: i
          mode: increment
          flow:
            - executeFunction:
                name: mx.functions.home.promotions-carousel.tapCTAButton 
            - executeFunction:
                name: mx.functions.home.plp.isDisplayed # RETURN--${isPlpDisplayed}--
            - if: 
                condition: ${isPlpDisplayed} == false
                then:
                  - log:
                      message: "[WANRN]('${i}') PLP is NOT displayed, return to home and open next promotion in carousel (Hero POV)"
                      color: YELLOW
                  - executeFunction:
                      name: mx.functions.bottom-menu.tapHome
                  - sleep: 
                      duration: 2000
                  - scroll:
                      direction: left
                      withinIdentifier: mx.mappings.home.promotionsCarouselContainer
                      scrollLimit: 1
                else:
                  - log:
                      message: "[Success] PLP is displayed"
                      color: GREEN_BOLD
                  - break: true
      - if:
          condition: ${isPlpDisplayed} == false
          then:
            - failTest:
                message: "Any promotion opended from the Hero POV redirected to a Product List Page (PLP)"
      - log:
          message: "End flow: mx.flows.od.home.openPlpFromPromotionCarousel"
          color: BLUE
            