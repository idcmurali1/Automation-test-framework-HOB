#======================================================================================================================
#    AUTHOR: Francisco Javier Ramírez Hernandez (vn53vq4)
#   CREATED: Mar/13/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

## ANDROID ------------------------------------------------------------------------------------------------------------

  # Description: This function clicks on back button.
  - name: mx.functions.add-card-form.tapBack
    platform: android
    flow:
      - click: 
          identifier: mx.mappings.add-card-form.backButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function clicks on cancel button.
  - name: mx.functions.add-card-form.tapCancel
    platform: android
    flow:
      - click: 
          identifier: mx.mappings.add-card-form.cancelButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters card number.
  # Param ${cardNumber} [Mandatory] Card Number to enter.
  - name: mx.functions.add-card-form.enterCardNumber
    platform: android
    flow:
      - enterText:
          identifier: mx.mappings.add-card-form.cardNumberField
          clickFirst: true
          clearField: true
          string: ${cardNumber}
      - executeFunction:
          name: mx.functions.utils.performActionDone
      - log:
          message: "End function: add-card-form.enterCardNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters card holder name.
  # Param ${cardHolderName} [Mandatory] Card Holder Name to enter.
  - name: mx.functions.add-card-form.enterCardHolderName
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.cardHolderNameField
      - enterText:
          identifier: mx.mappings.add-card-form.cardHolderNameField
          string: ${cardHolderName}

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects expiration date.
  # Param ${expirationDate} [Mandatory] User's card expiration date (Eg. 12/25).
  - name: mx.functions.add-card-form.selectExpirationDate
    platform: android
    flow:
      - enterText:
          identifier: mx.mappings.add-card-form.expirationDateField
          clickFirst: true
          clearField: true
          string: ${expirationDate}
      - executeFunction:
          name: mx.functions.utils.performActionDone
      - log:
          message: "End function: add-card-form.selectExpirationDate"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Documentation: This function hides the keyboard on this page, because the R2 function "hideKeyboard" forces the add card 
  #form popup to close otherwhise the expirationDateButton does not save the expected data.

  - name: mx.functions.add-card-form.hideKeyboard
    platform: android
    flow:
      - executeAppiumScript:
          method: "mobile: performEditorAction"
          params:
            - key: action
              value: done

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters card CVV.
  # Param ${cardCVV} [Mandatory] Card CVV to enter.
  - name: mx.functions.add-card-form.enterCVV
    platform: android
    flow:
      - enterText:
          identifier: mx.mappings.add-card-form.CVVField
          clickFirst: true
          clearField: true
          string: ${cvv}
      - executeFunction:
          name: mx.functions.utils.performActionDone
      - log:
          message: "End function: wallet.enterCVV"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function clicks on add address button.
  - name: mx.functions.add-card-form.tapAddAddress
    platform: android
    flow:
      - if:
          identifier: 
              present: 
                - identifier: mx.mappings.add-card-form.useDeliveryAddressCheckBoxNotChecked
          then:
              - click:
                  identifier: mx.mappings.add-card-form.addAddressButton
          else:
              - if:
                  identifier:
                    present:
                        - identifier: mx.mappings.add-card-form.useDeliveryAddressCheckBoxChecked
                  then:
                      - click:
                          identifier: mx.mappings.add-card-form.useDeliveryAddressCheckBoxChecked
                      - click:
                          identifier: mx.mappings.add-card-form.addAddressButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function clicks on use existing address button.
  - name: mx.functions.add-card-form.tapUseExistingAddress
    platform: android
    flow:
      - if:
          identifier: 
              present: 
                - identifier: mx.mappings.add-card-form.useDeliveryAddressCheckBoxNotChecked
          then:
              - click:
                  identifier: mx.mappings.add-card-form.addAddressButton
              - click:
                  identifier: mx.mappings.add-card-form.useExistingAddressButton
          else:
              - if:
                  identifier:
                    present:
                        - identifier: mx.mappings.add-card-form.useDeliveryAddressCheckBoxChecked
                  then:
                      - click:
                          identifier: mx.mappings.add-card-form.useDeliveryAddressCheckBoxChecked
                      - click:
                          identifier: mx.mappings.add-card-form.addAddressButton
                      - click:
                          identifier: mx.mappings.add-card-form.useExistingAddressButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects MX as country.
  - name: mx.functions.add-card-form.selectCountryAsMX
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.countrySelector
      - click:
          identifier: mx.mappings.add-card-form.optionMX

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects US as country.
  - name: mx.functions.add-card-form.selectCountryAsUS
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.countrySelector
      - click:
          identifier: mx.mappings.add-card-form.optionUS

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters street data.
  # Param ${streetName} [Mandatory] street name to enter.
  - name: mx.functions.add-card-form.enterStreetName
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.calleField
      - enterText:
          identifier: mx.mappings.add-card-form.calleField
          string: ${streetName}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard
          
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters exterior number data.
  # Param ${exteriorNumber} [Mandatory] exterior number to enter.
  - name: mx.functions.add-card-form.enterExteriorNumber
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.exteriorNumField
      - enterText:
          identifier: mx.mappings.add-card-form.exteriorNumField
          string: ${exteriorNumber}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters city data.
  # Param ${cityName} [Mandatory] city name to enter.
  - name: mx.functions.add-card-form.enterCity
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.cityField
      - enterText:
          identifier: mx.mappings.add-card-form.cityField
          string: ${cityName}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters interior number data.
  # Param ${interiorNumber} [Mandatory] interior number to enter.
  - name: mx.functions.add-card-form.enterInteriorNumber
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.interiorNumField
      - enterText:
          identifier: mx.mappings.add-card-form.interiorNumField
          string: ${interiorNumber}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters municipality data.
  # Param ${municipalityName} [Mandatory] municipality name to enter.
  - name: mx.functions.add-card-form.enterMunicipality
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.municipalityField
      - enterText:
          identifier: mx.mappings.add-card-form.municipalityField
          string: ${municipalityName}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard
          
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters state data.
  # Param ${stateName} [Mandatory] city name to enter.
  - name: mx.functions.add-card-form.enterState
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.stateField
      - enterText:
          identifier: mx.mappings.add-card-form.stateField
          string: ${stateName}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters zip code data.
  # Param ${zipCode} [Mandatory] city name to enter.
  - name: mx.functions.add-card-form.enterZipCode
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.zipcodeField
      - enterText:
          identifier: mx.mappings.add-card-form.zipcodeField
          string: ${zipCode}
      - executeFunction:
          name: mx.functions.add-card-form.hideKeyboard

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function tap favorite card checkbox.
  - name: mx.functions.add-card-form.tapFavoriteCardCheckbox
    platform: android
    flow:
      - if:
          identifier: 
              present: 
                - identifier: mx.mappings.add-card-form.favoriteCardCheckBoxChecked
          then:
              - log: "The card is already marked as favorite"
          else:
              - if:
                  identifier:
                    present:
                        - identifier: mx.mappings.add-card-form.favoriteCardCheckBoxNotChecked
                  then:
                      - log: "Marking card as favorite"
                      - click:
                         identifier: mx.mappings.add-card-form.favoriteCardCheckBox

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function tap save.
  - name: mx.functions.add-card-form.tapSave
    platform: android
    flow:
      - click:
          identifier: mx.mappings.add-card-form.saveCardButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function assert page is displayed.
  - name: mx.functions.add-card-form.assertPageDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.add-card-form.pageTitle
            - identifier: mx.mappings.add-card-form.cardNumberField
            - identifier: mx.mappings.add-card-form.calleField
  
  #--------------------------------------------------------------------------------------------------------------------
  # DESCRIPTION: Tap on interior number field to break focus on neighborhood field
  # PARAMS: ${interiorNumber} [Mandatory] User's address int number.
  # AUTHOR: Olga D. González
  - name: mx.functions.add-card-form.tapInteriorNumber
    platform: android
    flow: 
        - click:
            identifier: mx.mappings.add-card-form.interiorNumField
        - executeFunction:
           name: mx.functions.add-card-form.hideKeyboard
        - scroll:
                direction: down
                scrollLimit: 1
                untilIdentifier: mx.mappings.add-card-form.saveCardButton
                wait: 1000
        - log:
           message: "End function: add-card-form.tapInteriorNumber"
           color: BLUE