#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#   CREATED: Dic/05/2022
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

functions:

## ANDROID ------------------------------------------------------------------------------------------------------------

  # Description: Because there is no "Listo" button on this view, this function simulates the pressing of that button
  # by going "back" to the previous page.
  - name: mx.functions.associate-discount.tapDone
    platform: android
    flow:
      - goBack: true

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.tapReload
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.associate-discount.topRightMenuButton
          then:
            - click:
                identifier: mx.mappings.associate-discount.topRightMenuButton
            - click:
                identifier: mx.mappings.associate-discount.reloadButton
          else:
            - scroll:
                direction: up
                scrollLimit: 1
            - click:
                identifier: mx.mappings.associate-discount.topRightMenuButton
            - click:
                identifier: mx.mappings.associate-discount.reloadButton  

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters the associate's number.
  # Params: ${associateNumber}  [Mandatory]  Associate number to enter.
  - name: mx.functions.associate-discount.enterAssociateNumber
    platform: android
    flow:
      - enterText:
          identifier: mx.mappings.associate-discount.associateNumberField
          string: ${associateNumber}
      - hideKeyboard: true

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the associate's joined date.
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.selectJoinedDate
    platform: android
    flow:
      - log: "Associate joined date: ${associateJoinedDate}."
      - click:
          identifier: mx.mappings.associate-discount.joinedDateField
      - executeFunction:
          name: mx.functions.associate-discount.calendar-pop-up.selectYear
      - executeFunction:
          name: mx.functions.associate-discount.calendar-pop-up.selectMonth
      - executeFunction:
          name: mx.functions.associate-discount.calendar-pop-up.selectDay
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.establecerButton

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.tapSave
    platform: android
    flow:
      - click:
          identifier: mx.mappings.associate-discount.saveButton

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.assertPageDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.associate-discount.pageTitle
            - identifier: mx.mappings.associate-discount.linkAssociateForm
            - identifier: mx.mappings.associate-discount.associateNumberField
            - identifier: mx.mappings.associate-discount.joinedDateField
            - identifier: mx.mappings.associate-discount.saveButton
  
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the year of the associate's joined date in this format: "dd/mm/yyyy".
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.calendar-pop-up.selectYear
    platform: android
    flow:
      - executeNode:
          file: mx/test/helpers/associate-discount/getDateSegment.js
          args:
            - value: ${associateJoinedDate}
            - value: "Year"
          getResponse:
            storeIn: associateJoinedYear
      - log: "Associate joined year: ${associateJoinedYear}"
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.selectYearButton
      - if:
          identifier:
            present:
              - identifier: mx.mappings.associate-discount.calendar-pop-up.associateJoinedYear
          then:
            - click:
                identifier: mx.mappings.associate-discount.calendar-pop-up.associateJoinedYear
          else:
            - scroll:
                direction: up
                untilIdentifier: mx.mappings.associate-discount.calendar-pop-up.associateJoinedYear
                scrollLimit: 10
            - click:
                identifier: mx.mappings.associate-discount.calendar-pop-up.associateJoinedYear

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the month of the associate's joined date in this format: "dd/mm/yyyy".
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.calendar-pop-up.selectMonth
    platform: android
    flow:
      - executeNode:
          file: mx/test/helpers/associate-discount/getDateSegment.js
          args:
            - value: ${associateJoinedDate}
            - value: "Month-Android"
          getResponse:
            storeIn: associateJoinedMonth
      - log: "Associate joined month: ${associateJoinedMonth}"
      - loop:
          begin: 0
          end: 12
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.associate-discount.calendar-pop-up.firstDayContainingAssociateJoinedMonth
                then:
                  - log: "Associate joined month: ${associateJoinedMonth}, has been selected."
                  - break: true
                else:
                  - log: "Associate joined month not selected, verifying previous month..."
                  - click:
                      identifier: mx.mappings.associate-discount.calendar-pop-up.previousMonthButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the day of the associate's joined date in this format: "dd/mm/yyyy".
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.calendar-pop-up.selectDay
    platform: android
    flow:
      - executeNode:
          file: mx/test/helpers/associate-discount/getDateSegment.js
          args:
            - value: ${associateJoinedDate}
            - value: "Day"
          getResponse:
            storeIn: associateJoinedDay
      - log: "Associate joined day: ${associateJoinedDay}"
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.dayOnCalendarByText
