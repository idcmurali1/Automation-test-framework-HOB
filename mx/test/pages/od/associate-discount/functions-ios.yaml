#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#   CREATED: Dic/05/2022
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

functions:

## IOS ----------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.tapDone
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.associate-discount.doneButton

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.tapReload
    platform: ios
    flow:
      - scroll:
          direction: up
          scrollLimit: 1
      - click:
          identifier: mx.mappings.associate-discount.reloadButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function enters the associate's number.
  # Params: ${associateNumber}  [Mandatory]  Associate number to enter.
  - name: mx.functions.associate-discount.enterAssociateNumber
    platform: ios
    flow:
      - enterText:
          identifier: mx.mappings.associate-discount.associateNumberField
          string: ${associateNumber}

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.tapSave
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.associate-discount.saveButton

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.associate-discount.assertPageDisplayed
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.associate-discount.pageTitle
            - identifier: mx.mappings.associate-discount.linkAssociateForm
            - identifier: mx.mappings.associate-discount.associateNumberField
            - identifier: mx.mappings.associate-discount.joinedDateField
            - identifier: mx.mappings.associate-discount.saveButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the associate's joined date.
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.selectJoinedDate
    platform: ios
    flow:
      - log: "Associate joined date: ${associateJoinedDate}."
      - click:
          identifier: mx.mappings.associate-discount.joinedDateField
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.selectYearMonthButton
      - executeFunction:
          name: mx.functions.associate-discount.calendar-pop-up.selectYear
      - executeFunction:
          name: mx.functions.associate-discount.calendar-pop-up.selectMonth
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.hideYearMonthSelectorButton
      - executeFunction:
          name: mx.functions.associate-discount.calendar-pop-up.selectDay
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.listoButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the year of the associate's joined date in this format: "dd/mm/yyyy".
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.calendar-pop-up.selectYear
    platform: ios
    flow:
      - executeNode:
          file: mx/test/helpers/associate-discount/getDateSegment.js
          args:
            - value: ${associateJoinedDate}
            - value: "Year"
          getResponse:
            storeIn: associateJoinedYear
      - log: "Associate joined year: ${associateJoinedYear}"
      - loop:
          begin: 0
          end: 30
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.associate-discount.calendar-pop-up.pickerWheelYearToFind
                then:
                  - log: "Associate joined year: ${associateJoinedYear}, has been selected."
                  - break: true
                else:
                  - log: "Associate joined year not selected, verifying previous year..."
                  - click:
                      identifier: mx.mappings.associate-discount.calendar-pop-up.pickerWheelYear
                      coordinates: 50%,40%

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the month of the associate's joined date in this format: "dd/mm/yyyy".
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.calendar-pop-up.selectMonth
    platform: ios
    flow:
      - executeNode:
          file: mx/test/helpers/associate-discount/getDateSegment.js
          args:
            - value: ${associateJoinedDate}
            - value: "Month-iOS"
          getResponse:
            storeIn: associateJoinedMonth
      - log: "Associate joined month: ${associateJoinedMonth}"
      - loop:
          begin: 0
          end: 12
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.associate-discount.calendar-pop-up.pickerWheelMonthToFind
                then:
                  - log: "Associate joined month: ${associateJoinedMonth}, has been selected."
                  - break: true
                else:
                  - log: "Associate joined month not selected, verifying previous month..."
                  - click :
                      identifier: mx.mappings.associate-discount.calendar-pop-up.pickerWheelMonth
                      coordinates: 50%,40%

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects the day of the associate's joined date in this format: "dd/mm/yyyy".
  # Params: ${associateJoinedDate}  [Mandatory]  Associate joined date to enter ("dd/mm/yyyy").
  - name: mx.functions.associate-discount.calendar-pop-up.selectDay
    platform: ios
    flow:
      - executeNode:
          file: mx/test/helpers/associate-discount/getDateSegment.js
          args:
            - value: ${associateJoinedDate}
            - value: "Day"
          getResponse:
            storeIn: associateJoinedDay
      - log: "Associate joined day: ${associateJoinedDay}"
      - click:
          identifier: mx.mappings.associate-discount.calendar-pop-up.dayOnCalendarByName
