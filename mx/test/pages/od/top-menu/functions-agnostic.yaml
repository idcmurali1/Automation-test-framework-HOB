#======================================================================================================================
#  AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#  CREATED: Oct/20/2022
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # Description: This function enters text in the search field.
  # Param: ${searchTerm}  [Mandatory]  Partial product name to find.
  - name: mx.functions.top-menu.enterSearchTerm
    flow:
      - log:
          message: "Search Term: ${searchTerm}"
          color: CYAN
      - enterText:
          identifier: mx.mappings.top-menu.searchField
          string: ${searchTerm}
      - log:
          message: "End function: top-menu.enterSearchTerm"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: Asserts the Cart Button Quantity Counter Badge equals the given expected quantity.
  # Param: ${expectedQuantity} [Mandatory] Expected quantity of the Quantity Counter Badge.
  - name: mx.functions.top-menu.assertCartQuantity
    flow:
      - log:
          message: "Expected Quantity: ${expectedQuantity}"
          color: CYAN
      - if:
          condition: ${APP_PLATFORM} == 'android'
          then:
            - if:
                condition: ${expectedQuantity} == 0
                then:
                  - if:
                      identifier:
                        text:
                          - identifier: mx.mappings.top-menu.cartBadgeCounter
                            equals: "0"
                      then:
                        - log:
                            message: "Success: Cart is Empty."
                            color: CYAN
                      else:
                        - failTest:
                            message: "Cart is not Empty."
                else:
                  - if:
                      identifier:
                        text:
                          - identifier: mx.mappings.top-menu.cartBadgeCounter
                            equals: ${expectedQuantity}
                      then:
                        - log:
                            message: "Success: Correct Cart icon quantity."
                            color: CYAN
                      else:
                        - getString:
                            identifier: mx.mappings.top-menu.cartBadgeCounter
                            attribute: text
                            storeIn: displayedCartBadgeQuantity
                        - failTest:
                            message: "Expected quantity: ${expectedQuantity}, did not match displayed quantity: ${displayedCartBadgeQuantity}."
          else:
            - if:
                condition: ${expectedQuantity} == 0
                then:
                  - if:
                      identifier:
                        label:
                          - identifier: mx.mappings.top-menu.cartBadgeCounter
                            equals: "0"
                      then:
                        - log:
                            message: "Success: Cart is Empty."
                            color: CYAN
                      else:
                        - failTest:
                            message: "Cart is not Empty."
                else:
                  - if:
                      identifier:
                        label:
                          - identifier: mx.mappings.top-menu.cartBadgeCounter
                            equals: ${expectedQuantity}
                      then:
                        - log:
                            message: "Success: Correct Cart icon quantity."
                            color: CYAN
                      else:
                        - getString:
                            identifier: mx.mappings.top-menu.cartBadgeCounter
                            attribute: label
                            storeIn: displayedCartBadgeQuantity
                        - failTest:
                            message: "Expected quantity: ${expectedQuantity}, did not match displayed quantity: ${displayedCartBadgeQuantity}."
      - log:
          message: "End function: top-menu.assertCartQuantity"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  # Description: Clicks the back button to navigate to the store selection page.
  - name: mx.functions.top-menu.tapBack
    flow:
      - click:
          identifier: mx.mappings.top-menu.backButton

  # -------------------------------------------------------------------------------------------------------------------

  # This method clicks on the cart icon
  - name: mx.functions.top-menu.tapCartIcon
    flow:
      - click:
          identifier: mx.mappings.top-menu.cartIcon
      - log:
          message: "End function: top-menu.tapCartIcon"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.top-menu.tapSearchField
    flow:
      - click:
          identifier: mx.mappings.top-menu.searchField
      - log:
          message: "End function: top-menu.tapSearchField"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: Taps the Search button in the keyboard to complete the search. In the case of iOS, if the keyboard is
  #   not visible, it will press Enter to complete the search.
  # AUTHOR: Rodrigo Pacheco (xxxxx)
  # EDITOR: Sergio Fernandez (vn0t1qt)
  - name: mx.functions.top-menu.tapSearchInKeyboard
    flow:
      - if:
          condition: ${APP_PLATFORM} == 'android'
          then:
            - executeFunction:
                name: mx.functions.utils.performActionSearch
          else:
            - getString:
                identifier: mx.mappings.top-menu.searchKey
                attribute: visible
                storeIn: isVisible
            - if:
                condition: ${isVisible} == false
                then:
                  - enterText:
                      identifier: mx.mappings.top-menu.searchKey
                      string: ''
                      pressEnter: true
                else:
                  - click:
                      identifier: mx.mappings.top-menu.searchKey
      - log:
          message: "End function: top-menu.tapSearchInKeyboard"
          color: BLUE
