#======================================================================================================================
#  AUTHOR: Octavio Cabrales Zárate (vn53g23)
#  CREATED: Feb/06/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # Description: This method asserts if wallet page is displayed
  - name: mx.functions.wallet.assertPageDisplayed
    platform: android
    flow: 
      - verifyIdentifier: 
          present:
            - identifier: mx.mappings.wallet.pageTitle
            - identifier: mx.mappings.wallet.paymentMethodsContainer
            - identifier: mx.mappings.wallet.otherPaymentMethodsContainer
            - identifier: mx.mappings.wallet.backButton
      - executeFunction:
          name: mx.functions.utils.searchItemInPage
          params:
            - name: elementToFind 
              string: mx.mappings.wallet.associateDiscountContainer

  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method taps close Button.
  - name: mx.functions.wallet.tapClose
    platform: android
    flow: 
      - click:  
          identifier: mx.mappings.wallet.closeButton
      - log:
          message: "End Function: wallet.tapClose"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method scrolls down to pay at delivery section.
  - name: mx.functions.wallet.scrollDownToPayAtDelivery
    platform: android
    flow:
      - scroll:
          direction: down
          scrollLimit: 3
          wait: 1000
          position: center
          untilIdentifier: mx.mappings.wallet.payAtDeliveryContainer
      - log:
          message: "End Function: wallet.scrollDownToPayAtDelivery"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method asserts pay at delivery is not available (alert is displayed).
  - name: mx.functions.wallet.assertPayAtDeliveryNotAvailable
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.wallet.payAtDeliveryAlertNotAvailable
      - log:
          message: "Pay at delivery is not available!"
          color: CYAN
      - log:
          message: "End function: wallet.assertPayAtDeliveryNotAvailable"
          color: BLUE



  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method asserts Credit/ Debit card was added. (Listed in card container)
  # Param ${last4Digits} [Mandatory] Last 4 digits of the CC/DC.
  - name: mx.functions.wallet.assertCardAddedByLast4Digits
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.wallet.add-card.cardAddedByLast4Digits
          then:
            - log: 
                message: Card ${last4Digits} added.
                color: CYAN
          else:
            - scroll:
                direction: left
                scrollLimit: 2
                untilIdentifier: mx.mappings.wallet.add-card.cardAddedByLast4Digits
                withinIdentifier: mx.mappings.wallet.add-card.cardsContainer
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.wallet.add-card.cardAddedByLast4Digits 
                then:     
                 - log: 
                    message: Card ${last4Digits} added.  
                    color: CYAN
                else:
                    - scroll:
                        direction: left
                        scrollLimit: 2
                        untilIdentifier: mx.mappings.wallet.add-card.cardAddedByLast4Digits
                        withinIdentifier: mx.mappings.wallet.add-card.cardsContainer
                    - if:
                        identifier:
                          present:
                             - identifier: mx.mappings.wallet.add-card.cardAddedByLast4Digits
                        then:
                            - log: 
                                message: Card ${last4Digits} added.  
                                color: CYAN
      - log: 
          message: "End function: wallet.assertCardAdded"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters user's card name.
  # Param: ${cardName} [Mandatory] User's full name.
  - name: mx.functions.wallet.enterCardName
    platform: android
    flow: 
        - enterText:
            identifier: mx.mappings.wallet.add-card.cardName
            clearField: true
            clickFirst: true
            string: ${cardName}
        - executeFunction:
            name: mx.functions.utils.performActionDone
        - log:
           message: "End function: wallet.enterCardName"
           color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method selects country option.
  # Param: ${country} [Mandatory] User's country selection.
  - name: mx.functions.wallet.selectCountry
    platform: android
    flow: 
        - click:
            identifier: mx.mappings.wallet.add-card.countryField
        - click:
            identifier: mx.mappings.wallet.add-card.countryOption
        - log:
           message: "End function: wallet.selectCountry"
           color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters user's address.
  # Param: ${userAddress} [Mandatory] User's address.
  - name: mx.functions.wallet.enterAddress
    platform: android
    flow: 
       - enterText:
          identifier: mx.mappings.wallet.add-card.addressField
          string: ${userAddress}
          clickFirst: true
          clearField: true
       - executeFunction:
            name: mx.functions.utils.performActionDone
       - log:
           message: "End function: wallet.enterAddress"
           color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters user's address exterior number.
  # Param: ${addressNumber} [Mandatory] User's address ext number.
  - name: mx.functions.wallet.enterExteriorNumber
    platform: android
    flow: 
        - enterText:
            identifier: mx.mappings.wallet.add-card.addressNumberField
            clickFirst: true
            clearField: true
            string: ${addressNumber}
        - executeFunction:
            name: mx.functions.utils.performActionDone
        - log:
           message: "End function: wallet.enterAddress"
           color: BLUE
  
  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters user's city.
  # Param: ${city} [Mandatory] User's city.
  - name: mx.functions.wallet.enterCity
    platform: android
    flow: 
       - enterText:
          identifier: mx.mappings.wallet.add-card.cityField
          clickFirst: true
          clearField: true
          string: ${city}
       - executeFunction:
          name: mx.functions.utils.performActionDone
       - log:
           message: "End function: wallet.enterCity"
           color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters user's colony
  # Param: ${colony} [Mandatory] User's colony.
  - name: mx.functions.wallet.enterColony
    platform: android
    flow: 
        - enterText:
            identifier: mx.mappings.wallet.add-card.colonyField
            clearField: true
            clickFirst: true
            string: ${colony}
        - executeFunction:
            name: mx.functions.utils.performActionDone
        - log:
            message: "End function: wallet.enterColony"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters use's municipality
  # Param: ${municipality} [Mandatory] User's municipality.
  - name: mx.functions.wallet.enterMunicipality
    platform: android
    flow: 
        - enterText:
            identifier: mx.mappings.wallet.add-card.municipalityField
            clickFirst: true
            clearField: true
            string: ${municipality}
        - executeFunction:
            name: mx.functions.utils.performActionDone
        - log:
            message: "End function: wallet.enterMunicipality"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters use's municipality
  # Param: ${state} [Mandatory] User's State.
  - name: mx.functions.wallet.enterState
    platform: android
    flow: 
         - enterText:
            identifier: mx.mappings.wallet.add-card.stateField
            clearField: true
            clickFirst: true
            string: ${state}
         - executeFunction:
            name: mx.functions.utils.performActionDone
         - log:
            message: "End function: wallet.enterState"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method enters use's municipality
  # Param: ${zipCode} [Mandatory] User's Zip code.
  - name: mx.functions.wallet.enterZipCode
    platform: android
    flow: 
        - enterText:
            identifier: mx.mappings.wallet.add-card.zipCodeField
            clearField: true
            clickFirst: true
            string: ${zipCode}       
        - executeFunction:
            name: mx.functions.utils.performActionDone
        - log:
            message: "End function: wallet.enterZipcode"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method taps on save button
  - name: mx.functions.wallet.tapSave
    platform: android
    flow:
        - scroll:
            untilIdentifier: mx.mappings.wallet.add-card.saveButton
            direction: down
        - click:
             identifier: mx.mappings.wallet.add-card.saveButton
        - log:
            message: "End function: wallet.tapSave"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method asserts a card was added successfully. (recently added)
  - name: mx.functions.wallet.assertCardAdded
    platform: android
    flow: 
        - verifyIdentifier:
            present:
                - identifier: mx.mappings.wallet.add-card.cardLast4Digits
        - log:
            message: "End function: wallet.assertCardAdded"
            color: BLUE

   #--------------------------------------------------------------------------------------------------------------------
   
    # Description: This method scroll to card with last 4 digits.
    # Param: ${last4Digits} [Mandatory] User's card last 4 digits
  - name: mx.functions.wallet.scrollToCardWithLast4Digits
    platform: android
    flow: 
        - scroll:
            direction: right
            scrollLimit: 5
            untilIdentifier: mx.mappings.wallet.add-card.cardLast4Digits
            withinIdentifier: mx.mappings.wallet.add-card.cardsContainer
        - if:
            identifier:
              present:
                - identifier: mx.mappings.wallet.add-card.cardLast4Digits
            then:
              - log:
                 message: "Card with termination: ${last4Digits} displayed."
                 color: CYAN
            else:
                 - scroll:
                    direction: left
                    untilIdentifier: mx.mappings.wallet.add-card.cardLast4Digits
                    withinIdentifier: mx.mappings.wallet.add-card.cardsContainer
                    scrollLimit: 5
                 - verifyIdentifier:
                    present:
                      - identifier: mx.mappings.wallet.add-card.cardLast4Digits
        - log:
            message: "End function: wallet.scrollToCardWithLast4Digits"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method opens "edit card" by last 4 digits termination.
  # Param: ${last4Digits} [Mandatory] User's card last 4 digits
  - name: mx.functions.wallet.tapEditCardWithLast4Digits
    platform: android
    flow: 
        - click:
            identifier: mx.mappings.wallet.add-card.editCardWithLast4Digits
        - log:
            message: "End function: wallet.editCardWithLast4Digits"
            color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
   
  # Description: This method selects a card by last 4 digits termination.
  # Param: ${last4DigitsTermination} [Mandatory] User's card last 4 digits termination (E.g: x x x x)
  - name: mx.functions.wallet.edit-card.selectCardByLast4Digits
    platform: android
    flow: 
        - click:
            identifier: mx.mappings.wallet.edit-card.cardWithLast4DigitsTerminationRadioButton
        - log:
            message: "End function: wallet.edit-card.selectCardByLast4Digits"
            color: BLUE
  
  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on Continue Button.
  - name: mx.functions.wallet.tapContinue
    platform: android
    flow: 
      - click:  
          identifier: mx.mappings.wallet.edit-card.tapContinueButton
      - log:
          message: "End Function: wallet.tapContinue"
          color: BLUE
  
  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method validate card is not added previously.
  # Returns: ${paymentAlreadyAdded} [boolean]
  # Author: Francisco Ramirez vn53vq4)
  - name: mx.functions.wallet.isCardDisplayedWallet
    platform: android
    flow: 
      - if:
         identifier:
            present:
              - identifier: mx.mappings.wallet.editCardButton
         then:
            - storeIn:
                key: paymentAlreadyAdded # --> ${paymentAlreadyAdded}
                value: true
            - log:
                message: "Card already added!.."
                color: CYAN
         else:
            - storeIn:
                key: paymentAlreadyAdded  # --> ${paymentAlreadyAdded}
                value: false
            - log:
                message: "No card found in wallet!"
                color: CYAN
      - log:
          message: "End Function: wallet.isCardInWallet"
          color: BLUE
  
  # -------------------------------------------------------------------------------------------------------------------
  # Description: This method removes card(s) from wallet (Limited to Max. 5 cards)
  # Author: Francisco Ramirez vn53vq4)
  - name: mx.functions.wallet.removeExistingCard/loop
    platform: android
    flow: 
        - loop:
            begin: 0
            end: 5
            storeIndex: index
            flow:
            - log:
                message: Trying to remove cards ${index}...
                color: GREEN
            # Remove cards if displayed
            - if:
                identifier:
                    present:
                    - identifier: mx.mappings.wallet.editCardButton
                then:
                    # Remove item if any...
                    - try:
                        flow:
                            - click:
                                identifier: mx.mappings.wallet.editCardButton
                            - sleep:
                                duration: 2000
                            - click:
                                identifier: mx.mappings.wallet.edit-card.removeCardButton
                            - click:
                                identifier: mx.mappings.wallet.edit-card.confirmButton
                            - sleep:
                                duration: 3000
                            - log:
                                message: ✓ Card removed. Loop will continue looking for more items to remove.
                                color: GREEN
                            # Happy path to reload wallet page and re-activate edit button.    
                            - click:
                                identifier: mx.mappings.bottom-menu.homeButton
                            - sleep:
                                duration: 2000
                            - click:
                                identifier: mx.mappings.bottom-menu.accountButton
                            - sleep:
                                duration: 4000
                        catch:
                            flow:
                            - log:
                                message: "[!] No cards found to remove. Process will continue."
                                color: CYAN
                else: 
                    - log:
                        message: No cards found to remove. Process completed! ✓
                        color: GREEN
                    - break: true
        - log:
            message: "End Function: wallet.removeExistingCard/loop"
            color: BLUE