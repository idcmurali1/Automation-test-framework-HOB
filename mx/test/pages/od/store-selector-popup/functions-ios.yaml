#======================================================================================================================
#  AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#  CREATED: Feb/10/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # Description: This method taps on Back button
  - name: mx.functions.store-selector-popup.tapBack
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.store-selector-popup.backButton

  # -------------------------------------------------------------------------------------------------------------------- 

  # Description: This method taps on Close button
  - name: mx.functions.store-selector-popup.tapClose
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.store-selector-popup.closeButton
               
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method clears zip code field
  - name: mx.functions.store-selector-popup.clearCurrentZipCode
    platform: ios
    flow:
      - enterText:
          identifier: mx.mappings.store-selector-popup.zipcodeField
          string: ""
          clearField: true
      - executeFunction:
          name: mx.functions.store-selector-popup.clickListoButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method clicks on Listo buttton from Keyboard
  - name: mx.functions.store-selector-popup.tapListoButton
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.store-selector-popup.doneKeyboardButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on use current location buttton
  - name: mx.functions.store-selector-popup.tapUseCurrentLocation
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.store-selector-popup.useCurrentLocationButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects a store by position
  # Param ${storeIndex} [Mandatory] Store index
  - name: mx.functions.store-selector-popup.selectStoreByPosition
    platform: ios
    flow:
      - log: 
          message: "Selecting a store with index: ${storeIndex}"
          color: CYAN
      - click:
          identifier: mx.mappings.store-selector-popup.storeByIndex
      - executeFunction:
          name: mx.functions.store-selector-popup.tapSave
      - sleep:
          duration: 5000
      - executeFunction:
          name: mx.functions.store-selector-popup.tapRetryLaterIfDisplayed
      - log:
          message: "End function: store-selector-popup.selectStoreByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects a store by position
  # Param ${storeIndex} [Mandatory] Store index
  # Author: Gustavo Antonio López Cambambia (vn53g21)
  - name: mx.functions.store-selector-popup.selectStoreByPositionWhitoutTappingSave
    platform: ios
    flow:
      - log: 
          message: "Selecting a store with index: ${storeIndex}"
          color: CYAN
      - click:
          identifier: mx.mappings.store-selector-popup.storeByIndex

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects a store by position
  # Param ${storeIndex} [Mandatory] Store index
  - name: mx.functions.store-selector-popup.selectRandomStore
    platform: ios
    flow:
      - loop:
           begin: 0
           end: 20      
           storeIndex: j
           mode: increment
           flow:
            - executeNode:
                  file: mx/test/helpers/utils/getRandomInt.js
                  args:
                    - value: 0
                    - value: 5
                  getResponse:
                    storeIn: storeIndex
            - log: 
               message: "Looking for a store with index: ${storeIndex}"
               color: WHITE_BOLD
            - if:
                identifier:
                    present:
                      - identifier: mx.mappings.store-selector-popup.storeByIndex                      
                then:
                    - log:
                          message: "Store with index: ${storeIndex} was found!"
                          color: CYAN
                    - click:
                        identifier: mx.mappings.store-selector-popup.storeByIndex
                    - break: true
                else:
                  - log:
                     message: "Store with index: ${storeIndex} was not found, generating a new random index!"
                     color: YELLOW_BOLD_BRIGHT

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects the first OD Walmart store available
  - name: mx.functions.store-selector-popup.selectFirstODStore
    platform: ios
    flow:
      - loop:
          begin: 1
          end: 3
          storeIndex: odRandomStoreIndex
          mode: increment
          flow:
            - if: 
                identifier:
                  present:
                    - identifier: mx.mappings.store-selector-popup.odStoreByIndex
                then:
                  - log:
                      message: Selecting first OD store available!
                      color: CYAN
                  - click:
                      identifier: mx.mappings.store-selector-popup.odStoreByIndex
                  - break: true
                else:
                    - scroll:
                        direction: down
                        untilIdentifier: mx.mappings.store-selector-popup.odStore
                        withinIdentifier: mx.mappings.address-selector-popup.addressesContainer
                        position: center
                    - click:
                        identifier: mx.mappings.address-selector-popup.firstODStore
      - log:
          message: "End function: mx.functions.store-selector-popup.selectFirstODStore"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  
  # Description: This method selects the first XP Walmart store available
  - name: mx.functions.store-selector-popup.selectFirstXPStore
    platform: ios
    flow:
      - log: 
          message: "Selecting the first XP Walmart Store available"
          color: CYAN
      - click:
          identifier: mx.mappings.store-selector-popup.xpStore
      - log: 
          message: "XP Walmart Store selected!"
          color: CYAN

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects a random OD Walmart store
  - name: mx.functions.store-selector-popup.selectRandomODStore
    platform: ios
    flow:
      - loop:
           begin: 0
           end: 20      
           storeIndex: j
           mode: increment
           flow:
            - executeNode:
                  file: mx/test/helpers/utils/getRandomInt.js
                  args:
                    - value: 0
                    - value: 4
                  getResponse:
                    storeIn: odRandomStoreIndex
            - log: 
               message: "Looking for an OD walmart store with index: ${odRandomStoreIndex}"
               color: WHITE_BOLD
            - if:
                identifier:
                    present:
                      - identifier: mx.mappings.store-selector-popup.odStoreByIndex
                then:
                    - log:
                          message: "OD Walmart Store found! Selecting store with index: ${odRandomStoreIndex}"
                          color: CYAN
                    - click:
                        identifier: mx.mappings.store-selector-popup.odStoreByIndex
                    - break: true
                else:
                  - log:
                     message: "There is no OD Walmart store with index: ${odRandomStoreIndex}, trying with the next random store index!"
                     color: YELLOW_BOLD_BRIGHT

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects a random XP Walmart store
  - name: mx.functions.store-selector-popup.selectRandomXPStore
    platform: ios
    flow:
      - loop:
           begin: 0
           end: 20      
           storeIndex: j
           mode: increment
           flow:
            - executeNode:
                  file: mx/test/helpers/utils/getRandomInt.js
                  args:
                    - value: 0
                    - value: 4
                  getResponse:
                    storeIn: xpRandomStoreIndex
            - log: 
               message: "Looking for an OD walmart store with index: ${xpRandomStoreIndex}"
               color: WHITE_BOLD
            - if:
                identifier:
                    present:
                      - identifier: mx.mappings.store-selector-popup.xpStoreByIndex
                then:
                    - log:
                          message: "OD Walmart Store found! Selecting store with index: ${xpRandomStoreIndex}"
                          color: CYAN
                    - click:
                        identifier: mx.mappings.store-selector-popup.xpStoreByIndex
                    - break: true
                else:
                  - log:
                     message: "There is no OD Walmart store with index: ${xpRandomStoreIndex}, trying with the next random store index!"
                     color: YELLOW_BOLD_BRIGHT

  #--------------------------------------------------------------------------------------------------------------------

  # RETURNS: ${returnedStoreName}
  # AUTHOR: ???
  # EDITOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.store-selector-popup.getSelectedStoreName
    platform: ios
    flow:
      - getString:
          identifier: mx.mappings.store-selector-popup.selectedStoreName
          attribute: label
          storeIn: returnedStoreName
      - log:
          message: "Returned Store Name: ${returnedStoreName}"
          color: CYAN
      - log:
          message: "End function: store-selector-popup.getSelectedStoreName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # RETURNS: ${returnedStoreAddress}
  # AUTHOR: ???
  # EDITOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.store-selector-popup.getSelectedStoreAddress
    platform: ios
    flow:
      - getString:
          identifier: mx.mappings.store-selector-popup.selectedStoreAddress
          attribute: label
          storeIn: returnedStoreAddress
      - log:
          message: "Returned Store Address: ${returnedStoreAddress}"
          color: CYAN
      - log:
          message: "End function: store-selector-popup.getSelectedStoreAddress"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # RETURNS: ${returnedBanner}
  # AUTHOR: ???
  # EDITOR: Rodrigo Pacheco (vn53p0i)
  # RETURNS: ${returnedBanner}
  - name: mx.functions.store-selector-popup.getSelectedStoreBanner
    platform: ios
    flow:
      - getString:
          identifier: mx.mappings.store-selector-popup.selectedStoreBanner
          attribute: label
          storeIn: returnedBanner
      - log:
          message: "Returned Banner: ${returnedBanner}"
          color: CYAN
      - log:
          message: "End function: store-selector-popup.getSelectedStoreBanner"
          color: BLUE

 #--------------------------------------------------------------------------------------------------------------------

  # Description: This method scrolls up to store with name.
  # Param ${storeName} [Mandatory] Store name
  - name: mx.functions.store-selector-popup.scrollUpToStore
    platform: ios
    flow:
       - log:
          message: "Scrolling up until find the store with name: ${storeName}"
          color: CYAN  
       - loop:
           begin: 0
           end: 20      
           storeIndex: j
           mode: increment
           flow:
              - if:
                  identifier:
                      visible:
                        - identifier: mx.mappings.store-selector-popup.storeByName
                          value: "true"
                  then: 
                    - log:
                        message: "Walmart Store with name: ${storeName} was found!"
                        color: CYAN
                    - break: true
                  else:
                        - drag:
                            from:
                              x: 16
                              y: 271
                            to:
                              x: 388
                              y: 511

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method scrolls down to store with name.
  # Param ${storeName} [Mandatory] Store name
  - name: mx.functions.store-selector-popup.scrollDownToStore
    platform: ios
    flow:
      - log:
          message: "Scroll down until find store with name: ${storeName}"
          color: CYAN
      - scroll:
          direction: down
          untilIdentifier: mx.mappings.store-selector-popup.storeByName
          withinIdentifier: mx.mappings.store-selector-popup.storeListContainer
          scrollLimit: 8
          position: center
      - log:
          message: "Walmart Store with name: ${storeName} was found!"
          color: CYAN

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Francisco Ramirez (vn53vq4)
  - name: mx.functions.store-selector-popup.tapRetryLaterIfDisplayed
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.store-selector-popup.retryLaterButton
          then:
            - click:
                identifier: mx.mappings.store-selector-popup.retryLaterButton
      - log:
          message: "End function: store-selector-popup.tapRetryLaterIfDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: ?????
  # EDITOR: Sergio Fernandez (vn0t1qt)
  - name: mx.functions.store-selector-popup.tapSave
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.store-selector-popup.saveChooseButton
          coordinates: 75%, 75%
      - log:
          message: "End function: store-selector-popup.tapSave"
          color: BLUE