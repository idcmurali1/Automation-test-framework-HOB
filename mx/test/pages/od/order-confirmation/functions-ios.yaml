#======================================================================================================================
#  AUTHOR: Isis Rojas Tolentino (vn53dge)
#  CREATED: Mar/13/2023
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # PARAMS:  ${storeAddress}  [Mandatory]  Store Address.
  # AUTHOR: Isis Rojas (-----)
  # EDITOR: Sergio Fernandez (vn0t1qt)
  - name: mx.functions.order-confirmation.assertStoreAddress
    platform: ios
    flow:
      - log:
          message: '[ PARAM: Expected Store Address: "${storeAddress}"]'
          color: CYAN 
      - verifyIdentifier:
          label:
            - identifier: mx.mappings.order-confirmation.storeAddress
              equals: ${storeAddress}
      - log:
          message: 'End function: mx.functions.order-confirmation.assertStoreAddress'
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method asserts the banner
  # Params: ${banner}  [Mandatory] This param should have values like OD or Walmart Express
  - name: mx.functions.order-confirmation.assertBanner
    platform: ios
    flow: 
      - if:
          condition: ${banner} == 'Walmart Express'
          then:
            - verifyIdentifier:
                present:
                  - identifier: mx.mappings.order-confirmation.bannerLabel
  
  # -------------------------------------------------------------------------------------------------------------------
  
  # PARAMS:  ${expectedStoreAddressName}  [Mandatory]  Store Name.
  # AUTHOR: Isis Rojas (-----)
  # EDITOR: Sergio Fernandez (vn0t1qt)
  - name: mx.functions.order-confirmation.assertStoreAddressName
    platform: ios
    flow:
      - log:
          message: '[ PARAM: Expected Store Address Name: "${expectedStoreAddressName}"]'
          color: CYAN 
      - verifyIdentifier:
          label:
            - identifier: mx.mappings.order-confirmation.storeName
              contains: ${expectedStoreAddressName}
      - log:
          message: 'End function: mx.functions.order-confirmation.assertStoreAddressName'
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method asserts if an agent is sent
  - name: mx.functions.order-confirmation.assertDeliveryAgentMessageDisplayed
    platform: ios
    flow: 
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.order-confirmation.deliveryAgent

  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method asserts if the product image is displayed
  # Params: ${productByName} [Mandatory] Product name
  - name: mx.functions.order-confirmation.assertProductImagesDisplayed
    platform: ios
    flow: 
      - verifyIdentifier:
          label:
            - identifier: mx.mappings.order-confirmation.productImage
              contains: ${productByName}

   #--------------------------------------------------------------------------------------------------------------------

  # Description: This function compares the expected store address and the address displayed in Order confirmation page.
  # Params: ${expectedStoreAddress} [Mandatory] Store address
  # # AUTHOR: Gustavo Antonio López Cambambia (vn53g21)
  - name: mx.functions.order-confirmation.compareAddresses
    platform: ios
    flow:
      # Retrieving and cleaning expected value...
      - log:
          message: "Expected Store Address to be displayed: ${expectedStoreAddress}"
          color: CYAN
      - executeNode:
          file: mx/test/helpers/utils/stringToLowerCase
          args:
            - value: ${expectedStoreAddress}
          getResponse:
            storeIn: expectedStoreAddress
      - log:
          message: "Parsed Store Address to be displayed: ${expectedStoreAddress}"
          color: CYAN
      # Retrieving and cleaning displayed value...
      - getString:
          identifier: mx.mappings.order-confirmation.homeAddress
          storeIn: displayedAddress
      - executeNode:
          file: mx/test/helpers/utils/stringToLowerCase
          args:
            - value: ${displayedAddress}
          getResponse:
            storeIn: displayedAddress
      - log:
          message: "Parsed displayed Store Address: ${displayedAddress}"
          color: CYAN
      # Final comparison...
      - if:
          condition: ${displayedAddress} == ${expectedStoreAddress}
          then:
            - log: 
                message: "Addresses are correct"
                color: CYAN
          else:
            - failTest:
                message: "Addresses are not correct"
      - log: 
          message: "End Function: order-confirmation.compareAddresses (Addresses are correct)"
          color: BLUE

  # Description: This method clicks the find more products button
  - name: mx.functions.order-confirmation.tapFindMoreProducts
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.order-confirmation.findMoreProductsButton
          coordinates: 50%,50%
      - log:
          message: "End function: order-confirmation.tapFindMoreProducts"
          color: BLUE