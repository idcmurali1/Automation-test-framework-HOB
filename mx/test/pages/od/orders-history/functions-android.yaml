#======================================================================================================================
#  AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#  CREATED: Feb/20/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  #--------------------------------------------------------------------------------------------------------------------

  # Params: ${orderNumber}           [Mandatory]  ID of the order.
  # Params: ${expectedBanner}        [Mandatory]  Expected banner, comes coded with the delivery slot. 
  #                                               (input: [ Walmart | Walmart Express ])
  # Params: ${expectedDeliverySlot}  [Mandatory]  Expected delivery slot to be displayed. The value passed in this
  #                                               param must be the string value returned by the 
  #                                               'delivery-slot-extraction/parseDeliverySlotForAssertion.js' helper
  #                                               (see helper's documentation). Also the function 
  #                                               mx.functions.utils.getDeliverySlot returns this value.
  #
  #   Flags used:
  #   ${ASSERT_DELIVERY_SLOT_IN_ORDERS_HISTORY}
  #       If set to 'true', the flow will perform assertion for the Delivery Slot in Orders History page.
  #       If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
  #
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.orders-history.assertOrderDeliverySlot
    platform: android
    flow:
    - if:
        condition: ${ASSERT_DELIVERY_SLOT_IN_ORDERS_HISTORY} == true
        then:
          - log:
              message: "Order Number: '${orderNumber}'"
              color: CYAN
          - log:
              message: "Expected Banner: '${expectedBanner}'"
              color: CYAN
          - storeIn:
              key: deliverySlot
              value: "${expectedDeliverySlot} ${expectedBanner}"
          - log:
              message: "Expected Delivery Slot: '${deliverySlot}'"
              color: CYAN
          - getString:
              identifier: mx.mappings.orders-history.deliverySlotAndBannerByOrderNumber # <--PARAMS--${orderNumber}
              storeIn: currentDeliverySlot
          - executeNode:
              file: mx/test/helpers/delivery-slot/orders-history/parseDeliverySlotAndBannerForAndroid.js
              args:
                - value: ${currentDeliverySlot}
              getResponse:
                storeIn: parsedDeliverySlot
          - log: 
              message: "Parsed displayed Delivery Slot: '${parsedDeliverySlot}'"
              color: CYAN
          - if:
              condition: ${deliverySlot} != ${parsedDeliverySlot}
              then:
                - failTest:
                    message: "'${deliverySlot}', did not match '${parsedDeliverySlot}'"
          - log:
              message: Correct Delivery Slot.
              color: CYAN
        else:
          - log:
              message: "Delivery Slot Assertion has been turned off by flag: 'ASSERT_DELIVERY_SLOT_IN_ORDERS_HISTORY'"
              color: YELLOW
    - log:
        message: "End function: orders-history.assertOrderDeliverySlot"
        color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Params: ${orderNumber}       [Mandatory]  ID of the order.
  # Params: ${expectedBanner}    [Mandatory]  Expected Banner, comes coded with the delivery slot. Options: [ Walmart | WalmartExpress ]
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.orders-history.assertOrderBanner
    platform: android
    flow:
      - log:
          message: "Order Number: '${orderNumber}'"
          color: CYAN
      - log:
          message: "Expected Banner: '${expectedBanner}'"
          color: CYAN
      - if:
          condition: ${expectedBanner} != 'Walmart' && ${expectedBanner} != 'WalmartExpress'
          then:
            - failTest:
                message: "Wrong input, verify delivery banner supplied: '${expectedBanner}'"
      - if:
          condition: ${expectedBanner} == 'Walmart'
          then:
            - verifyIdentifier:
                present:
                  - identifier: mx.mappings.orders-history.walmartBannerByOrderNumber # <--PARAMS--${orderNumber}
                notPresent:
                  - identifier: mx.mappings.orders-history.walmartExpressBannerByOrderNumber # <--PARAMS--${orderNumber}
      - if:
          condition: ${expectedBanner} == 'WalmartExpress'
          then:
            - verifyIdentifier:
                present:
                  - identifier: mx.mappings.orders-history.walmartExpressBannerByOrderNumber # <--PARAMS--${orderNumber}
      - log:
          message: Correct Banner.
          color: CYAN
      - log:
          message: "End function: orders-history.assertOrderBanner"
          color: BLUE
