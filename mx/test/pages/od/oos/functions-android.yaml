#======================================================================================================================
#  AUTHOR: Gustavo Antonio López Cambambia (vn53g21)
#  CREATED: Nov/15/2022
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # Description: this function taps the close button
  - name: mx.functions.oos.tapCloseButton
    platform: android
    flow: 
      - click: 
          identifier: mx.mappings.oos.closeButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function asserts if OOS pop up page is displayed
  - name: mx.functions.oos.assertPageDisplayed
    platform: android
    flow: 
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.oos.pageTitle
            - identifier: mx.mappings.oos.warningMessage
            - identifier: mx.mappings.oos.productsContainer
            - identifier: mx.mappings.oos.agotadoProductLabel
          timeout: 50000
      - log:
          message: "End function: oos.assertPageDisplayed"
          color: BLUE
  
  #--------------------------------------------------------------------------------------------------------------------

  # Description: Asserts the expected OOS product to be displayed.
  # Param ${productName} [Mandatory] Name of the product to assert.
  - name: mx.functions.oos.assertProductDisplayed
    platform: android
    flow:
      - log:
          message: "OOS Product Name: ${productName}"
          color: CYAN
      - if:
          identifier:
              notPresent:
                - identifier: mx.mappings.oos.productByName
          then:
            - scroll:
                direction: down
                position: center
                scrollLimit: 15
                untilIdentifier: mx.mappings.oos.productByName
            - verifyIdentifier:
                present:
                  - identifier: mx.mappings.oos.productByName
      - log:
          message: "OOS Product found."
          color: CYAN
      - log:
          message: "End function: oos.assertProductDisplayed"
          color: BLUE

  # ---------------------------------------------------------------------------------------------------------------

  # Description: this function taps the "Accept" (Entendido) button
  - name: mx.functions.oos.tapAcceptButton
    platform: android
    flow: 
      - click: 
          identifier: mx.mappings.oos.acceptButton
      - log:
          message: "End function: oos.tapAcceptButton"
          color: BLUE

  # ---------------------------------------------------------------------------------------------------------------

  # Description: this function taps the "Delete and Continue" (Continuar) button
  - name: mx.functions.oos.tapDeleteAndContinueButton
    platform: android
    flow: 
      - click: 
          identifier: mx.mappings.oos.deleteAndContinueButton

  #----------------------------------------------------------------------------------------------------------------------

  # Description: This method deletes all products that are OOS in popup
  - name: mx.functions.oos.deleteAllOOSProducts
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: mx.mappings.oos.productsRootElement
      - numberOfChildElements:
          identifier: mx.mappings.oos.productsRootElement
          storeIn: numberOfLinks
          filterBy: mx.mappings.oos.deleteLink
      - loop:
          begin: 0
          end: ${numberOfLinks}
          flow:
            - click:
                identifier: mx.mappings.oos.deleteLink

  # ---------------------------------------------------------------------------------------------------------------

  # Description: this function taps the "Cancel" (Cancelar) button
  - name: mx.functions.oos.tapCancelButton
    platform: android
    flow: 
      - click: 
          identifier: mx.mappings.oos.cancelButton

 # ---------------------------------------------------------------------------------------------------------------
  
  # Description: this function asserts the number of OOS products.
  # Param ${expectedQuantity}  [Mandatory]  Expected quantity to assert.
  - name: mx.functions.oos.assertProductCount
    platform: android
    flow: 
      - verifyIdentifier: 
          present:
            - identifier: mx.mappings.oos.numberOfOosProducts

  #--------------------------------------------------------------------------------------------------------------------          

  # Description: This clicks on "Eliminar" link of specific OOS product
  # Params: ${productNameOOS} [Mandatory] OOS product
  - name: mx.functions.oos.tapDeleteLinkByProductName
    platform: android
    flow: 
      - log:
          message: "Product to delete: ${productNameOOS}"
          color: BLUE
      - click:
          identifier: mx.mappings.oos.deleteLinkByProductName
      - log:
          message: "End function: cart.oos-replacements-list.tapDeleteLinkByProductName"
          color: BLUE