#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#   CREATED: Feb/10/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

#######################################################################################################################
## ANDROID ############################################################################################################
#######################################################################################################################
  
  # Description: This method taps on "agregar dirección" button
  - name: mx.functions.address-selector-popup.tapAddAddress
    platform: android
    flow:
      - click:
          identifier: mx.mappings.address-selector-popup.addAddressButton
      - log: 
          message: "End function: address-selector-popup.tapAddAddress"
          color: BLUE


  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects address by name 
  # Param ${addressPosition} [Mandatory] User address position (address index)
  - name: mx.functions.address-selector-popup.selectAddressByPosition
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.address-selector-popup.addressSelectedByIndex
          then:
            - log: 
                message: "The preferred address is already selected!"
                color: CYAN
      - if:
          identifier:
            present:
              - identifier: mx.mappings.address-selector-popup.addressByIndex
          then:
            - click:
                identifier: mx.mappings.address-selector-popup.addressByIndex

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects a random address
  # Param ${addressPosition} [Mandatory] User address position (address index)
  # Note: Address possition count starts from 0.
  - name: mx.functions.address-selector-popup.selectRandomAddress
    platform: android
    flow:
      - loop:
           begin: 1
           end: 20    
           storeIndex: j
           mode: increment
           flow:
            - executeNode:
                  file: mx/test/helpers/utils/getRandomInt.js
                  args:
                    - value: 0
                    - value: 6
                  getResponse:
                    storeIn: addressPosition
            - log: "Random index: ${addressPosition}"
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.address-selector-popup.addressWithIndex
                then: 
                    - click:
                        identifier: mx.mappings.address-selector-popup.addressWithIndex
                    - break: true
                else:
                    - log: "Current address slot is not available, verifying next address slot..."

  #--------------------------------------------------------------------------------------------------------------------

  # Description: Returns the name of the selected address.
  - name: mx.functions.address-selector-popup.getSelectedAddressName
    platform: android
    flow:
      - sleep:
          duration: 2000
      - getString:
          identifier: mx.mappings.address-selector-popup.addressLabel
          attribute: text
          storeIn: returnedAddressName
      - log: 
          message: "The selected address name is: ${returnedAddressName}"
          color: CYAN
      - log:
          message: "End function: address-selector-popup.getSelectedAddressName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on edit address button
  - name: mx.functions.address-selector-popup.tapEditAddress
    platform: android
    flow:
      - click:
          identifier: mx.mappings.address-selector-popup.editAddressButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: Scrolls up to selected address
  # Param ${addressName} [Mandatory] User address
  # Note: Please first verify the order of the string for correct validation
  - name: mx.functions.address-selector-popup.scrollUpToAddress
    platform: android
    flow:
     - loop:
           begin: 0
           end: 2      
           mode: increment
           flow:
               - if:
                  identifier:
                    present:
                      - identifier: mx.mappings.address-selector-popup.unselectedAddressByName
                  then: 
                    - log: 
                        message: "Adress by name is shown"
                        color: CYAN
                    - break : true
                  else:
                      - if:
                          identifier:
                            notPresent:
                              - identifier: mx.mappings.address-selector-popup.unselectedAddressByName
                          then:
                            - drag:
                                from:
                                  x: 380
                                  y: 1500
                                to:
                                  x: 380
                                  y: 1900

  #--------------------------------------------------------------------------------------------------------------------

  # Description: Scrolls down until address with name
  # Param ${addressName} [Mandatory] User address
  # Note: Please first verify the order of the string for correct validation
  - name: mx.functions.address-selector-popup.scrollDownToAddress
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.address-selector-popup.unselectedAddressByName
          then: 
            - log:
                message: "The selected address is already shown"
                color: CYAN
          else:
            - scroll:
                direction: down
                untilIdentifier: mx.mappings.address-selector-popup.unselectedAddressByName
                withinIdentifier: mx.mappings.address-selector-popup.addressesContainer
                wait: 8000