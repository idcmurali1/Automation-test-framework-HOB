#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#   CREATED: Feb/10/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # Description:  This method asserts select-address page is displayed
  # USES FLAG:    ${ASSERT_PAGE_TITLE}
  # EDITOR: Rodrigo Pacheco C. (vn53p0i)
  # EDITOR: Francisco Ramirez (vn53vq4)
  - name: mx.functions.address-selector-popup.assertPageDisplayed
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.address-selector-popup.pageTitle
            - identifier: mx.mappings.address-selector-popup.addAddressButton
      - log:
          message: "End function: address-selector-popup.assertPageDisplayed"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on Guardar button
  - name: mx.functions.address-selector-popup.tapSave
    flow:
      - click:
          identifier: mx.mappings.address-selector-popup.saveButton
      - log:
          message: "End function: address-selector-popup.tapSave"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------- 
  
  # Description: This method selects a random address
  - name: mx.functions.address-selector-popup.selectVisibleRandomAddress
    flow:
      - sleep:
          duration: 2000
      - click:
          identifier: mx.mappings.address-selector-popup.availableAddress
          index: -1
      - sleep:
          duration: 5000
      - log:
          message: "End function: address-selector-popup.selectVisibleRandomAddress"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------- 
  
  # Description: Returns the name of the selected address.
  - name: mx.functions.address-selector-popup.getSelectedShortAddress
    flow:
      - sleep:
          duration: 3000
      - getString:
          identifier: mx.mappings.address-selector-popup.selectedAddressText
          storeIn: returnedShortAddress
      - executeNode:
          file: mx/test/helpers/reserve-slot/getShortAddress.js
          args:
            - value: ${returnedShortAddress}
          getResponse:
            storeIn: returnedShortAddress
      - log: 
          message: "The selected address name is: ${returnedShortAddress}"
          color: CYAN
      - log:
          message: "End function: address-selector-popup.getSelectedShortAddress"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------- 
  
  # DESCRIPTION: This function gets and returns a string containing the selected address in reserve-slot page, in the
  #              variable ${returnedDeliveryAddress}, but also it can return each piece of data from this string inside
  #              different variables ${returnedStreetName}, ${returnedExteriorNumber}, ${returnedCity}, ${returnedState},
  #              and ${returnedZipCode}. These will be needed for other address assertions. Grab these values whenever
  #              or wherever you need them.
  # NOTE: TO DO: UPDATE THIS FUNCTION ONCE THE BUG ON IOS GETS FIXED (IOS NOT DISPLAYING EXTERIOR NUMBER)!!!!!!!!!!!!!
  - name: mx.functions.address-selector-popup.getSelectedAddress
    flow:
      - getString:
          identifier: mx.mappings.address-selector-popup.selectedAddressText
          storeIn: returnedDeliveryAddress
      - log:
          message: "Displayed delivery address: ${returnedDeliveryAddress}"
          color: CYAN
      - log:
          message: "TO DO: UPDATE THIS FUNCTION ONCE THE BUG ON IOS GETS FIXED (IOS NOT DISPLAYING EXTERIOR NUMBER)!!!!!!!!!!!!!"
          color: YELLOW
      - executeNode:
          file: mx/test/helpers/address-selector-popup/splitAddressValues.js
          args:
            - value: ${returnedDeliveryAddress}
          getValue:
            - key: street
              storeIn: returnedStreetName
            - key: exteriorNumber
              storeIn: returnedExteriorNumber
            - key: city
              storeIn: returnedCity
            - key: state
              storeIn: returnedState
            - key: zipCode
              storeIn: returnedZipCode
      # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
      - log: "\e[36mreturnedStreetName: '${returnedStreetName}'\e[0m"
      - log: "\e[36mreturnedExteriorNumber: '${returnedExteriorNumber}'\e[0m"
      - log: "\e[36mreturnedCity: '${returnedCity}'\e[0m"
      - log: "\e[36mreturnedState: '${returnedState}'\e[0m"
      - log: "\e[36mreturnedZipCode: '${returnedZipCode}'\e[0m"
      - log: "\e[36mreturnedDeliveryAddress: '${returnedDeliveryAddress}'\e[0m"
      - log:
          message: "End function: address-selector-popup.getSelectedAddress"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method selects address by name.
  # Param ${addressName} [Mandatory] Name of the address to select.
  - name: mx.functions.address-selector-popup.selectAddressByName
    flow:
      - log: 
          message: "Address to select: ${addressName}"
          color: CYAN
      - if:
          identifier:
            present:
              - identifier: mx.mappings.address-selector-popup.selectedAddressByName
          then:
            - log: 
                message: "The address is already selected."
                color: CYAN
          else:
            - click:
                identifier: mx.mappings.address-selector-popup.addressByName
            - verifyIdentifier:
                present:
                  - identifier: mx.mappings.address-selector-popup.selectedAddressByName
      - log: 
          message: "End function: address-selector-popup.selectAddressByName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on close button
  - name: mx.functions.address-selector-popup.tapClose
    flow:
      - click:
          identifier: mx.mappings.address-selector-popup.closeButton
      - log: 
          message: "End function: address-selector-popup.tapClose"
          color: BLUE
  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIOTION: This method asserts that delivery address is displayed on page.
  - name: mx.functions.address-selector-popup.assertDeliveryAddressDisplayedByName
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.address-selector-popup.addressByName # <-- USE: ${addressName}
      - log: 
          message: "End function: address-selector-popup.assertDeliveryAddressDisplayedByName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This method asserts that delivery address is displayed on page.
  - name: mx.functions.address-selector-popup.isPopUpDisplayed
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.address-selector-popup.pageTitle
              - identifier: mx.mappings.address-selector-popup.addAddressButton
          then:
            - storeIn:
                key: returnedIsDisplayed
                value: true
            - log:
                message: "End function: address-selector-popup.isPopUpDisplayed (Displayed)"
                color: BLUE
          else:
            - storeIn:
                key: returnedIsDisplayed
                value: false
            - log:
                message: "End function: address-selector-popup.isPopUpDisplayed (Not Displayed)"
                color: BLUE
