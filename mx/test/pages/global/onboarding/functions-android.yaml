#======================================================================================================================
#  AUTHOR: Francisco Javier Ramírez Hernández (vn53vq4)
#  CREATED: Oct/17/2022
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # PARAMS:  ${zipCode}  [Mandatory]  ZIP Code of the desired store.
  # AUTHOR: ?????
  # EDITOR: Sergio Fernandez (vn0t1qt)
  - name: mx.functions.onboarding.location.enterZipCode
    platform: android
    flow:
      - log:
          message: "ZIP Code: '${zipCode}'"
          color: CYAN
      - click:
          identifier: mx.mappings.onboarding.location.zipCodeField
      - enterText:
          identifier: mx.mappings.onboarding.location.zipCodeField
          string: ${zipCode}
      - hideKeyboard: true
      - log:
          message: "End function: onboarding.location.enterZipCode"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on Allows While App Is In Use button
  - name: mx.functions.onboarding.location-popup.tapAllowWhileUsingApp
    platform: android
    flow:
      - click: 
          identifier: mx.mappings.onboarding.location-popup.allowWhileUsingButton
      - log:
          message: "End function: onboarding.location-popup.tapAllowWhileUsingApp"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method taps on Not Allow button
  - name: mx.functions.onboarding.location-popup.tapNotAllow
    platform: android
    flow: 
      - verifyIdentifier:
          present: 
            - identifier: mx.mappings.onboarding.location-popup.notAllowButton
      - click: 
          identifier: mx.mappings.onboarding.location-popup.notAllowButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method clicks on use my current location button
  - name: mx.functions.onboarding.location.tapUseCurrentLocation
    platform: android
    flow:
      - click:
          identifier: mx.mappings.onboarding.location.useCurrentLocationButton

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method asserts Welcome Page is displayed
  - name: mx.functions.onboarding.assertWelcomePageisDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.onboarding.welcomePage

  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.onboarding.assertAllowLocationPageIsDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.onboarding.allowLocationPageTitle
            - identifier: mx.mappings.onboarding.continueButton
            - identifier: mx.mappings.onboarding.enterZipCodeButton
      - log:
          message: "End function: onboarding.assertAllowLocationPageIsDisplayed (Page Displayed)"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  
  # Description: Dismisses the popup by clicking in the given option in case the popup displayed.
  # Param  ${option}  [Optional]  Option to click when dismissing the popup. (Input: [ AllowOnce | AllowWhileUsingApp | NotAllow ] )
  #                               If not provided 'AllowWhileUsingApp' will be selected.
  - name: mx.functions.onboarding.location-popup.dismissPopupIfDisplayed
    platform: android
    flow:
      - if:
          condition: ${option} == null
          then:
            - storeIn:
                key: option
                value: "AllowWhileUsingApp"
      - if:
          condition: ${option} != 'AllowOnce' && ${option} != 'AllowWhileUsingApp' && ${option} != 'NotAllow'
          then:
            - failTest:
                message: "Given option not valid: ${option}"
      - log:
          message: "Dismissing Location Popup if displayed. (option = '${option}')"
          color: CYAN
      - executeFunction:
          name: mx.functions.onboarding.location-popup.isPopupDisplayed
      - if:
          condition: ${returnedIsDisplayed} == true
          then:
            - if:
                condition: ${option} == 'AllowOnce'
                then:
                  - executeFunction:
                      name: mx.functions.onboarding.location-popup.tapAllowOnce
                else:
                  - if:
                      condition: ${option} == 'AllowWhileUsingApp'
                      then:
                        - executeFunction:
                            name: mx.functions.onboarding.location-popup.tapAllowWhileUsingApp
                      else:
                        - executeFunction:
                            name: mx.functions.onboarding.location-popup.tapNotAllow
          else:
            - log:
                message: "Popup not displayed."
                color: CYAN
      - log:
          message: "End function: onboarding.location-popup.dismissPopupIfDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This method clicks on use my current location button
  - name: mx.functions.onboarding.location.tapSearch
    platform: android
    flow:
      - click:
          identifier: mx.mappings.onboarding.location.searchButton
      - log: 
          message: "End function: onboarding.location.tapSearch"
          color: BLUE
  
  #--------------------------------------------------------------------------------------------------------------------

  - name: mx.functions.onboarding.dismissOrderDiscountUpdatesIfDisplayed
    platform: android
    flow:
      - if: 
          identifier:
            present:
              - identifier: mx.mappings.onboarding.notificationsTitleTextView
          then:
            - click:
                identifier: mx.mappings.onboarding.maybeLatterNotificationsButton
      - log: 
          message: "End function: mx.functions.onboarding.dismissOrderDiscountUpdatesIfDisplayed"
          color: BLUE