#======================================================================================================================
#  AUTHOR: Osmar Juárez (vn56dce)
#  CREATED: Dec/27/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.assertPageDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.pageTitle
            - identifier: mx.mappings.ea.add-and-edit-address-form.closeButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.saveButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.nameField
      - log:
          message: "End function: add-and-edit-address-form.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userFirstName} [Mandatory] User's first name to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterName
    platform: android
    flow:
      - log:
          message: "User first name: '${userFirstName}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.nameField
          string: ${userFirstName}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userLastName} [Mandatory] User's last name to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterLastName
    platform: android
    flow:
      - log:
          message: "User last name: '${userLastName}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.lastNameField
          string: ${userLastName}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterLastName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userStreet} [Mandatory] User's street to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterStreet
    platform: android
    flow:
      - log:
          message: "User's street: '${userStreet}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.streetField
          string: ${userStreet}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterStreet"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userExteriorNumber} [Mandatory] User's exterior number to enter.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.enterExteriorNumber
    platform: android
    flow:
      - log:
          message: "User's exterior number: '${userExteriorNumber}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.exteriorNumberField
          string: ${userExteriorNumber}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterExteriorNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userInteriorNumber} [Mandatory] User's interior number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterInteriorNumber
    platform: android
    flow:
      - log:
          message: "User's interior number: '${userInteriorNumber}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.interiorNumberField
          string: ${userInteriorNumber}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterInteriorNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userZipCode} [Mandatory] User's zip code number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterZipCode
    platform: android
    flow:
      - log:
          message: "User's zip code: '${userZipCode}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.zipCodeField
          string: ${userZipCode}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - sleep:
          duration: 3000
      - log:
          message: "End function: add-and-edit-address-form.enterZipCode"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userNeighborhood} [Mandatory] User's colony/neighborhood to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.selectNeighborhood
    platform: android
    flow:
      - log:
          message: "User's neighborhood: '${userNeighborhood}'"
          color: CYAN
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.neighborhoodField
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.add-and-edit-address-form.neighborhoodListOption # <--PARAM--${userNeighborhood}
          then:
            - click:
                identifier: mx.mappings.ea.add-and-edit-address-form.neighborhoodListOption # <--PARAM--${userNeighborhood}
          else:
            - log:
                message: "Option: '${userNeighborhood}' not visible, scrolling down..."
                color: CYAN
            - scroll:
                direction: down
                wait: 1000
                scrollLimit: 5
                untilIdentifier: mx.mappings.ea.add-and-edit-address-form.neighborhoodListOption # <--PARAM--${userNeighborhood}
                withinIdentifier: mx.mappings.ea.add-and-edit-address-form.neighborhoodList
            - click:
                identifier: mx.mappings.ea.add-and-edit-address-form.neighborhoodListOption # <--PARAM--${userNeighborhood}
      - log:
          message: "Success: Neighborhood has been selected."
          color: CYAN
      - log:
          message: "End function: add-and-edit-address-form.selectNeighborhood"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedUserCity} [Mandatory] User's city to verify.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertCity
    platform: android
    flow:
      - log:
          message: "User's city: '${expectedUserCity}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.cityFieldForAssertion # <--PARAM--${expectedUserCity}
      - log:
          message: "End function: add-and-edit-address-form.assertCity"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedUserState} [Mandatory] User's state to verify.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertState
    platform: android
    flow:
      - log:
          message: "User's state: '${expectedUserState}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.stateFieldForAssertion # <--PARAM--${expectedUserState}
      - log:
          message: "End function: add-and-edit-address-form.assertState"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedUserMunicipality} [Mandatory] User's municipality to verify.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertMunicipality
    platform: android
    flow:
      - log:
          message: "User's municipality: '${expectedUserMunicipality}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.municipalityFieldForAssertion # <--PARAM--${expectedUserMunicipality}
      - log:
          message: "End function: add-and-edit-address-form.assertMunicipality"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userPhoneNumber} [Mandatory] User's phone number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterPhoneNumber
    platform: android
    flow:
      - log:
          message: "User's phone number: '${userPhoneNumber}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.phoneNumberField
          string: ${userPhoneNumber}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterPhoneNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.tapFavoriteAddressCheckbox
    platform: android
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.favoriteAddressCheckbox
      - log:
          message: "End function: add-and-edit-address-form.tapFavoriteAddressCheckbox"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedCheckboxState}  [Mandatory]   State of the checkbox you want to assert. Options: [ 'true' | 'false' ].
  #                                                   Set to 'true' to assert the checkbox as 'marked' and 'false' to 'unmarked'.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertFavoriteAddressCheckboxState
    platform: android
    flow:
      - if:
          condition: ${expectedCheckboxState} != true && ${expectedCheckboxState} != false
          then:
            - failTest:
                message: "Failed: 'expectedCheckboxState' Option not valid, value provided: '${expectedCheckboxState}'."
      - if:
          condition: ${expectedCheckboxState} == true
          then:
            - log:
                message: "Expected Checkbox state: 'Marked'."
                color: CYAN
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.add-and-edit-address-form.markedFavoriteAddressCheckbox
                then:
                  - log:
                      message: "Assertion Succeeded: Favorite Address checkbox is marked."
                      color: CYAN
                else:
                  - failTest:
                      message: "Failed: Favorite Address checkbox is unmarked."
      - if:
          condition: ${expectedCheckboxState} == false
          then:
            - log:
                message: "Expected Checkbox state: 'Unmarked'."
                color: CYAN
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.add-and-edit-address-form.unmarkedFavoriteAddressCheckbox
                then:
                  - log: 
                      message: "Assertion Succeeded: Favorite Address checkbox is unmarked."
                      color: CYAN
                else:
                  - failTest:
                      message: "Failed: Favorite Address checkbox is marked."
      - log:
          message: "End function: add-and-edit-address-form.assertFavoriteAddressCheckboxState"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  Taps the "Close" button
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.tapClose
    platform: android
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.closeButton
      - sleep:
          duration: 3000
      - log:
          message: "End function: add-and-edit-address-form.tapClose"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.tapSave
    platform: android
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.saveButton
      - log:
          message: "End function: add-and-edit-address-form.tapSave"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.assertErrorsNotDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          notPresent:
            - identifier: mx.mappings.ea.add-and-edit-address-form.errorMessages
      - log:
          message: "End function: add-and-edit-address-form.assertErrorsNotDisplayed"
          color: BLUE

  # CONFIRMATION-MAP ##################################################################################################

  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertPageDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.mapView
            - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.saveConfirmButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected delivery address.
  # PARAMS:
  #               ${assertBy}           [Mandatory]   How to verify the desired address. Options: [ 'FullString' | 'Values' ]
  #                                                   If 'FullString' function validates by using 'addressFullString'.
  #                                                   If 'Values' function validates by individual values using the rest of the parameters.
  #
  #               ${addressFullString}  [Optional]    Full string containing the address to be validated.
  #               ${streetName}         [Optional]    Name of the street to be validated.
  #               ${exteriorNumber}     [Optional]    Exterior number to be validated.
  #               ${city}               [Optional]    City to be validated.
  #               ${state}              [Optional]    State to be validated.
  #               ${zipCode}            [Optional]    ZIP Code to be validated.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertAddressBy
    platform: android
    flow:
      - if:
          condition: ${assertBy} != 'FullString' && ${assertBy} != 'Values'
          then:
            - failTest:
                message: "Failed: 'assertBy' Option not valid, value provided: '${assertBy}'."
      
      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      # Assertion by Full String...
      - if:
          condition: ${assertBy} == 'FullString'
          then:
            - log:
                message: "Address will be verified by Full String..."
                color: CYAN
            - log:
                message: "Expected Address Full String: '${addressFullString}'"
                color: CYAN
            - if:
                identifier:
                  text:
                    - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
                      contains: ${addressFullString}
                then:
                  - log:
                      message: "Assertion Succeeded: Address by Full String is correct."
                      color: CYAN
                else:
                  - failTest:
                      message: "Failed: Address by Full String is not correct."

      # Assertion by Individual Values...
      - if:
          condition: ${assertBy} == 'Values'
          then:
            - log:
                message: "Address will be verified by Individual Values..."
                color: CYAN
            # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
            - log: "\e[36mExpected StreetName: '${streetName}'\e[0m"
            - log: "\e[36mExpected ExteriorNumber: '${exteriorNumber}'\e[0m"
            - log: "\e[36mExpected City: '${city}'\e[0m"
            - log: "\e[36mExpected State: '${state}'\e[0m"
            - log: "\e[36mExpected ZipCode: '${zipCode}'\e[0m"
            - executeNode:
                file: mx/test/helpers/utils/stringContainsAll.js
                args:
                  - value: ${displayedAddress}
                  - value: ${streetName}, ${exteriorNumber}, ${city}, ${state}, ${zipCode}
                getResponse:
                  storeIn: isAddressCorrect
            - if:
                condition: ${isAddressCorrect} == true
                then:
                  - log:
                      message: "Address is correct."
                      color: CYAN
                else:
                  - failTest:
                      message: "Expected address not contained in: '${displayedAddress'}"
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertAddressBy"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected delivery address by the full string.
  # PARAMS:       ${addressFullString}  [Mandatory]   Full string containing the address to be validated.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertAddressByFullString
    platform: android
    flow:
      - log:
          message: "Expected Address Full String: '${addressFullString}'"
          color: CYAN

      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      # Assertion by Full String...
      - if:
          identifier:
            text:
              - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
                contains: ${addressFullString}
          then:
            - log:
                message: "Assertion Succeeded: Address by Full String is correct."
                color: CYAN
          else:
            - failTest:
                message: "Failed: Address by Full String is not correct."
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertAddressByFullString"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected delivery address by individual values.
  # PARAMS:
  #               ${streetName}         [Mandatory]   Name of the street to be validated.
  #               ${exteriorNumber}     [Mandatory]   Exterior number to be validated.
  #               ${city}               [Mandatory]   City to be validated.
  #               ${state}              [Mandatory]   State to be validated.
  #               ${zipCode}            [Mandatory]   ZIP Code to be validated.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertAddressByIndividualValues
    platform: android
    flow:
      # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
      - log: "\e[36mExpected StreetName: '${streetName}'\e[0m"
      - log: "\e[36mExpected ExteriorNumber: '${exteriorNumber}'\e[0m"
      - log: "\e[36mExpected City: '${city}'\e[0m"
      - log: "\e[36mExpected State: '${state}'\e[0m"
      - log: "\e[36mExpected ZipCode: '${zipCode}'\e[0m"
      - executeNode:
          file: mx/test/helpers/utils/stringContainsAll.js
          args:
            - value: ${displayedAddress}
            - value: ${streetName}, ${exteriorNumber}, ${city}, ${state}, ${zipCode}
          getResponse:
            storeIn: isAddressCorrect

      # Assertion by Individual Values...
      - if:
          condition: ${isAddressCorrect} == true
          then:
            - log:
                message: "Address is correct."
                color: CYAN
          else:
            - failTest:
                message: "Expected address not contained in: '${displayedAddress'}"
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertAddressByIndividualValues"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  Taps the "Confirmar" button ("Guardar" on Android but it is the same button).
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.tapConfirm
    platform: android
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.saveConfirmButton
      - sleep:
          duration: 3000
      - log: 
          message: "End function: add-and-edit-address-form.confirmation-map.tapConfirm"
          color: BLUE
