#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Mar/08/2024
#  REVISION: ---
#
#  Copyright Â© 2024 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertPageDisplayed
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.pageTitle
            - identifier: mx.mappings.ea.add-and-edit-address-form.closeButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.saveButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.nameField
      - log:
          message: "End function: add-and-edit-address-form.assertPageDisplayed"
          color: BLUE
  
  #--------------------------------------------------------------------------------------------------------------------
  
  # AUTHOR: Francisco Ramirez (vn53vq4)
  - name: mx.functions.ea.add-and-edit-address-popup-form.assertPageDisplayed
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.pageTitle
            - identifier: mx.mappings.ea.add-and-edit-address-form.closeButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.nameField
      - log:
          message: "End function: add-and-edit-address-popup-form.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userFirstName} [Mandatory] User's first name to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterName
    platform: ios
    flow:
      - log:
          message: "User's first name: '${userFirstName}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.nameField
          string: ${userFirstName}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userLastName} [Mandatory] User's last name to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterLastName
    platform: ios
    flow:
      - log:
          message: "User's last name: '${userLastName}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.lastNameField
          string: ${userLastName}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterLastName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userStreet} [Mandatory] User's street to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterStreet
    platform: ios
    flow:
      - log:
          message: "User's street: '${userStreet}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.streetField
          string: ${userStreet}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterStreet"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userExteriorNumber} [Mandatory] User's exterior number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterExteriorNumber
    platform: ios
    flow:
      - log:
          message: "User's exterior number: '${userExteriorNumber}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.exteriorNumberField
          string: ${userExteriorNumber}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterExteriorNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userInteriorNumber} [Mandatory] User's interior number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterInteriorNumber
    platform: ios
    flow:
      - log:
          message: "User's interior number: '${userInteriorNumber}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.interiorNumberField
          string: ${userInteriorNumber}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterInteriorNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userZipCode} [Mandatory] User's zip code number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterZipCode
    platform: ios
    flow:
      - log:
          message: "User's zip code: '${userZipCode}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.zipCodeField
          string: ${userZipCode}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - sleep:
          duration: 3000
      - log:
          message: "End function: add-and-edit-address-form.enterZipCode"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userNeighborhood} [Mandatory] User's colony/neighborhood to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.selectNeighborhood
    platform: ios
    flow:
      - log:
          message: "User's neighborhood: '${userNeighborhood}'"
          color: CYAN
      ## NOTE: Validate for iOS if this function works properly and delete this log and restore commented code after doing so.
      - log:
          message: "[!] THERE IS AN ISSUE WITH IOS AND APPIUM NOT SAVING THE SELECTED OPTION AND SELECTS THE FIRST OPTION INSTEAD ! ! !"
          color: YELLOW
      - click:
          identifier: mx.mappings.add-address-form.neighborhoodField
      # - enterText:
      #     identifier: mx.mappings.add-address-form.neighborhoodPickerWheel
      #     string: ${userNeighborhood}
      #     clickFirst: false
      #     clearField: false
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "Success: Neighborhood has been selected."
          color: GREEN_BOLD
      - log:
          message: "End function: add-and-edit-address-form.selectNeighborhood"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedUserCity} [Mandatory] User's city to verify.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertCity
    platform: ios
    flow:
      - log:
          message: "User's city: '${expectedUserCity}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.cityFieldForAssertion # <--PARAM--${expectedUserCity}
      - log:
          message: "Success: User's city is correct."
          color: GREEN_BOLD
      - log:
          message: "End function: add-and-edit-address-form.assertCity"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedUserState} [Mandatory] User's state to verify.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertState
    platform: ios
    flow:
      - log:
          message: "User's state: '${expectedUserState}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.stateFieldForAssertion # <--PARAM--${expectedUserState}
      - log:
          message: "Success: User's state is correct."
          color: GREEN_BOLD
      - log:
          message: "End function: add-and-edit-address-form.assertState"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedUserMunicipality} [Mandatory] User's municipality to verify.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertMunicipality
    platform: ios
    flow:
      - log:
          message: "User's municipality: '${expectedUserMunicipality}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.municipalityFieldForAssertion # <--PARAM--${expectedUserMunicipality}
      - log:
          message: "Success: User's municipality is correct."
          color: GREEN_BOLD
      - log:
          message: "End function: add-and-edit-address-form.assertMunicipality"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${userPhoneNumber} [Mandatory] User's phone number to enter.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.enterPhoneNumber
    platform: ios
    flow:
      - log:
          message: "User's phone number: '${userPhoneNumber}'"
          color: CYAN
      - enterText:
          identifier: mx.mappings.ea.add-and-edit-address-form.phoneNumberField
          string: ${userPhoneNumber}
          clickFirst: true
      - executeFunction:
          name: mx.functions.utils.tapCloseKeyboardButton
      - log:
          message: "End function: add-and-edit-address-form.enterPhoneNumber"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.tapFavoriteAddressCheckbox
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.favoriteAddressCheckbox
      - log:
          message: "End function: add-and-edit-address-form.tapFavoriteAddressCheckbox"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedCheckboxState}  [Mandatory]   State of the checkbox you want to assert. Options: [ 'true' | 'false' ].
  #                                                   Set to 'true' to assert the checkbox as 'marked' and 'false' to assert as 'unmarked'.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertFavoriteAddressCheckboxState
    platform: ios
    flow:
      - if:
          condition: ${expectedCheckboxState} != true && ${expectedCheckboxState} != false
          then:
            - failTest:
                message: "Failed: 'expectedCheckboxState' Option not valid, value provided: '${expectedCheckboxState}'."
      - if:
          condition: ${expectedCheckboxState} == true
          then:
            - log:
                message: "Expected Checkbox state: 'Marked'."
                color: CYAN
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.add-and-edit-address-form.markedFavoriteAddressCheckbox
                then:
                  - log:
                      message: "Assertion Succeeded: Favorite Address checkbox is marked."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Favorite Address checkbox is unmarked."
      - if:
          condition: ${expectedCheckboxState} == false
          then:
            - log:
                message: "Expected Checkbox state: 'Unmarked'."
                color: CYAN
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.add-and-edit-address-form.unmarkedFavoriteAddressCheckbox
                then:
                  - log: 
                      message: "Assertion Succeeded: Favorite Address checkbox is unmarked."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Favorite Address checkbox is marked."
      - log:
          message: "End function: add-and-edit-address-form.assertFavoriteAddressCheckboxState"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.tapClose
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.closeButton
      - log:
          message: "End function: add-and-edit-address-form.tapClose"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.tapSave
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.saveButton
      - log:
          message: "End function: add-and-edit-address-form.tapSave"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.assertErrorsNotDisplayed
    platform: ios
    flow:
      - verifyIdentifier:
          notPresent:
            - identifier: mx.mappings.ea.add-and-edit-address-form.errorMessages
      - log:
          message: "End function: add-and-edit-address-form.assertErrorsNotDisplayed"
          color: BLUE

  # CONFIRMATION-MAP ##################################################################################################

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertPageDisplayed
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.mapView
            - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.saveConfirmButton
            - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected delivery address by the full string.
  # PARAMS:       ${addressFullString}  [Mandatory]   Full string containing the address to be validated.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertAddressByFullString
    platform: ios
    flow:
      - log:
          message: "Expected Address Full String: '${addressFullString}'"
          color: CYAN

      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      # Assertion by Full String...
      - if:
          identifier:
            label:
              - identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
                contains: ${addressFullString}
          then:
            - log:
                message: "Assertion Succeeded: Address by Full String is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Address by Full String is not correct."
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertAddressByFullString"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected delivery address by individual values.
  # NOTE:         On iOS, the full address string only contains streetName, city and state.
  # PARAMS:
  #               ${streetName}         [Mandatory]   Name of the street to be validated.
  #               ${exteriorNumber}     [Mandatory]   Exterior number to be validated.
  #               ${city}               [Mandatory]   City to be validated.
  #               ${state}              [Mandatory]   State to be validated.
  #               ${zipCode}            [Mandatory]   ZIP Code to be validated.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.assertAddressByIndividualValues
    platform: ios
    flow:
      # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
      - log: "\e[36mExpected StreetName: '${streetName}'\e[0m"
      - log: "\e[36mExpected ExteriorNumber: '${exteriorNumber}'\e[0m"
      - log: "\e[36mExpected City: '${city}'\e[0m"
      - log: "\e[36mExpected State: '${state}'\e[0m"
      - log: "\e[36mExpected ZipCode: '${zipCode}'\e[0m"

      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.userFullAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      - executeNode:
          file: mx/test/helpers/utils/stringContainsAll.js
          args:
            - value: ${displayedAddress}
            - value: ${streetName}, ${city}, ${state}
          getResponse:
            storeIn: isAddressCorrect

      # Assertion by Individual Values...
      - if:
          condition: ${isAddressCorrect} == true
          then:
            - log:
                message: "Address is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Expected address not contained in: '${displayedAddress'}"
      - log:
          message: "End function: add-and-edit-address-form.confirmation-map.assertAddressByIndividualValues"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  Taps the "Confirmar" button ("Guardar" on ios but it is the same button).
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.tapConfirm
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.saveConfirmButton
      - sleep:
          duration: 3000
      - log: 
          message: "End function: add-and-edit-address-form.confirmation-map.tapConfirm"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.add-and-edit-address-form.confirmation-map.tapBack
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.add-and-edit-address-form.confirmation-map.backButton
      - sleep:
          duration: 3000
      - log: 
          message: "End function: add-and-edit-address-form.confirmation-map.tapBack"
          color: BLUE
