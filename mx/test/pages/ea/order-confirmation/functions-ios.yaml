#======================================================================================================================
#  AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#  CREATED: Feb/28/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertPageDisplayed
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.order-confirmation.orderNumberLabel
              - identifier: mx.mappings.ea.order-confirmation.total
              - identifier: mx.mappings.ea.order-confirmation.fulfillmentContainer
              - identifier: mx.mappings.ea.order-confirmation.findMoreProductsButton
          then:
            - log:
                message: "Assertion Succeeded: Order Confirmation page is displayed."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Order Confirmation page did not display."
      - log:
          message: "End function: order-confirmation.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method asserts the selected delivery method, either home delivery or pickup. Other values given
  #                 will fail the test.
  # PARAM         ${expectedDeliveryMethod} [Mandatory] Delivery method to assert. Options: [ 'HomeDelivery' | 'PickupDelivery' ].
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertDeliveryMethod
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Assert For: '${expectedDeliveryMethod}' ]"
          color: CYAN
      - if:
          condition: ${expectedDeliveryMethod} != 'HomeDelivery' && ${expectedDeliveryMethod} != 'PickupDelivery'
          then:
            - failTest:
                message: "Invalid Delivery Method Option provided: '${expectedDeliveryMethod}'"
      # Home Delivery Assertion...
      - if:
          condition: ${expectedDeliveryMethod} == 'HomeDelivery'
          then:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.order-confirmation.homeDeliveryIsSelected
                then:
                  - log:
                      message: "Assertion Succeeded: Home Delivery Method is Selected."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Home Delivery Method is not Selected."
      # Pickup Delivery Assertion...
      - if:
          condition: ${expectedDeliveryMethod} == 'PickupDelivery'
          then:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.order-confirmation.pickupDeliveryIsSelected
                then:
                  - log:
                      message: "Assertion Succeeded: Pickup Delivery Method is Selected."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Pickup Delivery Method is not Selected."
      - log:
          message: "End function order-confirmation.assertDeliveryMethod"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedTotal} [Mandatory] Order total
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertTotal
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Expected Total: '${expectedTotal}' ]"
          color: CYAN
      # Get displayed Total.
      - getString:
          identifier: mx.mappings.ea.order-confirmation.total
          storeIn: displayedTotal
      # Clean the Total obtained and log it...
      - executeNode:
           file: mx/test/helpers/order-confirmation/sanitizeTotal.js
           args:
             - value: ${displayedTotal}
           getResponse:
               storeIn: displayedTotal
      - log:
          message: "Displayed Total: '${displayedTotal}'"
          color: CYAN
      # Assert displayed vs expected...
      - if:
          condition: ${displayedTotal} == ${expectedTotal}
          then:
            - log:
                message: "Successful Assertion: Total is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed Assertion: Total is incorrect."
      - log:
          message: "End function: order-confirmation.assertTotal"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method asserts the selected delivery date collected from the updated one after selecting a
  #                 payment method in Review Order Page.
  # NOTE:         This function is ONLY for orders without multiple delivery sections.
  # PARAM:        ${expectedDeliveryDate}     [Mandatory]   Delivery date to assert.
  #               ${expectedDeliveryMethod}   [Mandatory]   Selected Delivery method. Options: [ 'HomeDelivery' | 'PickupDelivery' ].
  # FLAGS:        IOS_SKIP_DELIVERY_DATE_ASSERTION      This flag skips the assertion, when the selected delivery
  #                 method is Pickup due to a problem in the app not showing the correct delivery date string.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertSingleDeliveryDate
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Expected Delivery Date: '${expectedDeliveryDate}' ]"
          color: CYAN
      - log:
          message: "[ PARAM: Selected Delivery Method: '${expectedDeliveryMethod}' ]"
          color: CYAN
      - if:
          condition: ${expectedDeliveryMethod} == 'PickupDelivery' && ${IOS_SKIP_DELIVERY_DATE_ASSERTION} == true
          then:
            - log:
                message: "[!] WARNING: This assertion will be skipped for 'PickupDelivery' orders, the flag 'IOS_SKIP_DELIVERY_DATE_ASSERTION' has been turned on."
                color: YELLOW
          else:
            # Getting and parsing the displayed Delivery Date...
            - getString:
                identifier: mx.mappings.ea.order-confirmation.deliveryDate
                storeIn: displayedDeliveryDate
            - executeNode:
                file: mx/test/helpers/order-confirmation/getDeliveryDateEAForiOS.js
                args:
                  - value: ${displayedDeliveryDate}
                getResponse:
                  storeIn: displayedDeliveryDate
            - log:
                message: "Displayed Delivery Date: '${displayedDeliveryDate}'"
                color: CYAN
            # Comparing Expected vs Displayed...
            - if:
                condition: ${expectedDeliveryDate} == ${displayedDeliveryDate}
                then:
                  - log:
                      message: "Assertion Succeeded: Correct Delivery Date."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Incorrect Delivery Date."
      - log:
          message: "End function order-confirmation.assertSingleDeliveryDate"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method asserts the Home Delivery Address NAME and not the actual address.
  # PARAM         ${expectedHomeAddressName} [Mandatory] Address Name to validate.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertHomeAddressName
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Expected Home Address Name: '${expectedHomeAddressName}' ]"
          color: CYAN
      - if:
          identifier:
            label:
              - identifier: mx.mappings.ea.order-confirmation.homeAddressName
                contains: ${expectedHomeAddressName}
          then:
            - log:
                message: "Assertion Succeeded: Correct Home Address Name."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Incorrect Home Address Name."
      - log:
          message: "End function order-confirmation.assertHomeAddressName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAMS: ${expectedProductsCount}  [Mandatory]  Expected products count.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertProductsCount
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Expected Product Count: '${expectedProductsCount}' ]"
          color: CYAN
      - getString:
          identifier: mx.mappings.ea.order-confirmation.productsCount
          storeIn: displayedProductsCount
      - log:
          message: "Displayed Product Count: '${displayedProductsCount}'"
          color: CYAN
      - verifyIdentifier:
          label:
            - identifier: mx.mappings.ea.order-confirmation.productsCount
              contains: ", ${expectedProductsCount} artículo"
      - log:
          message: "Assertion Succeeded: Products Count is correct"
          color: GREEN_BOLD
      - log:
          message: "End function: order-confirmation.assertProductsCount"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected user address by full string.
  # NOTE:         Home Delivery must be selected in order to perform assertion correctly.
  # PARAM:        ${addressFullString}  [Mandatory]  Full string containing the address to be validated.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertHomeAddressByFullString
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Expected Address Full String: '${addressFullString}' ]"
          color: CYAN
      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN
      # Assertion by Full String...
      - if:
          identifier:
            value:
              - identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
                contains: ${addressFullString}
          then:
            - log:
                message: "Assertion Succeeded: Home Address by Full String is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Home Address by Full String is not correct."
      - log:
          message: "End function: order-confirmation.assertHomeAddressByFullString"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected user address by its individual values.
  # NOTE:         Home Delivery must be selected in order to perform assertion correctly.
  # PARAMS:
  #               ${streetName}       [Mandatory]   Name of the street to be validated.
  #               ${exteriorNumber}   [Mandatory]   Exterior number to be validated.
  #               ${city}             [Mandatory]   City to be validated.
  #               ${state}            [Mandatory]   State to be validated.
  #               ${zipCode}          [Mandatory]   ZIP Code to be validated.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertHomeAddressByIndividualValues
    platform: ios
    flow:
      # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
      - log: "\e[36mExpected StreetName: '${streetName}'\e[0m"
      - log: "\e[36mExpected ExteriorNumber: '${exteriorNumber}'\e[0m"
      - log: "\e[36mExpected City: '${city}'\e[0m"
      - log: "\e[36mExpected State: '${state}'\e[0m"
      - log: "\e[36mExpected ZipCode: '${zipCode}'\e[0m"
      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN
      # Assertion by Individual Values...
      - executeNode:
          file: mx/test/helpers/utils/stringContainsAll.js
          args:
            - value: ${displayedAddress}
            - value: ${streetName}, ${exteriorNumber}, ${city}, ${state}, ${zipCode}
          getResponse:
            storeIn: isAddressCorrect
      - if:
          condition: ${isAddressCorrect} == true
          then:
            - log:
                message: "Home Address by individual values is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Expected Home address not contained in: '${displayedAddress}'"
      - log:
          message: "End function: order-confirmation.assertHomeAddressByIndividualValues"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected store address by full string.
  # NOTE:         Pickup Delivery must be selected in order to perform assertion correctly.
  # PARAMS:       ${addressFullString}  [Mandatory]  Full string containing the address to be validated.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertStoreAddressByFullString
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Expected Address Full String: '${addressFullString}' ]"
          color: CYAN
      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN
      # Assertion by Full String...
      - if:
          identifier:
            label:
              - identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
                contains: ${addressFullString}
          then:
            - log:
                message: "Assertion Succeeded: Store Address by Full String is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Store Address by Full String is not correct."
      - log:
          message: "End function: order-confirmation.assertStoreAddressByFullString"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertInStorePaymentMethodIsSelected
    platform: ios
    flow:
      - log:
          message: "Validating In-Store Payment Method is Selected..."
          color: CYAN
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.order-confirmation.inStorePaymentMethodIsSelected
          then:
            - log:
                message: "Assertion Succeeded: In-Store Payment Method is Selected."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: In-Store Payment Method is not Selected."
      - log:
          message: "End function: order-confirmation.assertInStorePaymentMethodIsSelected"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method gets the order number.
  # RETURNS:      ${returnedOrderNumber}
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.getOrderNumber
    platform: ios
    flow:
      - getString:
          identifier: mx.mappings.ea.order-confirmation.orderNumberLabel
          storeIn: orderNumber
      - executeNode:
          file: mx/test/helpers/order-confirmation/sanitizeOrderNumberValue.js
          args:
            - value: ${orderNumber}
          getResponse:
            storeIn: returnedOrderNumber
      - log:
          message: "Order number got: '${returnedOrderNumber}'"
          color: GREEN_BOLD
      - log:
          message: "End function: order-confirmation.getOrderNumber"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.tapFindMoreProducts
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.order-confirmation.findMoreProductsButton
          coordinates: 50%,50% # Element cannot be clicked by selector, but it can be clicked by coordinates.
      - log:
          message: "End function: order-confirmation.tapFindMoreProducts"
          color: BLUE
