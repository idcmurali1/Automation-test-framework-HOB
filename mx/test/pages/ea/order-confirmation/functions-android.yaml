#======================================================================================================================
#  AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#  CREATED: Oct/30/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertPageDisplayed
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.order-confirmation.orderNumberLabel
              - identifier: mx.mappings.ea.order-confirmation.total
              - identifier: mx.mappings.ea.order-confirmation.fulfillmentContainer
              - identifier: mx.mappings.ea.order-confirmation.findMoreProductsButton
          then:
            - log:
                message: "Assertion Succeeded: Order Confirmation page is displayed."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Order Confirmation page did not display."
      - log:
          message: "End function: order-confirmation.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method asserts the selected delivery method, either home delivery or pickup. Other values given
  #                 will fail the test.
  # PARAM         ${expectedDeliveryMethod} [Mandatory] Delivery method to assert. Options: [ 'HomeDelivery' | 'PickupDelivery' ].
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertDeliveryMethod
    platform: android
    flow:
      - if:
          condition: ${expectedDeliveryMethod} != 'HomeDelivery' && ${expectedDeliveryMethod} != 'PickupDelivery'
          then:
            - failTest:
                message: "Invalid Delivery Method Option provided: '${expectedDeliveryMethod}'"
      - log:
          message: "Assert For: '${expectedDeliveryMethod}'"
          color: CYAN

      # Home Delivery Assertion...
      - if:
          condition: ${expectedDeliveryMethod} == 'HomeDelivery'
          then:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.order-confirmation.homeDeliveryIsSelected
                then:
                  - log:
                      message: "Assertion Succeeded: Home Delivery Method is Selected."
                      color: CYAN
                else:
                  - failTest:
                      message: "Failed: Home Delivery Method is not Selected."

      # Pickup Delivery Assertion...
      - if:
          condition: ${expectedDeliveryMethod} == 'PickupDelivery'
          then:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.order-confirmation.pickupDeliveryIsSelected
                then:
                  - log:
                      message: "Assertion Succeeded: Pickup Delivery Method is Selected."
                      color: CYAN
                else:
                  - failTest:
                      message: "Failed: Pickup Delivery Method is not Selected."
      - log:
          message: "End function order-confirmation.assertDeliveryMethod"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedTotal} [Mandatory] Order total
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertTotal
    platform: android
    flow:
      - log:
          message: "Expected Total: '${expectedTotal}'"
          color: CYAN

      # Get displayed Total.
      - getString:
          identifier: mx.mappings.ea.order-confirmation.total
          attribute: text
          storeIn: displayedTotal

      # Clean the Total obtained and log it...
      - executeNode:
           file: mx/test/helpers/utils/cleanPriceString.js
           args:
             - value: ${displayedTotal}
           getResponse:
               storeIn: displayedTotal
      - log:
          message: "Displayed Total: '${displayedTotal}'"
          color: CYAN

      # Assert displayed vs expected...
      - if:
          condition: ${displayedTotal} == ${expectedTotal}
          then:
            - log:
                message: "Successful Assertion: Total is correct."
                color: CYAN
          else:
            - failTest:
                message: "Failed Assertion: Total is incorrect."
      - log:
          message: "End function: order-confirmation.assertTotal"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method asserts the selected delivery date collected from the updated one after selecting a
  #                 payment method in Review Order Page.
  # NOTE:         This function is ONLY for orders without multiple delivery sections.
  # PARAM:        ${expectedDeliveryDate} [Mandatory] Delivery date to assert.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertSingleDeliveryDate
    platform: android
    flow:
      - log:
          message: "Expected Delivery Date: '${expectedDeliveryDate}'"
          color: CYAN

      # Getting and parsing the displayed Delivery Date...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.deliveryDate
          storeIn: displayedDeliveryDate
      - executeNode:
          file: mx/test/helpers/utils/getDeliveryDateEA.js
          args:
            - value: ${displayedDeliveryDate}
          getResponse:
            storeIn: displayedDeliveryDate
      - log:
          message: "Displayed Delivery Date: '${displayedDeliveryDate}'"
          color: GREEN_BOLD

      # Comparing Expected vs Displayed...
      - if:
          condition: ${expectedDeliveryDate} == ${displayedDeliveryDate}
          then:
            - log:
                message: "Assertion Succeeded: Correct Delivery Date."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Incorrect Delivery Date."
      - log:
          message: "End function order-confirmation.assertSingleDeliveryDate"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method asserts the Home Delivery Address NAME and not the actual address.
  # PARAM         ${expectedHomeAddressName} [Mandatory] Address Name to validate.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertHomeAddressName
    platform: android
    flow:
      - log:
          message: "Expected Home Address Name: '${expectedHomeAddressName}'"
          color: CYAN
      - if:
          identifier:
            text:
              - identifier: mx.mappings.ea.order-confirmation.homeAddressName
                equals: ${expectedHomeAddressName}
          then:
            - log:
                message: "Assertion Succeeded: Correct Home Address Name."
                color: CYAN
          else:
            - failTest:
                message: "Failed: Incorrect Home Address Name."
      - log:
          message: "End function order-confirmation.assertHomeAddressName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAMS: ${expectedProductsCount}  [Mandatory]  Expected products count.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertProductsCount
    platform: android
    flow:
      - log:
          message: "Expected Product Count: '${expectedProductsCount}'"
          color: CYAN

      # Retrieving and parsing the displayed quantity...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.productsCount
          storeIn: displayedQuantity
      - executeNode:
          file: mx/test/helpers/utils/sanitizeQuantity.js
          args:
            - value: ${displayedQuantity}
          getResponse:
            storeIn: displayedQuantity
      - log:
          message: "Displayed Products Count: '${displayedQuantity}'"
          color: CYAN

      # Comparing the expected vs the displayed...
      - if:
          condition: ${expectedProductsCount} == ${displayedQuantity}
          then:
            - log:
                message: "Assertion Succeeded: Products Count is correct."
                color: CYAN
          else:
            - failTest:
                message: "Failed: Products Count is not correct."
      - log:
          message: "End function: order-confirmation.assertProductsCount"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected user address by full string.
  # NOTE:         Home Delivery must be selected in order to perform assertion correctly.
  # PARAM:        ${addressFullString}  [Mandatory]  Full string containing the address to be validated.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertHomeAddressByFullString
    platform: android
    flow:
      - log:
          message: "Expected Address Full String: '${addressFullString}'"
          color: CYAN

      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      # Assertion by Full String...
      - if:
          identifier:
            text:
              - identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
                contains: ${addressFullString}
          then:
            - log:
                message: "Assertion Succeeded: Home Address by Full String is correct."
                color: CYAN
          else:
            - failTest:
                message: "Failed: Home Address by Full String is not correct."
      - log:
          message: "End function: order-confirmation.assertHomeAddressByFullString"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected user address by its individual values.
  # NOTE:         Home Delivery must be selected in order to perform assertion correctly.
  # PARAMS:
  #               ${streetName}       [Mandatory]   Name of the street to be validated.
  #               ${exteriorNumber}   [Mandatory]   Exterior number to be validated.
  #               ${city}             [Mandatory]   City to be validated.
  #               ${state}            [Mandatory]   State to be validated.
  #               ${zipCode}          [Mandatory]   ZIP Code to be validated.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertHomeAddressByIndividualValues
    platform: android
    flow:
      # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
      - log: "\e[36mExpected StreetName: '${streetName}'\e[0m"
      - log: "\e[36mExpected ExteriorNumber: '${exteriorNumber}'\e[0m"
      - log: "\e[36mExpected City: '${city}'\e[0m"
      - log: "\e[36mExpected State: '${state}'\e[0m"
      - log: "\e[36mExpected ZipCode: '${zipCode}'\e[0m"

      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      # Assertion by Individual Values...
      - executeNode:
          file: mx/test/helpers/utils/stringContainsAll.js
          args:
            - value: ${displayedAddress}
            - value: ${streetName}, ${exteriorNumber}, ${city}, ${state}, ${zipCode}
          getResponse:
            storeIn: isAddressCorrect
      - if:
          condition: ${isAddressCorrect} == true
          then:
            - log:
                message: "Home Address by individual values is correct."
                color: CYAN
          else:
            - failTest:
                message: "Expected Home address not contained in: '${displayedAddress}'"
      - log:
          message: "End function: order-confirmation.assertHomeAddressByIndividualValues"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method verifies the selected store address by full string.
  # NOTE:         Pickup Delivery must be selected in order to perform assertion correctly.
  # PARAMS:       ${addressFullString}  [Mandatory]  Full string containing the address to be validated.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertStoreAddressByFullString
    platform: android
    flow:
      - log:
          message: "Expected Address Full String: '${addressFullString}'"
          color: CYAN

      # Retrieving displayed Address...
      - getString:
          identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
          storeIn: displayedAddress
      - log:
          message: "Displayed Address: '${displayedAddress}'"
          color: CYAN

      # Assertion by Full String...
      - if:
          identifier:
            text:
              - identifier: mx.mappings.ea.order-confirmation.storeOrHomeAddress
                contains: ${addressFullString}
          then:
            - log:
                message: "Assertion Succeeded: Store Address by Full String is correct."
                color: CYAN
          else:
            - failTest:
                message: "Failed: Store Address by Full String is not correct."
      - log:
          message: "End function: order-confirmation.assertStoreAddressByFullString"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.assertInStorePaymentMethodIsSelected
    platform: android
    flow:
      - log:
          message: "Validating In-Store Payment Method is Selected..."
          color: CYAN
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.order-confirmation.inStorePaymentMethodIsSelected
          then:
            - log:
                message: "Assertion Succeeded: In-Store Payment Method is Selected."
                color: CYAN
          else:
            - failTest:
                message: "Failed: In-Store Payment Method is not Selected."
      - log:
          message: "End function: order-confirmation.assertInStorePaymentMethodIsSelected"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION:  This method gets the order number.
  # RETURNS:      ${returnedOrderNumber}
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.getOrderNumber
    platform: android
    flow:
      - getString:
          identifier: mx.mappings.ea.order-confirmation.orderNumberLabel
          storeIn: orderNumber
      - executeNode:
          file: mx/test/helpers/order-confirmation/sanitizeOrderNumberValue.js
          args:
            - value: ${orderNumber}
          getResponse:
            storeIn: returnedOrderNumber
      - log:
          message: "Order number: '${returnedOrderNumber}'"
          color: GREEN_BOLD
      - log:
          message: "End function: order-confirmation.getOrderNumber"
          color: BLUE

  # -------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.order-confirmation.tapFindMoreProducts
    platform: android
    flow:
      - click:
          identifier: mx.mappings.ea.order-confirmation.findMoreProductsButton
      - log:
          message: "End function: order-confirmation.tapFindMoreProducts"
          color: BLUE
