#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Mar/08/2024
#  REVISION: ---
#
#  Copyright Â© 2024 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.assertPopupDisplayed
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.address-selector-popup.popupTitle
              - identifier: mx.mappings.ea.address-selector-popup.saveButton
              - identifier: mx.mappings.ea.address-selector-popup.addAddressButton
          then:
            - log:
                message: "Success: Address Selector Popup displayed."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Address Selector Popup did not display."
      - log:
          message: "End function: address-selector-popup.assertPopupDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # NOTE:   This function confirms the presence of an address by its NAME and does not verify the actual address.
  # PARAM:  ${homeAddressName}  [Mandatory]   Name of the address to assert for.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.assertHomeAddressName
    platform: ios
    flow:
      - log:
          message: "Expected home address name: '${homeAddressName}'"
          color: CYAN
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.address-selector-popup.addressByName # <--PARAM--${homeAddressName}
          then:
            - log:
                message: "Assertion Succeeded: Expected Home Delivery Address is listed."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Expected Home Delivery Address is not listed."
      - log:
          message: "End function: address-selector-popup.assertHomeAddressName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.tapAddAddressButton
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.address-selector-popup.addAddressButton
      - log:
          message: "End function: address-selector-popup.tapAddAddressButton"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${homeAddressName}  [Mandatory]   Name of the address to select.
  # NOTE:   Notice that there's no logic to scroll to the address in case it is not displayed, this is because in all
  #         Test cases no more than 2 addresses are being added to the account so they should always have at most 2 or
  #         3 addresses, and that's enough to be displayed in the address selector popup.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.selectAddressByName
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.address-selector-popup.addressByName # <--PARAM--${homeAddressName}
      - log:
          message: "End function: address-selector-popup.selectAddressByName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${homeAddressName}  [Mandatory]   Name of the address to select.
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.assertAddressIsSelectedByName
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.address-selector-popup.addressIsSelectedByName # <--PARAM--${homeAddressName}
          then:
            - log:
                message: "Assertion Succeeded: Expected address is selected."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Expected address is not selected."
      - log:
          message: "End function: address-selector-popup.assertAddressIsSelectedByName"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.tapSave
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.address-selector-popup.saveButton
      - log:
          message: "End function: address-selector-popup.tapSave"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This function gets and returns a string containing the selected address from the address-selector-popup in the
  #              variable ${returnedSelectedAddress}, but also it can return each piece of data from this string inside
  #              different variables ${returnedStreetName}, ${returnedExteriorNumber}, ${returnedCity}, ${returnedState},
  #              and ${returnedZipCode}. These will be needed for other address assertions. Grab these values whenever
  #              or wherever you need them.
  # PARAM:
  #   ${homeAddressName}  [Mandatory]  Name of the selected address.
  # RETURNS:
  #   ${returnedSelectedAddress} Full String containing the selected address.
  #   ${returnedStreetName}
  #   ${returnedExteriorNumber}
  #   ${returnedCity}
  #   ${returnedState}
  #   ${returnedZipCode}
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.getSelectedAddress
    platform: ios
    flow:
      - getString:
          identifier: mx.mappings.ea.address-selector-popup.selectedAddressStringByName # <--PARAM--${homeAddressName}
          storeIn: returnedSelectedAddress
      - log:
          message: "Displayed Selected address: '${returnedSelectedAddress}'"
          color: CYAN
      - executeNode:
          file: mx/test/helpers/address-selector-popup/splitAddressValues.js
          args:
            - value: ${returnedSelectedAddress}
            - value: ${APP_PLATFORM}
          getValue:
            - key: street
              storeIn: returnedStreetName
            - key: exteriorNumber
              storeIn: returnedExteriorNumber
            - key: city
              storeIn: returnedCity
            - key: state
              storeIn: returnedState
            - key: zipCode
              storeIn: returnedZipCode
      # Using '\e[36m' to print in CYAN and '\e[0m' to reset color, to simplify logs.
      - log: "\e[36mreturnedStreetName: '${returnedStreetName}'\e[0m"
      - log: "\e[36mreturnedExteriorNumber: '${returnedExteriorNumber}'\e[0m"
      - log: "\e[36mreturnedCity: '${returnedCity}'\e[0m"
      - log: "\e[36mreturnedState: '${returnedState}'\e[0m"
      - log: "\e[36mreturnedZipCode: '${returnedZipCode}'\e[0m"
      - log: "\e[36mreturnedSelectedAddress: '${returnedSelectedAddress}'\e[0m"
      - log:
          message: "End function: address-selector-popup.getSelectedAddress"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This method taps on edit address button
  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.address-selector-popup.tapEditAddress
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.address-selector-popup.editAddressButton
      - log:
          message: "End function: ea.address-selector-popup.tapEditAddress"
          color: BLUE
