#======================================================================================================================
#  AUTHOR: Rodrigo Pacheco Cámara (vn53p0i)
#  CREATED: Mar/01/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.orders-history.assertPageDisplayed
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: mx.mappings.ea.orders-history.pageTitle
              - identifier: mx.mappings.ea.orders-history.ordersContainer
              - identifier: mx.mappings.ea.orders-history.backButton
          then:
            - log:
                message: "Assertion Succeeded: Orders History Page is Displayed."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Orders History Page did not Display."
      - log:
          message: "End function: orders-history.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:        ${position}                 [Mandatory]   Position on the list of orders.
  # PARAM:        ${expectedDeliveryMethod}   [Mandatory]   Delivery method to assert. Options: [ 'HomeDelivery' | 'PickupDelivery' ].
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.orders-history.assertOrderDeliveryMethodByPosition
    platform: ios
    flow:
      - if:
          condition: ${expectedDeliveryMethod} != 'HomeDelivery' && ${expectedDeliveryMethod} != 'PickupDelivery'
          then:
            - failTest:
                message: "Invalid Delivery Method Option provided: '${expectedDeliveryMethod}'"
      - log:
          message: "[ PARAM: Position: '${position}' ]"
          color: CYAN
      - log:
          message: "[ PARAM: Assert For: '${expectedDeliveryMethod}' ]"
          color: CYAN
      # Home Delivery Assertion...
      - if:
          condition: ${expectedDeliveryMethod} == 'HomeDelivery'
          then:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.orders-history.homeDeliveryIsSelectedByPosition # <--PARAM--${position}
                then:
                  - log:
                      message: "Assertion Succeeded: Home Delivery Method is Selected."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Home Delivery Method is not Selected."
      # Pickup Delivery Assertion...
      - if:
          condition: ${expectedDeliveryMethod} == 'PickupDelivery'
          then:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.ea.orders-history.pickupDeliveryIsSelectedByPosition # <--PARAM--${position}
                then:
                  - log:
                      message: "Assertion Succeeded: Pickup Delivery Method is Selected."
                      color: GREEN_BOLD
                else:
                  - failTest:
                      message: "Failed: Pickup Delivery Method is not Selected."
      - log:
          message: "End function orders-history.assertOrderDeliveryMethodByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAM:  ${expectedTotal}  [Mandatory]   Expected (cleaned) total to assert.
  # PARAM:  ${position}       [Mandatory]   Position on the list of orders.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.orders-history.assertOrderTotalByPosition
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Position: '${position}' ]"
          color: CYAN
      - log:
          message: "[ PARAM: Expected Total: '${expectedTotal}' ]"
          color: CYAN
      # Get displayed Total.
      - getString:
          identifier: mx.mappings.ea.orders-history.orderTotalByPosition # <--PARAM--${position}
          attribute: value
          storeIn: displayedOrderTotal
      # Clean the Total obtained and log it...
      - executeNode:
           file: mx/test/helpers/utils/cleanPriceString.js
           args:
             - value: ${displayedOrderTotal}
           getResponse:
               storeIn: displayedOrderTotal
      - log:
          message: "Displayed Total: '${displayedOrderTotal}'"
          color: CYAN
      # Assert displayed vs expected...
      - if:
          condition: ${displayedOrderTotal} == ${expectedTotal}
          then:
            - log:
                message: "Successful Assertion: Total is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed Assertion: Total is incorrect."
      - log:
          message: "End function: orders-history.assertOrderTotalByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAMS:
  #   ${position}             [Mandatory]   Position on the list of orders.
  #   ${expectedOrderStatus}  [Mandatory]   Expected order status. Values: [ Received | Waiting4Payment | Ready4Pickup | OnTheWay | Delivered ].
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.orders-history.assertOrderStatusByPosition
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Position: '${position}' ]"
          color: CYAN
      - if:
          condition: ${expectedOrderStatus} != 'Received' && ${expectedOrderStatus} != 'Waiting4Payment' && ${expectedOrderStatus} != 'Ready4Pickup' && ${expectedOrderStatus} != 'OnTheWay' && ${expectedOrderStatus} != 'Delivered'
          then:
            - failTest:
                message: "Expected Order Status not valid. Provided Order Status: '${expectedOrderStatus}'"
      - executeNode:
          file: mx/test/helpers/orders-history/parseToOrderStatusText.js
          args:
            - value: ${expectedOrderStatus}
          getResponse:
            storeIn: orderStatus
      - log:
          message: "[ PARAM: Expected Order Status: '${expectedOrderStatus}' (${orderStatus}) ]"
          color: CYAN
      - verifyIdentifier:
          value:
            - identifier: mx.mappings.ea.orders-history.orderStatusByPosition # <--PARAMS--${position}
              contains: ${orderStatus}
      - log:
          message: "Order Status is correct!"
          color: GREEN_BOLD
      - log:
          message: "End function: orders-history.assertOrderStatusByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAMS:
  #   ${position}               [Mandatory]   Position on the list of orders.
  #   ${expectedProductsCount}  [Mandatory]   Expected total quantity of purchased products.
  # NOTE: This function only works for orders without multiple deliveries.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.orders-history.assertOrderProductsCountByPosition
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Position: '${position}' ]"
          color: CYAN
      - log:
          message: "[ PARAM: Expected products count: '${expectedProductsCount}' ]"
          color: CYAN
      # Retrieving and parsing the displayed quantity...
      - getString:
          identifier: mx.mappings.ea.orders-history.productsCountByPosition # <--PARAMS--${position}
          storeIn: displayedQuantity
      - executeNode:
          file: mx/test/helpers/utils/sanitizeQuantity.js
          args:
            - value: ${displayedQuantity}
          getResponse:
            storeIn: displayedQuantity
      - log:
          message: "Displayed Products Count: '${displayedQuantity}'"
          color: CYAN
      # Comparing the expected vs the displayed...
      - if:
          condition: ${expectedProductsCount} == ${displayedQuantity}
          then:
            - log:
                message: "Assertion Succeeded: Products Count is correct."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Products Count is not correct."
      - log:
          message: "End function: orders-history.assertOrderProductsCountByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # NOTE:   This function is ONLY for orders with a Single Delivery section.
  # PARAMS:
  #   ${position}               [Mandatory]   Position on the list of orders.
  #   ${expectedDeliveryDate}   [Mandatory]   Delivery date to assert.
  # RETURNS:
  #   ${returnedDeliveryDate}   This is the parsed delivery date that can be used to assert the date on Order-Details page.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.orders-history.assertOrderSingleDeliveryDateByPosition
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Position: '${position}' ]"
          color: CYAN
      - log:
          message: "[ PARAM: Expected Delivery Date: '${expectedDeliveryDate}' ]"
          color: CYAN
      # Parsing the expected Delivery Date...
      - executeNode:
          file: mx/test/helpers/orders-history/parseToOrderDeliveryDateLabelEA.js
          args:
            - value: ${expectedDeliveryDate}
          getResponse:
            storeIn: expectedDeliveryDate
      - log:
          message: "Parsed Expected Delivery Date: '${expectedDeliveryDate}'"
          color: CYAN
      # Getting the displayed Delivery Date...
      - getString:
          identifier: mx.mappings.ea.orders-history.estimatedDeliveryDateByPosition # <--PARAMS--${position}
          attribute: value
          storeIn: displayedDeliveryDate
      - log:
          message: "Displayed Delivery Date: '${displayedDeliveryDate}'"
          color: CYAN
      # Comparing Expected vs Displayed...
      - if:
          condition: ${expectedDeliveryDate} == ${displayedDeliveryDate}
          then:
            - log:
                message: "Assertion Succeeded: Correct Delivery Date."
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Failed: Incorrect Delivery Date."
      - storeIn:
          key: returnedDeliveryDate
          value: ${expectedDeliveryDate}
      - log:
          message: "Returned Parsed Delivery Date: '${returnedDeliveryDate}'"
          color: GREEN_BOLD
      - log:
          message: "End function orders-history.assertOrderSingleDeliveryDateByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # PARAMS: ${position}   [Mandatory]   Position on the list of orders.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.orders-history.openOrderByPosition
    platform: ios
    flow:
      - log:
          message: "[ PARAM: Position: '${position}' ]"
          color: CYAN
      - click:
          identifier: mx.mappings.ea.orders-history.viewDetailsButtonByPosition # <--PARAMS--${position}
      - log:
          message: "End function: order-history.openOrderByPosition"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # AUTHOR: Rodrigo Pacheco C. (vn53p0i)
  - name: mx.functions.ea.orders-history.tapBack
    platform: ios
    flow:
      - click:
          identifier: mx.mappings.ea.orders-history.backButton
      - log:
          message: "End function: orders-history.tapBack"
          color: BLUE
