#======================================================================================================================
#  AUTHOR: Osmar Juárez (vn56dce)
#  CREATED: Nov/01/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

functions:

  # DESCRIPTION: This method asserts that a Sub-Department Screen is displayed
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.department-l1-l2.assertPageDisplayed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.department-l1-l2.topContainersView
            - identifier: mx.mappings.ea.department-l1-l2.backButton
      - log:
          message: "Assertion Succeeded: Sub-Department screen is displayed"
          color: CYAN
      - log:  
          message: "End function: ea.department-l1-l2.assertPageDisplayed"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------            

  # DESCRIPTION: This function clicks on back button.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.department-l1-l2.tapBack
    platform: android
    flow:
      - click:
          identifier: mx.mappings.ea.department-l1-l2.backButton
      - log:  
          message: "End function: ea.department-l1-l2.tapBack"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This function clicks on back button.
  # AUTHOR: Rodrigo Pacheco (vn53p0i)
  - name: mx.functions.ea.department-l1-l2.openFirstAvailableCategory
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: mx.mappings.ea.department-l1-l2.genericCategoryButton
          then:
            - scroll:
                direction: down
                untilIdentifier: mx.mappings.ea.department-l1-l2.genericCategoryButton
                wait: 1000
                scrollLimit: 10
                position: center
      - getString:
          identifier: mx.mappings.ea.department-l1-l2.genericCategoryButton
          attribute: text
          storeIn: categoryName
      - log:
          message: "First available category button found: '${categoryName}'"
          color: GREEN_BOLD
      - click:
          identifier: mx.mappings.ea.department-l1-l2.categoryButtonByName
      - log:
          message: "End function: ea.department-l1-l2.openFirstAvailableCategory"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: Scrolls down until the given section name is displayed.
  # PARAM: ${carouselName}  [Mandatory]  Name of the section to scroll.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.department-l1-l2.scrollDownToSectionCarousel
    platform: android
    flow:
      - log:
          message: "Scroll down until find '${carouselName}' section"
          color: CYAN
      - scroll:
          direction: down
          untilIdentifier: mx.mappings.ea.department-l1-l2.section-carousel.carouselContainerByName # <--PARAM--${carouselName}
          scrollLimit: 8
          wait: 3000
          position: center
      - log:  
          message: "End function: ea.department-l1-l2.scrollDownToSectionCarousel"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # DESCRIPTION: This function scrolls right inside carousel until find a product with a promotion label (sales, payment promotions).
  # PARAM: ${promotionLabel} [Mandatory]  Name of the promotion of the product to scroll until.
  # PARAM: ${carouselName}   [Mandatory]  Name of the carousel containing the product.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.department-l1-l2.section-carousel.scrollRightToProductWithPromotion
    platform: android
    flow:
      - log:
          message: "Scroll until find product with promotion '${promotionLabel}' inside of '${carouselName}' carousel"
          color: CYAN
      - if:
          identifier:
            timeout: 2000
            present:
              - identifier: mx.mappings.ea.department-l1-l2.section-carousel.firstProductWithPromotionLabel # <--PARAM--${promotionLabel}
          then:
            - log:  
                message: "Product with promotion displayed. No need to scrolling in carousel"
                color: CYAN
          else:
            - scroll:
                direction: left
                withinIdentifier: mx.mappings.ea.department-l1-l2.section-carousel.carouselContainerByName       # <--PARAM--${carouselName}
                untilIdentifier: mx.mappings.ea.department-l1-l2.section-carousel.firstProductWithPromotionLabel # <--PARAM--${promotionLabel}
                scrollLimit: 5
                wait: 700
      - log:  
          message: "End function: ea.department-l1-l2.section-carousel.scrollRightToProductWithPromotion"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------            

  # DESCRIPTION: This function clicks on a product view with a promotion label like sales or payment promotions.
  # PARAM: ${promotionLabel} [Mandatory]  Name of the promotion of the product
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.department-l1-l2.section-carousel.openFirstProductWithPromotion
    platform: android
    flow:
      - log:
          message: "Click on product with promotion '${promotionLabel}'"
          color: CYAN
      - click:
          identifier: mx.mappings.ea.department-l1-l2.section-carousel.firstProductWithPromotionLabel # <--PARAM--${promotionLabel}
      - log:
          message: "End function: ea.department-l1-l2.section-carousel.openFirstProductWithPromotion"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------            

  # DESCRIPTION: This method asserts the counter of items of a specific product added to the shopping cart
  # PARAM: ${productName}       [Mandatory]  Name of the product to find.
  # PARAM: ${expectedQuantity}  [Mandatory]  Number of items of the product.
  # AUTHOR: Osmar Juárez (vn56dce)
  - name: mx.functions.ea.department-l1-l2.section-carousel.assertProductQuantity
    platform: android
    flow:
      - log:
          message: "Expected '${expectedQuantity}' items of product '${productName}'"
          color: CYAN
      - verifyIdentifier:
          present:
            - identifier: mx.mappings.ea.department-l1-l2.section-carousel.productCounterLabel  # <--PARAMS--${productName} AND ${expectedQuantity}
      - log:
          message: "Assertion Succeeded: '${expectedQuantity}'' of '${productName}' added to cart"
          color: CYAN
      - log:
          message: "End function: ea.department-l1-l2.section-carousel.assertProductQuantity"
          color: BLUE
