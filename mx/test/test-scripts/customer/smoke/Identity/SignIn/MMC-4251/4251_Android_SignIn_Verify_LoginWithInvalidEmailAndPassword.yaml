#======================================================================================================================
#  AUTHOR: Francisco Ramirez (vn53vq4)
#  CREATED: Dec/05/2024
#  REVISION: ---
#  MANUAL JIRA TICKET: https://jira.walmart.com/browse/MMC-4251
#  AUTOMATED JIRA TICKET: https://jira.walmart.com/browse/MMC-4475
#  FLOW: Navigate to EA Banner, open Account page and perform login.
#
#  Copyright 춸 2024 Walmart. All rights reserved.
#  NOTE: We are working only on PROD environments.
#  NOTE: JIRA features are not implemented yet for WCP approach.
#======================================================================================================================

general:
  tags: customer-walmart-ea-smoke-production-android, customer-walmart-ea-smoke-production-android-4251,
        customer-bodega-ea-smoke-production-android, customer-bodega-ea-smoke-production-android-4251
  testCaseId: MMC-4475

scenarios:

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   B E F O R E   S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Before
    before: true
    flow:

      - log: R2_SUBFLOW_BEFORE ### [[ 游릭 Flow Identifier: BEFORE 游릭 ]] ###

      - executeFunction:
          name: functions.utils.setMarketInfo

      - storeIn:
          key: testStatus 
          value: false
      
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   M A I N   S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:

      - log: R2_SUBFLOW_LAUNCH_AND_LOGIN ### [[ 游릭 Flow Identifier: LAUNCH & LOGIN 游릭 ]] ###

      - storeIn:
          key: incompleteUserEmail
          value: mx.data.customer.incompleteUserEmail
      
      - storeIn:
          key: invalidUserEmail
          value: mx.data.customer.invalidUserEmail

      # Onboarding
      - log:
          message: "Step 1: Complete onboarding and open EA banner."
          color: GREEN_BOLD
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore

      # Search for an item and open cart
      - log:
          message: "Step 2: Search for an item and open cart"
          color: GREEN_BOLD

      - executeFunction:
          name: functions.global.tapShopBtn
      
      - executeFunction:
          name: mx.flows.od.search.addItemToCartFromSearch
          params:
            - name: searchTerm
              string: mx.data.customer.productName1
            - name: productName
              string: mx.data.customer.productName1
      
      - storeIn:
          key: cartIsEmpty
          value: false

      # Open cart
      - log:
          message: "Step 3: Open cart..."
          color: GREEN_BOLD
      - executeFunction:
          name: functions.global.tapCartIcon
      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn
      
      # Perform Login: Invalid password.
      - log:
          message: "Step 4.1 - Verify: Perform login with incomplete email. Invalidation [#1]"
          color: GREEN_BOLD
      - executeFunction:
          name: functions.loginPage.enterEmail.forSSOFlow # <-- ${incompleteUserEmail}
          params:
            - name: userEmail
              string: ${incompleteUserEmail}
      - executeFunction:
          name: functions.loginPage.tapContinue
      - executeFunction:
          name: mx.functions.login.assertIncorrectCredentialsErrorDisplayed
      
      - log:
          message: "Step 4.2 - Verify: Perform login with invalid email. Invalidation [#2]"
          color: GREEN_BOLD
      - executeFunction:
          name: functions.loginPage.enterEmail.forSSOFlow # <-- ${invalidUserEmail}
          params:
            - name: userEmail
              string: ${invalidUserEmail}
      - executeFunction:
          name: functions.loginPage.tapContinue
      - executeFunction:
          name: mx.functions.login.complete-your-information.assertPageDisplayed
      - goBack: true
      - sleep:
          duration: 2000
      
      - log:
          message: "Step 4.3 - Verify: Perform login with a valid email. Invalidation [#3]"
          color: GREEN_BOLD
      - storeIn:
          key: userEmail
          value: mx.data.customer.userEmail
      - executeFunction:
          name: functions.loginPage.enterEmail.forSSOFlow # <-- ${userEmail}
          params:
            - name: userEmail
              string: ${userEmail}
      - executeFunction:
          name: functions.loginPage.tapContinue
      - executeFunction:
          name: mx.functions.login.welcome-page.assertPageDisplayed

      # Main hook completed
      - storeIn:
          key: testStatus 
          value: true
       
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   A F T E R  S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: After
    after: true
    flow:
      - if:
          condition: ${testStatus}
          then:
            - log:
                message: "4251: Android_SignIn_Verify_LoginWithInvalidEmailAndPassword - Completed Succesfully!!"
                color: YELLOW_BOLD
          else:
            - failTest:
                message: "4251: Android_SignIn_Verify_LoginWithInvalidEmailAndPassword  - TEST FAILED!"