#======================================================================================================================
#  AUTHOR: Francisco Ramirez (vn53vq4)
#  CREATED: Jan/20/25
#  REVISION: ---
#  MANUAL JIRA TICKET: https://jira.walmart.com/browse/MMC-4256
#  AUTOMATED JIRA TICKET: https://jira.walmart.com/browse/MMC-4479
#
#  FLOW: Navigate to EA Banner, navigate to account and perform login, go back to home page and add any products to cart
#        open cart and tap on edit delivery address.
#
#  Copyright 춸 2024 Walmart. All rights reserved.
#  NOTE: We are working only on PROD environments.
#======================================================================================================================

general:
  tags: customer-walmart-ea-smoke-production-android, customer-walmart-ea-smoke-production-android-4256,
        customer-bodega-ea-smoke-production-android, customer-bodega-ea-smoke-production-android-4256
  testCaseId: MMC-4477

scenarios:

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   B E F O R E   S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Before
    before: true
    flow:

      - log: R2_SUBFLOW_BEFORE ### [[ 游릭 Flow Identifier: BEFORE 游릭 ]] ###

      - executeFunction:
          name: functions.utils.setMarketInfo
      
      - storeIn:
          key: testCompleted 
          value: false
      
      #Cart is empty
      - storeIn:
          key: cartEmpty 
          value: true

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   M A I N   S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:

      - log: R2_SUBFLOW_LAUNCH_AND_LOGIN ### [[ 游릭 Flow Identifier: LAUNCH & LOGIN 游릭 ]] ###

      # Step 1-2: Onboarding and select EA Banner.
      - log:
          message: "Step 1-2: Onboarding"
          color: GREEN_BOLD
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore

      # Step 3-4-5-6: Tap global account button and sign in.
      - log:
          message: "Step 3-4-5: Succesfully login"
          color: CYAN        
      - executeFunction:
          name: functions.global.tapAccountBtn
      - executeFunction:
          name: functions.accountPage.tapSignInBtn
      - executeFunction:
          name: functions.loginPage.userAuthentication # <-- ${userEmail}, ${userPassword}
          params:
            - name: userEmail
              string: mx.customer.4256.userAccount_android.email
            - name: userPassword
              string: mx.customer.userAccount.password
      - executeFunction:
          name: functions.accountPage.assertUserLoggedInSuccessfully

      
      # Step 7-8: Add products to the cart.
      - log:
          message: "Step 7-8: Add products to cart"
          color: CYAN  
      - executeFunction:
          name: functions.global.tapShopBtn
      - executeFunction:
          name: functions.searchPage.addToCartUsingItemArray
          params:
            - name: productArray
              string: mx.data.customer.simpleProductsArray
      #Cart is not empty
      - storeIn:
          key: cartEmpty 
          value: false

      # Step 9: Open Cart
      - log:
          message: "Step 9: Open cart"
          color: CYAN
      - executeFunction:
         name: functions.global.tapCartIcon
      - executeFunction:
          name: functions.cartPage.isCartPageDisplayed
      
      # Step 10-11: Add and edit delivery address
      - log:
          message: "Step 10-11: Edit delivery address"
          color: CYAN
      - executeFunction:
          name: functions.cartPage.tapOnAddressLink
      - sleep:
         duration: 3000
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.tapEditDeliveryAddressCheckoutFullUser # <-- ${userFullName}
          params:
            - name: userFullName
              string: mx.data.customer.shared.userFullName

      # Step 12: Tap edit addres by Full name.
      - log:
          message: "Step 12: Address selected"
          color: CYAN 
      - sleep:
         duration: 3000
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.scrollUpToDeliveryAddressFirstName
      
      # Step 10: Enter first name.
      - log:
          message: "Step 10: Enter first name"
          color: CYAN
      - executeFunction:
          name: functions.addAddressPage.enterFirstName # <-- ${firstName}
          params:
            - name: firstName
              string: mx.data.customer.shared.expectedFirstName
      - executeFunction:
          name: functions.addAddressPage.enterLastName # <-- ${lastName}
          params:
            - name: lastName
              string: mx.data.customer.shared.expectedLastName   
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.enterStreetDeliveryAddress # <-- ${streetAddress}
          params:
            - name: streetAddress
              string: mx.data.customer.shared.expectedStreetAddress
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.scrollUpToExteriorNumber
      - sleep:
         duration: 3000
      - executeFunction:
          name: functions.addAddressPage.enterExteriorNumber # <-- ${exteriorNumber}
          params:
            - name: exteriorNumber
              string: mx.data.customer.shared.expectedExteriorNumber
      - executeFunction:
          name: functions.addAddressPage.enterInteriorNumber # <-- ${interiorNumber}
          params:
            - name: interiorNumber
              string: mx.data.customer.shared.expectedInteriorNumber
      - executeFunction:
          name: functions.addAddressPage.enterZipCode # <-- ${zipCode}
          params:
            - name: zipCode
              string: mx.data.customer.shared.expectedZipCode
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.enterColoniaName # <-- ${coloniaName}
          params:
            - name: coloniaName
              string: mx.data.customer.shared.expectedColoniaName
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.enterCrossingStreets
          params:
            - name: crossingStreets 
              string: mx.data.customer.shared.expectedCrossingStreets
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.enterReferences # <-- ${references}
          params:
            - name: references
              string: mx.data.customer.shared.expectedReferences
      - executeFunction:
          name: mx.functions.add-and-edit-address-form.enterPhoneNumber # <-- ${phoneNumber}
          params:
            - name: phoneNumber
              string: mx.data.customer.shared.expectedPhoneNumber
      - executeFunction:
          name: functions.add-and-edit-address-form.setDeliveryAddressAsFavoriteDeliveryAddress

      # Step 13: Tap save button and verify the address edited.
      - log:
          message: "Step 17: Tap save button and verify address listed"
          color: CYAN
      - executeFunction:
          name:  functions.addAddressPage.tapSaveButton
      - executeFunction:
          name: functions.addAddressPage.mapViewForAddressConfirmation.confirmLocation
      - sleep:
         duration: 3000
      - executeFunction:
          name: functions.cartPage.tapOnAddressLink
      - executeFunction:
          name: mx.functions.addresses.assertAddressByIndividualValues
          params:
            - name: userFullName
              string: mx.data.customer.shared.userFullName
            - name: expectedStreetName
              string: mx.data.customer.shared.expectedStreetAddress
            - name: expectedExteriorNumber
              string: mx.data.customer.shared.expectedExteriorNumber
            - name: expectedCity
              string: mx.data.customer.shared.expectedCity
            - name: expectedState
              string: mx.data.customer.expectedState
            - name: expectedZipCode
              string: mx.data.customer.shared.expectedZipCode
      - executeFunction:
          name: mx.functions.add-address-form.tapClose
      - sleep:
         duration: 3000

      # Extra Step: Clean up cart.
      - executeFunction:
          name: functions.cartPage.removeRegularAndOOSItems/loop
      #Cart is empty
      - storeIn:
          key: cartEmpty 
          value: true

      #Test Execution Status.   
      - storeIn:
          key: testCompleted 
          value: true

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   A F T E R  S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: After
    after: true
    flow:
      - if:
          condition: ${testCompleted}
          then:
            - log:
                  message: "4256: Customer_Smoke_PROD_Android_DeliveryAddress_Verify_EditDeliveryAddressFromCheckout - Completed Succesfully!!"
                  color: YELLOW_BOLD
          else:
            - failTest:
                message: "4256: Customer_Smoke_PROD_Android_DeliveryAddress_Verify_EditDeliveryAddressFromCheckout - TEST FAILED!"