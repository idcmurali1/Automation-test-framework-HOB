#======================================================================================================================
#    AUTHOR: Osmar Juárez (vn56dce)
#   CREATED: Mar/5/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-dev-phase-ea-production-ios-025

scenarios:
#######################################################################################################################
#
#   CONFLUENCE TRACKING DASHBOARD:
#     https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+iOS
#
#   JIRA AUTOMATION TC:
#     https://jira.walmart.com/browse/MXMOB-1658
#
#   JIRA MANUAL TC:
#     https://jira.walmart.com/browse/MXMOB-1581
#
#######################################################################################################################

  - name: Main
    flow:
      - log: "TEST START: ${__SQUAD_REPORTING_TEST_CASE_NAME}"

      # STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER - EA HOME IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-025.zipCode
            - name: banner
              string: 'EA'

  #--------------------------------------------------------------------------------------------------------------------

      # STEP 2: NAVIGATE TO ACCOUNT AND CREATE AN ACCOUNT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 2: NAVIGATE TO ACCOUNT AND CREATE AN ACCOUNT."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed

      - executeFunction:
         name: mx.flows.login.createAccountFromAccountScreen  # RETURN --${returnedUniqueEmail}-->
         params:
           - name: userFirstName
             string: mx.data.qaa.sanity.ea-025.userFirstName
           - name: userLastName
             string: mx.data.qaa.sanity.ea-025.userLastName
           - name: userPassword
             string: mx.data.qaa.sanity.ea-025.userPassword
           - name: testCaseNum
             string: 'ea_025'
      - storeIn:
          key: EA_025_CREATED_USER_EMAIL
          value: ${returnedUniqueEmail}

      - executeFunction: 
         name:  mx.functions.ea.account.assertUserLogged
         params: 
           - name: userName
             string: mx.data.qaa.sanity.ea-025.userFirstName
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 3: IN ACCOUNT PAGE SELECT "SOLICITUD DE ELIMINACIÓN DE CUENTA" OPTION
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 3: IN ACCOUNT PAGE SELECT 'SOLICITUD DE ELIMINACIÓN DE CUENTA' OPTION."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.account.customer-service.tapAccountDeletionRequest
      - executeFunction:
         name: mx.functions.ea.delete-account.assertPageDisplayed

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 3 (A): VERIFY PRIVACY NOTICE LINK"
            - name: squadNames
              string: CUSTOMER | QAA
      
      - executeFunction:
         name: mx.functions.ea.delete-account.tapPrivacyNoticeLink
      - executeFunction:
         name: mx.functions.ea.delete-account.privacy-notice-web-view.assertPageDisplayed
      - executeFunction:
         name: mx.functions.ea.delete-account.privacy-notice-web-view.tapDoneWebView
      - executeFunction:
         name: mx.functions.ea.delete-account.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      # STEP 4: CANCEL ACCOUNT DELETE PROCESS BY CLICKING ON "REGRESAR" BUTTON
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 4: CANCEL ACCOUNT DELETE PROCESS BY CLICKING ON 'REGRESAR' BUTTON."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.delete-account.tapCancelButton
      - executeFunction:
         name: mx.functions.ea.account.assertPageDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 5: SELECT "ELIMINAR MI CUENTA" OPTION AGAIN
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 5: SELECT 'ELIMINAR MI CUENTA' OPTION AGAIN."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.account.customer-service.tapAccountDeletionRequest
      - executeFunction:
         name: mx.functions.ea.delete-account.assertPageDisplayed
        
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 6: CLICK ON "CONTINUAR" BUTTON
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 6: CLICK ON 'CONTINUAR' BUTTON."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.delete-account.tapContinueButton
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.assertPageDisplayed
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.assertEmailDisplayed
         params:
           - name: expectedEmailAddress
             string: ${EA_025_CREATED_USER_EMAIL}
      
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 7: ENTER AN INVALID PASSWORD AND CLICK "CONFIRMAR" BUTTON
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7: ENTER AN INVALID PASSWORD AND CLICK 'CONFIRMAR' BUTTON."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.enterPassword
         params:
           - name: userPassword
             string: mx.data.qaa.sanity.ea-025.userWrongPassword
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.tapContinue
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.assertPageDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 8: ENTER THE CORRECT PASSWORD AND CLICK "CONFIRMAR" BUTTON
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 8: ENTER THE CORRECT PASSWORD AND CLICK 'CONFIRMAR' BUTTON."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.enterPassword
         params:
           - name: userPassword
             string: mx.data.qaa.sanity.ea-025.userPassword
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.tapContinue
      - executeFunction:
         name: mx.functions.ea.account.confirm-deletion-account-process-popup.assertPageDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 9: CLICK ON 'ENTENDIDO' BUTTON
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9: CLICK ON 'ENTENDIDO' BUTTON."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.functions.ea.account.confirm-deletion-account-process-popup.tapUnderstoodButton
      - executeFunction:
         name: mx.functions.ea.account.assertNoUserLogged
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 10: TRY TO LOGIN FROM ACCOUNT PAGE USING DELETED USER CREDENTIALS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 10: TRY TO LOGIN FROM ACCOUNT PAGE USING DELETED USER CREDENTIALS."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.functions.ea.account.tapLogin
      - executeFunction:
          name: mx.functions.ea.login.enterEmail
          params:
            - name: userEmail
              string: ${EA_025_CREATED_USER_EMAIL}
      - executeFunction:
          name: mx.functions.ea.login.enterPassword
          params:
            - name: userPassword
              string: mx.data.qaa.sanity.ea-025.userPassword
      - executeFunction:
          name: mx.functions.ea.login.tapLogin
      - executeFunction:
         name: mx.functions.ea.login.assertIncorrectCredentialsErrorDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 11: TRY TO CREATE A NEW ACCOUNT USING DELETED USER ID
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 11: TRY TO CREATE A NEW ACCOUNT USING DELETED USER ID."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.flows.od.login.createAccountFromLoginPopup  
         params:
           - name: userFirstName
             string: mx.data.qaa.sanity.ea-025.userFirstName
           - name: userLastName
             string: mx.data.qaa.sanity.ea-025.userLastName
           - name: userEmail
             string: ${EA_025_CREATED_USER_EMAIL}
           - name: userPassword
             string: mx.data.qaa.sanity.ea-025.userPassword
           - name: skipEmailAndPsswrd
             string: "true"

      - executeFunction: 
         name:  mx.functions.ea.account.assertUserLogged
         params: 
           - name: userName
             string: mx.data.qaa.sanity.ea-025.userFirstName
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 12: DELETE THE ACCOUNT AGAIN
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 12: DELETE THE ACCOUNT AGAIN."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.account.customer-service.tapAccountDeletionRequest
      - executeFunction:
         name: mx.functions.ea.delete-account.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.delete-account.tapContinueButton
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.assertPageDisplayed
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.assertEmailDisplayed
         params:
           - name: expectedEmailAddress
             string: ${EA_025_CREATED_USER_EMAIL}
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.enterPassword
         params:
           - name: userPassword
             string: mx.data.qaa.sanity.ea-025.userPassword
      - executeFunction:
         name: mx.functions.ea.delete-account.quick-security-check-popup.tapContinue
      - executeFunction:
         name: mx.functions.ea.account.confirm-deletion-account-process-popup.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: EA_025_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: ${__SQUAD_REPORTING_TEST_CASE_NAME}"
  
  #####################################################################################################################

  - name: Before
    platform: ios
    before: true
    flow:
      - log: "BEFORE SCENARIO START: Initial Config..."
      
      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_iOS_025

      - storeIn:
          key: EA_025_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - log: "AFTER SCENARIO START: After Configs..."

      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${EA_025_SUCCESSFUL_EXECUTION}
      - if:
          condition: ${EA_025_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: User created during execution, no need to reset data."
                color: RED
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: GREEN_BOLD
      - log: "AFTER SCENARIO END"
