#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Jan/04/2024
#  REVISION: ---
#
#  Copyright Â© 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-ea-sanity-production-android-014, qaa-ea-sanity-production-android
  testCaseId: MXMOB-1622

scenarios:
#######################################################################################################################
#
#   CONFLUENCE TRACKING DASHBOARD:
#     https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+Android
#
#   JIRA AUTOMATION TC:
#     https://jira.walmart.com/browse/MXMOB-1622
#
#   JIRA MANUAL TC:
#     https://jira.walmart.com/browse/MXMOB-1592
#
#   FLAGS USED: N/A
#
#######################################################################################################################

  - name: Before
    before: true
    flow:

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_Android_014
      - log:
          message: "WORKAROUND: RELAUNCHING APP TO FIX ISSUE REGARDING INTERNAL APP FLAGS"
          color: YELLOW
      - executeFunction:
          name: mx.functions.utils.relaunchApp
      - storeIn:
          key: EA_014_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: Main
    flow:
      - log: "TEST START: QAA - EA - PRODUCTION SANITY - EA-014"

      ## STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER - EA HOME IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-014.zipCode
            - name: banner
              string: 'EA'

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 2-3: NAVIGATE TO ACCOUNT PAGE AND CREATE A NEW ACCOUNT - NEW ACCOUNT IS CREATED AND USER IS LOGGED IN.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 2-3: NAVIGATE TO ACCOUNT PAGE AND CREATE A NEW ACCOUNT."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
      - executeFunction:
         name: mx.flows.od.login.createAccountFromLoginPopup
         params:
           - name: userFirstName
             string: mx.data.qaa.sanity.ea-014.userFirstName
           - name: userLastName
             string: mx.data.qaa.sanity.ea-014.userLastName
           - name: userPassword
             string: mx.data.qaa.sanity.ea-014.userPassword
           - name: testCaseNum
             string: '014'
      - executeFunction:
         name:  mx.functions.ea.account.assertUserLogged
         params: 
           - name: userName
             string: mx.data.qaa.sanity.ea-014.userFirstName

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 4: ADD NEW ADDRESS FROM ACCOUNT - NEW ADDRESS IS ADDED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 4: ADD NEW ADDRESS FROM ACCOUNT."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.account.openAddresses
      - executeFunction:
          name: mx.functions.ea.addresses.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.addresses.tapAddAddressButton
      - executeFunction:
          name: mx.functions.ea.add-and-edit-address-form.assertPageDisplayed
      - executeFunction:
          name: mx.flows.ea.addresses.addHomeDeliveryAddressFromPopup
          params:
            - name: userFirstName
              string: mx.data.qaa.sanity.ea-014.userFirstName
            - name: userLastName
              string: mx.data.qaa.sanity.ea-014.userLastName
            - name: userStreet
              string: mx.data.qaa.sanity.ea-014.userStreet
            - name: userExteriorNumber
              string: mx.data.qaa.sanity.ea-014.userExteriorNumber
            - name: userZipCode
              string: mx.data.qaa.sanity.ea-014.zipCode
            - name: userNeighborhood
              string: mx.data.qaa.sanity.ea-014.userNeighborhood
            - name: expectedUserState
              string: mx.data.qaa.sanity.ea-014.userState
            - name: expectedUserCity
              string: mx.data.qaa.sanity.ea-014.userCity
            - name: expectedUserMunicipality
              string: mx.data.qaa.sanity.ea-014.userMunicipality
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-014.userPhoneNumber
            - name: markAsFavorite
              string: 'true'
      - sleep:
          duration: 5000
      - executeFunction:
          name: mx.functions.ea.addresses.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.addresses.assertAddressByIndividualValues
          params:
            - name: addressName
              string: mx.data.qaa.sanity.ea-014.newAddressName
            - name: expectedStreetName
              string: mx.data.qaa.sanity.ea-014.userStreet
            - name: expectedExteriorNumber
              string: mx.data.qaa.sanity.ea-014.userExteriorNumber
            - name: expectedCity
              string: mx.data.qaa.sanity.ea-014.userCity
            - name: expectedState
              string: mx.data.qaa.sanity.ea-014.userState
            - name: expectedZipCode
              string: mx.data.qaa.sanity.ea-014.zipCode

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 5: NAVIGATE TO DEPARTMENTS - DEPARTMENTS PAGE IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 5: NAVIGATE TO DEPARTMENTS."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.addresses.tapBack
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapDepartments
      - executeFunction:
          name: mx.functions.ea.departments.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 6: SEARCH FOR A PRODUCT WITH 5 STARS RATING ON REVIEWS - SLP AND PRODUCT ARE DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 6: SEARCH FOR A PRODUCT WITH 5 STARS RATING ON REVIEWS."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.sanity.ea-014.searchTerm
      - executeFunction:
          name: mx.flows.ea.sort-and-filter.addSoldByFilterWithOptionFromSLP
          params:
            - name: soldByOption
              string: 'ByWalmart'
      - executeFunction:
          name: mx.flows.ea.sort-and-filter.addCustomerRatingFilterWithOptionFromSLP
          params:
            - name: customerRating
              string: '5'
      - executeFunction:
          name: mx.functions.ea.slp.findProductByCustomerRating #--RETURNS--${returnedProductName}
          params:
            - name: customerRating
              string: '5'
      - storeIn:
          key: QAA_EA_014_PRODUCT_NAME
          value: ${returnedProductName}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 7: OPEN PDP - PDP IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7: OPEN PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.slp.openProductDetailsByName
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.pdp.assertCorrectProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.pdp.assertCorrectCustomerRating
          params:
            - name: customerRating
              string: '5'

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 8: ADD PRODUCT TO CART - PRODUCT IS ADDED TO CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 8: ADD PRODUCT TO CART."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.addToCart
      - executeFunction:
          name: mx.functions.ea.pdp.assertAddedToCart
      - executeFunction:
          name: mx.functions.ea.pdp.checkIfProductHasDiscount #--RETURNS--${returnedHasDiscount}-->
      - executeFunction:
          name: mx.functions.ea.pdp.getProductPrice #--RETURNS--${returnedPrice}--${returnedOriginalPrice}--${returnedDiscountAmount}-->
      - storeIn:
          key: QAA_EA_014_PRODUCT_HAS_DISCOUNT
          value: ${returnedHasDiscount}
      - storeIn:
          key: QAA_EA_014_PRODUCT_UNIT_PRICE
          value: ${returnedPrice}
      - storeIn:
          key: QAA_EA_014_PRODUCT_ORIGINAL_PRICE
          value: ${returnedOriginalPrice}
      - storeIn:
          key: QAA_EA_014_PRODUCT_SAVINGS_AMOUNT
          value: ${returnedDiscountAmount}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 9: OPEN THE FULL DETAILS LINK FROM THE PDP - THE FULL PRODUCT DETAILS INFO SHOULD BE DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9: OPEN THE FULL DETAILS LINK FROM THE PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.tapMoreDetailsLink
      - executeFunction:
          name: mx.functions.ea.pdp.more-details.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 10: GO BACK TO PDP - PDP IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 10: GO BACK TO PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.more-details.tapBack
      - executeFunction:
          name: mx.functions.ea.pdp.genericPageAssertion

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 11: INCREASE PRODUCT QUANTITY FROM PDP - QUANTITY IS INCREASED UP TO 2.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 11: INCREASE PRODUCT QUANTITY FROM PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.increaseProductQuantityBy
          params:
            - name: quantity
              string: '1'
            - name: ignoreClickException
              string: 'false'
      - executeFunction:
          name: mx.functions.ea.pdp.getProductQuantity #--RETURNS--${returnedProductQuantity}-->
      - storeIn:
          key: QAA_EA_014_PRODUCT_QUANTITY
          value: ${returnedProductQuantity}
      - arithmetic:
          expression: ${QAA_EA_014_PRODUCT_QUANTITY} * ${QAA_EA_014_PRODUCT_UNIT_PRICE}
          numberOfDecimalPlaces: 2
          storeIn: QAA_EA_014_PRODUCT_SUBTOTAL

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 12: CLOSE PDP - SLP SHOULD BE DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 12: CLOSE PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.tapClose
      - executeFunction:
          name: mx.functions.ea.slp.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 13: OPEN CART - PRODUCT INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 13: OPEN CART."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.selectDeliveryMethod
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-014.deliveryMethod
      - executeFunction:
          name: mx.flows.ea.cart.changeAddressByNameFromSelector
          params:
            - name: addressName
              string: mx.data.qaa.sanity.ea-014.newAddressName
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.getSingleDeliveryDate #--RETURNS--${returnedDeliveryDate}
      - storeIn:
          key: QAA_EA_014_CART_DELIVERY_DATE
          value: ${returnedDeliveryDate}
      - executeFunction:
          name: mx.flows.ea.cart.quickPerformProductAssertions
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
            - name: expectedQuantity
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
            - name: expectedUnitPrice
              string: ${QAA_EA_014_PRODUCT_UNIT_PRICE}
            - name: assertDiscount
              string: ${QAA_EA_014_PRODUCT_HAS_DISCOUNT}
            - name: expectedOriginalPrice
              string: ${QAA_EA_014_PRODUCT_ORIGINAL_PRICE}
            - name: expectedSubtotal
              string: ${QAA_EA_014_PRODUCT_SUBTOTAL}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 14: VALIDATE CART TOTALS - TOTALS ARE CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 14: VALIDATE CART TOTALS."
            - name: squadNames
              string: PURCHASE | QAA

      # Calculating Cart Total Savings Amount...
      - arithmetic:
          expression: ${QAA_EA_014_PRODUCT_QUANTITY} * ${QAA_EA_014_PRODUCT_SAVINGS_AMOUNT}
          numberOfDecimalPlaces: 2
          storeIn: QAA_EA_014_TOTAL_SAVINGS_AMOUNT

      # Calculating Cart Subtotal...
      - arithmetic:
          expression: ${QAA_EA_014_PRODUCT_SUBTOTAL} + ${QAA_EA_014_TOTAL_SAVINGS_AMOUNT}
          numberOfDecimalPlaces: 2
          storeIn: QAA_EA_014_SUBTOTAL

      - executeFunction:
          name: mx.functions.ea.cart.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.flows.ea.cart.assertTotals
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-014.deliveryMethod
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedDeliveryFee
              string: mx.data.qaa.sanity.ea-014.deliveryFee
            - name: assertDiscount
              string: ${QAA_EA_014_PRODUCT_HAS_DISCOUNT}
            - name: expectedSubtotal
              string: ${QAA_EA_014_SUBTOTAL}
            - name: expectedSavingsAmount
              string: ${QAA_EA_014_TOTAL_SAVINGS_AMOUNT}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 15: DECREASE PRODUCT QUANTITY FROM CART - PRODUCT INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 15: DECREASE PRODUCT QUANTITY FROM CART."
            - name: squadNames
              string: PURCHASE | QAA

      - scroll:
          direction: up
          scrollLimit: 1
          wait: 1000
      - executeFunction:
          name: mx.functions.ea.cart.decreaseProductQuantityBy
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
            - name: quantity
              string: '1'

      # Updating Cart Values...

      # Total product savings amount...
      - storeIn:
          key: QAA_EA_014_TOTAL_SAVINGS_AMOUNT
          value: ${QAA_EA_014_PRODUCT_SAVINGS_AMOUNT}

      # Total product quantity...
      - arithmetic:
          expression: ${QAA_EA_014_PRODUCT_QUANTITY} - 1
          storeIn: QAA_EA_014_PRODUCT_QUANTITY

      # Product Subtotal...
      - storeIn:
          key: QAA_EA_014_PRODUCT_SUBTOTAL
          value: ${QAA_EA_014_PRODUCT_UNIT_PRICE}

      # Calculating Cart Subtotal...
      - arithmetic:
          expression: ${QAA_EA_014_PRODUCT_SUBTOTAL} + ${QAA_EA_014_TOTAL_SAVINGS_AMOUNT}
          numberOfDecimalPlaces: 2
          storeIn: QAA_EA_014_SUBTOTAL

      # Verifying product information after modifying quantity...
      - executeFunction:
          name: mx.flows.ea.cart.quickPerformProductAssertions
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
            - name: expectedQuantity
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
            - name: expectedUnitPrice
              string: ${QAA_EA_014_PRODUCT_UNIT_PRICE}
            - name: assertDiscount
              string: ${QAA_EA_014_PRODUCT_HAS_DISCOUNT}
            - name: expectedOriginalPrice
              string: ${QAA_EA_014_PRODUCT_ORIGINAL_PRICE}
            - name: expectedSubtotal
              string: ${QAA_EA_014_PRODUCT_SUBTOTAL}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 16: VALIDATE CART TOTALS - TOTALS ARE CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 16: VALIDATE CART TOTALS."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.flows.ea.cart.assertTotals
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-014.deliveryMethod
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedDeliveryFee
              string: mx.data.qaa.sanity.ea-014.deliveryFee
            - name: assertDiscount
              string: ${QAA_EA_014_PRODUCT_HAS_DISCOUNT}
            - name: expectedSubtotal
              string: ${QAA_EA_014_SUBTOTAL}
            - name: expectedSavingsAmount
              string: ${QAA_EA_014_TOTAL_SAVINGS_AMOUNT}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 17: CLICK CONTINUE AND PROCEED TO REVIEW-ORDER - INITIAL REVIEW ORDER ASSERTIONS.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 17: CLICK CONTINUE AND PROCEED TO REVIEW-ORDER."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.tapContinue
      - sleep:
          duration: 8000
      - executeFunction:
          name: mx.flows.ea.cart.proceedToReviewOrderWithoutErrors
      - executeFunction:
          name: mx.functions.ea.review-order.assertPageDisplayed
      - executeFunction:
          name: mx.flows.ea.review-order.assertHomeDeliveryInformation
          params:
            - name: assertBy
              string: 'FullString'
            - name: expectedDeliveryDate
              string: ${QAA_EA_014_CART_DELIVERY_DATE}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-014.newAddressName
            - name: addressFullString
              string: mx.data.qaa.sanity.ea-014.android.addressFullString
      - executeFunction:
          name: mx.functions.ea.review-order.assertProductsCountInDeliveryDetailsSection
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.review-order.openProductsDetailsPopup
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertPopupDisplayed
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductsCount
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductListed
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.tapClose

  #--------------------------------------------------------------------------------------------------------------------

        ## STEP 18: SELECT IN-STORE PAYMENT METHOD - PAYMENT METHOD IS SELECTED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 18: SELECT IN-STORE PAYMENT METHOD."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: 'Payment'
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.review-order.paymentSectionContainer
      - executeFunction:
          name: mx.flows.ea.review-order.selectInStorePaymentMethod

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 19: FINAL REVIEW ORDER ASSERTIONS - REVIEW ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 19: FINAL REVIEW ORDER ASSERTIONS."
            - name: squadNames
              string: PURCHASE | QAA

      - scroll:
          direction: up
          scrollLimit: 2
      - executeFunction:
          name: mx.functions.ea.review-order.getSingleDeliveryDate #--RETURNS--${returnedDeliveryDate}-->
      - storeIn:
          key: QAA_EA_014_REVIEW_ORDER_DELIVERY_DATE
          value: ${returnedDeliveryDate}
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: "PhoneNumber"
      - executeFunction:
          name: mx.flows.ea.review-order.enterCellphoneNumberIfNotDisplayed
          params:
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-014.userPhoneNumber
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: "Totals"
      - executeFunction:
          name: mx.functions.ea.review-order.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.flows.ea.review-order.assertTotals #--RETURNS--${returnedEstimatedTotal}-->
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-014.deliveryMethod
            - name: expectedDeliveryFee
              string: mx.data.qaa.sanity.ea-014.deliveryFee
            - name: expectedSubtotal
              string: ${QAA_EA_014_PRODUCT_ORIGINAL_PRICE}
            - name: assertDiscount
              string: ${QAA_EA_014_PRODUCT_HAS_DISCOUNT}
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedSavingsAmount
              string: ${QAA_EA_014_PRODUCT_SAVINGS_AMOUNT}
      - storeIn:
          key: QAA_EA_014_ORDER_TOTAL
          value: ${returnedEstimatedTotal}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 20: PLACE ORDER - ORDER CONFIRMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 20: PLACE ORDER AND VALIDATE ORDER CONFIRMATION PAGE."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.tapPlaceOrder #--RETURNS--${returnedOrderedDate}-->
      - sleep:
          duration: 10000
      - storeIn:
          key: QAA_EA_014_ORDERED_DATE
          value: ${returnedOrderedDate}
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.order-confirmation.getOrderNumber #--RETURNS--${returnedOrderNumber}-->
      - storeIn:
          key: QAA_EA_014_ORDER_NUMBER
          value: ${returnedOrderNumber}
      - executeFunction:
          name: mx.flows.ea.order-confirmation.assertConfirmationForHomeDelivery
          params:
            - name: expectedTotal
              string: ${QAA_EA_014_ORDER_TOTAL}
            - name: expectedDeliveryDate
              string: ${QAA_EA_014_REVIEW_ORDER_DELIVERY_DATE}
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-014.newAddressName
            - name: isMultipleDelivery
              string: 'false'
            - name: assertBy
              string: 'FullString'
            - name: addressFullString
              string: mx.data.qaa.sanity.ea-014.android.addressFullString

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 21: NAVIGATE TO ACCOUNT PAGE - ACCOUNT SCREEN IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 21: NAVIGATE TO ACCOUNT PAGE."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.order-confirmation.tapFindMoreProducts
      - sleep:
          duration: 10000
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 22: VERIFY ORDER IN ORDERS HISTORY - ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 22: VERIFY ORDER IN ORDERS HISTORY."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.account.openOrdersHistory
      - executeFunction:
          name: mx.functions.ea.orders-history.assertPageDisplayed
      - executeFunction:
          name: mx.flows.ea.orders-history.assertOrder #--RETURNS--${returnedDeliveryDate}-->
          params:
            - name: orderNumber
              string: ${QAA_EA_014_ORDER_NUMBER}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-014.deliveryMethod
            - name: expectedTotal
              string: ${QAA_EA_014_ORDER_TOTAL}
            - name: isMultipleDelivery
              string: 'false'
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.ea-014.expectedOrderStatus
            - name: expectedDeliveryDate
              string: ${QAA_EA_014_REVIEW_ORDER_DELIVERY_DATE}
            - name: expectedProductsCount
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - storeIn:
          key: QAA_EA_014_ORDERS_HISTORY_DELIVERY_DATE
          value: ${returnedDeliveryDate}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 23: OPEN ORDER DETAILS AND CONFIRM CORRECT INFORMATION - ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 23: OPEN ORDER DETAILS AND CONFIRM CORRECT INFORMATION."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.orders-history.openOrder
          params:
            - name: orderNumber
              string: ${QAA_EA_014_ORDER_NUMBER}

      # First assertions...
      - executeFunction:
          name: mx.flows.ea.order-details.assertDetailsForHomeDeliveryWithSingleDelivery
          params:
            - name: expectedOrderNumber
              string: ${QAA_EA_014_ORDER_NUMBER}
            - name: expectedOrderedDate
              string: ${QAA_EA_014_ORDERED_DATE}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-014.deliveryMethod
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.ea-014.expectedOrderStatus
            - name: expectedDeliveryDate
              string: ${QAA_EA_014_ORDERS_HISTORY_DELIVERY_DATE}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-014.newAddressName
            - name: assertBy
              string: 'FullString'
            - name: addressFullString
              string: mx.data.qaa.sanity.ea-014.android.addressFullStringInOrderDetails
      - executeFunction:
          name: mx.functions.ea.order-details.expandProductsDetailsIfNotExpandedForSingleDelivery
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.order-details.collapseProductDetailsSectionButton
      
      # Product Assertions...
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_014_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductUnitPrice
          params:
            - name: expectedUnitPrice
              string: ${QAA_EA_014_PRODUCT_ORIGINAL_PRICE}
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductOrderedQuantity
          params:
            - name: expectedQuantity
              string: ${QAA_EA_014_PRODUCT_QUANTITY}
      - scroll:
          direction: down
          scrollLimit: 1

      # Totals Assertions...
      - executeFunction:
          name: mx.functions.ea.order-details.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${QAA_EA_014_PRODUCT_ORIGINAL_PRICE}
      - executeFunction:
          name: mx.functions.ea.order-details.assertDiscount
          params:
            - name: expectedDiscount
              string: ${QAA_EA_014_PRODUCT_SAVINGS_AMOUNT}
      - executeFunction:
          name: mx.functions.ea.order-details.assertDeliveryFee
          params:
            - name: expectedDeliveryFee
              string: mx.data.qaa.sanity.ea-014.deliveryFee
      - executeFunction:
          name: mx.functions.ea.order-details.assertTotal
          params:
            - name: expectedTotal
              string: ${QAA_EA_014_ORDER_TOTAL}
      - scroll:
          direction: down
          scrollLimit: 1
          wait: 1000

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 24: CANCEL ORDER - ORDER STATUS IS 'CANCELED'.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 24: CANCEL ORDER."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.order-details.cancelOrderWithSetOption

  #--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: EA_014_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: QAA - EA - PRODUCTION SANITY - EA-014"

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${EA_014_SUCCESSFUL_EXECUTION}
      - if:
          condition: ${EA_014_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: Account Creation... No data to reset for the next execution..."
                color: GREEN_BOLD
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: GREEN_BOLD
      - log: "AFTER SCENARIO END"
