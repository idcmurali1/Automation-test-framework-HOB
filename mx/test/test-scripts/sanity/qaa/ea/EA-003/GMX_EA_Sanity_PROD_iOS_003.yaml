#======================================================================================================================
#    AUTHOR: Osmar Juárez (vn56dce)
#   CREATED: Mar/22/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-dev-phase-ea-production-ios-003

scenarios:
#######################################################################################################################
#
#  CONFLUENCE TRACKING DASHBOARD:
#     https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+iOS
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MXMOB-1636
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MXMOB-1603
#
#######################################################################################################################

  - name: Main
    platform: ios
    flow:
      - log: "TEST START: ${__SQUAD_REPORTING_TEST_CASE_NAME}"
      
      # STEP 1: NAVIGATE THROUGH ONBOARDING AND SWITCH TO EA - EA HOME IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 1: NAVIGATE THROUGH ONBOARDING AND SWITCH TO THE EA.'
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-003.zipCode
            - name: banner
              string: 'EA'

  #--------------------------------------------------------------------------------------------------------------------

      # STEP 2: NAVIGATE TO ACCOUNT
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 2: NAVIGATE TO ACCOUNT SCREEN'
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 3: NEW USER ACCOUNT CREATED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 3: CREATE NEW USER ACCOUNT'
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.flows.od.login.createAccountFromLoginPopup
         params:
           - name: userFirstName
             string: mx.data.qaa.sanity.ea-003.userFirstName
           - name: userLastName
             string: mx.data.qaa.sanity.ea-003.userLastName
           - name: userPassword
             string: mx.data.qaa.sanity.ea-003.userPassword
           - name: testCaseNum
             string: '003'

      - executeFunction: 
         name:  mx.functions.ea.account.assertUserLogged
         params: 
           - name: userName
             string: mx.data.qaa.sanity.ea-003.userFirstName

  #--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: EA_003_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: ${__SQUAD_REPORTING_TEST_CASE_NAME}"

  #####################################################################################################################

  - name: Before
    before: true
    flow:
      - log: "BEFORE SCENARIO START: Initial Config..."

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_iOS_003
      
      - storeIn:
          key: EA_003_IS_ORDER_CREATED
          value: false
      - storeIn:
          key: EA_003_SUCCESSFUL_EXECUTION
          value: false
    
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: After
    after: true
    platform: ios
    flow:
      - log: "AFTER SCENARIO START"

      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${EA_003_SUCCESSFUL_EXECUTION} 
      - if:
          condition: ${EA_003_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: Verifying if there's data to reset for the next execution..."
                color: CYAN

            # Relaunching app, and navigate to home page...
            - executeFunction:
                name: mx.flows.ea.after-scenario-exclusive.relaunchAndNavigateToHomePage

            # Cancel Order in case it was not deleted during main scenario...
            - if:
                condition: ${EA_003_IS_ORDER_CREATED} == true
                then:
                  - log:
                      message: "New Order was created but couldn't cancel during Main Scenario, resetting data..."
                      color: CYAN
                  - executeFunction:
                      name: mx.functions.ea.bottom-menu.tapAccount
                  - executeFunction:
                      name: mx.functions.ea.account.assertPageDisplayed
                  - executeFunction:
                      name: mx.functions.ea.account.openOrdersHistory
                  - executeFunction:
                      name: mx.functions.ea.orders-history.openOrder
                      params:
                        - name: orderNumber
                          string: ${QAA_EA_003_ORDER_NUMBER}
                  - executeFunction:
                      name: mx.flows.ea.order-details.cancelOrderWithSetOption
                
      - log: "AFTER SCENARIO END"
