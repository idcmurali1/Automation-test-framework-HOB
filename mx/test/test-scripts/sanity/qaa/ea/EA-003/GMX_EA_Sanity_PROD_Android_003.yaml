#======================================================================================================================
#    AUTHOR: Osmar Juárez (vn56dce)
#   CREATED: Oct/24/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-dev-phase-ea-production-android-003

scenarios:
#######################################################################################################################
#
#  CONFLUENCE TRACKING DASHBOARD:
#    https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+Android
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MXMOB-1611
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MXMOB-1603
#
#######################################################################################################################

  - name: Main
    flow:
      - log: "TEST START: ${__SQUAD_REPORTING_TEST_CASE_NAME}"
      
      ## STEP 1: NAVIGATE THROUGH ONBOARDING AND SWITCH TO EA - EA HOME IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 1: NAVIGATE THROUGH ONBOARDING AND SWITCH TO THE EA.'
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-003.zipCode
            - name: banner
              string: 'EA'

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 2: NAVIGATE TO ACCOUNT
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 2: NAVIGATE TO ACCOUNT SCREEN'
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      # STEP 3: NEW USER ACCOUNT CREATED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 3: CREATE NEW USER ACCOUNT'
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
         name: mx.flows.od.login.createAccountFromLoginPopup
         params:
           - name: userFirstName
             string: mx.data.qaa.sanity.ea-003.userFirstName
           - name: userLastName
             string: mx.data.qaa.sanity.ea-003.userLastName
           - name: userPassword
             string: mx.data.qaa.sanity.ea-003.userPassword
           - name: testCaseNum
             string: '003'

      - executeFunction: 
         name:  mx.functions.ea.account.assertUserLogged
         params: 
           - name: userName
             string: mx.data.qaa.sanity.ea-003.userFirstName

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 4: OPEN INVOICE SCREEN, SELECT ADD AND FILL INFO FOR ADD NEW INVOICE PROFILE.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 4: ADD NEW INVOICE PROFILE'
            - name: squadNames
              string: POST-PURCHASE | QAA  
      
      - executeFunction:
          name: mx.functions.ea.account.tapInvoice
      - executeFunction:
          name: mx.functions.ea.invoice.assertPageDisplayed
      
      - executeFunction:
          name: mx.functions.ea.invoice.tapAddInvoiceInfo

      - executeFunction:
          name: mx.flows.ea.invoice.addNewMoralPersonInvoiceProfile
          params:
            - name: taxCompanyName
              string: mx.data.qaa.sanity.ea-003.taxCompanyName
            - name: taxPayerId
              string: mx.data.qaa.sanity.ea-003.taxPayerId
            - name: taxRegime
              string: mx.data.qaa.sanity.ea-003.taxRegime
            - name: cfdiType
              string: mx.data.qaa.sanity.ea-003.cfdiType
            - name: invoiceEmail
              string: mx.data.qaa.sanity.ea-003.invoiceEmail
            - name: invoiceZipCode
              string: mx.data.qaa.sanity.ea-003.invoiceZipCode
            - name: invoiceStreetName
              string: mx.data.qaa.sanity.ea-003.invoiceStreetName
            - name: invoiceOutdoorNumber
              string: mx.data.qaa.sanity.ea-003.invoiceOutdoorNumber
            - name: invoiceNeighborhood
              string: mx.data.qaa.sanity.ea-003.invoiceNeighborhood
            - name: invoiceMunicipality
              string: mx.data.qaa.sanity.ea-003.invoiceMunicipality
            - name: invoiceCity
              string: mx.data.qaa.sanity.ea-003.invoiceCity
            - name: invoiceState
              string: mx.data.qaa.sanity.ea-003.invoiceState
            - name: invoiceCountryCodePhoneNumber
              string: mx.data.qaa.sanity.ea-003.invoiceCountryCodePhoneNumber
            - name: invoicePhoneNumber
              string: mx.data.qaa.sanity.ea-003.invoicePhoneNumber
            - name: isMainInvoiceProfile
              string: 'true'
            - name: invoiceAddress
              string: mx.data.qaa.sanity.ea-003.invoiceFullAddress
            - name: cfdiId
              string: mx.data.qaa.sanity.ea-003.cfdiId

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 5: BACK TO ACCOUNT SCREEN, RE-OPEN INVOICING AND VALIDATE INVOICE PROFILE KEEPS LISTED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 5: BACK TO ACCOUNT SCREEN, RE-OPEN INVOICING AND VALIDATE INVOICE PROFILE KEEPS LISTED'
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction: 
          name:  mx.functions.ea.invoice.tapBackButton
      - executeFunction: 
          name:  mx.functions.ea.account.assertPageDisplayed
    
      - executeFunction: 
          name:  mx.functions.ea.account.tapInvoice
    
      - executeFunction: 
          name:  mx.functions.ea.invoice.assertInvoiceProfileDisplayed
          params: 
            - name: invoiceType
              string: 'Organización'
            - name: invoiceName
              string: mx.data.qaa.sanity.ea-003.taxCompanyName
            - name: taxPayerId
              string: mx.data.qaa.sanity.ea-003.taxPayerId
            - name: cfdiId
              string: mx.data.qaa.sanity.ea-003.cfdiId
            - name: invoiceAddress
              string: mx.data.qaa.sanity.ea-003.invoiceFullAddress
            - name: email
              string: mx.data.qaa.sanity.ea-003.invoiceEmail
            - name: isMainProfile
              string: 'true'

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 6: GO BACK TO ACCOUNT AND NAVIGATE THROUGH DEPARTMENTS TO A PLP SCREEN.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 6: BACK TO ACCOUNT AND NAVIGATE THROUGH DEPARTMENTS TO A PLP SCREEN'
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction: 
          name:  mx.functions.ea.invoice.tapBackButton
      - executeFunction: 
          name:  mx.functions.ea.account.assertPageDisplayed
    
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapDepartments
      - executeFunction:
          name: mx.functions.ea.departments.assertPageDisplayed

      - executeFunction:
          name: mx.functions.ea.departments.selectDepartmentByIndex
          params:
            - name: departmentIndex
              string: mx.data.qaa.sanity.ea-003.departmentIndex 
      - executeFunction:
          name: mx.functions.ea.department-l1-l2.assertPageDisplayed
  
  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 7: SEARCH FOR A PRODUCT WITH MSI PROMOTION AND OPENS ITS PDP.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 7: SEARCH FOR A PRODUCT WITH MSI PROMOTION AND OPENS ITS PDP'
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.department-l1-l2.scrollDownToSectionCarousel
          params:
            - name: carouselName
              string: mx.data.qaa.sanity.ea-003.carouselName
      - executeFunction:
          name: mx.functions.ea.department-l1-l2.section-carousel.scrollRightToProductWithPromotion
          params:
            - name: carouselName
              string: mx.data.qaa.sanity.ea-003.carouselName
            - name: promotionLabel
              string: 'MSI'
      - executeFunction: 
          name:  mx.functions.ea.department-l1-l2.section-carousel.openFirstProductWithPromotion
          params:
            - name: promotionLabel
              string: 'MSI'

      - executeFunction:
          name: mx.functions.ea.pdp.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.pdp.assertMonthsWithoutInterestDetails

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 8: ADD PRODUCT TO CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 8: ADD PRODUCT TO CART'
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.addToCart
      - executeFunction:
          name: mx.functions.ea.pdp.assertAddedToCart

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 9: CLOSE PDP.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 9: CLOSE PDP'
            - name: squadNames
              string: PRE-PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.pdp.getProductName #--RETURNS--${returnedProductName}
      - storeIn:
          key: QAA_EA_003_PRODUCT_NAME
          value: ${returnedProductName}
      - executeFunction:
          name: mx.functions.ea.pdp.getProductPrice #--RETURNS--${returnedPrice}
      - storeIn:
          key: QAA_EA_003_PRODUCT_PRICE
          value: ${returnedPrice}
      
      - executeFunction:
          name: mx.functions.ea.pdp.tapClose 
      - executeFunction:
          name: mx.functions.ea.department-l1-l2.section-carousel.assertProductQuantity
          params:
            - name: productName
              string: ${QAA_EA_003_PRODUCT_NAME}
            - name: expectedQuantity
              string: '1'

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 10: NAVIGATE TO CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 10: NAVIGATE TO CART'
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.getSingleDeliveryDate #--RETURNS--${returnedDeliveryDate}
      - storeIn:
          key: QAA_EA_003_CART_DELIVERY_DATE
          value: ${returnedDeliveryDate}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 11: VALIDATE PRODUCT DETAILS COMPARED VS PDP.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 11: VALIDATE PRODUCT DETAILS WITH MSI INFO'
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.flows.ea.cart.quickPerformProductAssertions
          params:
            - name: productName
              string: ${QAA_EA_003_PRODUCT_NAME}
            - name: expectedQuantity
              string: '1'
            - name: expectedUnitPrice
              string: 'null'
            - name: assertDiscount
              string: 'false'
            - name: expectedOriginalPrice
              string: 'null'
            - name: expectedSubtotal
              string: ${QAA_EA_003_PRODUCT_PRICE}
            - name: direction
              string: 'null'
      - executeFunction:
          name: mx.functions.ea.cart.assertProductMonthsWithoutInterest
          params:
            - name: productName
              string: ${QAA_EA_003_PRODUCT_NAME}

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 12: VALIDATE CART TOTALS WITH PRODUCTS COUNT (IN SUBTOTAL LABEL), SUBTOTAL, DELIVERY FEE
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 12: VALIDATE CART TOTALS'
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: '1'
      
      - executeFunction:
          name: mx.flows.ea.cart.assertTotals     #--RETURNS--${returnedDeliveryFee}-->
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-003.deliveryMethod
            - name: expectedDeliveryFee
              string: 'null'
            - name: expectedSubtotal
              string: ${QAA_EA_003_PRODUCT_PRICE}
            - name: assertDiscount
              string: 'false'
            - name: assertDeliveryFee
              string: 'false'
            - name: expectedSavingsAmount
              string: 'false'
      - storeIn:
          key: QAA_EA_003_DELIVERY_FEE_SHOPPING_CART
          value: ${returnedDeliveryFee}

#--------------------------------------------------------------------------------------------------------------------

      # STEP 13: CONTINUE PURCHASE
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 13: CONTINUE PURCHASE'
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.tapContinue
      - executeFunction:
          name: mx.functions.ea.add-and-edit-address-form.assertPageDisplayed

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 14: ADD NEW DELIVERY ADDRESS FROM CART
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 14: ADD NEW DELIVERY ADDRESS FROM CART'
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.flows.ea.addresses.addHomeDeliveryAddressFromPopup
          params:
            - name: userFirstName
              string: mx.data.qaa.sanity.ea-003.userFirstName
            - name: userLastName
              string: mx.data.qaa.sanity.ea-003.userLastName
            - name: userStreet
              string: mx.data.qaa.sanity.ea-003.invoiceStreetName
            - name: userExteriorNumber
              string: mx.data.qaa.sanity.ea-003.invoiceOutdoorNumber
            - name: userInteriorNumber
              string: 'null'
            - name: userZipCode
              string: mx.data.qaa.sanity.ea-003.invoiceZipCode
            - name: userNeighborhood
              string: mx.data.qaa.sanity.ea-003.invoiceNeighborhood
            - name: expectedUserState
              string: mx.data.qaa.sanity.ea-003.invoiceState
            - name: expectedUserCity
              string: mx.data.qaa.sanity.ea-003.invoiceCity
            - name: expectedUserMunicipality
              string: mx.data.qaa.sanity.ea-003.invoiceMunicipality
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-003.invoicePhoneNumber
            - name: markAsFavorite
              string: 'true'
      - executeFunction:
          name: mx.functions.ea.address-selector-popup.assertHomeAddressName
          params:
            - name: homeAddressName 
              string: mx.data.qaa.sanity.ea-003.userFullName

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 15: Continue with purchase with the selected delivery address
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 15: CONTINUE TO PURCHASE WITH SELECTED DELIVERY ADDRESS'
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.address-selector-popup.tapSave
      - executeFunction:
          name: mx.functions.ea.review-order.assertPageDisplayed
         
#--------------------------------------------------------------------------------------------------------------------
      
      ## STEP 16: Validate the initial/top information of Review Order (delivery date, delivery address, products)
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 16: REVIEW ORDER - INITIAL ASERTIONS (DELIVERY DATE, ADDRESS AND PRODUCTS)"
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.review-order.assertHomeDeliveryInformation
          params:
            - name: assertBy
              string: 'Values'
            - name: expectedDeliveryDate
              string: ${QAA_EA_003_CART_DELIVERY_DATE}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-003.userFullName
            - name: streetName
              string: mx.data.qaa.sanity.ea-003.invoiceStreetName
            - name: exteriorNumber
              string: mx.data.qaa.sanity.ea-003.invoiceOutdoorNumber
            - name: city
              string: mx.data.qaa.sanity.ea-003.invoiceCity
            - name: state
              string: mx.data.qaa.sanity.ea-003.invoiceState
            - name: zipCode 
              string: mx.data.qaa.sanity.ea-003.invoiceZipCode
      - executeFunction:
          name: mx.functions.ea.review-order.assertProductsCountInDeliveryDetailsSection
          params:
            - name: expectedProductsCount
              string: '1'
      - executeFunction:
          name: mx.functions.ea.review-order.openProductsDetailsPopup
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertPopupDisplayed
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductsCount
          params:
            - name: expectedProductsCount
              string: '1'
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductListed
          params:
            - name: productName
              string: ${QAA_EA_003_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.tapClose

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 17: SELECT IN-STORE PAYMENT METHOD - PAYMENT METHOD IS SELECTED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 17: SELECT IN-STORE PAYMENT METHOD."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: 'Payment'
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.review-order.paymentSectionContainer
      - executeFunction:
          name: mx.flows.ea.review-order.selectInStorePaymentMethod
      - log: 
          message: "Getting estimated delivery date after payment method selected - scroll up"
          color: GREEN_BOLD
      - scroll:
          direction: up
          scrollLimit: 2      
      - executeFunction:
          name: mx.functions.ea.review-order.getSingleDeliveryDate #--RETURNS--${returnedDeliveryDate}-->
      - storeIn:
          key: QAA_EA_003_REVIEW_ORDER_DELIVERY_DATE
          value: ${returnedDeliveryDate}
  
#--------------------------------------------------------------------------------------------------------------------

      ## STEP 18: SELECT INVOICE PURCHASE OPTION.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 18: SELECT INVOICE PURCHASE OPTION. [##### SKIPPED #####]"
            - name: squadNames
              string: PURCHASE | QAA
      - log:
          message: '[ !!! STEP 18 SKIPPED !!! ]'
          color: YELLOW
      - log:
          message: "[INFO] There are no available native components yet to test Invoice in Review Order."
          color: YELLOW
      - log:
          message: "[INFO] To avoid enter to a web view when placing an order with Required Invoice selected, this step will be skipped."
          color: YELLOW
      - log:
          message: "[INFO] Once all native mobile components are released the script will be updated with properly."
          color: YELLOW

      # TODO: Uncomment this lines when native components are available to finish this workflow and if neccessary add the steps or assertions missings
      # - executeFunction:
      #     name: mx.functions.ea.review-order.scrollDownToSection
      #     params:
      #       - name: sectionOption
      #         string: 'Invoice'
      # - executeFunction:
      #     name: mx.functions.utils.positionElementAtTheTop
      #     params:
      #       - name: elementToPositionUp
      #         string: mx.mappings.ea.review-order.invoiceSectionContainer
      # - executeFunction:
      #     name: mx.functions.ea.review-order.tapWantInvoiceCheckbox
      # - executeFunction:
      #     name: mx.functions.ea.review-order.assertWantInvoiceCheckboxState
      #     params:
      #       - name: expectedCheckState
      #         string: 'true'
         
#--------------------------------------------------------------------------------------------------------------------

      ## STEP 19: VALIDATE PHONE NUMBER WITH THE ONE OF THE DELIVERY ADDRESS.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 19: ASSERT PHONE NUMBER EXPECTING SAME AS DELIVERY ADDRESS"
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: "PhoneNumber"
      - executeFunction:
          name: mx.flows.ea.review-order.enterCellphoneNumberIfNotDisplayed
          params:
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-003.invoicePhoneNumber

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 20: VALIDATE LAST PART IN REVIEW ORDER - ASSERT TOTALS.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 20: VALIDATE LAST PART IN REVIEW ORDER - ASSERT TOTALS"
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: "Totals"
      - executeFunction:
          name: mx.functions.ea.review-order.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: '1'
      - executeFunction:
          name: mx.flows.ea.review-order.assertTotals #--RETURNS--${returnedEstimatedTotal}-->
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-003.deliveryMethod
            - name: expectedDeliveryFee
              string: ${QAA_EA_003_DELIVERY_FEE_SHOPPING_CART}
            - name: expectedSubtotal
              string: ${QAA_EA_003_PRODUCT_PRICE}
            - name: assertDiscount
              string: 'false'
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedSavingsAmount
              string: 'null'
      - storeIn:
          key: QAA_EA_003_ESTIMATED_TOTAL_REVIEW_ORDER
          value: ${returnedEstimatedTotal}

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 21: PLACE ORDER
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 21: PLACE ORDER"
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.tapPlaceOrder #--RETURNS--${returnedOrderedDate}-->
      - sleep:
          duration: 10000
      - storeIn:
          key: QAA_EA_003_ORDERED_DATE
          value: ${returnedOrderedDate}
      - storeIn:
          key: EA_003_IS_ORDER_CREATED
          value: true
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertPageDisplayed

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 22: VALIDATE ORDER CONFIRMATION
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 22: VALIDATE ORDER CONFIRMATION"
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.order-confirmation.getOrderNumber #--RETURNS--${returnedOrderNumber}-->
      - storeIn:
          key: QAA_EA_003_ORDER_NUMBER
          value: ${returnedOrderNumber}
      - executeFunction:
          name: mx.flows.ea.order-confirmation.assertConfirmationForHomeDelivery
          params:
            - name: expectedTotal
              string: ${QAA_EA_003_ESTIMATED_TOTAL_REVIEW_ORDER}
            - name: expectedDeliveryDate
              string: ${QAA_EA_003_REVIEW_ORDER_DELIVERY_DATE}
            - name: expectedProductsCount
              string: '1'
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-003.userFullName
            - name: isMultipleDelivery
              string: 'false'
            - name: assertBy
              string: 'Values'
            - name: streetName
              string: mx.data.qaa.sanity.ea-003.invoiceStreetName
            - name: exteriorNumber
              string: mx.data.qaa.sanity.ea-003.invoiceOutdoorNumber
            - name: city
              string: mx.data.qaa.sanity.ea-003.invoiceCity
            - name: state
              string: mx.data.qaa.sanity.ea-003.invoiceState
            - name: zipCode
              string: mx.data.qaa.sanity.ea-003.invoiceZipCode
      - log:
          message: Tap Find More products to Dissmiss Order Confirmation
          color: GREEN_BOLD
      - executeFunction:
          name: mx.functions.ea.order-confirmation.tapFindMoreProducts
      - sleep:
          duration: 5000

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 23: NAVIGATE TO ACCOUNT AND VERIFY ORDER IN ORDERS HISTORY.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 23 (A): NAVIGATE TO ACCOUNT."
            - name: squadNames
              string: PRE-PURCHASE | QAA
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
      
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 23 (B): VERIFY ORDER IN ORDERS HISTORY"
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.functions.ea.account.openOrdersHistory
      - executeFunction:
          name: mx.functions.ea.orders-history.assertPageDisplayed
      - executeFunction:
          name: mx.flows.ea.orders-history.assertOrder #--RETURNS--${returnedDeliveryDate}-->
          params:
            - name: orderNumber
              string: ${QAA_EA_003_ORDER_NUMBER}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-003.deliveryMethod
            - name: expectedTotal
              string: ${QAA_EA_003_ESTIMATED_TOTAL_REVIEW_ORDER}
            - name: isMultipleDelivery
              string: 'false'
            - name: expectedOrderStatus
              string: 'Waiting4Payment'
            - name: expectedDeliveryDate
              string: ${QAA_EA_003_REVIEW_ORDER_DELIVERY_DATE}
            - name: expectedProductsCount
              string: '1'
      - storeIn:
          key: QAA_EA_003_ORDERS_HISTORY_DELIVERY_DATE
          value: ${returnedDeliveryDate}

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 24: OPEN ORDER DETAILS AND CONFIRM CORRECT INFORMATION - ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 24: OPEN ORDER DETAILS AND CONFIRM CORRECT INFORMATION."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.orders-history.openOrder
          params:
            - name: orderNumber
              string: ${QAA_EA_003_ORDER_NUMBER}

      # First assertions...
      - executeFunction:
          name: mx.flows.ea.order-details.assertDetailsForHomeDeliveryWithSingleDelivery
          params:
            - name: expectedOrderNumber
              string: ${QAA_EA_003_ORDER_NUMBER}
            - name: expectedOrderedDate
              string: ${QAA_EA_003_ORDERED_DATE}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-003.deliveryMethod
            - name: expectedOrderStatus
              string: "Waiting4Payment"
            - name: expectedDeliveryDate
              string: ${QAA_EA_003_ORDERS_HISTORY_DELIVERY_DATE}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-003.userFullName
            - name: assertBy
              string: 'Values'
            - name: streetName
              string: mx.data.qaa.sanity.ea-003.invoiceStreetNameNoAccent
            - name: exteriorNumber
              string: mx.data.qaa.sanity.ea-003.invoiceOutdoorNumber
            - name: city
              string: mx.data.qaa.sanity.ea-003.invoiceCity
            - name: state
              string: mx.data.qaa.sanity.ea-003.invoiceState
            - name: zipCode
              string: mx.data.qaa.sanity.ea-003.invoiceZipCode
      - executeFunction:
          name: mx.functions.ea.order-details.expandProductsDetailsIfNotExpandedForSingleDelivery
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.order-details.collapseProductDetailsSectionButton
      
      # Product Assertions...
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_003_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductUnitPrice
          params:
            - name: expectedUnitPrice
              string: ${QAA_EA_003_PRODUCT_PRICE}
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductOrderedQuantity
          params:
            - name: expectedQuantity
              string: '1'
      - scroll:
          direction: down
          scrollLimit: 1

      # Totals Assertions...
      - executeFunction:
          name: mx.functions.ea.order-details.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${QAA_EA_003_PRODUCT_PRICE}
      - executeFunction:
          name: mx.functions.ea.order-details.assertDiscount
          params:
            - name: expectedDiscount
              string: '0.00'
      - executeFunction:
          name: mx.functions.ea.order-details.assertDeliveryDiscount
          params:
            - name: expectedDeliveryDiscount
              string: '0.00'
      - executeFunction:
          name: mx.functions.ea.order-details.assertDeliveryFee
          params:
            - name: expectedDeliveryFee
              string: ${QAA_EA_003_DELIVERY_FEE_SHOPPING_CART}
      - executeFunction:
          name: mx.functions.ea.order-details.assertTotal
          params:
            - name: expectedTotal
              string: ${QAA_EA_003_ESTIMATED_TOTAL_REVIEW_ORDER}
      - scroll:
          direction: down
          scrollLimit: 1

#--------------------------------------------------------------------------------------------------------------------

      ## STEP 25: CANCEL ORDER - ORDER STATUS IS 'CANCELED'.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 25: CANCEL ORDER."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.order-details.cancelOrderWithSetOption
      - storeIn:
          key: EA_003_IS_ORDER_CREATED
          value: false

#--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: EA_003_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: ${__SQUAD_REPORTING_TEST_CASE_NAME}"

  #####################################################################################################################

  - name: Before
    before: true
    flow:
      - log: "BEFORE SCENARIO START: Initial Config..."

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_Android_003
      
      - storeIn:
          key: EA_003_IS_ORDER_CREATED
          value: false
      - storeIn:
          key: EA_003_SUCCESSFUL_EXECUTION
          value: false
    
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - log: "AFTER SCENARIO START"

      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${EA_003_SUCCESSFUL_EXECUTION} 
      - if:
          condition: ${EA_003_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: Verifying if there's data to reset for the next execution..."
                color: CYAN

            # Relaunching app, and navigate to home page...
            - executeFunction:
                name: mx.flows.ea.after-scenario-exclusive.relaunchAndNavigateToHomePage

            # Cancel Order in case it was not deleted during main scenario...
            - if:
                condition: ${EA_003_IS_ORDER_CREATED} == true
                then:
                  - log:
                      message: "New Order was created but couldn't cancel during Main Scenario, resetting data..."
                      color: CYAN
                  - executeFunction:
                      name: mx.functions.ea.bottom-menu.tapAccount
                  - executeFunction:
                      name: mx.functions.ea.account.assertPageDisplayed
                  - executeFunction:
                      name: mx.functions.ea.account.openOrdersHistory
                  - executeFunction:
                      name: mx.functions.ea.orders-history.openOrder
                      params:
                        - name: orderNumber
                          string: ${QAA_EA_003_ORDER_NUMBER}
                  - executeFunction:
                      name: mx.flows.ea.order-details.cancelOrderWithSetOption
                
      - log: "AFTER SCENARIO END"
