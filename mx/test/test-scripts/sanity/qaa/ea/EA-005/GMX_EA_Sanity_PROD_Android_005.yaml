#======================================================================================================================
#    AUTHOR: Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Nov/07/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-ea-sanity-production-android-005, qaa-ea-sanity-production-android
  testCaseId: MXMOB-1613

scenarios:
#######################################################################################################################
#
#  CONFLUENCE TRACKING DASHBOARD:
#    https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+Android
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MXMOB-1613
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MXMOB-1601
#
#  FLAGS USED: N/A
#
#######################################################################################################################

  - name: Main
    flow:
      - log: "TEST START: QAA - EA - PRODUCTION SANITY - EA-005"
      
      ## STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER - EA HOME IS DISPLAYED.
      ## STEP 2: NAVIGATE TO ACCOUNT - ACCOUNT PAGE IS DISPLAYED.
      ## STEP 3: LOGIN EXISTING ACCOUNT - USER LOGS IN SUCCESSFULLY.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1-3: NAVIGATE THROUGH ONBOARDING, SELECT EA BANNER AND LOGIN IN ACCOUNT PAGE."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-005.zipCode
            - name: banner
              string: 'EA'
      - executeFunction:
          name: mx.flows.od.login.navigateToAccountAndLogin
          params:
            - name: userEmail
              string: mx.data.qaa.sanity.ea-005.userEmail
            - name: userPassword
              string: mx.data.qaa.sanity.ea-005.userPassword
            - name: userName
              string: mx.data.qaa.sanity.ea-005.userName

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 4: SEARCH FOR A PRODUCT - SLP IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 4: SEARCH FOR A PRODUCT."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.bottom-menu.tapHome
      - executeFunction:
          name: mx.flows.ea.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.sanity.ea-005.searchTerm

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 5: OPEN PRODUCT DESCRIPTION PAGE (PDP) - PDP IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 5: OPEN PRODUCT DESCRIPTION PAGE (PDP)."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.sort-and-filter.addSoldByFilterWithOptionFromSLP
          params:
            - name: soldByOption
              string: 'ByWalmart'
      - executeFunction:
          name: mx.functions.ea.slp.getProductNameWithoutDiscount #--RETURNS--${returnedProductName}-->
      - storeIn:
          key: QAA_EA_005_PRODUCT_1_NAME
          value: ${returnedProductName}
      - executeFunction:
          name: mx.functions.ea.slp.openProductDetailsByName
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
      - executeFunction:
          name: mx.functions.ea.pdp.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.pdp.assertCorrectProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 6: ADD PRODUCT TO CART - PRODUCT IS ADDED TO CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 6: ADD PRODUCT TO CART."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.addToCart
      - storeIn:
          key: EA_005_IS_CART_EMPTY
          value: false
      - executeFunction:
          name: mx.functions.ea.pdp.assertAddedToCart

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 7: CLOSE PDP AND GO TO CART - CART SCREEN IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7-A: CLOSE PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.tapClose
      - executeFunction:
          name: mx.functions.ea.slp.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.slp.scrollDownToProductByName
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
      - executeFunction:
          name: mx.functions.ea.slp.getProductQuantity #--RETURNS--${returnedQuantity}-->
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
      - executeFunction:
          name: mx.functions.ea.slp.getProductPrice #--RETURNS--${returnedPrice}-->
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
      - storeIn:
          key: QAA_EA_005_PRODUCT_1_QUANTITY
          value: ${returnedQuantity}
      - storeIn:
          key: QAA_EA_005_PRODUCT_1_UNIT_PRICE
          value: ${returnedPrice}

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7-B: GO TO CART."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: ${QAA_EA_005_PRODUCT_1_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.selectDeliveryMethod
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 8: INCREASE QUANTITY FROM CART - QUANTITY IS MODIFIED SUCCESSFULLY.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 8: INCREASE QUANTITY FROM CART."
            - name: squadNames
              string: PURCHASE | QAA

      # Modifying product quantity...
      - executeFunction:
          name: mx.functions.ea.cart.assertProductListed
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
      - executeFunction:
          name: mx.functions.ea.cart.increaseProductQuantityBy
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
            - name: quantity
              string: mx.data.qaa.sanity.ea-005.increaseQuantity
            - name: ignoreClickException
              string: 'true'
      - executeFunction:
          name: mx.functions.ea.cart.decreaseProductQuantityBy
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
            - name: quantity
              string: mx.data.qaa.sanity.ea-005.decreaseQuantity

      # Retrieving and calculating product details...
      - executeFunction:
          name: mx.functions.ea.cart.getProductQuantity #--RETURNS--${returnedProductQuantity}-->
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
      - storeIn:
          key: QAA_EA_005_PRODUCT_1_QUANTITY
          value: ${returnedProductQuantity}
      - arithmetic:
          expression: ${QAA_EA_005_PRODUCT_1_QUANTITY} * ${QAA_EA_005_PRODUCT_1_UNIT_PRICE}
          numberOfDecimalPlaces: 2
          storeIn: QAA_EA_005_PRODUCT_1_SUBTOTAL
      - storeIn:
          key: QAA_EA_005_CART_SUBTOTAL
          value: ${QAA_EA_005_PRODUCT_1_SUBTOTAL}

      # Performing Product and Totals assertions...
      - executeFunction:
          name: mx.functions.ea.cart.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_1_QUANTITY}
      - executeFunction:
          name: mx.flows.ea.cart.quickPerformProductAssertions
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
            - name: expectedQuantity
              string: ${QAA_EA_005_PRODUCT_1_QUANTITY}
            - name: expectedUnitPrice
              string: ${QAA_EA_005_PRODUCT_1_UNIT_PRICE}
            - name: assertDiscount
              string: 'false'
            - name: expectedOriginalPrice
              string: 'null'
            - name: expectedSubtotal
              string: ${QAA_EA_005_PRODUCT_1_SUBTOTAL}
      - scroll:
          direction: down
          scrollLimit: 1
          wait: 1000
      - executeFunction:
          name: mx.flows.ea.cart.assertTotals #--RETURNS--${returnedDeliveryFee}-->
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod
            - name: expectedDeliveryFee
              string: 'null'
            - name: expectedSubtotal
              string: ${QAA_EA_005_CART_SUBTOTAL}
            - name: assertDiscount
              string: 'false'
            - name: assertDeliveryFee
              string: 'false'
            - name: expectedSavingsAmount
              string: 'null'
      - storeIn:
          key: QAA_EA_005_DELIVERY_FEE
          value: ${returnedDeliveryFee}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 9: CLOSE CART AND SEARCH FOR ANOTHER PRODUCT - SLP IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9-A: CLOSE CART."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.tapBack

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9-B: SEARCH FOR ANOTHER PRODUCT."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.sanity.ea-005.searchTerm2
      - executeFunction:
          name: mx.flows.ea.sort-and-filter.addSoldByFilterWithOptionFromSLP
          params:
            - name: soldByOption
              string: 'ByWalmart'
      - executeFunction:
          name: mx.functions.ea.slp.getProductNameWithoutDiscount #--RETURNS--${returnedProductName}-->
      - storeIn:
          key: QAA_EA_005_PRODUCT_2_NAME
          value: ${returnedProductName}
      - executeFunction:
          name: mx.functions.ea.slp.getProductPrice #--RETURNS--${returnedPrice}-->
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_2_NAME}
      - storeIn:
          key: QAA_EA_005_PRODUCT_2_UNIT_PRICE
          value: ${returnedPrice}
      - storeIn:
          key: QAA_EA_005_PRODUCT_2_SUBTOTAL
          value: ${returnedPrice}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 10: OPEN PRODUCT DESCRIPTION PAGE (PDP) - PDP IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 10: OPEN PRODUCT DESCRIPTION PAGE (PDP)."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.slp.openProductDetailsByName
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_2_NAME}
      - executeFunction:
          name: mx.functions.ea.pdp.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.pdp.assertCorrectProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_2_NAME}
      - executeFunction:
          name: mx.functions.ea.pdp.getDeliveryDate #--RETURNS--${returnedDeliveryDate}-->
      - storeIn:
          key: QAA_EA_005_PDP_DELIVERY_DATE
          value: ${returnedDeliveryDate}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 11: CLICK ON 'BUY NOW' - REVIEW ORDER PAGE SHOULD BE DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 11: CLICK ON 'BUY NOW'."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.clickBuyNow
      - storeIn:
          key: QAA_EA_005_PRODUCT_2_QUANTITY
          value: '1' # <--- Hardcoding this value because when clicking the 'Buy now' button without modifying product quantity, the expected should be '1'.
      - sleep:
          duration: 5000
      - executeFunction:
          name: mx.functions.ea.review-order.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 12: INITIAL REVIEW ORDER ASSERTIONS - REVIEW ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 12: INITIAL REVIEW ORDER ASSERTIONS."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.review-order.assertHomeDeliveryInformation
          params:
            - name: assertBy
              string: 'Values'
            - name: expectedDeliveryDate
              string: ${QAA_EA_005_PDP_DELIVERY_DATE}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-005.homeAddressName
            - name: streetName
              string: mx.data.qaa.sanity.ea-005.userStreet
            - name: exteriorNumber
              string: mx.data.qaa.sanity.ea-005.userExteriorNumber
            - name: city
              string: mx.data.qaa.sanity.ea-005.userCity
            - name: state
              string: mx.data.qaa.sanity.ea-005.userState
            - name: zipCode
              string: mx.data.qaa.sanity.ea-005.zipCode
      - executeFunction:
          name: mx.functions.ea.review-order.assertProductsCountInDeliveryDetailsSection
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_2_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.review-order.openProductsDetailsPopup
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertPopupDisplayed
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductsCount
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_2_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductListed
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_2_NAME}
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.tapClose

  #--------------------------------------------------------------------------------------------------------------------

        ## STEP 13: SELECT IN-STORE PAYMENT METHOD - PAYMENT METHOD IS SELECTED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 13: SELECT IN-STORE PAYMENT METHOD."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: 'Payment'
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.review-order.paymentSectionContainer
      - executeFunction:
          name: mx.flows.ea.review-order.selectInStorePaymentMethod

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 14: FINAL REVIEW ORDER ASSERTIONS - REVIEW ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 14: FINAL REVIEW ORDER ASSERTIONS."
            - name: squadNames
              string: PURCHASE | QAA

      - scroll:
          direction: up
          scrollLimit: 2
      - executeFunction:
          name: mx.functions.ea.review-order.getSingleDeliveryDate #--RETURNS--${returnedDeliveryDate}-->
      - storeIn:
          key: QAA_EA_005_REVIEW_ORDER_DELIVERY_DATE
          value: ${returnedDeliveryDate}
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: "PhoneNumber"
      - executeFunction:
          name: mx.flows.ea.review-order.enterCellphoneNumberIfNotDisplayed
          params:
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-005.userPhoneNumber
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: "Totals"
      - executeFunction:
          name: mx.functions.ea.review-order.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_2_QUANTITY}
      - executeFunction:
          name: mx.flows.ea.review-order.assertTotals #--RETURNS--${returnedEstimatedTotal}-->
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod
            - name: expectedDeliveryFee
              string: ${QAA_EA_005_DELIVERY_FEE}
            - name: expectedSubtotal
              string: ${QAA_EA_005_PRODUCT_2_SUBTOTAL}
            - name: assertDiscount
              string: 'false'
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedSavingsAmount
              string: 'null'
      - storeIn:
          key: QAA_EA_005_ORDER_TOTAL
          value: ${returnedEstimatedTotal}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP: 15: PLACE ORDER - ORDER CONFIRMATION IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP: 15: PLACE ORDER - ORDER CONFIRMATION IS DISPLAYED."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.review-order.tapPlaceOrder #--RETURNS--${returnedOrderedDate}-->
      - sleep:
          duration: 10000
      - storeIn:
          key: QAA_EA_005_ORDERED_DATE
          value: ${returnedOrderedDate}
      - storeIn:
          key: EA_005_IS_CART_EMPTY
          value: true
      - storeIn:
          key: EA_005_IS_ORDER_CREATED
          value: true
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 16: VALIDATE ORDER CONFIRMATION INFORMATION - ORDER CONFIRMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 16: VALIDATE ORDER CONFIRMATION INFORMATION."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.order-confirmation.getOrderNumber #--RETURNS--${returnedOrderNumber}-->
      - storeIn:
          key: QAA_EA_005_ORDER_NUMBER
          value: ${returnedOrderNumber}
      - executeFunction:
          name: mx.flows.ea.order-confirmation.assertConfirmationForHomeDelivery
          params:
            - name: expectedTotal
              string: ${QAA_EA_005_ORDER_TOTAL}
            - name: expectedDeliveryDate
              string: ${QAA_EA_005_REVIEW_ORDER_DELIVERY_DATE}
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_2_QUANTITY}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-005.homeAddressName
            - name: isMultipleDelivery
              string: 'false'
            - name: assertBy
              string: 'Values'
            - name: streetName
              string: mx.data.qaa.sanity.ea-005.userStreet
            - name: exteriorNumber
              string: mx.data.qaa.sanity.ea-005.userExteriorNumber
            - name: city
              string: mx.data.qaa.sanity.ea-005.userCity
            - name: state
              string: mx.data.qaa.sanity.ea-005.userState
            - name: zipCode
              string: mx.data.qaa.sanity.ea-005.zipCode

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 17: TAP FIND MORE PRODUCTS BUTTON AND VALIDATE ORDER IN ORDERS HISTORY - ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 17-A: TAP FIND MORE PRODUCTS BUTTON."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.order-confirmation.tapFindMoreProducts
      - sleep:
          duration: 5000

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 17-B: NAVIGATE TO ACCOUNT."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.tapClose
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 17-C: VERIFY ORDER IN ORDERS HISTORY."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.account.openOrdersHistory
      - executeFunction:
          name: mx.functions.ea.orders-history.assertPageDisplayed
      - executeFunction:
          name: mx.flows.ea.orders-history.assertOrder #--RETURNS--${returnedDeliveryDate}-->
          params:
            - name: orderNumber
              string: ${QAA_EA_005_ORDER_NUMBER}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod
            - name: expectedTotal
              string: ${QAA_EA_005_ORDER_TOTAL}
            - name: isMultipleDelivery
              string: 'false'
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.ea-005.expectedOrderStatus
            - name: expectedDeliveryDate
              string: ${QAA_EA_005_REVIEW_ORDER_DELIVERY_DATE}
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_2_QUANTITY}
      - storeIn:
          key: QAA_EA_005_ORDERS_HISTORY_DELIVERY_DATE
          value: ${returnedDeliveryDate}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 18: OPEN ORDER DETAILS AND CONFIRM CORRECT INFORMATION - ORDER INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 18: OPEN ORDER DETAILS AND CONFIRM CORRECT INFORMATION."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.orders-history.openOrder
          params:
            - name: orderNumber
              string: ${QAA_EA_005_ORDER_NUMBER}

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 18-A: PERFORMING INITIAL ASSERTIONS."
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.flows.ea.order-details.assertDetailsForHomeDeliveryWithSingleDelivery
          params:
            - name: expectedOrderNumber
              string: ${QAA_EA_005_ORDER_NUMBER}
            - name: expectedOrderedDate
              string: ${QAA_EA_005_ORDERED_DATE}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.ea-005.expectedOrderStatus
            - name: expectedDeliveryDate
              string: ${QAA_EA_005_ORDERS_HISTORY_DELIVERY_DATE}
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.ea-005.homeAddressName
            - name: assertBy
              string: 'Values'
            - name: streetName
              string: mx.data.qaa.sanity.ea-005.userStreet
            - name: exteriorNumber
              string: mx.data.qaa.sanity.ea-005.userExteriorNumber
            - name: city
              string: mx.data.qaa.sanity.ea-005.userCity
            - name: state
              string: mx.data.qaa.sanity.ea-005.userState
            - name: zipCode
              string: mx.data.qaa.sanity.ea-005.zipCode
      - executeFunction:
          name: mx.functions.ea.order-details.expandProductsDetailsIfNotExpandedForSingleDelivery
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.order-details.collapseProductDetailsSectionButton

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 18-B: PERFORMING PRODUCT ASSERTIONS."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.order-details.assertProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_2_NAME}
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductUnitPrice
          params:
            - name: expectedUnitPrice
              string: ${QAA_EA_005_PRODUCT_2_UNIT_PRICE}
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductOrderedQuantity
          params:
            - name: expectedQuantity
              string: ${QAA_EA_005_PRODUCT_2_QUANTITY}
      - scroll:
          direction: down
          scrollLimit: 1

  #--------------------------------------------------------------------------------------------------------------------

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 18-C: PERFORMING TOTALS ASSERTIONS."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.order-details.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${QAA_EA_005_PRODUCT_2_SUBTOTAL}
      - executeFunction:
          name: mx.functions.ea.order-details.assertDiscount
          params:
            - name: expectedDiscount
              string: '0.00'
      - executeFunction:
          name: mx.functions.ea.order-details.assertDeliveryFee
          params:
            - name: expectedDeliveryFee
              string: ${QAA_EA_005_DELIVERY_FEE}
      - executeFunction:
          name: mx.functions.ea.order-details.assertTotal
          params:
            - name: expectedTotal
              string: ${QAA_EA_005_ORDER_TOTAL}
      - scroll:
          direction: down
          scrollLimit: 1

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 19: CANCEL ORDER - ORDER STATUS IS 'CANCELED'.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 19: CANCEL ORDER."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.flows.ea.order-details.cancelOrderWithSetOption
      - storeIn:
          key: EA_005_IS_ORDER_CREATED
          value: false

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 20: OPEN CART - CART IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 20: OPEN CART."
            - name: squadNames
              string: POST-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: ${QAA_EA_005_PRODUCT_1_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.selectDeliveryMethod
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 21: VERIFY PREVIOUSLY ADDED PRODUCT KEPT SAME INFORMATION (FULL PAGE) - FULL PAGE INFORMATION IS CORRECT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 21: VERIFY PREVIOUSLY ADDED PRODUCT KEPT SAME INFORMATION IN CART (FULL PAGE)."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: ${QAA_EA_005_PRODUCT_1_QUANTITY}
      - executeFunction:
          name: mx.flows.ea.cart.quickPerformProductAssertions
          params:
            - name: productName
              string: ${QAA_EA_005_PRODUCT_1_NAME}
            - name: expectedQuantity
              string: ${QAA_EA_005_PRODUCT_1_QUANTITY}
            - name: expectedUnitPrice
              string: ${QAA_EA_005_PRODUCT_1_UNIT_PRICE}
            - name: assertDiscount
              string: 'false'
            - name: expectedOriginalPrice
              string: 'null'
            - name: expectedSubtotal
              string: ${QAA_EA_005_PRODUCT_1_SUBTOTAL}
      - scroll:
          direction: down
          scrollLimit: 1
          wait: 1000
      - executeFunction:
          name: mx.flows.ea.cart.assertTotals
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.ea-005.deliveryMethod
            - name: expectedDeliveryFee
              string: ${QAA_EA_005_DELIVERY_FEE}
            - name: expectedSubtotal
              string: ${QAA_EA_005_CART_SUBTOTAL}
            - name: assertDiscount
              string: 'false'
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedSavingsAmount
              string: 'null'

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 22: CLEAR CART (CLOSE AND RE-OPEN) - CART SHOULD BE EMPTY.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 22: CLEAR CART (CLOSE AND RE-OPEN)."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.emptyCart
      - storeIn:
          key: EA_005_IS_CART_EMPTY
          value: true
      - executeFunction:
          name: mx.functions.ea.cart.tapBack
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.assertCartIsEmpty

  #--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: EA_005_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: QAA - EA - PRODUCTION SANITY - EA-005"

  #####################################################################################################################

  - name: Before
    before: true
    flow:

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_Android_005
      - log:
          message: "WORKAROUND: RELAUNCHING APP TO FIX ISSUE REGARDING INTERNAL APP FLAGS"
          color: YELLOW
      - executeFunction:
          name: mx.functions.utils.relaunchApp
      - storeIn:
          key: EA_005_IS_CART_EMPTY
          value: true
      - storeIn:
          key: EA_005_IS_ORDER_CREATED
          value: false
      - storeIn:
          key: EA_005_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${EA_005_SUCCESSFUL_EXECUTION}
      - if:
          condition: ${EA_005_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: Verifying if there's data to reset for the next execution..."
                color: CYAN

            # Relaunching app, login again if not logged and navigate to home page...
            - executeFunction:
                name: mx.flows.ea.after-scenario-exclusive.relaunchAndNavigateToHomePage
            - executeFunction:
                name: mx.flows.ea.after-scenario-exclusive.navigateToAccountAndLoginIfNotLogged
                params:
                  - name: userEmail
                    string: mx.data.qaa.sanity.ea-005.userEmail
                  - name: userPassword
                    string: mx.data.qaa.sanity.ea-005.userPassword
            - executeFunction:
                name: mx.functions.ea.bottom-menu.tapHome

            # Cancel Order in case it was not deleted during main scenario...
            - if:
                condition: ${EA_005_IS_ORDER_CREATED} == true
                then:
                  - log:
                      message: "New Order was created but couldn't cancel during Main Scenario, resetting data..."
                      color: CYAN
                  - executeFunction:
                      name: mx.functions.ea.bottom-menu.tapAccount
                  - executeFunction:
                      name: mx.functions.ea.account.assertPageDisplayed
                  - executeFunction:
                      name: mx.functions.ea.account.openOrdersHistory
                  - executeFunction:
                      name: mx.functions.ea.orders-history.openOrder
                      params:
                        - name: orderNumber
                          string: ${QAA_EA_005_ORDER_NUMBER}
                  - executeFunction:
                      name: mx.flows.ea.order-details.cancelOrderWithSetOption
                  - executeFunction:
                      name: mx.functions.ea.order-details.tapBack
                  - executeFunction:
                      name: mx.functions.ea.orders-history.tapBack
                  - executeFunction:
                      name: mx.functions.ea.bottom-menu.tapHome
                else:
                  - log:
                      message: "New Order was cancelled, no need to reset data..."
                      color: CYAN

            # Empty Cart if not Empty.
            - if:
                condition: ${EA_005_IS_CART_EMPTY} == false
                then:
                  - log:
                      message: "Products remained in Cart, deleting products..."
                      color: CYAN
                  - executeFunction:
                      name: mx.flows.ea.after-scenario-exclusive.openCartAndDeleteAllProducts
                else:
                  - log:
                      message: "No Products were left in Cart, no need to empty it..."
                      color: CYAN
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: CYAN
      - log: "AFTER SCENARIO END"
