#======================================================================================================================
#    AUTHOR: Francisco Javier Ramírez Hernández (vn53vq4)
#   CREATED: Feb/14/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-ea-sanity-production-android-020, qaa-ea-sanity-production-android
  testCaseId: MXMOB-1628

scenarios:
#######################################################################################################################
#
#   CONFLUENCE TRACKING DASHBOARD:
#     https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+Android
#
#   JIRA AUTOMATION TC:
#     https://jira.walmart.com/browse/MXMOB-1628
#
#   JIRA MANUAL TC:
#     https://jira.walmart.com/browse/MXMOB-1586
#
#   FLAGS USED: N/A
#
#######################################################################################################################

  - name: Before
    before: true
    flow:
      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_Android_020
      - log:
          message: "WORKAROUND: RELAUNCHING APP TO FIX ISSUE REGARDING INTERNAL APP FLAGS"
          color: YELLOW
      - executeFunction:
          name: mx.functions.utils.relaunchApp
      - storeIn:
          key: EA_020_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

###########################################################################################################################

  - name: Main
    flow:

      - log: "TEST START: QAA - EA - PRODUCTION SANITY - EA-020"
      # STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER - EA HOME IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-020.zipCode
            - name: banner
              string: 'EA'

  # --------------------------------------------------------------------------------------------------------------------
      # STEP 2: NAVIGATE TO ACCOUNT PAGE AND LOGIN EXISTING ACCOUNT
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 2: NAVIGATE TO ACCOUNT PAGE AND LOGIN EXISTING ACCOUNT"
            - name: squadNames
              string: CUSTOMER | QAA
      
      - executeFunction:
          name: mx.flows.od.login.navigateToAccountAndLogin
          params:
            - name: userEmail
              string: mx.data.qaa.sanity.ea-020.userEmail
            - name: userPassword
              string: mx.data.qaa.sanity.ea-020.userPassword
            - name: userName
              string: mx.data.qaa.sanity.ea-020.userName

  # --------------------------------------------------------------------------------------------------------------------
      # STEP 3 (SKIPPED): Go to wallet, select cashi and add a phone number related to a existing account
      # STEP 4: SEARCH AND ADD PRODUCTS TO CART
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 4: SEARCH AND ADD PRODUCTS TO CART"
            - name: squadNames
              string: PRE-PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapHome
     
      - executeFunction:
          name: mx.flows.ea.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.sanity.ea-020.searchTerm1
      
      - executeFunction:
          name: mx.flows.ea.sort-and-filter.addSoldByFilterWithOptionFromSLP
          params:
            - name: soldByOption
              string: 'ByWalmart'
              
      - executeFunction:
          name: mx.functions.slp.openProductDetailsByName
          params:
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1
     
      - sleep:
          duration: 4000
      
      - executeFunction:
          name: mx.functions.ea.pdp.addToCart
      
      - executeFunction:
          name: mx.functions.pdp.assertAddedToCart
      
      - executeFunction:
          name: mx.functions.ea.pdp.getProductQuantity # <-- RETURNS:  ${returnedProductQuantity}
      
      - storeIn:
          key: product1Quantity
          value: ${returnedProductQuantity}
      
      - executeFunction:
          name: mx.functions.ea.pdp.getProductPrice # RETURNS <-- ${returnedPrice}
      
      - storeIn:
          key: product1Price
          value: ${returnedPrice}
      
      - storeIn:
          key: product1OriginalPrice
          value: ${returnedOriginalPrice}
      
      - executeFunction:
          name: mx.functions.ea.pdp.tapClose
  #--------------------------------------------------------------------------------------------------------------------
      - storeIn:
          key: EA_020_IS_CART_EMPTY
          value: false
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 5: GO TO CART
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 5: GO TO CART"
            - name: squadNames
              string: PRE-PURCHASE | QAA
  
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
      
      - scroll:
          direction: up
          scrollLimit: 1
          wait: 1000
      
      - executeFunction:
          name: mx.functions.ea.cart.assertCartNotEmpty
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 6: VALIDATE PRODUCT DETAILS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 6: VALIDATE PRODUCT DETAILS"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.cart.assertProductListed
          params:
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1
            - name: direction
              string: up
      
      - executeFunction:
          name: mx.functions.ea.cart.assertProductQuantity
          params:
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1
            - name: expectedQuantity
              string: "${product1Quantity}"

      - executeFunction:
          name: mx.functions.ea.cart.assertProductUnitPrice
          params:
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1
            - name: expectedUnitPrice
              string: ${product1Price}
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 7: VALIDATE CART TOTALS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7: VALIDATE CART TOTALS"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.cart.scrollDownToSubTotalSection
      
      - executeFunction:
          name: mx.functions.ea.cart.assertDeliveryFee
          params:
            - name: expectedDeliveryFee
              string: mx.data.qaa.sanity.ea-020.deliveryFee
      
      - arithmetic:
          expression: ${product1Price} + 54.00
          storeIn: estimatedTotalWithFee

      - storeIn:
          key: tc_estimatedSubTotal
          value: ${product1Price}
      
      - executeFunction:
          name: mx.functions.ea.cart.assertProductsCountInSubtotalLabel
          params:
            - name: expectedProductsCount
              string: mx.data.qaa.sanity.ea-020.productsCount
      
      - executeFunction:
          name: mx.functions.ea.cart.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${tc_estimatedSubTotal}
      
      - executeFunction:
          name: mx.functions.ea.cart.assertEstimatedTotalFromButton
          params:
            - name: expectedEstimatedTotal
              string: ${estimatedTotalWithFee}
      
      - executeFunction:
          name: mx.functions.ea.cart.assertEstimatedTotalFromDetailsSection
          params:
            - name: expectedEstimatedTotal
              string: ${estimatedTotalWithFee}
              
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 8: SELECT PICK UP DELIVERY METHOD
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 8: SELECT PICK UP DELIVERY METHOD"
            - name: squadNames
              string: PURCHASE | QAA
      
      - scroll:
          direction: up
          scrollLimit: 2
          wait: 20000
      
      - executeFunction:
          name: mx.functions.ea.cart.tapSwitchToPickupDeliveryButton
      
      - executeFunction:
          name: mx.functions.ea.store-selector-popup.assertPopupDisplayed
      
      - executeFunction:
          name: mx.functions.ea.store-selector-popup.enterZipCode
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-020.zipCode
      
      - executeFunction:
          name: mx.functions.ea.store-selector-popup.selectStoreByStoreName
          params:
            - name: storeName
              string: mx.data.qaa.sanity.ea-020.storeName      
      
      - executeFunction:
          name: mx.functions.ea.store-selector-popup.tapSave
          
      - sleep:
          duration: 4000
      
      - scroll:
          direction: up
          scrollLimit: 1
          wait: 20000
    
      - executeFunction:
          name: mx.functions.ea.cart.assertPickupDeliveryIsSelected
      
      - executeFunction:
          name: mx.functions.ea.cart.getSingleDeliveryDate # <-- RETURNS:  ${returnedDeliveryDate}
      
      # RETURNED DELIVERY DATE IN CART
      - storeIn:
          key: QAA_EA_020_CART_DELIVERY_DATE
          value: ${returnedDeliveryDate}

  # --------------------------------------------------------------------------------------------------------------------
      # STEP 9: VALIDATE DELIVERY FEE IS NOT CHARGED
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9: VALIDATE DELIVERY FEE IS NOT CHARGED"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.cart.scrollDownToSubTotalSection
     
      - executeFunction:
          name: mx.functions.ea.cart.assertDeliveryFeeNotCharged
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 10: VALIDATE ESTIMATED TOTAL IS UPDATED CORRECTLY
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 10: VALIDATE ESTIMATED TOTAL IS UPDATED CORRECTLY"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.cart.assertEstimatedTotalFromButton
          params:
            - name: expectedEstimatedTotal
              string: ${tc_estimatedSubTotal}
      
      - executeFunction:
          name: mx.functions.ea.cart.assertEstimatedTotalFromDetailsSection
          params:
            - name: expectedEstimatedTotal
              string: ${tc_estimatedSubTotal}
 
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 11: CONTINUE PURCHASE
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 11:CONTINUE PURCHASE"
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.cart.tapContinue
        
      - executeFunction:
          name: mx.functions.ea.review-order.assertPageDisplayed
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 12: VALIDATE REVIEW ORDER INFORMATION
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 12: VALIDATE REVIEW ORDER INFORMATION"
            - name: squadNames
              string: PURCHASE | QAA
            
      - executeFunction:
          name: mx.functions.ea.review-order.assertDeliveryMethod
          params:
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-020.deliveryMethod
      
      - executeFunction:
          name: mx.functions.ea.review-order.getSingleDeliveryDate # <-- RETURNS: ${returnedDeliveryDate}
      
      - storeIn:
          key: QAA_EA_020_REVIEW_ORDER_DATE
          value: ${returnedDeliveryDate}

      # THIS ASSERTION WILL BE SKIPPED TEMPORARILY DUE WE ARE HAVING DIFFICULTIES ON PRODUCTION
      - executeFunction:
          name: mx.functions.ea.review-order.assertSingleDeliveryDate
          params:
            - name: expectedDeliveryDate
              string: ${QAA_EA_020_REVIEW_ORDER_DATE}

      - executeFunction:
          name: mx.functions.ea.review-order.assertPickupPerson
          params:
            - name: pickupPersonName
              string: mx.data.qaa.sanity.ea-020.pickupPersonName
      
      - executeFunction:
          name: mx.functions.ea.review-order.openProductsDetailsPopup
      
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertPopupDisplayed
      
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductListed
          params:
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1
      
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.assertProductsCount
          params:
            - name: expectedProductsCount
              string: ${product1Quantity}
      
      - executeFunction:
          name: mx.functions.ea.review-order.products-details-popup.tapClose
      
      - sleep:
          duration: 3000
      
      - executeFunction:      
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: 'Totals'
      
      - executeFunction:      
          name: mx.functions.ea.review-order.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${product1OriginalPrice}
      
      - executeFunction:      
          name: mx.functions.ea.review-order.assertDeliveryFeeNotCharged
      
      - executeFunction:      
          name: mx.functions.ea.review-order.assertEstimatedTotalFromButton
          params:
            - name: expectedEstimatedTotal
              string: ${tc_estimatedSubTotal}
      
      - executeFunction:      
          name: mx.functions.ea.review-order.assertEstimatedTotalFromDetailsSection
          params:
            - name: expectedEstimatedTotal
              string: ${tc_estimatedSubTotal}
              
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 13: GO TO PAYMENT METHOD AND SELECT CASHI 
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 13: GO TO PAYMENT METHOD AND SELECT CASHI"
            - name: squadNames
              string: PURCHASE | QAA
            
      - executeFunction:
          name: mx.functions.ea.review-order.scrollUpToSection
          params:
            - name: sectionOption
              string: Payment
      
      - executeFunction:
          name: mx.flows.ea.review-order.selectCashiPaymentMethod
      
      # GET DELIVERY DATE AFTER PAYMENT METHOD
      - executeFunction:
          name: mx.functions.ea.review-order.scrollUpToSection
          params:
            - name: sectionOption
              string: Delivery
      
      - executeFunction:
          name: mx.functions.ea.review-order.getSingleDeliveryDate # <-- RETURNS: ${returnedDeliveryDate}

      - storeIn:
          key: QAA_EA_020_REVIEW_ORDER_DATE
          value: ${returnedDeliveryDate}
      
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 14: ADD VALID PHONE NUMBER
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  14: ADD VALID PHONE NUMBER"
            - name: squadNames
              string: PURCHASE | QAA
       
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: PhoneNumber
      
      - executeFunction:
          name: mx.flows.ea.review-order.enterCellphoneNumberIfNotDisplayed
          params:
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-020.userPhoneNumber

  # --------------------------------------------------------------------------------------------------------------------
      # STEP 15: PLACE ORDER
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  15: PLACE ORDER"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.review-order.tapPlaceOrder
      
      - executeFunction:
          name: mx.functions.ea.cashi-payment.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------
      - storeIn:
          key: EA_020_IS_CART_EMPTY
          value: true
          
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 16: CANCEL CASHI PAYMENT METHOD
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  16: CANCEL CASHI PAYMENT METHOD"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.cashi-payment.tapCancelCashiPayment
      
      - executeFunction:
          name: mx.functions.ea.cashi-payment.cancel-popup.assertPageIsDisplayed
      
      - executeFunction:
          name: mx.functions.ea.cashi-payment.cancel-popup.tapCancelButton
      
      - sleep:
          duration: 3000
      
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed
           
 # --------------------------------------------------------------------------------------------------------------------
      # STEP 17: VALIDATE CORRECT CASHI CANCELATION MESSAGE AT THE TOP
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  17: VALIDATE CORRECT CASHI CANCELATION MESSAGE AT THE TOP"
            - name: squadNames
              string: PURCHASE | QAA
      - scroll:
          direction: up
          scrollLimit: 1
          wait: 1000
      
      - executeFunction:
          name: mx.mappings.ea.cart.assertCorrectCanceledCashiPaymentMessage
 
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 18: VALIDATE CART TOTALS 
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  18: VALIDATE CART TOTALS"
            - name: squadNames
              string: PURCHASE | QAA
      
      - scroll:
          direction: down
          scrollLimit: 1
          wait: 2000
     
      - executeFunction:
          name: mx.functions.ea.cart.assertEstimatedTotalFromDetailsSection
          params:
            - name: expectedEstimatedTotal
              string: ${tc_estimatedSubTotal}
      
      - executeFunction:
          name: mx.functions.ea.cart.assertDeliveryFeeNotCharged
      
      - executeFunction:
          name: mx.functions.ea.cart.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${tc_estimatedSubTotal}      
      
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 19: CONTINUE TO REVIEW ORDER 
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  19: CONTINUE TO REVIEW ORDER"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.cart.tapContinue
      
      - executeFunction:
          name: mx.functions.ea.review-order.assertPageDisplayed

  # --------------------------------------------------------------------------------------------------------------------
      # STEP 20: GO TO PAYMENT SECTION AND SELECT IN STORE PAYMENT METHOD
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  20: GO TO PAYMENT SECTION AND SELECT IN STORE PAYMENT METHOD"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: Payment
    
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.review-order.paymentSectionContainer
      
      - executeFunction:
          name: mx.flows.ea.review-order.selectInStorePaymentMethod
      
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 21: ADD A VALID PHONE NUMBER
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  21: ADD A VALID PHONE NUMBER"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.review-order.scrollDownToSection
          params:
            - name: sectionOption
              string: PhoneNumber
      
      - executeFunction:
          name: mx.functions.utils.positionElementAtTheTop
          params:
            - name: elementToPositionUp
              string: mx.mappings.ea.review-order.phoneNumberSectionContainer
      
      - executeFunction:
          name: mx.flows.ea.review-order.enterCellphoneNumberIfNotDisplayed
          params:
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.ea-020.userPhoneNumber
 
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 22: PLACER ORDER
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP  22: PLACER ORDER"
            - name: squadNames
              string: PURCHASE | QAA
      
      # GET DELIVERY DATE AFTER CANCEL CASHI PAYMENT METHOD
      - executeFunction:
          name: mx.functions.ea.review-order.scrollUpToSection
          params:
            - name: sectionOption
              string: Delivery
      
      - executeFunction:
          name: mx.functions.ea.review-order.getSingleDeliveryDate # <-- RETURNS: ${returnedDeliveryDate}

      - storeIn:
          key: QAA_EA_020_REVIEW_ORDER_DATE
          value: ${returnedDeliveryDate}
      
      - executeFunction:
          name: mx.functions.ea.review-order.tapPlaceOrder
      
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertPageDisplayed
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 23: VALIDATE ORDER CONFIRMATION
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 23: VALIDATE ORDER CONFIRMATION"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertTotal
          params:
            - name: expectedTotal
              string: ${tc_estimatedSubTotal}
      
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertDeliveryMethod
          params:
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-020.deliveryMethod
      
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertStoreAddressByFullString
          params:
            - name: addressFullString
              string: mx.data.qaa.sanity.ea-020.fullStringAddress
      
      - executeFunction:
          name: mx.functions.ea.order-confirmation.assertProductsCount
          params:
            - name: expectedProductsCount
              string: mx.data.qaa.sanity.ea-020.productsCount
 
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 24: CLICK ON FIND MORE PRODUCTS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 24: CLICK ON FIND MORE PRODUCTS"
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.order-confirmation.getOrderNumber # <-- RETURNS ${returnedOrderNumber}
      
      - storeIn:
          key: tc_OrderNumber
          value: ${returnedOrderNumber}

      - executeFunction:
          name: mx.functions.ea.order-confirmation.tapFindMoreProducts
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 25: NAVIGATE TO ACCOUNT AND OPEN ORDERS HISTORY
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 25: NAVIGATE TO ACCOUNT AND OPEN ORDERS HISTORY"
            - name: squadNames
              string: POST-PURCHASE | QAA
      
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
      
      - executeFunction:
          name: mx.functions.ea.account.openOrdersHistory
      
      - executeFunction:
          name: mx.functions.ea.orders-history.assertPageDisplayed

  # --------------------------------------------------------------------------------------------------------------------
      # STEP 26: VERIFY ORDER IN ORDERS HISTORY
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 26: NAVIGATE TO ACCOUNT AND VERIFY ORDER IN ORDERS HISTORY"
            - name: squadNames
              string: POST-PURCHASE | QAA
     
      - executeFunction:
          name: mx.functions.ea.orders-history.assertOrderDisplayed
          params:
            - name: orderNumber
              string: ${tc_OrderNumber}
      
      - executeFunction:
          name: mx.functions.ea.orders-history.assertDeliveryMethodByProductAndOrderNumber
          params:
            - name: orderNumber
              string: ${tc_OrderNumber}
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-020.deliveryMethod
      
      - executeFunction:
          name: mx.functions.ea.orders-history.assertOrderTotal
          params:
            - name: expectedTotal
              string: ${tc_estimatedSubTotal}
            - name: orderNumber
              string: ${tc_OrderNumber}
   
      - executeFunction:
          name: mx.functions.ea.orders-history.assertOrderStatus
          params:
            - name: orderNumber
              string: ${tc_OrderNumber}
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.ea-020.orderStatus
      
      - executeFunction:
          name: mx.functions.ea.orders-history.assertProductsCountByProductAndOrderNumber
          params:
            - name: orderNumber
              string: ${tc_OrderNumber}
            - name: expectedProductsCount
              string: mx.data.qaa.sanity.ea-020.productsCount
      
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 27: VERIFY ORDER IN ORDERS HISTORY
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 27: NAVIGATE TO ACCOUNT AND VERIFY ORDER IN ORDERS HISTORY"
            - name: squadNames
              string: POST-PURCHASE | QAA
     
      - executeFunction:
          name: mx.functions.ea.orders-history.openOrder
          params:
            - name: orderNumber
              string: ${tc_OrderNumber}
      
      - executeFunction:
          name: mx.functions.ea.order-details.assertCorrectOrderDisplayed
          params:
            - name: expectedOrderNumber
              string: ${tc_OrderNumber}
      
      - executeFunction:
          name: mx.functions.ea.order-details.assertDeliveryMethodForSingleDelivery
          params:
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.ea-020.deliveryMethod
      
      - executeFunction:
          name: mx.functions.ea.order-details.assertStatusForSingleDelivery
          params:
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.ea-020.orderStatus
      
      - executeFunction:
          name: mx.functions.ea.order-details.assertStoreNameForSingleDelivery
          params:
            - name: expectedStoreName
              string: mx.data.qaa.sanity.ea-020.order-details.storeName
      
      - scroll:
          direction: down
          scrollLimit: 1
      
       # Product Assertions...
      - executeFunction:
          name: mx.functions.ea.order-details.assertProductDisplayed
          params:
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1

      - executeFunction:
          name: mx.functions.ea.order-details.assertProductUnitPrice
          params:
            - name: expectedUnitPrice
              string: ${returnedOriginalPrice}

      - executeFunction:
          name: mx.functions.ea.order-details.assertProductOrderedQuantity
          params:
            - name: expectedQuantity
              string: mx.data.qaa.sanity.ea-020.productsCount
            - name: productName
              string: mx.data.qaa.sanity.ea-020.productName1

      - executeFunction:
          name: mx.functions.ea.order-details.assertSubtotal
          params:
            - name: expectedSubtotal
              string: ${returnedOriginalPrice}
      
      - scroll:
          direction: down
          scrollLimit: 1
          wait: 1000
      
      - executeFunction:
          name: mx.functions.ea.order-details.assertTotal
          params:
            - name: expectedSubtotal
              string: ${tc_estimatedSubTotal}
  
  # --------------------------------------------------------------------------------------------------------------------
      # STEP 28: CANCEL ORDER
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 28: CANCEL ORDER"
            - name: squadNames
              string: POST-PURCHASE | QAA
      
      - executeFunction:
          name: mx.flows.ea.order-details.cancelOrderWithSetOption

  #--------------------------------------------------------------------------------------------------------------------
      - storeIn:
          key: EA_020_SUCCESSFUL_EXECUTION
          value: true
      
      - log: "TEST END: QAA - EA - PRODUCTION SANITY - EA-020"
  #####################################################################################################################

  - name: After
    after: true
    flow:
      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${EA_020_SUCCESSFUL_EXECUTION}
      - if:
          condition: ${EA_020_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: Verifying if there's data to reset for the next execution..."
                color: CYAN
            # Empty Cart if not Empty.
            - if:
                condition: ${EA_020_IS_CART_EMPTY} == false
                then:
                  - log:
                      message: "Products remained in Cart, deleting products..."
                      color: CYAN
                  - executeFunction:
                      name: mx.flows.ea.after-scenario-exclusive.openCartAndDeleteAllProducts
                else:
                  - log:
                      message: "No Products were left in Cart, no need to empty it..."
                      color: CYAN
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: CYAN
                
      - log: "AFTER SCENARIO END"