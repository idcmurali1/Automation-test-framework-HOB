#======================================================================================================================
#    AUTHOR: Isis Tolentino (vn53dge)
#   CREATED: Mar/12/2024
#  REVISION: ---
#
#  Copyright Â© 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-dev-phase-ea-production-ios-008

scenarios:
#######################################################################################################################
#
#  CONFLUENCE TRACKING DASHBOARD:
#    https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+EA+-+Sanity+-+Production+-+ios
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MXMOB-1641
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MXMOB-1598
#
#  FLAGS USED: N/A
#
#######################################################################################################################

  - name: Before
    platform: ios
    before: true
    flow:

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_EA_Sanity_PROD_iOS_008
      - storeIn:
          key: EA_008_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: Main
    flow:
      - log: "TEST START: QAA - EA - PRODUCTION SANITY - EA-008"

      # STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER - EA HOME IS DISPLAYED.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.ea-008.zipCode
            - name: banner
              string: 'EA'

  # --------------------------------------------------------------------------------------------------------------------

      # STEP 2: NAVIGATE TO ACCOUNT AND CREATE A NEW ACCOUNT
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 2: NAVIGATE TO ACCOUNT AND CREATE A NEW ACCOUNT'
            - name: squadNames
              string: CUSTOMER | QAA
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.ea.account.assertPageDisplayed
      - executeFunction:
         name: mx.flows.od.login.createAccountFromLoginPopup
         params:
           - name: userFirstName
             string: mx.data.qaa.sanity.ea-008.userFirstName
           - name: userLastName
             string: mx.data.qaa.sanity.ea-008.userLastName
           - name: userPassword
             string: mx.data.qaa.sanity.ea-008.userPassword
           - name: testCaseNum
             string: '008'
      - executeFunction: 
         name:  mx.functions.ea.account.assertUserLogged
         params: 
           - name: userName
             string: mx.data.qaa.sanity.ea-008.userFirstName

  #--------------------------------------------------------------------------------------------------------------------

      # STEPS 3-5: OPEN DEPARTMENTS AND ADD PRODUCT TO CART FROM PDP
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 3-5: OPEN DEPARTMENTS AND ADD PRODUCT TO CART FROM PDP'
            - name: squadNames
              string: PRE-PURCHASE | QAA
      - executeFunction:
          name: mx.functions.ea.bottom-menu.tapDepartments
      - executeFunction:
          name: mx.functions.ea.departments.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.departments.selectDepartmentByName
          params:
            - name: departmentName
              string: mx.data.qaa.sanity.ea-008.departmentName
      - executeFunction:
          name: mx.functions.ea.department-l1-l2.openFirstAvailableCategory
      - executeFunction:
          name: mx.functions.ea.department-l1-l2.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.department-l1-l2.openFirstAvailableCategory
      - executeFunction:
          name: mx.functions.ea.department-l3.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.department-l3.openFirstAvailablePDP #--RETURNS--${returnedProductName}-->
      - storeIn:
          key: QAA_EA_008_PRODUCT_NAME
          value: ${returnedProductName}
      - executeFunction:
          name: mx.functions.ea.pdp.assertCorrectProductDisplayed
          params:
            - name: productName
              string: ${QAA_EA_008_PRODUCT_NAME}
      - executeFunction:
          name: mx.functions.ea.pdp.addToCart 

  #--------------------------------------------------------------------------------------------------------------------

      # STEP 6: INCREASE PRODUCT QUANTITY FROM PDP - QUANTITY IS MODIFIED SUCCESSFULLY.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 6: INCREASE PRODUCT QUANTITY FROM PDP."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.increaseProductQuantityBy
          params:
            - name: productName
              string: ${QAA_EA_008_PRODUCT_NAME}
            - name: quantity
              string: mx.data.qaa.sanity.ea-008.increaseQuantity
            - name: ignoreClickException
              string: 'true'
      - executeFunction:
          name: mx.functions.ea.pdp.getProductQuantity #--RETURNS--${returnedProductQuantity}-->
      - storeIn:
          key: QAA_EA_008_PRODUCT_QUANTITY
          value: ${returnedProductQuantity}
      - executeFunction:
          name: mx.functions.ea.pdp.getProductPrice #--RETURNS--${returnedPrice}-->
          params:
            - name: productName
              string: ${QAA_EA_008_PRODUCT_NAME}
      - storeIn:
          key: QAA_EA_008_PRODUCT_PRICE
          value: ${returnedPrice}

  #--------------------------------------------------------------------------------------------------------------------

      # STEP 7: CLOSE PDP AND OPEN CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7: CLOSE PDP AND OPEN CART."
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.ea.pdp.tapClose
      - executeFunction:
          name: mx.functions.ea.department-l3.assertPageDisplayed
      - executeFunction:
          name: mx.functions.ea.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: ${QAA_EA_008_PRODUCT_QUANTITY}
      - executeFunction:
          name: mx.functions.ea.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.ea.cart.assertPageDisplayed