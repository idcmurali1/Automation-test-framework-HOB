#======================================================================================================================
#    AUTHOR: Sergio Fernandez (vn0t1qt)
#   CREATED: Feb/13/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: batch-1-qaa-od-sanity-production-ios-006, batch-1-qaa-od-sanity-production-ios
  debug: true
  testCaseId: MXMOB-1387

scenarios:

#######################################################################################################################
#
#  CONFLUENCE TRACKING DASHBOARD:
#    https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+OD+-+Sanity+-+Production+-+iOS
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MXMOB-1387
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MXMOB-1938
#
#  Flags Used:
#    IOS_ORDERS_HISTORY_WORKAROUND
#    ORDER_DETAILS_AND_HISTORY_DELIVERY_SLOT_ASSERTION_WORKAROUND
#
#  NOTE: DUE TO BAD PERFORMANCE IN IOS, PRODUCT WILL NOT BE ADDED FROM 'Tus Productos' CAROUSEL FROM 'Home' PAGE.
#        THIS WILL HELP THE TEST CASE TO REDUCE THE TIME TAKEN TO COMPLETE THE EXECUTION AND, ADDITIONALlY, THERE ARE
#        ARE OTHER TEST CASES THAT ARE ALREADY TESTING THE APP ABILITY TO ADD PRODUCTS FROM 'Home > Tus Productos'.
#
#######################################################################################################################

  - name: Before
    before: true
    flow:
      - log: 'BEFORE SCENARIO START: Initial Config...'

      - storeIn:
          key: varTC_SUCCESSFUL_EXECUTION
          value: false

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_OD_Sanity_PROD_iOS_006

      - log: 'BEFORE SCENARIO END'

  #####################################################################################################################

  - name: Main
    flow:
      - log: 'TEST START: ${__SQUAD_REPORTING_TEST_CASE_NAME}'

      #----------------------------------------------------------------------------------------------------------------
      # STEP 1-2: Navigate through Onboarding and select OD Banner...
      - executeFunction: #---------------------------------------------------------------------------------------------
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1-2: Navigate through Onboarding and select OD Banner..."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: banner
              string: mx.data.sanity.qaa.od006.banner
            - name: zipCode
              string: mx.data.sanity.qaa.od006.zipCode

      #----------------------------------------------------------------------------------------------------------------
      # STEP 3: Login from Profile...
      - executeFunction: #---------------------------------------------------------------------------------------------
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 3: Login from Profile..."
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.flows.od.login.navigateToAccountAndLogin
          params:
            - name: userEmail
              string: mx.data.sanity.qaa.od006.email
            - name: userPassword
              string: mx.data.sanity.qaa.od006.password
            - name: userName
              string: mx.data.sanity.qaa.od006.userName

      # NOTE: THERE'S NO NEED TO IDENTIFY THE PRODUCT THAT WILL BE USED LATER FROM 'Home > Tus Productos'.

      # TODO: UNCOMMENT THE ADDITIONAL STEP BELOW ONCE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.

      # #----------------------------------------------------------------------------------------------------------------
      # # ADDITIONAL STEP: Identify, through searching, which product can be used in the TC...
      # - executeFunction: #---------------------------------------------------------------------------------------------
      #     name: mx.squad-reporting.setTestCaseStep
      #     params:
      #       - name: step
      #         string: "ADDITIONAL STEP: Identify, through searching, which product can be used in the TC..."
      #       - name: squadNames
      #         string: PRE-PURCHASE | QAA

      # - executeFunction:
      #     name: mx.functions.bottom-menu.tapHome
      # - executeFunction:
      #     name: mx.flows.od.search.identifyWhichOfTheseProductsIsTheFirstOneAvailableToBePurchased
      #     params:
      #       - name: productNamesList
      #         string: mx.data.sanity.qaa.od006.homeProducts.listOfPossibleProducts
      #       - name: maxScrolls
      #         string: '4'
      # - storeIn:
      #     key: varTC_homeProduct_name
      #     value: ${returnedAvailableProduct}

      - if:
          condition: true == false # ${returnedAvailableProduct} == 'NONE' # TODO: CORRECT CONDITION ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
          then:
            - storeIn:
                key: warningMessage
                value: mx.data.sanity.qaa.od006.notAbleToExecuteMessage
            - log:
                message: ${warningMessage}
                color: YELLOW

          else:
            #----------------------------------------------------------------------------------------------------------
            # STEP 4: Search & Add Products to Cart (from: Home, SLP, PLP)...
            - executeFunction: #---------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 4: Search & Add Products to Cart (from: Home, SLP, PLP)..."
                  - name: squadNames
                    string: PRE-PURCHASE | QAA
      
            # Add to Cart: Product 1 (Home) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 4-a: Add Product 1 to Cart (from Home)..."
                  - name: squadNames
                    string: PRE-PURCHASE | QAA

            # TODO: UNCOMMENT THE CODE BELOW AND REMOVE THE WARNING LOG ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.

            - log:
                message: '[!] [WARNING] The Scenario will not use a Product from Home due to performance issues in iOS.'
                color: YELLOW
            
            - executeFunction:
                name: mx.functions.bottom-menu.tapHome
            - executeFunction:
                name: mx.functions.home.assertPageDisplayed
            # - executeFunction:
            #     name: mx.functions.home.carousel.addProductToCart
            #     params:
            #       - name: carouselType
            #         string: Regular
            #       - name: carouselName
            #         string: mx.data.sanity.qaa.od006.homeProduct.carouselName
            #       - name: productName
            #         string: ${varTC_homeProduct_name}
            # - executeFunction:
            #     name: mx.functions.home.carousel.getProductPrice
            #     params:
            #       - name: productName
            #         string: ${varTC_homeProduct_name}
            - storeIn:
                key: varTC_homeProduct_price # Price of Product 1
                value: 0 # ${returnedPrice} # TODO: REMOVE HARDCODED VALUE ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
            - storeIn:
                key: varTC_homeProduct_quantity # Quantity of Product 1
                value: 0 # mx.data.sanity.qaa.od006.homeProduct.quantity # TODO: REMOVE HARDCODED VALUE ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
            - storeIn:
                key: varTC_homeProduct_isDualOrWeighable # Dual or Weighable Flag of Product 1
                value: false # mx.data.sanity.qaa.od006.homeProduct.isDualOrWeighable # TODO: REMOVE HARDCODED VALUE ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
            - storeIn:
                key: varTC_homeProduct_weight # Weight of Product 1
                value: 0 # mx.data.sanity.qaa.od006.homeProduct.weightConversionRate # TODO: REMOVE HARDCODED VALUE ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.

            # Add to Cart: Product 2 (SLP). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 4-b: Add Product 2 to Cart (from SLP)..."
                  - name: squadNames
                    string: PRE-PURCHASE | QAA

            - executeFunction:
                name: mx.flows.od.search.performSuccessfulSearch
                params:
                  - name: searchTerm
                    string: mx.data.sanity.qaa.od006.slpProduct.searchTerm
            - executeFunction:
                name: mx.flows.od.add-to-cart.addProductToCartByNameInSLP
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
                  - name: direction
                    string: down
            - executeFunction:
                name: mx.functions.slp.assertProductQuantityAsPieces
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
                  - name: expectedQuantityAsPieces
                    string: '1'
            - sleep:
                duration: 4000
            - executeFunction:
                name: mx.functions.slp.tapWeightButton
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
            - executeFunction:
                name: mx.functions.slp.getProductQuantityAsWeight
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
            - storeIn:
                key: varTC_slpProduct_weight # Weight of Product 2
                value: ${returnedProductWeight}
            - executeFunction:
                name: mx.functions.slp.getProductPrice
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
            - storeIn:
                key: varTC_slpProduct_price # Price of Product 2
                value: ${returnedPrice}
            - storeIn:
                key: varTC_slpProduct_quantity # Quantity of Product 2
                value: mx.data.sanity.qaa.od006.slpProduct.quantity
            - storeIn:
                key: varTC_slpProduct_isDualOrWeighable # Dual or Weighable Flag of Product 2
                value: mx.data.sanity.qaa.od006.slpProduct.isDualOrWeighable

            # Add to Cart: Product 3 (PLP). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 4-c: Add Product 3 to Cart (from PLP)..."
                  - name: squadNames
                    string: PRE-PURCHASE | QAA

            - executeFunction:
                name: mx.functions.bottom-menu.tapDepartments
            - executeFunction:
                name: mx.flows.od.taxonomy.openDepartment
                params:
                  - name: L1
                    string: mx.data.sanity.qaa.od006.plpProduct.departmentL1
                  - name: L2
                    string: mx.data.sanity.qaa.od006.plpProduct.departmentL2
                  - name: L3
                    string: mx.data.sanity.qaa.od006.plpProduct.departmentL3
            - executeFunction:
                name: mx.flows.od.add-to-cart.addProductToCartByNameInPLP
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.plpProduct.productName
                  - name: direction
                    string: down
            - executeFunction:
                name: mx.functions.department-l3.getProductPrice
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.plpProduct.productName
            - storeIn:
                key: varTC_plpProduct_price # Price of Product 3
                value: ${returnedProductPrice}
            - storeIn:
                key: varTC_plpProduct_quantity # Quantity of Product 3
                value: mx.data.sanity.qaa.od006.plpProduct.quantity
            - storeIn:
                key: varTC_plpProduct_isDualOrWeighable # Dual or Weighable Flag of Product 3
                value: mx.data.sanity.qaa.od006.plpProduct.isDualOrWeighable
            - storeIn:
                key: varTC_plpProduct_weight # Weight of Product 3
                value: mx.data.sanity.qaa.od006.plpProduct.weightConversionRate

            #----------------------------------------------------------------------------------------------------------
            # STEP 5: Perform Cart Validations...
            - executeFunction: #---------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5: Perform Cart Validations..."
                  - name: squadNames
                    string: PURCHASE | QAA

            # Cart Badge Quantity Validation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-a: Cart Badge Quantity Validation..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - arithmetic:
                expression: ${varTC_homeProduct_quantity} + ${varTC_slpProduct_quantity} + ${varTC_plpProduct_quantity}
                storeIn: varTC_cartBadge_expectedQuantity
            - executeFunction:
                name: mx.functions.top-menu.assertCartQuantity
                params:
                  - name: expectedQuantity
                    string: ${varTC_cartBadge_expectedQuantity}

            # Initial Cart Validations (Cart Opened, Cart not empty). . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-b: Cart Opened and Not Empty Validations..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.top-menu.tapCartIcon
            - executeFunction:
                name: mx.functions.utils.closeBlackPopupIfDisplayed
            - executeFunction:
                name: mx.functions.cart.assertPageDisplayed
            - executeFunction:
                name: mx.functions.cart.assertCartNotEmpty

            # Product 1 Validations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-c: Product 1 Validations..."
                  - name: squadNames
                    string: PURCHASE | QAA

            # TODO: UNCOMMENT THE CODE BELOW AND REMOVE THE WARNING LOG ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.

            - log:
                message: '[!] [WARNING] The Scenario will not use a Product from Home due to performance issues in iOS.'
                color: YELLOW

            - if:
                condition: ${varTC_homeProduct_isDualOrWeighable} == true
                then:
                  - storeIn:
                      key: varTC_homeProduct_quantityOrWeight
                      value: 0 # ${varTC_homeProduct_weight} # TODO: REMOVE HARDCODED VALUE ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
                else:
                  - storeIn:
                      key: varTC_homeProduct_quantityOrWeight
                      value: 0 # ${varTC_homeProduct_quantity} # TODO: REMOVE HARDCODED VALUE ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
            # - executeNode:
            #     file: mx/test/helpers/utils/calculateProductSubtotal.js
            #     args:
            #       - value: ${varTC_homeProduct_price}
            #       - value: ${varTC_homeProduct_quantityOrWeight}
            #       - value: ${varTC_homeProduct_isDualOrWeighable}
            #     getResponse:
            #       storeIn: varTC_homeProduct_subtotal # Subtotal for Product 1
            - storeIn:
                key: varTC_homeProduct_subtotal
                value: 0 # TODO: REMOVE WHOLE STORE IN ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.
            # - executeFunction:
            #     name: mx.flows.od.cart.performProductAssertions
            #     params:
            #       - name: productName
            #         string: ${varTC_homeProduct_name}
            #       - name: productListed
            #         string: listed
            #       - name: availability
            #         string: available
            #       - name: expectedQuantity
            #         string: ${varTC_homeProduct_quantity}
            #       - name: expectedWeightQuantity
            #         string: ${varTC_homeProduct_weight}
            #       - name: expectedUnitPrice
            #         string: ${varTC_homeProduct_price}
            #       - name: expectedSubtotal
            #         string: ${varTC_homeProduct_subtotal}

            # Product 2 Validations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-d: Product 2 Validations..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - if:
                condition: ${varTC_slpProduct_isDualOrWeighable} == true
                then:
                  - storeIn:
                      key: varTC_slpProduct_quantityOrWeight
                      value: ${varTC_slpProduct_weight}
                else:
                  - storeIn:
                      key: varTC_slpProduct_quantityOrWeight
                      value: ${varTC_slpProduct_quantity}
            - executeNode:
                file: mx/test/helpers/utils/calculateProductSubtotal.js
                args:
                  - value: ${varTC_slpProduct_price}
                  - value: ${varTC_slpProduct_quantityOrWeight}
                  - value: ${varTC_slpProduct_isDualOrWeighable}
                getResponse:
                  storeIn: varTC_slpProduct_subtotal # Subtotal for Product 2
            - executeFunction:
                name: mx.flows.od.cart.performProductAssertions
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
                  - name: productListed
                    string: listed
                  - name: availability
                    string: available
                  - name: expectedQuantity
                    string: ${varTC_slpProduct_quantity}
                  - name: expectedWeightQuantity
                    string: ${varTC_slpProduct_weight}
                  - name: expectedUnitPrice
                    string: ${varTC_slpProduct_price}
                  - name: expectedSubtotal
                    string: ${varTC_slpProduct_subtotal}

            - executeFunction:
                name: mx.flows.od.cart.getProductPricingInformation
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName

            # Product 3 Validations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-e: Product 3 Validations..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - if:
                condition: ${varTC_plpProduct_isDualOrWeighable} == true
                then:
                  - storeIn:
                      key: varTC_plpProduct_quantityOrWeight
                      value: ${varTC_plpProduct_weight}
                else:
                  - storeIn:
                      key: varTC_plpProduct_quantityOrWeight
                      value: ${varTC_plpProduct_quantity}
            - executeNode:
                file: mx/test/helpers/utils/calculateProductSubtotal.js
                args:
                  - value: ${varTC_plpProduct_price}
                  - value: ${varTC_plpProduct_quantityOrWeight}
                  - value: ${varTC_plpProduct_isDualOrWeighable}
                getResponse:
                  storeIn: varTC_plpProduct_subtotal # Subtotal for Product 3
            - executeFunction:
                name: mx.flows.od.cart.performProductAssertions
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.plpProduct.productName
                  - name: productListed
                    string: listed
                  - name: availability
                    string: available
                  - name: expectedQuantity
                    string: ${varTC_plpProduct_quantity}
                  - name: expectedWeightQuantity
                    string: ${varTC_slpProduct_weight}
                  - name: expectedUnitPrice
                    string: ${varTC_plpProduct_price}
                  - name: expectedSubtotal
                    string: ${varTC_plpProduct_subtotal}

            # Subtotal Product Count Validation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-f: Validation in Subtotal Label for Products Count..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.cart.assertProductsCountInSubtotalLabel
                params:
                  - name: expectedProductsCount
                    string: ${varTC_cartBadge_expectedQuantity}

            # Cart's Subtotal Validation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-g: Cart's Subtotal Validation..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - arithmetic:
                expression: ${varTC_homeProduct_subtotal} + ${varTC_slpProduct_subtotal} + ${varTC_plpProduct_subtotal}
                storeIn: varTC_cart_subtotal
            - executeFunction:
                name: mx.functions.cart.assertSubtotal
                params:
                  - name: expectedSubtotal
                    string: ${varTC_cart_subtotal}
            - executeFunction:
                name: mx.functions.cart.getCartDiscount
            - storeIn:
                key: varTC_TotalCartDiscount
                value: ${returnedCartDiscount}

            # Cart's Estimated Total Validation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 5-h: Cart's Estimated Total Validation..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - arithmetic:
                expression: ${varTC_cart_subtotal} + ${varTC_TotalCartDiscount}
                storeIn: varTC_cart_estimatedTotal
            - executeFunction:
                name: mx.functions.cart.assertEstimatedTotalFromDetailsSection
                params:
                  - name: expectedEstimatedTotal
                    string: ${varTC_cart_estimatedTotal}
            - executeFunction:
                name: mx.functions.cart.assertEstimatedTotalFromBottom
                params:
                  - name: expectedEstimatedTotal
                    string: ${varTC_cart_estimatedTotal}

            #----------------------------------------------------------------------------------------------------------
            # STEP 6-7: Reserve Slot...
            - executeFunction: #---------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 6-7: Reserve Slot..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.flows.od.cart.reserveSlot
                params:
                  - name: deliveryMethod
                    string: mx.data.sanity.qaa.od006.delivery.method
                  - name: deliveryPlaceAction
                    string: mx.data.sanity.qaa.od006.delivery.locationAction
                  - name: zipCode
                    string: mx.data.sanity.qaa.od006.delivery.zipCode
                  - name: storeName
                    string: mx.data.sanity.qaa.od006.delivery.storeName
                  - name: slotDate
                    string: mx.data.sanity.qaa.od006.delivery.slotDateOption
                  - name: slotTime
                    string: mx.data.sanity.qaa.od006.delivery.slotTimeOption
            - storeIn:
                key: varTC_selectedDaySlot
                value: ${returnedSelectedDaySlot}
            - storeIn:
                key: varTC_selectedTimeSlot
                value: ${returnedSelectedTimeSlot}

            #----------------------------------------------------------------------------------------------------------------
            # STEP 8: Continue to Checkout & Perform Order Review Validations...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: 'STEP 8: Continue to Checkout & Perform Order Review Validations...'
                  - name: squadNames
                    string: PURCHASE | QAA

            - sleep:
                duration: 5000
            - executeFunction:
                name: mx.functions.cart.tapContinue
            - executeFunction:
                name: mx.functions.missing-something.continueWithoutSelectionIfPageDisplayed
            - executeFunction:
                name: mx.functions.review-order.assertPageDisplayed
            - executeFunction:
                name: mx.flows.od.review-order.assertDeliveryInformation
                params:
                  - name: deliveryMethod
                    string: mx.data.sanity.qaa.od006.delivery.method
                  - name: expectedDaySlot
                    string: ${varTC_selectedDaySlot}
                  - name: expectedTimeSlot
                    string: ${varTC_selectedTimeSlot}
                  - name: expectedStoreOrHomeName
                    string: mx.data.sanity.qaa.od006.delivery.expectedStoreNameInOrderReview
                  - name: expectedStoreOrHomeAddress
                    string: mx.data.sanity.qaa.od006.delivery.expectedStoreAddressInOrderReview.forIOS
            - executeFunction:
                name: mx.flows.od.review-order.assertTotalsInformation
                params:
                  - name: expectedSubtotalProductsCount
                    string: ${varTC_cartBadge_expectedQuantity}
                  - name: expectedSubtotal
                    string: ${varTC_cart_estimatedTotal}
                  - name: assertDeliveryFee
                    string: true
                  - name: expectedDeliveryFee
                    string: '0.00'

            #----------------------------------------------------------------------------------------------------------------
            # STEP 9: Disable Substitute Preferences for all products...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 9: Disable Substitute Preferences for all products..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.flows.od.review-order.disableSubstitutePreferencesForAllProducts

            #----------------------------------------------------------------------------------------------------------------
            # STEP 10: Select Pay at Delivery payment method...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 10: Select Pay at Delivery payment method..."
                  - name: squadNames
                    string: PURCHASE | QAA

            # Order's Comments. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 10-a: Enter Order's Comments..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.utils.scrollToTop
                params:
                  - name: elementAtTheTop
                    string: mx.mappings.review-order.deliveryHeaderContainer
            - executeFunction:
                name: mx.functions.review-order.tapAddDeliveryInstructions
            - executeFunction:
                name: mx.functions.general-comments-pop-up.enterTestOrderDisclaimer
            - executeFunction:
                name: mx.functions.general-comments-pop-up.tapSave

            # Pay at Delivery Method Selection. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 10-b: Select Pay at Delivery payment method..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.review-order.scrollDownToWallet
            - executeFunction:
                name: mx.flows.od.review-order.forceSelectPayAtDeliveryMethod
                params:
                  - name: payAtDeliveryOption
                    string: mx.data.sanity.qaa.od006.payAtDeliveryOption

            # Uncheck Order Status Updates by Phone . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 10-c: Uncheck Order Status Updated by Phone..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.review-order.enterCellphoneNumber
                params:
                  - name: userPhoneNumber
                    string: "5512345678"
            - executeFunction:
                name: mx.functions.review-order.uncheckUpdatesByPhoneCheckbox
            - executeFunction:
                name: mx.functions.review-order.assertUpdatesByPhoneCheckboxState
                params:
                  - name: expectedState
                    string: unchecked

            # Review Order Totals Assertions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 10-d: Review Order Totals Assertions..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.review-order.scrollDownToSection
                params:
                  - name: sectionName
                    string: Total estimado
            - executeFunction:
                name: mx.functions.review-order.assertSubtotal
                params:
                  - name: subtotal
                    string: ${varTC_cart_estimatedTotal}
            - executeFunction:
                name: mx.functions.review-order.assertDeliveryFee
                params:
                  - name: deliveryFee
                    string: "0.00"
            - executeFunction:
                name: mx.functions.review-order.assertEstimatedTotal
                params:
                  - name: estimatedTotalFromBottom
                    string: ${varTC_cart_estimatedTotal}
            - executeFunction:
                name: mx.functions.review-order.assertEstimatedTotalFromButton
                params:
                  - name: estimatedTotalFromButton
                    string: ${varTC_cart_estimatedTotal}

            #----------------------------------------------------------------------------------------------------------------
            # STEP 11: Place Order...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 11: Place Order..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.review-order.tapPlaceOrder
            - executeNode:
                file: mx/test/helpers/utils/getTodaysDateAsStringForAssertion.js
                getResponse:
                  storeIn: varTC_OrderDate
            - sleep:
                duration: 10000

            #----------------------------------------------------------------------------------------------------------------
            # STEP 12: Order Confirmation Review...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 12: Order Confirmation Review..."
                  - name: squadNames
                    string: PURCHASE | QAA

            - executeFunction:
                name: mx.functions.utils.closeRateWalmartPopupIfDisplayed

            - executeFunction:
                name: mx.functions.order-confirmation.assertPageDisplayed
            
            # Delivery Method Assertion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.functions.order-confirmation.assertDeliveryMethod
                params:
                  - name: expectedDeliveryMethod
                    string: mx.data.sanity.qaa.od006.delivery.method

            # Total Assertion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.functions.order-confirmation.assertTotal
                params:
                  - name: expectedTotal
                    string: ${varTC_cart_estimatedTotal}

            # Delivery Slot Assertion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.functions.utils.getDeliverySlot
                params:
                  - name: forPage
                    string: 'ReviewOrder'
                  - name: selectedDaySlot
                    string: ${varTC_selectedDaySlot}
                  - name: selectedTimeSlot
                    string: ${varTC_selectedTimeSlot}
            - executeFunction:
                name: mx.functions.order-confirmation.assertDeliverySlot
                params:
                  - name: expectedDeliverySlot
                    string: ${returnedDeliverySlot}

            # Delivery Place Assertions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.functions.order-confirmation.assertStoreAddressName
                params:
                  - name: expectedStoreAddressName
                    string: mx.data.sanity.qaa.od006.delivery.expectedStoreNameInOrderReview
            - executeFunction:
                name: mx.functions.order-confirmation.assertStoreAddress
                params:
                  - name: storeAddress
                    string: mx.data.sanity.qaa.od006.delivery.expectedStoreAddressInOrderReview.forIOS

            # Products Count Assertion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.functions.order-confirmation.assertProductsCount
                params:
                  - name: expectedProductsCount
                    string: ${varTC_cartBadge_expectedQuantity}

            # Get Order Number . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.functions.order-confirmation.getOrderNumber
            - storeIn:
                key: varTC_OrderNumber
                value: ${returnedOrderNumber}

            #----------------------------------------------------------------------------------------------------------------
            # STEP 13: Go back to Home Screen...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 13: Go back to Home Screen..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            - executeFunction:
                name: mx.functions.order-confirmation.tapFindMoreProducts
            - executeFunction:
                name: mx.functions.bottom-menu.tapHome

            #----------------------------------------------------------------------------------------------------------------
            # STEP 14: Go to Orders History and perform Order Validations for newly placed order...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 14: Go to Orders History and perform Order Validations for newly placed order..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            - executeFunction:
                name: mx.functions.bottom-menu.tapAccount
            - executeFunction:
                name: mx.functions.account.assertPageDisplayed
            - executeFunction:
                name: mx.functions.account.openOrdersHistory
            - executeFunction:
                name: mx.functions.orders-history.assertPageDisplayed
            - executeFunction:
                name: mx.flows.od.orders-history.assertOrder
                params:
                  - name: orderNumber
                    string: ${varTC_OrderNumber}
                  - name: expectedDeliveryMethod
                    string: mx.data.sanity.qaa.od006.delivery.method
                  - name: expectedTotal
                    string: ${varTC_cart_estimatedTotal}
                  - name: expectedBanner
                    string: Walmart
                  - name: expectedDaySlot
                    string: ${varTC_selectedDaySlot}
                  - name: expectedTimeSlot
                    string: ${varTC_selectedTimeSlot}
                  - name: expectedOrderStatus
                    string: Received
                  - name: expectedProductsCount
                    string: ${varTC_cartBadge_expectedQuantity}

            #----------------------------------------------------------------------------------------------------------------
            # STEP 15: Go to Orders Details and perform Order's Details validation...
            - executeFunction: #---------------------------------------------------------------------------------------------
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 15: Go to Orders Details and perform Order's Details validation..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            # Order Details Assertions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 15-a: Order Details Assertions..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            - if:
                condition: ${IOS_ORDERS_HISTORY_WORKAROUND} == true
                then:
                  - log:
                      message: "[!] Flag IOS_ORDERS_HISTORY_WORKAROUND is set to 'true'."
                      color: YELLOW
                  - log:
                      message: "[!] The scenario will open the Order at the top of the list."
                      color: YELLOW
                  - executeFunction:
                      name: mx.functions.orders-history.tapOrderDetailsByPosition
                      params:
                        - name: position
                          string: '1'
                else:
                  - executeFunction:
                      name: mx.functions.orders-history.openOrder
                      params:
                        - name: orderNumber
                          string: ${qaa_od001_order_number}
            - sleep:
                duration: 5000

            - arithmetic:
                expression: ${varTC_cart_estimatedTotal} + ( ${varTC_TotalCartDiscount} * -1 )
                storeIn: varTC_subtotalForOrderDetails
            - executeFunction:
                name: mx.flows.od.order-details.assertOrderDetailsWithoutDeliveryLocationAssertion
                params:
                  - name: orderNumber
                    string: ${varTC_OrderNumber}
                  - name: expectedOrderedDate
                    string: ${varTC_OrderDate}
                  - name: expectedDeliveryMethod
                    string: mx.data.sanity.qaa.od006.delivery.method
                  - name: expectedOrderStatus
                    string: Received
                  - name: expectedBanner
                    string: Walmart
                  - name: expectedDaySlot
                    string: ${returnedSelectedDaySlot}
                  - name: expectedTimeSlot
                    string: ${returnedSelectedTimeSlot}
                  - name: expectedProductsCount
                    string: ${varTC_cartBadge_expectedQuantity}
                  - name: expectedPaymentMethod
                    string: PayAtDelivery
                  - name: expectedSubtotal
                    string: ${varTC_subtotalForOrderDetails}
                  - name: assertDiscount
                    string: true
                  - name: expectedDiscount
                    string: ${varTC_TotalCartDiscount}
                  - name: expectedDeliveryFee
                    string: "0.00"
                  - name: expectedTotal
                    string: ${varTC_cart_estimatedTotal}

            # Delivery Location Assertion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 15-b: Delivery Location Assertion..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            - executeFunction:
                name: mx.functions.utils.scrollToTop
                params:
                  - name: elementAtTheTop
                    string: mx.mappings.order-details.orderNumber
            - executeFunction:
                name: mx.flows.od.order-details.assertRawDeliveryLocation
                params:
                  - name: deliveryMethod
                    string: mx.data.sanity.qaa.od006.delivery.method
                  - name: expectedRawName
                    string: mx.data.sanity.qaa.od006.delivery.expectedStoreNameInOrderDetails
                  - name: expectedRawAddress
                    string: mx.data.sanity.qaa.od006.delivery.expectedStoreAddressInOrderDetails

            # Product 3 Assertions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 15-c: Product 3 Details Assertion..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            - executeFunction:
                name: mx.functions.order-details.expandProductsDetailsIfNotExpanded
            - executeFunction:
                name: mx.flows.od.order-details.assertProductDetails
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.plpProduct.productName
                  - name: expectedPrice
                    string: ${varTC_plpProduct_price}
                  - name: expectedSubtotal
                    string: ${varTC_plpProduct_subtotal}
                  - name: productType
                    string: mx.data.sanity.qaa.od006.plpProduct.type
                  - name: expectedOrderedQuantityAsPieces
                    string: ${varTC_plpProduct_quantity}
                  - name: expectedOrderedQuantityAsWeight
                    string: ${varTC_plpProduct_weight}

            # Product 2 Assertions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 15-d: Product 2 Details Assertion..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            - executeFunction:
                name: mx.flows.od.order-details.assertProductDetails
                params:
                  - name: productName
                    string: mx.data.sanity.qaa.od006.slpProduct.productName
                  - name: expectedPrice
                    string: ${varTC_slpProduct_price}
                  - name: expectedSubtotal
                    string: ${varTC_slpProduct_subtotal}
                  - name: productType
                    string: mx.data.sanity.qaa.od006.slpProduct.type
                  - name: expectedOrderedQuantityAsPieces
                    string: ${varTC_slpProduct_quantity}
                  - name: expectedOrderedQuantityAsWeight
                    string: ${varTC_slpProduct_weight}

            # Product 1 Assertions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: "STEP 15-e: Product 1 Details Assertion..."
                  - name: squadNames
                    string: POST-PURCHASE | QAA

            # TODO: UNCOMMENT THE CODE BELOW AND REMOVE THE WARNING LOG ONCE THE SCENARIO USES THE PRODUCT FROM 'Home > Tus Productos'.

            - log:
                message: '[!] [WARNING] The Scenario did not use a Product from Home due to performance issues in iOS. Assertion omitted.'
                color: YELLOW

            # - executeFunction:
            #     name: mx.flows.od.order-details.assertProductDetails
            #     params:
            #       - name: productName
            #         string: ${varTC_homeProduct_name}
            #       - name: expectedPrice
            #         string: ${varTC_homeProduct_price}
            #       - name: expectedSubtotal
            #         string: ${varTC_homeProduct_subtotal}
            #       - name: productType
            #         string: mx.data.sanity.qaa.od006.homeProduct.type
            #       - name: expectedOrderedQuantityAsPieces
            #         string: ${varTC_homeProduct_quantity}
            #       - name: expectedOrderedQuantityAsWeight
            #         string: ${varTC_homeProduct_weight}

      #----------------------------------------------------------------------------------------------------------------
      # Test Case Successful Execution...
      #----------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: varTC_SUCCESSFUL_EXECUTION
          value: true

      - log: 'TEST END: ${__SQUAD_REPORTING_TEST_CASE_NAME}'

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - log: 'AFTER SCENARIO START: Test Data Reset...'

      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${varTC_SUCCESSFUL_EXECUTION}

      # Check if data needs to be reset...
      - if:
          condition: ${varTC_SUCCESSFUL_EXECUTION} != true
          then:
            
            # STEP (After 1): Relaunch App...
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: 'STEP (After 1): Relaunch App...'
                  - name: squadNames
                    string: QAA
            - executeFunction:
                name: mx.functions.utils.relaunchApp

            # STEP (After 2): Re-login if Session Expired...
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: 'STEP (After 2): Re-login if Session Expired...'
                  - name: squadNames
                    string: CUSTOMER | QAA
            - executeFunction:
                name: mx.flows.od.after-scenario-exclusive.reLoginIfSessionExpired
            - executeFunction:
                name: mx.functions.prehome.tapODBanner
            - executeFunction:
                name: mx.functions.delivery-method-selector.closeSelectorIfExpanded
            - executeFunction:
                name: mx.functions.home.assertPageDisplayed

            # STEP (After 3): Empty Cart...
            - executeFunction:
                name: mx.squad-reporting.setTestCaseStep
                params:
                  - name: step
                    string: 'STEP (After 3): Empty Cart...'
                  - name: squadNames
                    string: QAA
            - executeFunction:
                name: mx.flows.od.after-scenario-exclusive.emptyCart
                params:
                  - name: userEmail
                    string: mx.data.sanity.qaa.od006.email
                  - name: userPassword
                    string: mx.data.sanity.qaa.od006.password
                  - name: isCartEmpty
                    string: 'false'

            # Data Reset Succeeded...
            - log:
                message: Data Reset Succeeded
                color: CYAN
            - failTest:
                message: Main Scenario Failed. After Scenario Failed too to ensure proper Execution Status in SauceLabs.

          else:
            - log:
                message: Main Scenario Passed. No data reset needed.
                color: CYAN

      - log: 'AFTER SCENARIO END'
