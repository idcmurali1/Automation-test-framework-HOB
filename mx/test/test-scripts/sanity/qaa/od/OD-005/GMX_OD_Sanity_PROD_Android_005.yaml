#======================================================================================================================
#    AUTHOR: Octavio Cabrales Zárate (vn53g23), Rodrigo Pacheco C. (vn53p0i)
#   CREATED: Jun/24/2022
#  REVISION: ---
#
#  Copyright © 2022 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-od-sanity-production-android-005, qaa-od-sanity-production-android
  testCaseId: MXMOB-1368

scenarios:
#######################################################################################################################
#
#  CONFLUENCE TRACKING DASHBOARD:
#    https://confluence.walmart.com/display/MXGECMEX/MXMOB-QAA%3A+Tracking%3A+Test+Suite%3A+GlassMX+-+OD+-+Sanity+-+Production+-+Android
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MXMOB-1368
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MXMOB-1937
#
#   - Flags used:
#
#       ${ORDER_DETAILS_AND_HISTORY_DELIVERY_SLOT_ASSERTION_WORKAROUND}  -  Values: [true | false]
#           Turns on/off the execution of the workaround to perform (or not) the delivery slot assertions on 
#           order-details and orders-history pages due to an error that displays a different time slot from the selected 
#           during the booking phase.
#
#       ${IOS_LOGIN_AS_REGISTERED_USER_WORKAROUND}  -  Values: [true | false]
#           Turns on/off the execution of the workaround to log in after finishing the onboarding steps due to iOS not
#           having the login button inside the onboarding aside from Android. Turn on to log in in Account page after
#           the onboarding steps, turn off to log in inside the onboarding as usual.
#
#       ${ASSERT_DELIVERY_SLOT_IN_CART}  -  Values: [true | false]
#           If set to 'true', the flow will perform assertion for the Delivery Slot in Cart page.
#           If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
#  
#       ${ASSERT_DELIVERY_SLOT_IN_REVIEW_ORDER}  -  Values: [true | false]
#           If set to 'true', the flow will perform assertion for the Delivery Slot in Review Order page.
#           If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
#  
#       ${ASSERT_DELIVERY_SLOT_IN_ORDER_CONFIRMATION}  -  Values: [true | false]
#           If set to 'true', the flow will perform assertion for the Delivery Slot in Order Confirmation page.
#           If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
#  
#       ${ASSERT_DELIVERY_SLOT_IN_ORDERS_HISTORY}  -  Values: [true | false]
#           If set to 'true', the flow will perform assertion for the Delivery Slot in Orders History page.
#           If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
#  
#       ${ASSERT_DELIVERY_SLOT_IN_ORDER_DETAILS}  -  Values: [true | false]
#           If set to 'true', the flow will perform assertion for the Delivery Slot in Order Details page.
#           If set to 'false' or not set at all, it will perform the Delivery Slot assertion as expected.
#
#######################################################################################################################

#======================================================================================================================

  - name: Main
    flow:
      - log: "TEST START: ${__SQUAD_REPORTING_TEST_CASE_NAME}"
      ## STEP 1: OPEN APP AND COMPLETE ONBOARDING AS GUEST - PRE-HOME SCREEN IS DISPLAYED
      ## STEP 2: SELECT OD BANNER - HOME SCREEN IS DISPLAYED
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEPS 1-2: LAUNCH AND COMPLETE ONBOARDING - SELECT OD BANNER.'
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.sanity.od-005.zipCode
            - name: banner
              string: OD

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 3: GO TO PROFILE SCREEN AND LOGIN - USER INFORMATION SHOULD BE LOADED ON ACCOUNT PAGE
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 3: GO TO PROFILE SCREEN AND LOGIN.'
            - name: squadNames
              string: CUSTOMER | QAA


      - executeFunction:
          name: mx.flows.od.login.navigateToAccountAndLogin
          params:
            - name: userEmail
              string: mx.data.qaa.sanity.od-005.userEmail
            - name: userPassword
              string: mx.data.qaa.sanity.od-005.userPassword
            - name: userName
              string: mx.data.qaa.sanity.od-005.userName

  # Changing store.....................................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 3-A: Changing store (if necessary)...'
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - executeFunction:
          name: mx.functions.home.scrollUpToLocationBanner
      - if:
          identifier:
            present:
              - identifier: mx.mappings.delivery-method-selector.expandLocationBanner
          then:
            - executeFunction:
                name: mx.functions.delivery-method-selector.expandSelector
            - executeFunction:
                name: mx.functions.delivery-method-selector.tapPickupButtonIfNotSelected
            - executeFunction:
                name: mx.flows.od.delivery-method-selector.changeStoreFromSelector
                params:
                  - name: zipCode
                    string: mx.data.qaa.sanity.od-005.zipCode
                  - name: storeName
                    string: mx.data.qaa.sanity.od-005.storeName
            - executeFunction:
                name: mx.functions.delivery-method-selector.closeSelector
          else:
            - if:
                identifier:
                  present:
                    - identifier: mx.mappings.home.selectedStoreButton # <--Selected Store--${selectedStore}--Set in 'Before' Scenario.
                then:
                  - log: "Desired Store already selected, execution will continue..."
                else:
                  - log: "Desired Store not selected, changing store..."
                  - executeFunction:
                      name: mx.functions.home.tapStoreSelector
                  - executeFunction:
                      name: mx.functions.store-selector-popup.assertPageDisplayed
                  - executeFunction:
                      name: mx.flows.od.store-selector-popup.quickChangeStoreFromPopup
                      params:
                        - name: zipCode
                          string: mx.data.qaa.sanity.od-005.zipCode
                        - name: storeName
                          string: mx.data.qaa.sanity.od-005.storeName

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 4: ADD PRODUCTS TO CART - PRODUCTS ARE ADDED TO CART
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 4: ADD PRODUCTS TO CART.'
            - name: squadNames
              string: PRE-PURCHASE | QAA

      - log: "Adding first product sold by pieces..."
      - executeFunction:
          name: mx.flows.od.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.sanity.od-005.searchTerm1 # Always returns pieces products...
      - storeIn:
          key: OD_005_IS_CART_EMPTY
          value: false
      - executeFunction:
          name: mx.flows.od.add-to-cart.addProductWithoutBadgesToCartInSLP #--RETURNS--${returnedProductName}-->
          params:
            - name: previousList
              string: 'null'
      - executeFunction:
          name: mx.functions.slp.getProductPrice
          params:
            - name: productName
              string: ${returnedProductName}
      - storeIn:
          key: qaa_od005_product_1_name
          value: ${returnedProductName}
          # [VARIABLE] Product Name 1 saved in ${qaa_od005_product_1_name}
      - storeIn:
          key: qaa_od005_product_1_price
          value: ${returnedPrice}
          # [VARIABLE] Price of product 1 saved in ${qaa_od005_product_1_price}

  #....................................................................................................................

      - log: "Adding second product sold by pieces..."
      - executeFunction:
          name: mx.flows.od.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.sanity.od-005.searchTerm2 # Always returns pieces products...
      - executeFunction:
          name: mx.flows.od.add-to-cart.addProductWithoutBadgesToCartInSLP #--RETURNS--${returnedProductName}-->
          params:
            - name: previousList
              string: 'null'
      - executeFunction:
          name: mx.functions.slp.getProductPrice
          params:
            - name: productName
              string: ${returnedProductName}
      - storeIn:
          key: qaa_od005_product_2_name
          value: ${returnedProductName}
          # [VARIABLE] Product Name 2 saved in ${qaa_od005_product_2_name}
      - storeIn:
          key: qaa_od005_product_2_price
          value: ${returnedPrice}
          # [VARIABLE] Price of product 2 saved in ${qaa_od005_product_2_price}

  #--------------------------------------------------------------------------------------------------------------------
    
      ## STEP 5: OPEN CART - PRODUCTS ADDED ARE DISPLAYED IN CART AND PRODUCTS QUANTITIES ARE CORRECT
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 5: OPEN CART.'
            - name: squadNames
              string: PURCHASE | QAA
      
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 5(A): Getting total products quantity...'
            - name: squadNames
              string: PURCHASE | QAA
      - storeIn:
          key: qaa_od005_total_products_quantity
          value: mx.data.qaa.sanity.od-005.totalProductsQuantity
      - log:
          message: "Total Products Quantity: ${qaa_od005_total_products_quantity}"
          color: CYAN
      - executeFunction:
          name: mx.functions.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: ${qaa_od005_total_products_quantity}
      - executeFunction:
          name: mx.functions.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed
      - executeFunction:
          name: mx.functions.cart.assertPageDisplayed

  #....................................................................................................................

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 5-B: Product 1 assertions...'
            - name: squadNames
              string: PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.cart.quickPerformProductAssertions #--[RETURNS]--${returnedProductType}-->
          params:
            - name: productName
              string: ${qaa_od005_product_1_name}
            - name: productType
              string: 'null'
            - name: expectedQuantity
              string: mx.data.qaa.sanity.od-005.genericProductAddedQuantity
            - name: expectedWeightQuantity
              string: "null"
            - name: expectedUnitPrice
              string: ${qaa_od005_product_1_price}
            - name: expectedOriginalPrice
              string: "null"
            - name: expectedSubtotal
              string: ${qaa_od005_product_1_price}
      - storeIn:
          key: qaa_od005_product_1_type
          value: ${returnedProductType}
          # [VARIABLE] Type of product 1 saved in ${qaa_od005_product_1_type}

  #....................................................................................................................

      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 5-C: Product 2 assertions...'
            - name: squadNames
              string: PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.cart.quickPerformProductAssertions #--[RETURNS]--${returnedProductType}-->
          params:
            - name: productName
              string: ${qaa_od005_product_2_name}
            - name: productType
              string: 'null'
            - name: expectedQuantity
              string: mx.data.qaa.sanity.od-005.genericProductAddedQuantity
            - name: expectedWeightQuantity
              string: "null"
            - name: expectedUnitPrice
              string: ${qaa_od005_product_2_price}
            - name: expectedOriginalPrice
              string: "null"
            - name: expectedSubtotal
              string: ${qaa_od005_product_2_price}
      - storeIn:
          key: qaa_od005_product_2_type
          value: ${returnedProductType}
          # [VARIABLE] Type of product 1 saved in ${qaa_od005_product_2_type}

  #--------------------------------------------------------------------------------------------------------------------
    
      ## STEP 6: CLICK ON 'RESERVAR HORARIO' - RESERVE-SLOT PAGE IS DISPLAYED
      ## STEP 7: CLICK THE HOME DELIVERY METHOD TAB AND SELECT DAY AND TIME SLOTS - FINAL CART ASSERTIONS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEPS 6-7: RESERVE SLOT (HOME DELIVERY)'
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.flows.od.cart.reserveSlot
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.od-005.deliveryMethod
            - name: addressName
              string: mx.data.qaa.sanity.od-005.userAddressName
            - name: deliveryPlaceAction
              string: 'Change'
            - name: slotDate
              string: 'dayAfterTomorrow'
            - name: slotTime
              string: 'lastAvailable'

  # Retrieving Home Delivery Address data for future validations.......................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Steps 6-7-A: Retrieving Home Delivery Address data for future validations...'
            - name: squadNames
              string: PURCHASE | QAA
      - storeIn:
          key: qaa_od005_selected_user_address_street_name
          value: ${returnedStreetName}
          # [VARIABLE] Street name from selected address saved in ${qaa_od005_selected_user_address_street_name}
      - storeIn:
          key: qaa_od005_selected_user_address_exterior_number
          value: ${returnedExteriorNumber}
          # [VARIABLE] Exterior Number from selected address saved in ${qaa_od005_selected_user_address_exterior_number}
      - storeIn:
          key: qaa_od005_selected_user_address_city
          value: ${returnedCity}
          # [VARIABLE] City from selected address saved in ${qaa_od005_selected_user_address_city}
      - storeIn:
          key: qaa_od005_selected_user_address_state
          value: ${returnedState}
          # [VARIABLE] State from selected address saved in ${qaa_od005_selected_user_address_state}
      - storeIn:
          key: qaa_od005_selected_user_address_zip_code
          value: ${returnedZipCode}
          # [VARIABLE] Zip Code from selected address saved in ${qaa_od005_selected_user_address_zip_code}
      
  # Retrieving values for totals Assertions............................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Steps 6-7-B: Retrieving values for totals Assertions...'
            - name: squadNames
              string: PURCHASE | QAA
      - storeIn:
          key: qaa_od005_delivery_fee
          value: mx.data.qaa.sanity.od-005.deliveryFee # <-- Business rule
          # [VARIABLE] Delivery fee saved in ${qaa_od005_delivery_fee}
      - arithmetic:
          expression: ${qaa_od005_product_1_price} + ${qaa_od005_product_2_price}
          numberOfDecimalPlaces: 2
          storeIn: qaa_od005_subtotal
          # [VARIABLE] Cart subtotal saved in ${qaa_od005_subtotal}
      - arithmetic:
          expression: ${qaa_od005_subtotal} + ${qaa_od005_delivery_fee}
          numberOfDecimalPlaces: 2
          storeIn: qaa_od005_total
          # [VARIABLE] Cart estimated total saved in ${qaa_od005_total}
      
  # Validating totals and continuing to Review-Order...................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Steps 6-7-C: Validating totals and continuing to Review-Order...'
            - name: squadNames
              string: PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.cart.assertTotals # --RETURNS--${returnedEstimatedTotal}-->
          params:
            - name: expectedDeliveryFee
              string: ${qaa_od005_delivery_fee}
            - name: expectedSubtotal
              string: ${qaa_od005_subtotal}
      - executeFunction:
          name: mx.functions.cart.tapContinue
      - executeFunction:
          name: mx.functions.missing-something.continueWithoutSelectionIfPageDisplayed
      - executeFunction:
          name: mx.functions.review-order.assertPageDisplayed

  #--------------------------------------------------------------------------------------------------------------------
    
      ## STEP 8: CLICK ON CONTINUE BUTTON AND OPEN REVIEW ORDER PAGE - INITIAL REVIEW-ORDER ASSERTIONS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 8: CLICK ON CONTINUE BUTTON AND OPEN REVIEW ORDER PAGE.'
            - name: squadNames
              string: PURCHASE | QAA

  # Running Delivery Information Assertions............................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 8-A: Running Delivery Information Assertions...'
            - name: squadNames
              string: PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.review-order.assertDeliveryInformation
          params:
            - name: deliveryMethod
              string: mx.data.qaa.sanity.od-005.deliveryMethod
            - name: expectedDaySlot
              string: ${returnedSelectedDaySlot}
            - name: expectedTimeSlot
              string: ${returnedSelectedTimeSlot}
            - name: expectedStoreOrHomeName
              string: mx.data.qaa.sanity.od-005.userAddressName
            - name: expectedStoreOrHomeAddress
              string: 'null'
            - name: expectedUserStreet
              string: ${qaa_od005_selected_user_address_street_name}
            - name: expectedUserExteriorNumber
              string: ${qaa_od005_selected_user_address_exterior_number}
            - name: expectedUserCity
              string: ${qaa_od005_selected_user_address_city}
            - name: expectedUserState
              string: ${qaa_od005_selected_user_address_state}
            - name: expectedUserZipCode
              string: ${qaa_od005_selected_user_address_zip_code}
      
  # Test Order Disclaimer..............................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 8-B: Test Order Disclaimer...'
            - name: squadNames
              string: PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.review-order.enterTestOrderDisclaimer

  #--------------------------------------------------------------------------------------------------------------------
    
      ## STEP 9: GO TO 'PREFERENCIAS DE SUSTITUTOS' AND REMOVE SUBSTITUTIONS - SUBSTITUTIONS SHOULD BE DISABLED
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9: GO TO 'PREFERENCIAS DE SUSTITUTOS' AND REMOVE SUBSTITUTIONS."
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.review-order.tapEditSubstitutePreferences
      - executeFunction:
          name: mx.functions.substitutes-preferences.assertPageDisplayed
      - executeFunction:
          name: mx.functions.substitutes-preferences.assertProductListed
          params:
            - name: productName
              string: ${qaa_od005_product_1_name}
      - executeFunction:
          name: mx.functions.substitutes-preferences.assertProductListed
          params:
            - name: productName
              string: ${qaa_od005_product_2_name}
      - executeFunction:
          name: mx.functions.substitutes-preferences.assertTotalProductsCount
          params:
            - name: expectedQuantity
              string: mx.data.qaa.sanity.od-005.totalProductsQuantity
      - executeFunction:
          name: mx.functions.substitutes-preferences.unselectAllProducts
      - executeFunction:
          name: mx.functions.substitutes-preferences.tapUnderstood
      - executeFunction:
          name: mx.functions.review-order.assertNoSubstitutionsSelected

  #--------------------------------------------------------------------------------------------------------------------
      
      ## STEP 10: SELECT PAY AT DELIVERY - PAYMENT METHOD SHOULD BE UPDATED AND FINAL REVIEW-ORDER ASSERTIONS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 10: SELECT PAY AT DELIVERY.'
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: Pago
      - executeFunction:
          name: mx.flows.od.review-order.selectPayAtDeliveryMethodIfNotSelected
          params:
            - name: payAtDeliveryOption
              string: mx.data.qaa.sanity.od-005.payAtDeliveryFormat
      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: "Número telefónico"
      - executeFunction:
          name: mx.flows.od.review-order.enterCellphoneNumber
          params:
            - name: userPhoneNumber
              string: mx.data.qaa.sanity.od-005.userPhoneNumber
      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: Total
      - executeFunction:
          name: mx.flows.od.review-order.assertTotalsInformation
          params:
            - name: expectedSubtotalProductsCount
              string: mx.data.qaa.sanity.od-005.totalProductsQuantity
            - name: expectedSubtotal
              string: ${qaa_od005_subtotal}
            - name: assertDeliveryFee
              string: 'true'
            - name: expectedDeliveryFee
              string: ${qaa_od005_delivery_fee}

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 11: PLACE ORDER - ORDER CONFIRMATION ASSERTIONS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 11: PLACE ORDER.'
            - name: squadNames
              string: PURCHASE | QAA

      - executeFunction:
          name: mx.functions.review-order.tapPlaceOrder
      - storeIn:
          key: qaa_od005_ordered_date
          value: ${returnedOrderedDate}
          # [VARIABLE] Ordered Date saved in ${qaa_od005_ordered_date}
      - storeIn:
          key: OD_005_IS_CART_EMPTY
          value: true
      - sleep:
          duration: 10000

  # Running Confirmation Page Assertions...............................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 11-A: Running Confirmation Page Assertions...'
            - name: squadNames
              string: PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.order-confirmation.assertConfirmation
          params:
            - name: expectedTotal
              string: ${qaa_od005_total}
            - name: expectedDaySlot
              string: ${returnedSelectedDaySlot}
            - name: expectedTimeSlot
              string: ${returnedSelectedTimeSlot}
            - name: expectedProductsCount
              string: mx.data.qaa.sanity.od-005.totalProductsQuantity
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.od-005.deliveryMethod
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.od-005.userAddressName
            - name: expectedUserStreet
              string: ${qaa_od005_selected_user_address_street_name}
            - name: expectedUserExteriorNumber
              string: ${qaa_od005_selected_user_address_exterior_number}
            - name: expectedUserCity
              string: ${qaa_od005_selected_user_address_city}
            - name: expectedUserState
              string: ${qaa_od005_selected_user_address_state}
            - name: expectedUserZipCode
              string: ${qaa_od005_selected_user_address_zip_code}

      - executeFunction:
          name: mx.functions.order-confirmation.getOrderNumber
      - storeIn:
          key: qaa_od005_order_number
          value: ${returnedOrderNumber}
          # [VARIABLE] Order number saved in ${qaa_od005_order_number}"

  #--------------------------------------------------------------------------------------------------------------------

      ## STEP 12: TAP FIND MORE PRODUCTS - CONFIRMATION PAGE SHOULD BE CLOSED
      ## STEP 13: GO TO ACCOUNT AND OPEN ORDERS HISTORY - ORDERS HISTORY ASSERTIONS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step  
              string: 'STEPS 12-13: GO TO ORDERS HISTORY.'
            - name: squadNames
              string: CUSTOMER | QAA

      - executeFunction:
          name: mx.functions.order-confirmation.tapFindMoreProducts
      - sleep:
          duration: 10000
      - executeFunction:
          name: mx.functions.bottom-menu.tapAccount
      - executeFunction:
          name: mx.functions.account.assertPageDisplayed
      - executeFunction:
          name: mx.functions.account.openOrdersHistory

  # Running Orders History assertions..................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Steps 12-13-A: Running Orders History assertions...'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.orders-history.assertOrder
          params:
            - name: orderNumber
              string: ${qaa_od005_order_number}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.od-005.deliveryMethod
            - name: expectedTotal
              string: ${qaa_od005_total}
            - name: expectedBanner
              string: mx.data.qaa.sanity.od-005.storeBanner
            - name: expectedDaySlot
              string: ${returnedSelectedDaySlot}
            - name: expectedTimeSlot
              string: ${returnedSelectedTimeSlot}
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.od-005.expectedOrderStatus
            - name: expectedProductsCount
              string: mx.data.qaa.sanity.od-005.totalProductsQuantity

  #--------------------------------------------------------------------------------------------------------------------
      
      ## STEP 14: OPEN ORDER DETAILS OF THE PREVIOUSLY PLACED ORDER - ORDER DETAILS ASSERTIONS
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'STEP 14: OPEN ORDER DETAILS OF THE PREVIOUSLY PLACED ORDER.'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - sleep:
          duration: 5000
      - executeFunction:
          name: mx.functions.orders-history.openOrder
          params:
            - name: orderNumber
              string: ${qaa_od005_order_number}

  # Performing Order Details assertions................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 14-A: Performing Order Details assertions...'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.order-details.assertDetailsWithoutAddressAndTotalsInformation
          params:
            - name: orderNumber
              string: ${qaa_od005_order_number}
            - name: expectedOrderedDate
              string: ${qaa_od005_ordered_date}
            - name: expectedDeliveryMethod
              string: mx.data.qaa.sanity.od-005.deliveryMethod
            - name: expectedOrderStatus
              string: mx.data.qaa.sanity.od-005.expectedOrderStatus
            - name: expectedBanner
              string: mx.data.qaa.sanity.od-005.storeBanner
            - name: expectedDaySlot
              string: ${returnedSelectedDaySlot}
            - name: expectedTimeSlot
              string: ${returnedSelectedTimeSlot}
            - name: expectedProductsCount
              string: mx.data.qaa.sanity.od-005.totalProductsQuantity

  # Performing Order Details - Home Delivery assertions................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 14-B: Performing Order Details - Home Delivery assertions...'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.functions.order-details.assertHomeDeliveryAddressName
          params:
            - name: expectedHomeAddressName
              string: mx.data.qaa.sanity.od-005.userAddressName
      - executeFunction:
          name: mx.functions.order-details.assertHomeDeliveryAddressByIndividualValues
          params:
            - name: streetName
              string: ${qaa_od005_selected_user_address_street_name}
            - name: exteriorNumber
              string: ${qaa_od005_selected_user_address_exterior_number}
            - name: city
              string: ${qaa_od005_selected_user_address_city}
            - name: state
              string: ${qaa_od005_selected_user_address_state}
            - name: zipCode
              string: ${qaa_od005_selected_user_address_zip_code}
      
  # Performing assertions for Product 1................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 14-C: Performing assertions for Product 1...'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.functions.order-details.expandProductsDetailsIfNotExpanded
      - executeFunction:
          name: mx.flows.od.order-details.assertProductDetails
          params:
            - name: productName
              string: ${qaa_od005_product_1_name}
            - name: expectedPrice
              string: ${qaa_od005_product_1_price}
            - name: expectedSubtotal
              string: ${qaa_od005_product_1_price}
            - name: productType
              string: ${qaa_od005_product_1_type}
            - name: expectedOrderedQuantityAsPieces
              string: mx.data.qaa.sanity.od-005.genericProductAddedQuantity

  # Performing assertions for Product 2................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 14-D: Performing assertions for Product 2...'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.flows.od.order-details.assertProductDetails
          params:
            - name: productName
              string: ${qaa_od005_product_2_name}
            - name: expectedPrice
              string: ${qaa_od005_product_2_price}
            - name: expectedSubtotal
              string: ${qaa_od005_product_2_price}
            - name: productType
              string: ${qaa_od005_product_2_type}
            - name: expectedOrderedQuantityAsPieces
              string: mx.data.qaa.sanity.od-005.genericProductAddedQuantity

  # Performing Totals assertions.......................................................................................
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: 'Step 14-E: Performing Totals Assertions...'
            - name: squadNames
              string: POST-PURCHASE | QAA
      - executeFunction:
          name: mx.functions.order-details.scrollToBottom
      - executeFunction:
          name: mx.flows.od.order-details.assertTotals
          params:
            - name: expectedPaymentMethod
              string: mx.data.qaa.sanity.od-005.orderDetailsPaymentMethod
            - name: expectedDeliveryFee
              string: ${qaa_od005_delivery_fee}
            - name: expectedSubtotal
              string: ${qaa_od005_subtotal}

  #--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: OD_005_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: ${__SQUAD_REPORTING_TEST_CASE_NAME}"

  #####################################################################################################################

  - name: Before
    before: true
    flow:
      - log: "BEFORE SCENARIO START: Initial Config..."

      - executeFunction:
          name: mx.squad-reporting.setTestCaseName
          params:
            - name: testCaseName
              string: GMX_OD_Sanity_PROD_Android_005

      - log:
          message: "WORKAROUND: RELAUNCHING APP TO FIX ISSUE REGARDING INTERNAL APP FLAGS"
          color: YELLOW
      - executeFunction:
          name: mx.functions.utils.relaunchApp
      - storeIn:
          key: selectedStore
          value: mx.data.qaa.sanity.od-005.storeName
      - storeIn:
          key: OD_005_IS_CART_EMPTY
          value: true
      - storeIn:
          key: OD_005_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - log: "AFTER SCENARIO START: Test Data Reset..."
      
      - executeFunction:
          name: mx.squad-reporting.logTestCaseFailure
          params:
            - name: testCaseExecutionStatus
              string: ${OD_005_SUCCESSFUL_EXECUTION}

      - if:
          condition: ${OD_005_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed: Resetting data for the next execution if necessary..."
                color: CYAN
            - executeFunction:
                name: mx.flows.od.after-scenario-exclusive.emptyCart
                params:
                  - name: userEmail
                    string: mx.data.qaa.sanity.od-005.userEmail
                  - name: userPassword
                    string: mx.data.qaa.sanity.od-005.userPassword
                  - name: isCartEmpty
                    string: ${OD_005_IS_CART_EMPTY}
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: CYAN
      - log: "AFTER SCENARIO END"
