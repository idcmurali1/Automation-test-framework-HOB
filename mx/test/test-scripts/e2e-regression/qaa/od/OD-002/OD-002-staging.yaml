#======================================================================================================================
#    AUTHOR: Francisco Ramirez (vn53vq4)
#   CREATED: Jan/30/2023
#  REVISION: ---
#
#  Copyright Â© 2023 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-od-e2e-regression-staging-002

scenarios:

#---------------------------------------------------------------------------------------------------------------------

  - name: Main
    flow:
       
      - log: Steps 1 and 2 - Complete Onboarding as Guest User and display Home Page.
      
      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.e2e-regression.od-002.zipCode
            - name: banner
              string: "OD"

      - log: Step 3 - Navigate to departments and select a department.
      
      - executeFunction:
         name: mx.functions.home.tapStoreSelector
      
      - executeFunction:
          name: mx.functions.store-selector-popup.clearCurrentZipCode
      
      - executeFunction:
          name: mx.functions.store-selector-popup.enterZipCode
          params:
            - name: zipCode
              string: "11200"
      
      - executeFunction:
          name: mx.functions.store-selector-popup.selectStoreByPosition
          params:
            - name: storeIndex
              string: "0"
      
      - executeFunction:
          name: mx.functions.home.scrollDownToCarousel
          params:
            - name: carouselName
              string: mx.data.e2e-regression.od-002.carouselName

      - executeFunction:
          name: mx.functions.home.carousel.addProductToCart
          params:
            - name: carouselName
              string: mx.data.e2e-regression.od-002.carouselName
            - name: productName
              string: mx.data.e2e-regression.od-002.productName1

      - executeFunction:
          name: mx.functions.bottom-menu.tapDepartments
      
      - executeFunction:
          name: mx.functions.departments.selectDepartment 
          params:
            - name: departmentName
              string: mx.data.e2e-regression.od-002.departmentName
      
      - executeFunction:
          name: mx.functions.department-l1-l2.assertPageDisplayed
      
      - log: Step 4 - Add Products to cart.

      - executeFunction:
          name: mx.functions.department-l1-l2.assertPageDisplayed
      
      - executeFunction:
          name: mx.functions.department-l1-l2.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.e2e-regression.od-002.departmentSection  
  
      - executeFunction:
          name: mx.functions.department-l1-l2.section-carousel.addProductToCart
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName2
      
      - executeFunction:
          name: mx.functions.department-l1-l2.section-carousel.getProductPrice
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName2
      
      - storeIn:
          key: returnedProductPrice2
          value: ${price}
     
      - log: Step 5 - Click Home and Perform a Search

      - executeFunction:
          name: mx.functions.bottom-menu.tapHome
      
      - executeFunction:
          name:  mx.functions.utils.scrollToTop
      
      - executeFunction:
          name: mx.functions.home.assertPageDisplayed
      
      - executeFunction:
          name: mx.functions.top-menu.enterSearchTerm
          params:
            - name: searchTerm
              string: mx.data.e2e-regression.od-002.productSearch1

      - executeFunction:
          name: mx.functions.top-menu.tapSearchInKeyboard
      
      - executeFunction:
          name: mx.functions.delivery-methods-info-popup.dismissPopupIfDisplayed
      
      - log: Step 6 - Add Products to the Cart from SLP
      
      - executeFunction:
          name: mx.functions.slp.addProductToCart
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName3
      
      - executeFunction:
          name: mx.functions.slp.getProductPrice
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName3

      - storeIn:
          key: returnedProductPrice3 
          value: ${price}

      - executeFunction:
          name: mx.functions.top-menu.enterSearchTerm
          params:
            - name: searchTerm
              string: mx.data.e2e-regression.od-002.productSearch2

      - executeFunction:
          name: mx.functions.top-menu.tapSearchInKeyboard
      
      - executeFunction:
          name: mx.functions.delivery-methods-info-popup.dismissPopupIfDisplayed
      
      - executeFunction:
          name: mx.functions.slp.addProductToCart
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName4
      
      - executeFunction:
          name: mx.functions.slp.getProductPrice
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName4
      
      - storeIn:
          key: returnedProductPrice4
          value: ${price}

      - log: Step 7 - Open Cart 

      - executeFunction:
          name: mx.functions.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: mx.data.e2e-regression.od-002.top-menu.expectedProductsQuantity

      - executeFunction:
          name: mx.functions.top-menu.tapCartIcon
      
      - executeFunction:
          name: mx.functions.cart.assertPageDisplayed
      
      - executeFunction:
          name: mx.functions.cart.assertCartNotEmpty
      
      - executeFunction:
          name: mx.functions.cart.assertProductListed
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName1
      
      - executeFunction:
          name: mx.functions.cart.assertProductListed
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName2
      
      - executeFunction:
          name: mx.functions.cart.assertProductListed
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName3
     
      - executeFunction:
          name: mx.functions.cart.assertProductListed
          params:
            - name: productName
              string: mx.data.e2e-regression.od-002.productName4
     
      - executeFunction:
          name: mx.functions.cart.assertTotalProductsCount
          params:
            - name: expectedProductsQuantity
              string: mx.data.e2e-regression.od-002.cart.expectedProductsQuantity
      
      - log: Step 8 -  Hit "Continuar" button

      - executeFunction:
          name: mx.functions.cart.tapContinue
      
      - log: Step 9 - Login existing account
      
      - executeFunction:
          name: mx.flows.od.login.loginFromPopup
          params:
            - name: userEmail
              string: mx.data.e2e-regression.od-002.login.userEmail
            - name: userPassword
              string: mx.data.e2e-regression.od-002.login.userPassword

      # Actually this is a "continue" button, but mapping is designed to works btw.
      - executeFunction:
           name: mx.functions.reserve-slot.tapReserve
  
      - log: Step 10 - Step 11- Select Time Slot and hit "Reservar"
      
      - executeFunction:
          name: mx.functions.reserve-slot.assertPageDisplayed      
      
      - executeFunction:
          name: mx.functions.reserve-slot.tapHomeDeliveryMethod
    
      - executeFunction:
          name: mx.functions.reserve-slot.selectTomorrowSlot
      
      - executeFunction:
          name: mx.functions.reserve-slot.selectFirstAvailableTimeSlot

      - log: Step 12 - Continue Checkout

      - executeFunction:
           name: mx.functions.reserve-slot.tapReserve
      
      - log: Step 13 - Select MSI promotion

      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.e2e-regression.od-002.reserve-slot.sectionName1
      
      - executeFunction:
          name: mx.functions.review-order.payment-section.enterCVV
          params:
            - name: cvv
              string: mx.data.e2e-regression.od-002.reserve-slot-payment.cvv

      - executeFunction:
          name: mx.functions.review-order.payment-section.selectMSIPromotion 
          params:
            - name: msiPromotionOption
              string: mx.data.e2e-regression.od-002.reserve-slot-payment.msiPromotionOption

      - executeFunction:
          name: mx.functions.review-order.payment-section.assertMSIPromotionIsApplied
          params:
            - name: msiPromotionOption
              string: mx.data.e2e-regression.od-002.reserve-slot-payment.msiPromotionOption
      
      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.e2e-regression.od-002.reserve-slot.sectionName2
      
      - executeFunction:
          name: mx.functions.review-order.enterCellphoneNumber
          params:
            - name: userPhoneNumber
              string: mx.data.e2e-regression.od-002.review-order.cellphoneNumber
      
      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.e2e-regression.od-002.reserve-slot.sectionName3


      - log: Step 14 - Place Order

      - executeFunction:
          name: mx.functions.review-order.tapPlaceOrder
      
      - executeFunction:
          name: mx.functions.order-confirmation.assertPageDisplayed

      - executeFunction:
          name: mx.functions.order-confirmation.assertDeliveryMethod
          params:
            - name: expectedDeliveryMethod
              string: mx.data.e2e-regression.od-002.order-confirmation.deliveryMethod
      
      - log: Step 15 - Hit "Descubrir mas productos" button

      - executeFunction:
          name: mx.functions.order-confirmation.tapFindMoreProducts
      
      - executeFunction:
          name: mx.functions.bottom-menu.tapHome

      - executeFunction:
          name: mx.functions.home.assertPageLoaded

      # NOTE: I have notice that in case the test execution fails, for the next execution test case will present more and different pages and actions that may change the behavior of the app.
      # For this, I will recommend for further use, that for each failed execution do a clean up, which means to complete the buy(transaction) manually with the existing user.
      # With this you can avoid implementing or change the code as a listed functions below in case that the tester need them.

      # - executeFunction:
      #     name: mx.functions.oos.tapAcceptButton
      
      # - executeFunction:
      #     name: mx.functions.reserve-slot.address-message-popup.closePopupIfDisplayed
      
      # - executeFunction:
      #     name: mx.functions.reserve-slot.tapSaveAddressIfDisplayed
      
      # - executeFunction:
      #     name: mx.functions.reserve-slot.tapSaveAddressIfDisplayed