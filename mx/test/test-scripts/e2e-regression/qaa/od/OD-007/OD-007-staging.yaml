#======================================================================================================================
#    AUTHOR: Francisco Javier Ramírez Hernández
#   CREATED: March/03/2023
#  REVISION: ---
#
#  Copyright © 2023 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-od-e2e-regression-staging-007

scenarios:

  #--------------------------------------------------------------------------------------------------------------------
  
  - name: Main
    flow:

      - log: Steps 1 and 2 - Complete Onboarding as Guest User and display Home Page.
      
      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.e2e-regression.od-007.zipCode
            - name: banner
              string: "OD"
      
      - log: "STEP 3: Login from Profile..."

      - executeFunction:
          name: mx.flows.od.login.navigateToAccountAndLogin
          params:
            - name: userEmail
              string: mx.data.e2e-regression.od-007.login.userEmail
            - name: userPassword
              string: mx.data.e2e-regression.od-007.userPassword
            - name: userName
              string: mx.data.e2e-regression.od-007.userName
      
      - log: "Step 4 and 5 - Go to wallet and add Credit Card And Assert CC added"
      
      - executeFunction:
            name: mx.functions.account.openWallet
      
      - executeFunction:
          name: mx.flows.od.wallet.addNewDebitOrCreditCard
          params:
            - name: cardHolderName
              string: mx.data.e2e-regression.od-007.wallet.cardName
            - name: cardNumber
              string: mx.data.e2e-regression.od-007.wallet.cardNumber
            # - name: expirationDate
            #   string: mx.data.e2e-regression.od-007.wallet.expirationDate
            # PENDING TO ANALYZE FOR FURTHER IMPLEMENTATION
            - name: expectedExpirationMonth
              string: "Abril"
            - name: expectedExpirationYear
              string: "2025"
            - name: cardCVV
              string: mx.data.e2e-regression.od-007.wallet.cvv
            - name: streetName
              string: mx.data.e2e-regression.od-007.wallet.userAddress
            - name: exteriorNumber
              string: mx.data.e2e-regression.od-007.wallet.addressNumber
            - name: cityName
              string: mx.data.e2e-regression.od-007.wallet.city
            - name: neighborhoodName
              string: mx.data.e2e-regression.od-007.wallet.colony
            - name: municipalityName
              string: mx.data.e2e-regression.od-007.wallet.municipality
            - name: stateName
              string: mx.data.e2e-regression.od-007.wallet.state
            - name: zipCode
              string: mx.data.e2e-regression.od-007.wallet.zipcode
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits
      
      - log: "Add debit card"

      - executeFunction:
          name: mx.functions.wallet.tapAddPaymentMethod
      
      - executeFunction:
          name: mx.flows.od.wallet.addNewDebitOrCreditCardShort
          params:
            - name: cardNumber
              string: mx.data.e2e-regression.od-007.wallet.cardNumber2
            # - name: expirationDate
            #   string: mx.data.e2e-regression.od-007.wallet.expirationDate
            # PENDING TO ANALYZE FOR FURTHER IMPLEMENTATION
            - name: expectedExpirationMonth
              string: "Abril"
            - name: expectedExpirationYear
              string: "2025"
            - name: cardCVV
              string: mx.data.e2e-regression.od-007.wallet.cvv2
            - name: cardHolderName
              string: mx.data.e2e-regression.od-007.wallet.cardName2
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits
    
      - executeFunction:
          name: mx.functions.wallet.assertCardAddedByLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits2

      - log: "Add Amex Card"

      - executeFunction:
          name: mx.functions.wallet.tapAddPaymentMethod
      
      - executeFunction:
          name: mx.flows.od.wallet.addNewDebitOrCreditCardShort
          params:
            - name: cardNumber
              string: mx.data.e2e-regression.od-007.wallet.cardNumber3
            # - name: expirationDate
            #   string: mx.data.e2e-regression.od-007.wallet.expirationDate3
            # PENDING TO ANALYZE FOR FURTHER IMPLEMENTATION
            - name: expectedExpirationMonth
              string: "Abril"
            - name: expectedExpirationYear
              string: "2025"
            - name: cardCVV
              string: mx.data.e2e-regression.od-007.wallet.cvv3
            - name: cardHolderName
              string: mx.data.e2e-regression.od-007.wallet.cardName3
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits
        
      - executeFunction:
          name: mx.functions.wallet.assertCardAddedByLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits3
      
      - executeFunction:
          name: mx.functions.wallet.scrollToCardWithLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits3

      - executeFunction:
          name: mx.functions.wallet.tapEditCard
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits3
      
      - executeFunction:
          name: mx.functions.edit-card-form.tapRemoveCard

      - log: "Step 9 - Search and add items to cart"
      
      - executeFunction:
          name: mx.functions.bottom-menu.tapHome
      
      - executeFunction:
          name: mx.functions.home.assertPageLoaded
      
      - executeFunction:
          name: mx.functions.home.scrollDownToCarousel
          params:
            - name: carouselName
              string: mx.data.e2e-regression.od-007.home.carrouselName
      
      - executeFunction:
          name: mx.functions.home.carousel.addProductToCart
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.home.productName
            - name: carouselName
              string: mx.data.e2e-regression.od-007.home.carrouselName
      
      - executeFunction:
          name: mx.functions.bottom-menu.tapDepartments

      - executeFunction:
          name: mx.functions.departments.assertPageDisplayed

      - executeFunction:
          name: mx.functions.departments.selectDepartment
          params:
            - name: departmentName
              string: mx.data.e2e-regression.od-007.departments.departmentName
      
      - executeFunction:
          name: mx.functions.department-l1-l2.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.e2e-regression.od-007.department-l1-l2.sectionName
      
      - executeFunction:
          name: mx.functions.department-l1-l2.section-carousel.addProductToCart
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.department-l1-l2.productName

      - executeFunction:
          name: mx.flows.od.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.e2e-regression.od-007.slp.searchTerm

      - executeFunction:
          name: mx.functions.slp.scrollDownToProductByName
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.slp.productName

      - executeFunction:
          name: mx.functions.slp.addProductToCart
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.slp.productName
      
      - executeFunction:
          name: mx.functions.top-menu.assertCartQuantity
          params:
            - name: expectedQuantity
              string: mx.data.e2e-regression.od-007.top-menu.productQuantity
      
      - log:
          message: "Step 10 - Open Cart and Assertions"
      
      - executeFunction:
          name: mx.functions.top-menu.tapCartIcon
      
      - executeFunction:
          name: mx.flows.od.cart.performProductAssertions
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.home.productName
            - name: productListed
              string: "listed"
            - name: availability
              string: "available"
            - name: expectedQuantity
              string: mx.data.e2e-regression.od-007.cart.productQuantity
            - name: expectedWeightQuantity
              string: "null"
            - name: expectedPrice
              string: mx.data.e2e-regression.od-007.cart.expectedPrice # temporary variable, will save this value further during execution time
            - name: expectedSubtotal
              string: mx.data.e2e-regression.od-007.cart.expectedPrice # temporary variable, will save this value further during execution time

      - executeFunction:
          name: mx.flows.od.cart.performProductAssertions
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.department-l1-l2.productName
            - name: productListed
              string: "listed"
            - name: availability
              string: "available"
            - name: expectedQuantity
              string: mx.data.e2e-regression.od-007.cart.productQuantity2
            - name: expectedWeightQuantity
              string: "null"
            - name: expectedPrice
              string: mx.data.e2e-regression.od-007.cart.expectedPrice2 # temporary variable, will save this value further during execution time
            - name: expectedSubtotal
              string: mx.data.e2e-regression.od-007.cart.expectedPrice2 # temporary variable, will save this value further during execution time

      - executeFunction:
          name: mx.flows.od.cart.performProductAssertions
          params:
            - name: productName
              string: mx.data.e2e-regression.od-007.slp.productName
            - name: productListed
              string: "listed"
            - name: availability
              string: "available"
            - name: expectedQuantity
              string: mx.data.e2e-regression.od-007.cart.productQuantity3 # temporary variable, will save this value further during execution time
            - name: expectedWeightQuantity
              string: "300 g"
            - name: expectedPrice
              string: mx.data.e2e-regression.od-007.cart.expectedPrice3 # temporary variable, will save this value further during execution time
            - name: expectedSubtotal
              string: mx.data.e2e-regression.od-007.cart.expectedPrice3 # temporary variable, will save this value further during execution time
            
      - log: "Step 11: Hit Reservar un horario"
      
      - executeFunction:
          name: mx.functions.cart.tapReserveSlot

      - executeFunction:
          name: mx.functions.reserve-slot.assertPageDisplayed
      
      - log: "Step 12: Select Pickup a time slot available for today"

      - executeFunction:
          name: mx.functions.reserve-slot.tapPickupDeliveryMethod
  
      - executeFunction:
          name: mx.functions.reserve-slot.assertThereAreAvailableTimeSlots
      
      - executeFunction:
          name: mx.functions.reserve-slot.selectRandomDateSlot
      
      - executeFunction:
          name: mx.functions.reserve-slot.selectRandomVisibleTimeSlot
      
      - executeFunction:
          name: mx.functions.reserve-slot.tapReserve
      
      - log: "Step 13: Continue Checkout"

      - executeFunction:
          name: mx.functions.cart.tapContinue
      
      - executeFunction:
          name: mx.functions.review-order.assertPageDisplayed
      
      # Promotional Code: MUCOD10OFF
      - log: "Step 14: Add Promotional Coupon"

      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.e2e-regression.od-007.review-order.sectionName

      - executeFunction:
          name: mx.flows.od.review-order.applyCoupon
          params:
            - name: promoCode
              string: mx.data.e2e-regression.od-007.review-order.promoCode
      
      - log:  "Step 15: Go to payment methods and select debit card"

      - executeFunction:
          name: mx.functions.review-order.scrollUpToSection
          params:
            - name: sectionName
              string: "Pago"
      
      - executeFunction:
          name: mx.functions.review-order.payment-section.tapChangePaymentMethod
      
      - executeFunction:
          name: mx.functions.wallet.assertCardAddedByLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits
      
      - executeFunction:
          name: mx.functions.wallet.scrollToCardWithLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.last4Digits
      
      - executeFunction:
          name: mx.functions.edit-card-form.selectCardByLast4Digits
          params:
            - name: last4DigitsTermination
              string: mx.data.e2e-regression.od-007.wallet.cardLast4DigitsTermination
      
      - executeFunction:
          name: mx.functions.wallet.tapContinue
      
      # Extra step: enter phone number, this is mandatory
      - executeFunction:
          name: mx.functions.review-order.scrollDownToSection
          params:
            - name: sectionName
              string: "Número telefónico"
      
      - executeFunction:
          name: mx.functions.review-order.enterCellphoneNumber
          params:
            - name: userPhoneNumber
              string: mx.data.e2e-regression.od-007.review-order.userPhoneNumber

      - log: "Step 16: Get delivery slot and then Place Order"

      # Get the delivery slot.
      - executeFunction:
          name: mx.functions.review-order.scrollUpToSection
          params:
            - name: sectionName
              string: "Pickup"
      
      - executeFunction:
          name: mx.functions.review-order.getDeliverySlot

      - storeIn:
          key: tc_returnedDeliverySlot
          value: ${returnedDeliverySlot}

      - executeFunction:
          name: mx.functions.review-order.tapPlaceOrder
      
      - executeFunction:
          name: mx.functions.order-confirmation.assertPageDisplayed
        
      - executeFunction:
          name: mx.functions.order-confirmation.assertDeliveryMethod
          params:
            - name: expectedDeliveryMethod
              string: "PickupDelivery"
      
      - executeFunction:
          name: mx.functions.order-confirmation.assertDeliverySlot
          params:
            - name: expectedDeliverySlot
              string: ${tc_returnedDeliverySlot}
      
      #  Get order number
      - executeFunction:
          name: mx.functions.order-confirmation.getOrderNumber

      - storeIn:
          key: tc_OrderNumber
          value: ${returnedOrderNumber}

      - log: "Step 17: Hit Descubrir mas productos button "

      - executeFunction:
          name: mx.functions.order-confirmation.tapFindMoreProducts
          
      - executeFunction:
          name: mx.functions.home.scrollToTop

      - executeFunction:
          name: mx.functions.home.assertPageLoaded

      - log: "Step 18: Go to Profile screen and select 'Pedidos'"

      - executeFunction:
          name: mx.functions.bottom-menu.tapAccount
      
      - executeFunction:
          name: mx.functions.account.assertPageDisplayed
      
      - executeFunction:
          name: mx.functions.account.openOrdersHistory
      
      - executeFunction:
          name: mx.functions.orders-history.assertPageDisplayed

      - log: "Step 19 -  Select the newest placed order"
      
      - executeFunction:
          name: mx.functions.orders-history.tapOrderDetailsByPosition
          params:
            - name: position
              string: "1"
      
      - executeFunction:
          name: mx.functions.order-details.assertCorrectOrderDisplayed
          params:
            - name: expectedOrderNumber
              string: ${tc_OrderNumber}

      - log: "Step 20: Go to account select Wallet"

      - executeFunction:
          name: mx.functions.orders-history.tapBack
     
      - executeFunction:
          name: mx.functions.orders-history.tapBack

      - executeFunction:
          name: mx.functions.account.openWallet
      
      - executeFunction:
          name: mx.functions.wallet.assertPageDisplayed

      - log: "Step 21: Remove credit and debit card"

      - executeFunction:
          name: mx.functions.wallet.assertAtLeastCardQuantity

      - executeFunction:
          name: mx.functions.wallet.scrollToCardWithLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.cardLast4DigitsTermination
      
      - executeFunction:
          name: mx.functions.wallet.tapEditCardWithLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.cardLast4DigitsTermination
      
      - executeFunction:
          name: mx.functions.edit-card-form.tapRemoveCard
          
      - executeFunction:
          name: mx.functions.wallet.scrollToCardWithLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.cardLast4DigitsTermination2
      
      - executeFunction:
          name: mx.functions.wallet.tapEditCardWithLast4Digits
          params:
            - name: last4Digits
              string: mx.data.e2e-regression.od-007.wallet.cardLast4DigitsTermination2
      
      - executeFunction:
          name: mx.functions.edit-card-form.tapRemoveCard