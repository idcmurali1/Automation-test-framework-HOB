#======================================================================================================================
#    AUTHOR: Osmar Juárez (vn56dce)
#   CREATED: Apr/02/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: qaa-poc-walmart-prepurchase-production-ios-000, qaa-poc-bodega-prepurchase-production-ios-000

scenarios:
  - name: Main
    platform: ios
    flow:
      - log: "TEST START: ${PREPRUCHASE_TEST_CASE_NAME}"

      - log:
         message: "STEP 1: NAVIGATE THROUGH ONBOARDING AND SELECT EA BANNER AS GUEST USER."
         color: ORANGE

      - executeFunction:
          name: mx.flows.global.onboarding.navigateToHomeAsGuestUser
          params:
            - name: zipCode
              string: mx.data.qaa.prepurchase.poc.zipCode
            - name: banner
              string: 'EA'

  #--------------------------------------------------------------------------------------------------------------------

      - log:
         message: "STEP 2: SEARCH FOR A PRODUCT (ANY/NON SPECIFIED)."
         color: ORANGE

      
      - executeFunction:
          name: mx.functions.top-menu.tapSearchField
      - executeFunction:
          name: mx.functions.top-menu.enterSearchTerm
          params:
            - name: searchTerm
              string: mx.data.qaa.prepurchase.poc.searchTerm
      - executeFunction:
          name: mx.functions.top-menu.tapSearchInKeyboard
      - executeFunction:
          name: mx.functions.delivery-methods-info-popup.dismissPopupIfDisplayed
      - verifyIdentifier: 
          visible:
            - identifier: GlassResultsBarView.titleLabel
              value: "true"
  
  #--------------------------------------------------------------------------------------------------------------------

      - log:
         message: "STEP 3: ADD ANY PRODUCT TO CART FROM SLP."
         color: ORANGE
      
      - executeFunction:
          name: mx.functions.slp.addProductToCart
          params:
            - name: productName
              string: mx.data.qaa.prepurchase.poc.searchTerm
      - executeFunction:
          name: mx.functions.slp.assertProductAddedToCart
      
  #--------------------------------------------------------------------------------------------------------------------

      - storeIn:
          key: PREPURHCASE_POC_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: ${PREPRUCHASE_TEST_CASE_NAME}"
  
  #####################################################################################################################

  - name: Before
    before: true
    flow:
      - log: "BEFORE SCENARIO START: Initial Config..."
      
      - storeIn:
          key: PREPRUCHASE_TEST_CASE_NAME
          value: "GMX_PREPURCHASE_POC_IOS"

      - storeIn:
          key: PREPURHCASE_POC_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #####################################################################################################################

  - name: After
    after: true
    flow:
      - log: "AFTER SCENARIO START: After Configs..."

      - if:
          condition: ${PREPURHCASE_POC_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed. No need to reset data."
                color: RED
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: GREEN_BOLD
      - log: "AFTER SCENARIO END"
