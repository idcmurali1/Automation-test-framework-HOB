#======================================================================================================================
#    AUTHOR: Fernanda Peruyero (vn54e7a)
#   CREATED: Dec/16/2024
#  REVISION: ---
#
#  Copyright 춸 2024 Walmart. All rights reserved.
#======================================================================================================================

general:
  tags: prepurchase-walmart-ea-smoke-production-android-1134, prepurchase-walmart-ea-smoke-production-android,
        prepurchase-bodega-ea-smoke-production-android-1134, prepurchase-bodega-ea-smoke-production-android
  testCaseId: MMS-4938

scenarios:
#######################################################################################################################
#
#  TEST CASE TITLE: 
#    [Taxonomy] - Verify that an item can be added and removed from cart from a sub-category
#
#  CONFLUENCE TRACKING DASHBOARD:
#    https://confluence.walmart.com/display/MXGECMEX/GlassMX+-+OD+-+Smoke+-+Production+-+Android
#
#  JIRA AUTOMATION TC:
#    https://jira.walmart.com/browse/MMS-4938
#
#  JIRA MANUAL TC:
#    https://jira.walmart.com/browse/MMS-1134
#
#######################################################################################################################
 
scenarios:

#* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#  B E F O R E   S C E N A R I O
#* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Before
    before: true
    flow:

       - log: R2_SUBFLOW_BEFORE ### [[ 游릭 Flow Identifier: BEFORE 游릭 ]] ###
            
       - executeFunction:
          name: functions.utils.setMarketInfo

     #setting GMX_PP_APP_NAME variable for department selection
       - if:
          condition: ${APP_PACKAGE} == 'com.walmart.mg.debug'
          then:
            - storeIn:
                key: GMX_PP_APP_NAME
                value: ''
          else:
            - storeIn:
                key: GMX_PP_APP_NAME
                value: '_bodega'

       - storeIn:
          key: MMS_1134_SUCCESSFUL_EXECUTION
          value: false

       - log: "BEFORE SCENARIO END"

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#  M A I N   S C E N A R I O
#* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    platform: android
    flow:

      - log: R2_SUBFLOW_MAIN ### [[ 游릭 Flow Identifier: MAIN 游릭 ]] ###
 
      #  STEPS 1-2 ------------------------------------------------------------------------------------------------------
      - log:
         message: "STEPS 1-2: (1) OPEN APP AND COMPLETE ONBOARDING. (2) OPEN THE EA BANNER."
         color: ORANGE

      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: mx.prepurchase.onboarding.userPostalCode
            - name: ShoppingExperience
              string: mx.prepurchase.onboarding.onlineExclusiveStore
     
      #  STEP 3 Go to "Departamentos" by tapping on the corresponding icon in the bottom bar----------------------------------------------------------------
      - log:
         message: "STEP 3: GO TO 'Departamentos' BY TAPPING ON THE CORRESPONDING ICON IN THE BOTTOM BAR"
         color: ORANGE

      - executeFunction:
          name: functions.global.tapDepartmentsBtn
      
     # STEP 4 Tap a department by tapping it---------------------------------------------------------------------------------------------------------
      - log:
         message: "STEP 4: TAP A DEPARTMENT BY TAPPING IT."
         color: ORANGE

      - if:
          condition: ${GMX_PP_APP_NAME} == '_bodega'
          then:
            - executeFunction:
                name: mx.functions.departments.selectDepartment
                params:
                  - name: departmentName
                    string: mx.data.bodega.prepurchase-1134.departmentName
          else:
            - executeFunction:
                name: mx.functions.departments.selectDepartment
                params:
                  - name: departmentName
                    string: mx.data.walmart.prepurchase-1134.departmentName
      
    # STEP 5 Add the first item that appears to cart by tapping in the "+" icon on the stepper -----------------------     
      - log:
         message: "STEP 5: ADD THE FIRST ITEM THAT APPEARS TO CART BY TAPPING IN THE '+' ICON ON THE STEPPER."
         color: ORANGE

      - executeFunction:
          name: mx.functions.department-l1-l2.scrollDownToSection
          params:
            - name: sectionName
              string: mx.data.prepurchase-1134.sectionName

      - executeFunction:
          name: mx.functions.slp.addToCartFirstProductListed
      
      - executeFunction:
          name: mx.functions.department-l1-l2.getFirstProductName

      #STEP 5.1 ---------------------------------------------------------------------------------------------------------
      - log:
         message: "STEP 5.1: VERIFY THAT THE QUANTITY IN THE STEPPER IS THE EXPECTED ONE."
         color: ORANGE
 
      - executeFunction:
          name: mx.functions.slp.assertItemQuantity
          params:
            - name: expectedQuantity
              string: mx.data.prepurchase-1140.itemQuantity
            - name: productName
              string: ${productName}

        
       # STEP 6 Delete the selected item by tapping in the "-" icon on the stepper ----------------------------------------
      - log:
         message: "STEP 6: DELETE THE SELECTED ITEM BY TAPPING IN THE '-' ICON ON THE STEPPER."
         color: ORANGE

      - executeFunction:
          name: mx.functions.slp.decreaseProductQuantityBy
          params:
            - name: productName
              string: ${productName}
            - name: quantity
              string: mx.data.prepurchase-1140.itemQuantity
 
       # STEPS 6.1 -----------------------------------------------------------------------------------------------------
              
      - log:
         message: "STEP 6.1: VERIFY THAT NO ITEMS APPEAR IN THE STEPPER."
      
      - executeFunction:
          name: mx.functions.slp.assertItemQuantity
          params:
            - name: expectedQuantity
              string: "Agregar"
            - name: productName
              string: ${productName}
 
#      STEP 7 Tap a sub-category to navigate to a content page ----------------------------------------------------------
      - log:
         message: "STEP 7: TAP A SUB-CATEGORY TO NAVIGATE TO A CONTENT PAGE."
         color: ORANGE

      - if:
          condition: ${GMX_PP_APP_NAME} != '_bodega'
          then:
            - executeFunction:
                name: mx.functions.department-l1-l2.selectCategory
                params:
                  - name: categoryName
                    string: mx.data.walmart.prepurchase-1134.categoryName
                  - name: departmentName
                    string: mx.data.walmart.prepurchase-1134.departmentName
          else:
            - executeFunction: 
                name: mx.functions.review-order.scrollUpToSection
                params:
                  - name: sectionName
                    string: mx.data.bodega.prepurchase-1134.sectionName
            - executeFunction:
                name: mx.functions.department-l1-l2.selectCategory
                params:
                  - name: categoryName
                    string: mx.data.bodega.prepurchase-1134.categoryName
                  - name: departmentName
                    string: mx.data.bodega.prepurchase-1134.departmentName
      - executeFunction:
          name: mx.functions.department-l1-l2.assertPageDisplayed # Assert navpills and back button

    # STEP 8 Add the first item that appears to cart by tapping in the "+" icon on the stepper -----------------------     
      - log:
         message: "STEP 8: ADD THE FIRST ITEM THAT APPEARS TO CART BY TAPPING IN THE '+' ICON ON THE STEPPER."
         color: ORANGE
      
      - executeFunction:
          name: mx.functions.slp.addToCartFirstProductListed
      
      - executeFunction:
          name: mx.functions.department-l1-l2.getFirstProductName

      #STEP 8.1 ---------------------------------------------------------------------------------------------------------
      - log:
         message: "STEP 8.1: VERIFY THAT THE QUANTITY IN THE STEPPER IS THE EXPECTED ONE."
         color: ORANGE
 
      - executeFunction:
          name: mx.functions.slp.assertItemQuantity
          params:
            - name: expectedQuantity
              string: mx.data.prepurchase-1140.itemQuantity
            - name: productName
              string: ${productName}
        
#       STEP 9 Delete the selected item by tapping in the "-" icon on the stepper ----------------------------------------
      - log:
         message: "STEP 9: DELETE THE SELECTED ITEM BY TAPPING IN THE '-' ICON ON THE STEPPER."
         color: ORANGE
   
      - executeFunction:
          name: mx.functions.slp.decreaseProductQuantityBy
          params:
            - name: productName
              string: ${productName}
            - name: quantity
              string: mx.data.prepurchase-1140.itemQuantity
 
#       STEPS 9.1 -----------------------------------------------------------------------------------------------------
              
      - log:
         message: "STEP 9.1: VERIFY THAT NO ITEMS APPEAR IN THE STEPPER."
      
      - executeFunction:
          name: mx.functions.slp.assertItemQuantity
          params:
            - name: expectedQuantity
              string: "Agregar"
            - name: productName
              string: ${productName}

#      End main -------------------------------------------------------------------------------------------------------
      - storeIn:
          key: MMS_1134_SUCCESSFUL_EXECUTION
          value: true

#* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#  A F T E R   S C E N A R I O
#* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: After
    after: true
    flow:
      - log: R2_SUBFLOW_AFTER ### [[ 游릭 Flow Identifier: AFTER 游릭 ]] ###

      - if:
          condition: ${MMS_1134_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed."
                color: RED
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: GREEN_BOLD
      - log: "AFTER SCENARIO END"
  