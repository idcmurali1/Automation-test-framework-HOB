#======================================================================================================================
#  AUTHOR: Francisco Ramirez (vn53vq4)
#  CREATED: Jul/29/2024
#  REVISION: ---
#  JIRA TICKET: https://jira.walmart.com/browse/MXMOB-3948
#  FLOW: Navigate to EA Banner, <add more tc context here>
#
#  Copyright 춸 2024 Walmart. All rights reserved.
#  NOTE: We are working only on PROD environments.
#  NOTE: JIRA features are not implemented yet for WCP approach.
#======================================================================================================================
 
general:
  # testCaseId:TODO: This may be implemented further. (wcp-mx-ea-006)
  tags: wcp-qaa-mx-ea-006 #wcp-004, p1-mx-ea-prod, p1-bodega-ea-prod

scenarios:

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   B E F O R E   S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Before
    before: true
    flow:

      - log: R2_SUBFLOW_BEFORE ### [[ 游릭 Flow Identifier: BEFORE 游릭 ]] ###

      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#   M A I N   S C E N A R I O
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:

      - log: R2_SUBFLOW_LAUNCH_AND_LOGIN ### [[ 游릭 Flow Identifier: LAUNCH & LOGIN 游릭 ]] ###
      
      - storeIn:
          key: userEmail
          value: mx.data.ea-flows.tc006.userEmail

      # Onboarding
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore

      # Tap global account button and sign in.
      - executeFunction:
          name: functions.global.tapAccountBtn
      - executeFunction:
          name: functions.accountPage.tapSignInBtn
      
      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: mx.data.ea-flows.tc006..userPassword

      - executeFunction:
          name: functions.accountPage.assertUserLoggedInSuccessfully 

      - log: R2_SUBFLOW_PRE_TRANSACTION ### [[ 游릭 Flow Identifier: PRE-TRANSACTION 游릭 ]] ###
      
      # Tap shop button
      - log:  "Clear Cart if not empty (ensure TC repeatability)..."
      - executeFunction:
          name: functions.global.tapShopBtn
      - executeFunction:
          name: functions.cartPage.clearCart
      

      ### [[ 丘멆잺 Only for PROD Environment 丘멆잺 ]] ###
      - if:
          condition: ${environment} == 'Production'
          then:

            # Add to Cart any Item
            - executeFunction:
                name: functions.searchPage.addToCartUsingItemArrayList-GetProductDetails
                params:
                  - name: productArray
                    string: data.global.1PItems
                  - name: quantity
                    string: '1'
                  - name: searchValidationReq
                    string: 'false'

            # Add to Cart 1P Digital Item to validate Digital Item Error displays
            - executeFunction:
                name: functions.searchPage.addToCartUsingItemArray-assertSpecificErrorDisplayed
                params:
                  - name: productArray
                    string: data.global.1PItems.digital
                  - name: errorCode
                    string: data.global.errorCodes.addToCart.digitalItem

            # After testing Digital Item error popup, reset cart information to continue with the purchase with fresh cart
            - executeFunction:
                name: functions.global.resetCartInformation/GlobalVars

      # # Add to Cart 1P Digital Item
      # - executeFunction:
      #     name: functions.searchPage.addToCartUsingItemArrayList-GetProductDetails # --> RETURNS: ${typeOfErrorDisplayed}
      #     params:
      #       - name: productArray
      #         string: data.global.1PItems.digital
      #       - name: quantity
      #         string: '1'
            # - name: searchValidationReq
            #   string: 'false'

      # Go to cart
      - executeFunction:
          name: functions.global.tapCartIcon

      ### [[ 丘멆잺 Only for PROD Environment 丘멆잺 ]] ###
      - if:
          condition: ${environment} == 'Production'
          then:

            # Cart Product Qty Assertion
            - executeFunction:
                name: functions.cartPage.assertCartQuantity
                params:
                  - name: expectedQuantity
                    string: '1'

            # Cart Totals Assertions
            - executeFunction:
                name: functions.cartPage.assertCartTotals
                params:
                  - name: expectedSubTotal
                    string: ${totalPrice} # <-- ${totalPrice} / GLOBAL VAR
                  - name: assertEstimatedTotal
                    string: 'true'

      # Ensure S2H is selected
      - executeFunction:
          name: functions.cartPage.tapDeliveryOption

      - executeFunction:
          name: functions.cartPage.tapOnAddressLink

      - executeFunction:
          name: functions.cartPage.saveAddressFromList # --> RETURNS: ${returnedSelectedAddressName}, ${returnedSelectedAddress}      

      # Continue to checkout
      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn

#       ### [[ 丘멆잺 Only for PROD Environment 丘멆잺 ]] ###
#       - if:
#           condition: ${environment} == 'Production'
#           then:

#             # Item Products Section validation
#             - executeFunction:
#                 name: functions.checkoutPage.validateItemDetails

#             # Validate Wallet can be opened and multiple payment methods display
#             - executeFunction:
#                 name: functions.checkoutPage.assertWalletPopupDisplayed.all

#       # Select existing Master CC
#       - executeFunction:
#           name: flows.checkoutPage.selectFirstCardListed # --> RETURNS: ${cardLast4Digits}

#       # Assert Master CC selected
#       - executeFunction:
#           name: functions.checkoutPage.paymentMethod.assertCreditOrDebitCardSelected # <-- ${cardLast4Digits}

#       # Select existing invoice
#       - executeFunction:
#           name: functions.checkoutPage.selectInvoice

#       - executeFunction:
#           name: functions.checkoutPage.selectExistingInvoiceFromSheet

#       - storeIn:
#           key: testStatus
#           value: passed

# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
# # #   A F T E R   S C E N A R I O
# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

#   - name: After
#     after: true
#     flow:

#       - log: R2_SUBFLOW_AFTER ### [[ 游릭 Flow Identifier: AFTER 游릭 ]] ###

#       - executeFunction:
#           name: functions.utils.after