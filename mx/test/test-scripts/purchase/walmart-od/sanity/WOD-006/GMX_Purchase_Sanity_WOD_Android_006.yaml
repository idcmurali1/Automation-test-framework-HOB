#======================================================================================================================
#  AUTHOR: Miguel Angel Caballero Juárez (vn55rfi)
#  CREATED: May/06/2024
#  REVISION: ---
#
#  Copyright © 2024 Walmart. All rights reserved.
#======================================================================================================================


general:
  tags: qaa-purchase-sanity-walmart-od-production-android-006, qaa-purchase-sanity-walmart-od-production-android

scenarios:
  - name: Before
    before: true
    flow:
      - log: "BEFORE SCENARIO START: Initial Config..."

      - storeIn:
          key: PURCHASE_TEST_CASE_NAME
          value: "GMX_PURCHASE_SANITY_WOD_ANDROID_006"
      - executeFunction:
          name: mx.functions.utils.relaunchApp
      - storeIn:
          key: WOD_006_SUCCESSFUL_EXECUTION
          value: false
      - log: "BEFORE SCENARIO END"

  #--------------------------------------------------------------------------------------------------------------------

  - name: Main
    platform: android
    flow:
      - log: "TEST START: ${PURCHASE_TEST_CASE_NAME}"

      ## STEP 1: LOGIN IN ONBOARDING SCREEN AND GO TO BANNER OD.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 1: LAUNCH AND LOGIN IN ONBOARDING SCREEN AND SELECT OD BANNER."
            - name: squadNames
              string: CORE | QAA

      - executeFunction:
          name: mx.flows.global.onboarding.navigateOnboardingToHomeAsRegisteredUser
          params:
            - name: userEmail
              string: mx.data.qaa.purchase.sanity.wod-006.userEmail
            - name: userPassword
              string: mx.data.qaa.purchase.sanity.wod-006.userPassword
            - name: zipCode
              string: mx.data.qaa.purchase.sanity.wod-006.zipCode
            - name: banner
              string: 'OD'

      ## STEP 2: SELECT PICKUP DELIVERY IN GIC.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 2: SELECT PICKUP IN GIC."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.flows.od.delivery-method-selector.selectPickupDeliveryWithCurrentStore

      ## STEP 3: SELECT A STORE FOR PICKUP.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 3: SELECT A STORE FOR PICKUP."
            - name: squadNames
              string: PURCHASE
      - storeIn:
          key: compareStoreForPickupDelivery
          value: mx.data.qaa.purchase.sanity.wod-006.storeAddressSelected

      - if:
          condition: ${returnedStoreAddress} == ${compareStoreForPickupDelivery}
          then:
            - executeFunction:
                name: mx.flows.od.delivery-method-selector.selectPickupOdStoreByZipCode
                params:
                  - name: zipCode
                    string: mx.data.qaa.purchase.sanity.wod-006.zipCode1
                  - name: storeName
                    string: mx.data.qaa.purchase.sanity.wod-006.storeName1
          else:
            - executeFunction:
                name: mx.flows.od.delivery-method-selector.selectPickupOdStoreByZipCode
                params:
                  - name: zipCode
                    string: mx.data.qaa.purchase.sanity.wod-006.zipCode2
                  - name: storeName
                    string: mx.data.qaa.purchase.sanity.wod-006.storeName2

      ## STEP 4: SEARCH AND ADD ITEMS TO CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 4: SEARCH AND ADD ITEMS TO CART."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.flows.od.search.performSuccessfulSearch
          params:
            - name: searchTerm
              string: mx.data.qaa.purchase.sanity.wod-006.searchTerm
      - executeFunction:
          name: mx.functions.slp.addProductToCart
          params:
            - name: productName
              string: mx.data.qaa.purchase.sanity.wod-006.productName
      - executeFunction:
          name: mx.functions.slp.assertProductAddedToCart
          params:
            - name: productName
              string: mx.data.qaa.purchase.sanity.wod-006.productName

      ## STEP 5: OPEN CART.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 5: OPEN CART."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.functions.top-menu.tapCartIcon
      - executeFunction:
          name: mx.functions.utils.closeBlackPopupIfDisplayed

      ## STEP 6: ADD ITEM LEVEL COMMENTS.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 6: ADD ITEM LEVEL COMMENTS."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.flows.cart.addItemLevelComments
          params:
            - name: productName
              string: mx.data.qaa.purchase.sanity.wod-006.productName
            - name: itemLevelComment
              string: mx.data.qaa.purchase.sanity.wod-006.itemLevelComment

      ## STEP 7: HIT "RESERVAR UN HORARIO".
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 7: HIT RESERVAR UN HORARIO."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.functions.cart.tapReserveSlot

      ## STEP 8: SELECT PICKUP AND SELECT TIME SLOT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 8: SELECT PICKUP AND SELECT TIME SLOT."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.functions.reserve-slot.tapPickupDeliveryMethod
      - executeFunction:
          name: mx.flows.od.reserve-slot.selectDateAndRandomNormalTimeSlot
          params:
            - name: dateAfterTomorrow
              string: true

      ## STEP 9: CONTINUE CHECKOUT.
      - executeFunction:
          name: mx.squad-reporting.setTestCaseStep
          params:
            - name: step
              string: "STEP 9: CONTINUE CHECKOUT."
            - name: squadNames
              string: PURCHASE

      - executeFunction:
          name: mx.functions.cart.tapContinue

      - storeIn:
          key: WOD_006_SUCCESSFUL_EXECUTION
          value: true

      - log: "TEST END: ${PURCHASE_TEST_CASE_NAME}"

  #--------------------------------------------------------------------------------------------------------------------

  - name: After
    after: true
    flow:
      - log: "AFTER SCENARIO START: After Configs..."

      - if:
          condition: ${WOD_006_SUCCESSFUL_EXECUTION} != true
          then:
            - log:
                message: "Main Failed. No need to reset data."
                color: RED
            - failTest:
                message: "Main Scenario Failed: the After Scenario will propagate the failure to ensure SauceLabs run shows correct execution status."
          else:
            - log:
                message: "Main Scenario ended Successfully, no need to reset data."
                color: GREEN_BOLD
      - log: "AFTER SCENARIO END"