general:
  platform: android
  tags: CAPRE-1455, E2E-Android-English
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:

  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:

      - log: Start Main

      # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      - log:
          message: "Step 1: Onboarding To App using Postal Code K1C1T1."
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.orleansPostalCode

      - log:
          message: "Step 2: Search for Subscribe To Save Item and Validate Badge Displayed on Serach Page"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.subscribe$SaveItemSku
      - executeFunction:
          name: ca.test.functions.searchPage.isSubscribe$SaveBadgeDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - log:
                message: "End Functions: searchPage.isSubscribe$SaveBadgeDisplayed (Displayed)"
                color: CYAN
          else:
            - failTest:
                message: "End Functions: searchPage.isSubscribe$SaveBadgeDisplayed (Not Displayed)"
      
      - log:
          message: "Step 3: Open Product Details Page"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.pdp.srpToPdp
      - executeFunction:
          name: ca.test.functions.productPage.isProductPageDisplayed
          params:
            - name: productName
              string: ca.test.data.subscribe$SaveItemName
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - log:
                message:  "End Function: productPage.isProductPageDisplayed (Displayed)"
                color: CYAN
          else:
            - failTest:
                message:  "End Function: productPage.isProductPageDisplayed (Not Displayed)"
      
      - log:
          message: "Step 4: Click on Setup Subscription button and Validate Sign In Page Displayed"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productPage.purchaseOptions.tapSubscribeAndSave
      - executeFunction:
          name: ca.test.functions.productPage.validateAddToCartChangeToSubscriptionBtn
      - executeFunction:
          name: ca.test.functions.productPage.tapSetUpSubscription

      - log:
          message: "Step 5: Create Account and Validate Setup Subscription Popup Displayed"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.loginPage.createAccountPage.createNewAccount
          params:
            - name: email
              string: ${email}
            - name: password
              string: ${password}
            - name: firstName
              string: ${firstName}
            - name: lastName
              string: ${lastName}
      - executeFunction:
          name: ca.test.functions.isSetUpSubscriptionPopupDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - log:
                message: "End Functions: productPage.isSetUpSubscriptionPopupDisplayed (Displayed)"
                color: CYAN
          else:
            - failTest:
                message: "End Functions: productPage.isSetUpSubscriptionPopupDisplayed (Not Displayed)"
      
      - log:
          message: "Step 6: Book Subscription and Navigate to Cart Page"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.setupSubscriptionPopup.tapDeliveryFrequency
      - executeFunction:
          name: ca.test.functions.setupSubscriptionPopup.tapAddSubscriptionToCartBtn
      - executeFunction:
          name: ca.test.functions.productPage.tapCloseBtn
      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart
      - executeFunction:
          name: ca.test.functions.cartPage.isCartPageDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - log:
                message: "Cart Page Displayed"
                color: CYAN
          else:
            - failTest:
                message: "Cart Page Not Displayed"
      
      - log:
          message: "Step 7: Click on Continue To Checkout Button and Validate Address Page Displayed"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.cartPage.tapContinueToCheckoutBtn
      - executeFunction:
          name: ca.test.functions.addresses.addAddress.isPageDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - log:
                message: "End function: addresses.addAddress.isPageDisplayed (Displayed)"
                color: CYAN
          else:
            - failTest:
                message: "End function: addresses.addAddress.isPageDisplayed (Not Displayed)"
      
      - log:
          message: "Step 8: Add Address Details and Validate Checkout Page Displayed"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.address.addAddress
          params:
            - name: firstName
              string: ${firstName}
            - name:  lastName
              string: ${lastName}
            - name: streetAddress
              string: ${streetAddress}
            - name: cityName
              string: ${cityName}
            - name: stateName
              string: ${stateName}
            - name: postalCode
              string: ${postalCode} 
            - name: phoneNumber
              string: ${phoneNumber}
      - executeFunction:
          name: ca.test.functions.checkoutPage.isPageDisplayed
      - if: 
          condition: ${isReturnedDisplayed} == true
          then:
            - log:
                message: "End Functions: checkoutPage.isPageDisplayed (Displayed)"
                color: CYAN
          else:
            - failTest:
                message: "End Functions: checkoutPage.isPageDisplayed (Not Displayed)"
      
      - log:
          message: "Step 9: Add Gift Card And Wallet Page"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.checkout.tapAddPaymentMethod
      - executeFunction:
          name: ca.test.functions.wallet.addAPaymentMethod.isPageDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - executeFunction:
                name: ca.test.functions.walletPage.addPaymentMethod.tapGiftCardButton
      - executeFunction:
          name: ca.test.functions.walletPage.addPaymentMethod.addGiftCard.isPageDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - executeFunction:
                name: ca.test.functions.walletPage.addDifferentPaymentMethods
                params:
                  - name: cardPage
                    string: Add a Gift Card
                  - name: giftCardNumber
                    string: ca.test.data.walletPage.giftCardNumber
                  - name: giftCardPin
                    string: ca.test.data.walletPage.giftCardPin
            - log:
                message: "Gift Card Added"
                color: CYAN
      - executeFunction:
          name: ca.test.functions.walletPage.giftCard.validateGiftCardSuccessMsg
      - executeFunction:
          name: ca.test.functions.walletPage.tapContinueBtn
      - executeFunction:
          name: ca.test.functions.checkout.tapEditPaymentBtn
      - executeFunction:
          name: ca.test.functions.checkout.wallet.tapAddNewPaymentMethodButton
      - executeFunction:
          name: ca.test.functions.wallet.addAPaymentMethod.tapCreditDebitCardButton
      - executeFunction:
          name: ca.test.functions.wallet.addAPaymentMethod.addCreditOrDebitCard.isPageDisplayed
      - if:
          condition: ${isReturnedDisplayed} = true
          then:
            - executeFunction:
                name: ca.test.functions.utils.addPaymentMethods
                params:
                  - name: cardPage
                    string: Add credit or debit card
                  - name: checkWalmartMasterCard
                    string: true
                  - name: cardNumber
                    string: ${cardNumber}
                  - name: expirationDate
                    string: ${expirationDate}
                  - name: securityCode
                    string: ${securityCode}
                  - name: firstName
                    string: ${firstName}
                  - name: lastName
                    string: ${lastName}
                  - name: phoneNumber
                    string: ${phoneNumber}
                  - name: countryName
                    string: ${countryName}
                  - name: streetAddress
                    string: ${streetAddress}
                  - name: cityName
                    string: ${cityName}
                  - name: stateName
                    string: ${stateName}
                  - name: postalCode
                    string: ${postalCode}
            - log:
                message: "Walmart Credit Card Added"
                color: CYAN
          else:
            - log:
                message: "Walmart Credit Card Not Added"
                color: RED
      - executeFunction:
          name: ca.test.functions.walletPage.tapContinueBtn
      
      - log:
          message: "Step 10: Apply Redeem Rewards"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.checkout.tapRedeemRewardsCheckbox
      - log:
          message: "End Functions: checkout.tapRedeemRewardsCheckbox"
          color: CYAN

      - log:
          message: "Step 11: Mobile Number Field and Promo Code Validation And Place Order"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.checkOut.mobileContact.enterMobileNumber
          params:
            - name: phoneNumber
              string: ca.test.data.addAddressPage.phoneNumber
      - executeFunction:
          name: ca.test.functions.checkOut.promoCodeValidation
      - executeFunction:
          name: ca.test.functions.checkOut.PlacingOrder
      - executeFunction:
          name: ca.test.functions.checkout.orderConfirmationPage.isPageDisplayed
      - if:
          condition: ${isReturnedDisplayed} == true
          then:
            - executeFunction:
                name: ca.test.functions.checkout.orderConfirmationPage.isSubscriptionMsgDisplayedForSubscribe$SaveItem
            - log:
                message: "End Functions: checkout.orderConfirmationPage.isSubscriptionMsgDisplayedForSubscribe$SaveItem (Displayed)"
                color: CYAN
          else:
            - log:
                message: "End Functions: checkout.orderConfirmationPage.isSubscriptionMsgDisplayedForSubscribe$SaveItem (Not Displayed)"
                color: RED

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: CAPRE-1455 
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.utils.afterSteps
      


      
