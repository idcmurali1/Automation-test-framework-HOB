#------------------------------------------------------------------------------
##Validating the price summary of the cart for GM.
# Scenarios covered:
# Add a GM product to cart as reg user
# Go to cart, validate price(subtotal, savings, total items, taxes and estimated total, shipping and handling fees)
#------------------------------------------------------------------------------
general:
  platform: Android
  tags: cart-009, ca-function-run
  testCaseId: cart-009
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Validating the price summary of the cart for GM.
    flow:
      - log:
          message: Validating the price summary of the cart for GM.
          color: GREEN_BOLD

      - log:
          message: Onboarding to app using postal code.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.orleansZipCode

      - log:
          message: Selecting store at HomePage.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.selectStore
          params:
            - name: Zip_Code
              string: ca.test.data.orleansZipCode
            - name: storeName
              string: ca.test.data.orleansStoreName

      - log:
          message: Searching for a GM product with product sku.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart009.gmItemArray
            - name: quantity
              string: ca.test.data.cart09.cart_Qty
            - name: checkNonPromotionBadges
              string: true  

      # - executeFunction:
      #     name: ca.test.functions.productSearch.searchAProduct
      #     params:
      #       - name: product
      #         string: ca.test.data.cart09.GM_1P_item

      # - executeFunction:
      #     name: ca.test.functions.productSearch.extractingFirstProductName

      # - storeIn:
      #     key: gm_1p_item
      #     value: ${productTitle}

      # - log: ${gm_1p_item}

      # - executeFunction:
      #     name: ca.test.functions.productSearch.addToCartCostExtractionSRP
      #     params:
      #       - name: quantity
      #         string: ca.test.data.cart09.GM_1P_item_qty 

      # - storeIn:
      #     key: gm_1p_item_price
      #     value: ${productCost}

      # - log: ${gm_1p_item_price}

      - executeFunction:
          name: ca.test.functions.cart.assertCartQuantity
          params:
            - name: cartQuantity
              string: ca.test.data.cart09.cart_Qty 

      - log:
          message: Asserting cart total.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.assertCartTotal
          params:
            - name: subTotal
              string: ${totalPrice}

      # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
      # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - log:
          message: Navigating to cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      # Asserting cart subTotal
      - executeFunction:
          name: ca.test.functions.cart.subTotalAssertion
          params:
            - name: subTotal
              string: ${totalPrice}

      - log:
          message: Subtotal Validated
          color: YELLOW

      # Asserting Walmart shipping fee
      - executeFunction:
          name: ca.test.functions.cart.walmartShipping
          params:
            - name: walmartShipping
              string: ca.test.data.cart009.walmartShippingValue

      - log:
          message: Walmart Shipping Fee Validated
          color: YELLOW

      - executeFunction:
          name: ca.test.functions.utils.taxCalculation
          params:
            - name: taxableTotal
              string: ${taxableTotal}
            - name: slotPrice
              string: 0
            - name: taxPercentage
              string: ca.test.data.cart009.hst_tax_percentage 

      - log:
          message: Tax Price Validated
          color: YELLOW

      # Asserting hst tax
      - executeFunction:
          name: ca.test.functions.cart.hstTaxAssertion
          params:
            - name: hst_percentage
              string: ca.test.data.cart009.hst_tax_percentage 
            - name: hst_tax_value
              string: ${taxValue}

      - executeFunction:
          name: ca.test.functions.cart.estimatedTotalCalculation
          params:
            - name: tax
              string: ${taxValue}
            - name: subTotal
              string: ${totalPrice}
            - name: slotPrice
              string: 0

      # Asserting cart estimate Sub Total
      - executeFunction:
          name: ca.test.functions.cart.estimatedTotal
          params:
            - name: estimate_total
              string: ${estimate_total}

      - log:
          message: Estimated Total Validated
          color: YELLOW

      - log:
          message: Validated the price summary of the cart for GM
          color: GREEN_BOLD


  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps 