general:
  platform: android
  tags: ca-function-run, cart-003
  testCaseId: cart-003
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: false
    endTestOnFailure: true
    flow:


# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Validating MX item grouping with GO and GM products.
    flow:
      - log:
          message: Onboarding to home page using K1C1T1.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.orleansZipCode

      - log:
          message: Validating MX item grouping with GO and GM products.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.signIn

      - log:
          message: Entering user credentials.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.data.cart003.emailID
            - name: password
              string: ca.test.data.functional.password

      # Validating home page customer greeting
      - executeFunction:
          name: ca.test.functions.home.verifyUserNameHomePage
          params:
            - name: usergreeting
              string: ca.test.data.cart003.userNameValidation

      - executeFunction:
          name: ca.test.functions.home.selectStore
          params:
            - name: Zip_Code
              string: ca.test.data.orleansZipCode
            - name: storeName
              string: ca.test.data.orleansStoreName

      - executeFunction:
          name: ca.test.functions.productSearch.checkItemsInCartAndRemovingThem

      - log: 
          message: Searching for a GO product with product name.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.cart03.GO_Item 

      - log: 
          message: Adding product to cart and extracting product price.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.addToCartCostExtractionSRP
          params:
            - name: productName
              string: ca.test.data.cart03.GO_ItemName 
            - name: quantity
              string: ca.test.data.product_1_qty

      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.cart03.MX_Item 

      - executeFunction:
          name: ca.test.functions.productSearch.addToCartCostExtractionSRP
          params:
            - name: productName
              string: ca.test.data.cart03.MX_ItemName 
            - name: quantity
              string: ca.test.data.product_1_qty

      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.cart03.GM_Item 

      - executeFunction:
          name: ca.test.functions.productSearch.addToCartCostExtractionSRP
          params:
            - name: productName
              string: ca.test.data.cart03.GM_ItemName 
            - name: quantity
              string: ca.test.data.product_1_qty

      - log:
          message: Asserting cart quantity.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.assertCartQuantity
          params:
            - name: cartQuantity
              string: ca.test.data.cart003.cartQtyValidation

      - log:
          message: Asserting cart total.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.assertCartTotal
          params:
            - name: subTotal
              string: ${totalPrice}

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - log: 
          message: Navigating to cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      - log: 
          message: Validating product grouping in cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.cart03.GO_ItemName 
      
      - log: 
          message: Validating product grouping in cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.cart03.MX_ItemName

      - log: 
          message: Validating product grouping in cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.cart03.GM_ItemName
      
      - log: 
          message: Moving GO item to SFL
          color: GREEN_BOLD
      
      - executeFunction:
          name: ca.test.functions.cart.moveToSaveForLater
          params:
            - name: productName
              string: ca.test.data.cart03.GO_ItemName

      - log: 
          message: Validate MX is grouped with GM.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.cart03.MX_ItemName 

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.cart03.GM_ItemName

      - log: 
          message: Moving GM item to SFL
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.moveToSaveForLater
          params:
            - name: productName
              string: ca.test.data.cart03.GM_ItemName

      - log: 
          message: Validate MX is grouped with S2H even after removing GM item from cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.cart03.MX_ItemName 

      - log: 
          message: Moving GO item from SFL to cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.moveSFLProductToCart
          params:
            - name: productName
              string: ca.test.data.cart03.GO_ItemName 

      - log: 
          message: Validate MX is grouped with GO item.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.cart03.GO_ItemName 

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.cart03.MX_ItemName  

      - log: 
          message: Moving GM item from SFL to cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.moveSFLProductToCart
          params:
            - name: productName
              string: ca.test.data.cart03.GM_ItemName 

      - log: 
          message: Validate MX is grouped with GO item under pickup fulfillment.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.cart03.MX_ItemName 

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.cart03.GO_ItemName 

      - log: 
          message: GM item is grouped under shipping fulfillment.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.cart03.GM_ItemName 

      - executeFunction:
          name: ca.test.functions.cart.reserveTimePage

      # Validating reserve time page
      - executeFunction:
          name: ca.test.functions.reserveTimePageValidation

      # Reserving a slot
      - executeFunction:
          name: ca.test.functions.bookASlot.reserveTimePage.reserveStandardSlot

      # Clicking on book a slot button
      - executeFunction:
          name: ca.test.functions.bookASlot.reserveTimePage.bookASlotButton 

      # Proceed to continue to checkout
      - executeFunction:
          name: ca.test.functions.cart.proceedToCheckOut

      # Validating order card in check out page
      - executeFunction:
          name: ca.test.functions.checkout.validatingFulfillmentCard
          params:
            - name: fulfillmentType
              string: ca.test.data.cart003.fulfillmentTypePickup
 
      - executeFunction:
          name: ca.test.functions.checkOut.assertingStoreAddress
          params:
            - name: fulfillmentType
              string: ca.test.data.cart003.fulfillmentTypePickup
            - name: storeName
              string: ca.test.data.cart003.storeNameDisplay   
            - name: storeAddress
              string: ca.test.data.cart003.storeAddressDisplay

      # Validating order card in check out page
      - executeFunction:
          name: ca.test.functions.checkout.validatingFulfillmentCard
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
 
      # Asserting delivery address
      - executeFunction:
          name: ca.test.functions.checkOut.assertingDeliveryAddress
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: addressFirstLine
              string: ca.test.data.cart003.deliveryAddressDisplay

      # status
      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps
