#------------------------------------------------------------------------------
## With a guest user and with a user without addres, when adding GM items a msg in top of cart should be shown with a link to add the address. 'To accurately see how fast you can get your order delivered, add a delivery address'.
## Cart page shows for GM/Freight and MP items shipping information (shipping date range in the top of the group as well as the delivery date per item, and the postal code of the shipping address).
#------------------------------------------------------------------------------
general:
  platform: Android
  tags: cart-012, ca-function-run
  testCaseId: cart-012
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: With a guest user and with a user without addres, when adding GM items a msg in top of cart should be shown with a link to add the address. 'To accurately see how fast you can get your order delivered, add a delivery address', Cart page shows for GM/Freight and MP items shipping information (shipping date range in the top of the group as well as the delivery date per item, and the postal code of the shipping address).
    flow:
      - log:
          message: With a guest user and with a user without addres, when adding GM items a msg in top of cart should be shown with a link to add the address. 'To accurately see how fast you can get your order delivered, add a delivery address', Cart page shows for GM/Freight and MP items shipping information (shipping date range in the top of the group as well as the delivery date per item, and the postal code of the shipping address).
          color: GREEN_BOLD

      - log:
          message: Onboarding to app using postal code.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.orleansZipCode

      - log:
          message: Searching for a GM product with product name.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart012.gmItemArray
            - name: quantity
              string: ca.test.data.cart012.GMItemQty
            - name: checkNonPromotionBadges
              string: true  

    #   - executeFunction:
    #       name: ca.test.functions.productSearch.searchAProduct
    #       params:
    #         - name: product
    #           string: ca.test.data.product_1_sku

    #   - executeFunction:
    #       name: ca.test.functions.productSearch.extractingFirstProductName

    #   - storeIn:
    #       key: gm_1p_item
    #       value: ${productTitle}

    #   - log: ${gm_1p_item}

    #   - executeFunction:
    #       name: ca.test.functions.productSearch.addToCartCostExtractionSRP
    #       params:
    #         - name: quantity
    #           string: ca.test.data.cart012.GMItemQty

    #   - storeIn:
    #       key: gm_1p_item_price
    #       value: ${productCost}

    #   - log: ${gm_1p_item_price}

      # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
      # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - log:
          message: Navigating to cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      - log:
          message: Validating address message in cart
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validateAddressMessage

      - goBack: true

      - log:
          message: Validated a guest user and with a user without addres, when adding GM items a msg in top of cart should be shown with a link to add the address. 'To accurately see how fast you can get your order delivered, add a delivery address'!
          color: GREEN_BOLD_BRIGHT

      - executeFunction:
          name: ca.test.functions.global.navigation.goToShopTab

      - log:
          message: Navigating to Sign In to account from home page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.signIn

      - log:
          message: Putting user credentials.
          color: GREEN_BOLD

      #Signing in to account
      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.data.cart012.emailID
            - name: password
              string: ca.test.data.functional.password

      - log:
          message: Navigating to cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      - log:
          message: Validating shipping information in Cart
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.validateShippingInformation

      - log:
          message: Cart page shows for GM/Freight and MP items shipping information (shipping date range in the top of the group as well as the delivery date per item, and the postal code of the shipping address)!
          color: GREEN_BOLD_BRIGHT

      - storeIn:
          key: testStatus
          value: Passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps