general:
  platform: android
  tags: ca-function-run, cart-004
  testCaseId: cart-004
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: false
    endTestOnFailure: true
    flow:
      - log:
          message: Before scenarios.
          color: GREEN_BOLD

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: As guest user add product to the cart. Login as registered user and validate the products in cart(validate product merged).
    flow:
      - log:
          message: As guest user add product to the cart. Login as registered user and validate the products in cart(validate product merged).
          color: GREEN_BOLD

      - log:
          message: Onboarding to home page using K1C1T1.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.orleansZipCode

      - log:
          message: Selecting store from home page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.selectStore
          params:
            - name: Zip_Code
              string: ca.test.data.orleansZipCode
            - name: storeName
              string: ca.test.data.orleansStoreName

      - log:
          message: Searching for product with product name.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart004.gmItemArray1
            - name: quantity
              string: ca.test.data.product_1_qty
            - name: checkNonPromotionBadges
              string: true  

      # - executeFunction:
      #     name: ca.test.functions.productSearch.searchAProduct
      #     params:
      #       - name: product
      #         string: ca.test.data.product_6_name

      # - log:
      #     message: Extracting product name from SRP.
      #     color: GREEN_BOLD

      # - executeFunction:
      #     name: ca.test.functions.productSearch.extractingFirstProductName

      - storeIn:
          key: gm_item
          value: ${productName}
      
      # - log:
      #     message: ${gm_item}
      #     color: GREEN_BOLD

      # - log:
      #     message: Adding product to cart and extracting the price.
      #     color: GREEN_BOLD

      # - executeFunction:
      #     name: ca.test.functions.productSearch.addToCartCostExtractionSRP
      #     params:
      #       - name: quantity
      #         string: ca.test.data.product_1_qty

      - storeIn:
          key: gm_item_price
          value: ${productCost}
      
      # - log:
      #     message: ${gm_item_price}
      #     color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToShopTab

      - log:
          message: Sign In to account to home page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.signIn

      - log:
          message: Entering user credentials.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.data.cart004.emailID
            - name: password
              string: ca.test.data.functional.password

      - log:
          message: Searching product with product sku.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart004.gmItemArray2
            - name: quantity
              string: ca.test.data.product_1_qty
            - name: checkNonPromotionBadges
              string: true  

      # - executeFunction:
      #     name: ca.test.functions.productSearch.searchAProduct
      #     params:
      #       - name: product
      #         string: ca.test.data.cart04.GM

      # - log:
      #     message: Extracting product name from SRP.
      #     color: GREEN_BOLD

      # - executeFunction:
      #     name: ca.test.functions.productSearch.extractingFirstProductName

      - storeIn:
          key: gm_item0
          value: ${productName}
      
      # - log:
      #     message: ${gm_item0}
      #     color: GREEN_BOLD

      # - log:
      #     message: Adding product to cart and extracting the price.
      #     color: GREEN_BOLD

      # - executeFunction:
      #     name: ca.test.functions.productSearch.addToCartCostExtractionSRP
      #     params:
      #       - name: quantity
      #         string: ca.test.data.product_1_qty

      - storeIn:
          key: gm_item0_price
          value: ${productCost}
      
      # - log:
      #     message: ${gm_item0_price}
      #     color: GREEN_BOLD

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - log:
          message: Navigating to cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      - log:
          message: Validating to ${gm_item} product tile in cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.verifyProductTitleWithPrice
          params:
            - name: productName
              string: ${gm_item}
            - name: quantity
              string: ca.test.data.product_1_qty
            - name: productPrice
              string: ${gm_item_price}

      - log:
          message: Validating to ${gm_item0} product tile in cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.cart.verifyProductTitleWithPrice
          params:
            - name: productName
              string: ${gm_item0}
            - name: quantity
              string: ca.test.data.product_1_qty
            - name: productPrice
              string: ${gm_item0_price}

      - log:
          message: Reopen App.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.openApp

      - log:
          message: Removing item from cart.
          color: GREEN_BOLD

      - executeFunction:
         name: ca.test.functions.productSearch.checkItemsInCartAndRemovingThem

      # status
      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps