#------------------------------------------------------------------------------
# Add multi save skus to cart and verify discounted price in cart
# Verify env fee, eco and CRF fee in cart (all under environment fee)
# Rollback items can be added to the cart and old and new price is being shown in the cart
#------------------------------------------------------------------------------
general:
  platform: Android
  tags: cart-011, ca-function-run
  testCaseId: cart-011
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
  - name: Add multisave sku to cart, validate discounted price and env fee, eco and CRF fee in cart (all under environment fee). Rollback items can be added to the cart and old and new price is being shown in the cart.
    flow:
      - log:
          message: Add multisave sku to cart, validate discounted price and env fee, eco and CRF fee in cart (all under environment fee). Rollback items can be added to the cart and old and new price is being shown in the cart.
          color: GREEN_BOLD

      - log:
          message: Onboarding to app using postal code.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.cart010.onboarding.zipCodeT6N0A9

      - log:
          message: Navigating to Sign In to account from home page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.signIn

      - log:
          message: Putting user credentials.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.data.cart011.emailID
            - name: password
              string: ca.test.data.functional.password

      - log:
          message: Selecting store at home page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.selectStore
          params:
            - name: Zip_Code
              string: ca.test.data.onboarding.zipcodeT0E0A0
            - name: storeName
              string: ca.test.search.storeNameT0E0A0

      - executeFunction:
          name: ca.test.functions.home.changeLocationLink
          params:
            - name: pinCode
              string: ca.test.data.cart011.addressSelectionT0E0A0 

      #Checking for item and removing it
      - executeFunction:
          name: ca.test.functions.productSearch.checkItemsInCartAndRemovingThem
      
      - log:
          message: Scrolling to product with MultiSave Badge
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.cart11.multiSaveItem
      
      - executeFunction:
          name: ca.test.functions.srpPage.multiSaveBannerValidation

      - log:
          message: MultiSave Banner Validation Completed!
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.cart11.rollBackItem

      - log:
          message: Scrolling to product with rollback badge
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.basedOnPromotionalBadge
          params:
            - name: promotionalBadge
              string: ca.test.data.badges.rollback

      - log:
          message: Extracting product name with Rollback badge
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.nameExtractionBasedOnPromotionalBadge
          params:
            - name: promotionalBadge
              string: ca.test.data.badges.rollback

      - executeFunction:
          name: ca.test.functions.productSearch.navigateToOptions
          params:
            - name: productName
              string: $itemName

      - executeFunction:
          name: ca.test.functions.PDPpage.addToCartPriceExtraction
          params:
            - name: quantity
              string: ca.test.data.cart011.rollBackItemqty

      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      - log:
          message: Searching for a GM product with product name.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart011.gmItemArray
            - name: quantity
              string: ca.test.data.cart011.gmItemQty
            - name: checkNonPromotionBadges
              string: true  

      # - executeFunction:
      #     name: ca.test.functions.productSearch.searchAProduct
      #     params:
      #       - name: product
      #         string: ca.test.data.cart11.GM_Item  

      # # Add to cart
      # - executeFunction:
      #     name: ca.test.functions.productSearch.clickAddToCart
      #     params:
      #       - name: productName
      #         string: ca.test.data.cart11.GM_ItemName 

      - log:
          message: Searching for a GM product with product name.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart011.mxItemArray
            - name: quantity
              string: ca.test.data.cart011.mxItemQty
            - name: checkNonPromotionBadges
              string: true  

      # - executeFunction:
      #     name: ca.test.functions.productSearch.searchAProduct
      #     params:
      #       - name: product
      #         string: ca.test.data.cart11.MX_Item 

      # # Add to cart
      # - executeFunction:
      #     name: ca.test.functions.productSearch.clickAddToCart
      #     params:
      #       - name: productName
      #         string: ca.test.data.cart11.MX_ItemName 

      # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
        # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - log:
          message: Navigating to cart.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      #Rollback Price Validation
      - executeFunction:
          name: ca.test.functions.cart.rollbackPriceValidation

      - scroll:
          direction: down
          untilIdentifier: //android.widget.TextView[contains(@text,'Bev. Deposit')]

      # Walmart Eco Handling charges
      - executeFunction:
          name: ca.test.functions.cart.otherFee
          params:
            - name: fee
              string: Eco handling fees
            - name: additionalFee
              string: ca.test.data.cart011.ecoHandlingFees

      # Walmart CRF Fee
      - executeFunction:
          name: ca.test.functions.cart.otherFee
          params:
            - name: fee
              string: CRF
            - name: additionalFee
              string: ca.test.data.cart011.CRFFees

      # Walmart Bev. Deposit Fee
      - executeFunction:
          name: ca.test.functions.cart.otherFee
          params:
            - name: fee
              string: Bev. Deposit
            - name: additionalFee
              string: ca.test.data.cart011.bevDepositFees

      - log:
          message: Added multisave sku to cart, validated discounted price and env fee, eco and CRF fee in cart (all under environment fee). Rollback items can be added to the cart and old and new price is being shown in the cart!
          color: GREEN_BOLD_BRIGHT

      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps