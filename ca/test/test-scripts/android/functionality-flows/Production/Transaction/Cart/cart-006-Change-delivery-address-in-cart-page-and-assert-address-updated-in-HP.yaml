general:
  platform: android
  tags: ca-function-run, cart-006
  testCaseId: cart-006
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: false
    endTestOnFailure: true
    flow:
      - log: 
          message: Before Scenarios.
          color: GREEN_BOLD

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Changing delivery address in cart page and validating same in home page.
    flow:
      - log:
          message: Changing delivery address in cart page and validating same in home page.
          color: GREEN_BOLD

      - log:
          message: Onboarding to app using K1C1T1.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.onboarding.zipcode

      - log:
          message: Navigating to Sign In page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.home.signIn

      - log:
          message: Putting user credentials.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.data.cart006.emailID
            - name: password
              string: ca.test.data.functional.password

      # Remove Item from cart
      - executeFunction:
          name: ca.test.functions.productSearch.checkItemsInCartAndRemovingThem

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.cart006.gmItemArray
            - name: quantity
              string: ca.test.data.cart006.GMProductQty
            - name: checkNonPromotionBadges
              string: true  

      # - executeFunction:
      #     name: ca.test.functions.productSearch.searchAProduct
      #     params:
      #       - name: product
      #         string: ca.test.data.product_6_name

      # - executeFunction:
      #     name: ca.test.functions.productSearch.extractingFirstProductName

      # - storeIn:
      #     key: gm_item
      #     value: ${productName}
      
      # - log: ${gm_item}

      # - executeFunction:
      #     name: ca.test.functions.productSearch.addToCartCostExtractionSRP
      #     params:
      #       - name: quantity
      #         string: ca.test.data.cart006.GMProductQty

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      # Selecting ship instead
      - executeFunction:
          name: ca.test.functions.cart.selectShippingOptions

      # Verifying address and changing if needed
      - executeFunction:
          name: ca.test.functions.cart.fulfillmentAddress
          params:
            - name: addressFirstLine
              string: ca.test.data.cart006.AlbertaAddressAssertion 
      
      - executeFunction:
          name: ca.test.functions.cart.changeAddressButton

      - executeFunction:
          name: ca.test.function.cart.deliveryFromStore.addNewAddress

      - executeFunction:
          name: ca.test.functions.cart.addresses.addNewAddress
          params:
            - name: fName
              string: ca.test.android.data.addAddress.firstName
            - name: lName
              string: ca.test.android.data.addAddress.secondName
            - name: streetAddress
              string: ca.test.android.data.addAddress.addressFirstLine
            - name: city
              string: ca.test.android.data.addAddress.city
            - name: state
              string: ca.test.android.data.addAddress.state
            - name: zipcode
              string: ca.test.android.data.addAddress.zipcode
            - name: mobileNumber
              string: ca.test.android.data.addAddress.mobileNumber

      - executeFunction:
          name: ca.test.functions.cart.assertingDeliveryAddressInCartAtHP
          params:
            - name: addressFirstLine
              string: ca.test.data.cart006.OrleansAddressAssertion

  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: Navigating to my address page using deep link to cancel saved address.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: ca.test.data.ddepLink.accountPage
      - log:
          message: Opening addresses page in my account.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.accountPage.goToAddresses
      - log:
          message: Cancelling address saved from cart page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.accountPage.removeAddress
          params:
            - name: addressLine
              string: ca.test.android.data.deliveryAddress.Ottawa
      - executeFunction:
          name: ca.test.functions.utils.afterSteps