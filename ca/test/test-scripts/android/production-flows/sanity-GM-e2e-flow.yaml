
general:
  platform: android
  tags: sanityGM, prodSanity, PRODSANITY
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #

  - name: Main
    flow:
      - log: Start Main

      # Get TimeStamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      # Navigate onboarding to home
      - executeFunction:
          name: ca.test.functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: ca.test.data.sanityGM.zipCode

      # Verifying home screen
      - executeFunction:
          name: ca.test.functions.home.headerElements.validateHomePage

      # Verifying home screen bottom ribbon
      - executeFunction:
          name: ca.test.functions.home.livingDesign.validateBottomNavigation

      # GO to Account Tab
      - executeFunction:
          name: ca.test.functions.global.navigation.goToAccountFromTabBar

      # Creating Account from Account
      - executeFunction:
          name: ca.test.functions.loginPage.createAccountPage.createNewAccount
          params:
            - name: firstName
              string: ${firstName}
            - name: lastName
              string: ${lastName}
            - name: email
              string: ${email}
            - name: password
              string: ${password}

      # Sign Out from Account Page
      - executeFunction:
          name: ca.test.functions.accountPage.signOut

      - executeFunction:
          name: ca.test.functions.global.navigateToShop 

      # Home to Sign In
      - executeFunction:
          name: ca.test.functions.home.signIn

      # Sign In to account
      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ${email}
            - name: password
              string: ${password}

      # Validating home page customer greeting
      - executeFunction:
          name: ca.test.functions.home.verifyUserNameHomePage
          params:
            - name: usergreeting
              string: ca.test.data.sanityGM.customerName
    
      # Selecting store in home page
      - executeFunction:
          name: ca.test.functions.home.selectStore
          params:
            - name: Zip_Code
              string: ca.test.data.sanityGM.storeZipCode
            - name: storeName
              string: ca.test.data.sanityGM.storeName

      - executeFunction:
          name: ca.test.functions.home.naviagteToLocationLink

      # Add Address 
      - executeFunction:
          name: ca.test.functions.deliveryAddress.addAddress 
          params: 
            - name: firstName
              string: ca.test.data.sanityGM.firstName 
            - name: lastName
              string: ca.test.data.sanityGM.lastName 
            - name: streetAddress
              string: ca.test.data.sanityGM.streetAddress 
            - name: city
              string: ca.test.data.sanityGM.city 
            - name: state
              string: ca.test.data.sanityGM.state 
            - name: zipcode
              string: ca.test.data.sanityGM.zipCode 
            - name: phoneNumber
              string: ca.test.data.sanityGM.phoneNumber 

      # Search for L1 GM category
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.sanityGM.L1_GM 

      - executeFunction:
          name: ca.test.functions.productSearch.extractingFirstProductName
      
      - storeIn:
          key: GM_product_1
          value: ${productName}

      # Validating SRP page
      - executeFunction:
          name: ca.test.functions.productSearch.srpPageValidation
      
      # Add to cart
      - executeFunction:
          name: ca.test.functions.productSearch.addToCartCostExtractionSRP
          params:
            - name: quantity
              string: ca.test.data.sanityGM.L1_GM_QTY


      # Search for L2 GM category
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.sanityGM.L2_GM 

      - executeFunction:
          name: ca.test.functions.productSearch.extractingFirstProductName
      
      - storeIn:
          key: GM_product_2
          value: ${productName}

      # Validating SRP page
      - executeFunction:
          name: ca.test.functions.productSearch.srpPageValidation
      
      # Add to cart
      - executeFunction:
          name: ca.test.functions.productSearch.addToCartCostExtractionSRP
          params:
            - name: quantity
              string: ca.test.data.sanityGM.L2_GM_QTY

        # Search for GM sku
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.sanityGM.GM_sku 

      - executeFunction:
          name: ca.test.functions.productSearch.extractingFirstProductName
      
      - storeIn:
          key: GM_product_sku
          value: ${productName}

      # Validating SRP page
      - executeFunction:
          name: ca.test.functions.productSearch.srpPageValidation
      
      # Add to cart
      - executeFunction:
          name: ca.test.functions.productSearch.addToCartCostExtractionSRP
          params:
            - name: quantity
              string: ca.test.data.sanityGM.GM_sku_QTY

       # Search Multi-Variant Item
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.sanityGM.MV_sku 

      - executeFunction:
          name: ca.test.functions.productSearch.validatingMultiVariantProduct

      - executeFunction:
          name: ca.test.functions.productSearch.navigateToOptions
          params:
            - name: productName
              string: ca.test.data.sanityGM.MV_Name

      # Pdp product header validation
      - executeFunction:
          name: ca.test.functions.pdp.productHeaderContainer

      - executeFunction:
          name: ca.test.functions.pdp.extractingSize
      
      # Add to cart
      - executeFunction:
          name: ca.test.functions.PDPpage.addToCartPriceExtraction
          params:
            - name: quantity
              string: ca.test.data.sanityGM.MultiVariantQty

      # close
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage
  
       # Search for MP Item
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:
            - name: product
              string: ca.test.data.sanityGM.MP_sku 

      - log: 
          message: Extracting first product name from SRP.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.productSearch.extractingFirstProductName

      - log: 
          message: Storing product name to a variable.
          color: GREEN_BOLD

      - storeIn:
          key: minQtyItem
          value: ${productName}

      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productName
              string: ${minQtyItem}

      # Pdp product header validation
      - executeFunction:
          name: ca.test.functions.pdp.productHeaderContainer
          
      - executeFunction:
          name: ca.test.functions.pdp.navigateToMoreSeller

      - executeFunction:
          name: ca.test.functions.pdp.moreSellerOptions.validatingSellerInfo
      
      - executeFunction:
          name: ca.test.functions.pdp.moreSellerOptions.addToCartSpecificSeller
          params:
            - name: productName
              string: ca.test.data.sanityGM.MP_Name
            - name: sellerName
              string: ${filledBy}

      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

     # Navigate To Cart Page
      - executeFunction:
          name: ca.test.functions.global.navigation.goToCart

      - executeFunction:
          name: ca.test.functions.cart.proceedToPickupInstead

      - executeFunction:
          name: ca.test.functions.cart.proceedToShipInstead

      # Asserting cart subTotal
      - executeFunction:
          name: ca.test.functions.cart.subTotalAssertion
          params:
            - name: subTotal
              string: ${totalPrice}

      - log:
          message: Subtotal Validated
          color: YELLOW

      # Asserting Walmart shipping fee
      - executeFunction:
          name: ca.test.functions.cart.walmartShipping
          params:
            - name: walmartShipping
              string: FREE

      - log:
          message: Walmart Shipping Fee Validated
          color: YELLOW

      # Asserting cart taxes
      - executeFunction:
          name: ca.test.functions.cart.totalTaxAssertion
          params:
            - name: total_tax
              string: ${tax_values}

      - log:
          message: Tax Price Validated
          color: YELLOW

      # Asserting hst tax
      - executeFunction:
          name: ca.test.functions.cart.hstTaxAssertion
          params:
            - name: hst_percentage
              string: 13%
            - name: hst_tax_value
              string: ${tax_values}
            - name: hst_percentage
              string: 5%
            - name: hst_tax_value
              string: "$6"

      # Asserting cart estimate Sub Total
      - executeFunction:
          name: ca.test.functions.cart.estimatedTotal
          params:
            - name: estimate_total
              string: ${estimate_total}

      - log:
          message: Estimated Total Validated
          color: YELLOW

      - log:
          message: Validated the price summary of the cart for GM
          color: GREEN_BOLD

      # Proceed to Checkout
      - executeFunction:
          name: ca.test.functions.cart.proceedToCheckOut

      - executeFunction:
          name: ca.test.functions.checkout.navigateToCart

      - executeFunction:
          name: ca.test.functions.global.navigateToShop

      - executeFunction:
          name: ca.test.functions.global.navigation.goToAccountFromTabBar
      
      - executeFunction:
          name: ca.test.functions.accountPage.signOut
      
      - storeIn:
          key: testStatus
          value: Passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps



      