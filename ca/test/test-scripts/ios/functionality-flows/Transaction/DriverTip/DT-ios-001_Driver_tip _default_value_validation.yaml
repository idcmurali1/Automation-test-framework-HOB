#------------------------------------------------------------------------------
#Add GO item to cart with cart value above $35. (Make the add to cart dynamic which validate cart value before adding another product to cart)
#Book a delivery from store slot.
#Go to checkout page.

#Add a .js file which enables below logic
#Input -> .js file is Subtotal
#Logic -> The 4 percentages should be the following logic based on minimums $35, $80, $200, $400: {“35":[6%,10%,14%,18%],"80":[6%,8%,10%,12%],"200":[2%,4%,6%,8%],"400”:[1%,2%,4%,6%]}
#Output-> from .js -> 4 values

#Validate,
#1. "Driver tip (Optional): ${third value from .js file}"
#2. Use this output value from .js file to validate default tip and % value on the checkout page.
#3. Validate the third value is defaulted and selected.
#4. Validate the third value(default selected value) is shown in money box with %.

# Click on i-button, 
#1. Validate "Driver tip details"
#2. "Enter a custom tip amount by selecting Custom tip."
#3. "100% of tips go to the driver. Driver tip only applies for scheduled delivery orders."
#------------------------------------------------------------------------------
general:
  platform: ios
  tags: dt-001-ios #, ca-function-run
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps
    
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #  

  - name: Driver tip default value validation
    flow:

            # Navigate onboarding to home
            - executeFunction:
                name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
            - log:
                message: navigated from onboarding to home
                color: YELLOW 

            # Verifying home screen
            - executeFunction:
                name: ca.test.functions.home.headerElements.validateIosHomePage
            - log:
               message: Home page validated
               color: YELLOW 

            - executeFunction:    
                name: ca.test.functions.home.livingDesign.validateIosBottomNavigation
            - log:
               message: home page bottom validated
               color: YELLOW 

            # Navigate to sign in page
            - executeFunction:
                name: ca.test.functions.home.navigateHomeToSignInIos
            - log:
                message: navigated to signin page
                color: YELLOW 

            # Sign In to the account
            - executeFunction:
                name: ca.test.functions.global.authentication.signInAccountIos
                params:
                  - name: email
                    string: ca.test.data.dt001.emailios
                  - name: password
                    string: ca.test.data.dt001.passwordios
            - executeFunction:
                name: ca.test.functions.home.verifyUserNameInTopleft
            - log:
                message: Singed in as register user
                color: YELLOW 

            # Clear Cart
            - executeFunction:
                name:  ca.test.functions.cart.removeCartItems
            - log:
                message: cart cleared 
                color: YELLOW 

            # Selecting store in home page
            - executeFunction:
               name: ca.test.functions.global.authentication.storeSelect
               params:
                - name: Zip_Code
                  string: ca.test.data.onboarding.zipcodeL5V6N2
                - name: storeName
                  string: ca.test.search.storeNameL5V6N2
            - log:
               message: Updated the store to L5V6N2!
               color: YELLOW 

       # Selecting address at home page
            - executeFunction:
                name: ca.test.functions.home.changeLocationLink
                params:
                  - name: address
                    string: ca.test.data.deliveryPinCode_K1C1T1
            - log:
               message: Updated the address to K1C1T1.
               color: YELLOW 

          #product search:
            - executeFunction:
                name: ca.test.functions.productSearch.searchAProductIos
                params:
                  - name: product
                    string: ca.test.data.product.GO_L1
            - log:
               message: GO product searched
               color: YELLOW 

          #Add product to cart - GO - dynamic product addition                    
            - executeFunction:
                name: ca.test.functions.dynamicProduct
            - log:
               message: Go product added to cart
               color: YELLOW 

          # navigate to cart
            - executeFunction:
                name: ca.test.functions.global.navigation.goToCartIos
            - log:
                message: Navigated to cart
                color: YELLOW

         # Book a delivery slot
            - executeFunction:
                name: ca.test.functions.cart.deliverySlotIos
            - log:
                message: Booked delivery slot
                color: YELLOW
                
          # Proceed to Checkout
            - executeFunction:
                name: ca.test.functions.cart.proceedToCheckOut
            - log:
               message: Go to checkout page
               color: YELLOW 

          #Go to Driver tip box
            - executeFunction:
                name: ca.test.functions.checkout.drivertipOptionValidation
            - log:
               message: navigate to driver tip box
               color: YELLOW 

          #js file validation
            - executeFunction:
                name: ca.test.functions.checkOut.driverTipPercentageCalculation
            - log:
               message: calculated drivertip
               color: YELLOW 

          #Drivertip i button validation 
            - executeFunction:
                name: ca.test.functions.checkout.drivertipiBtnValidation
            - log:
                message: Driver tip i button validated
                color: YELLOW 
#------------------------------------------------------------------------------

            - storeIn:
                key: testStatus
                value: passed
  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: DT-001-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps

          