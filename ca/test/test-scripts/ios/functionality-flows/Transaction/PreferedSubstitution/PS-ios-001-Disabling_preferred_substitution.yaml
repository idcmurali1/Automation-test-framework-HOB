#------------------------------------------------------------------------------
#Add GO items to cart with amount above $35.
#Book a pickup slot and Go to checkout page.
#Validate logo and "Choose substitution preferences" link is present in the UI and click on that link.
#Validate:
# 1. "Substitution preferences" pop up.
# 2. text "Select or edit item substitution preferences, and we'll remember them for next time. You won't be charged extra for any substitution."
# 3. text "Allow substitution for this order"
#Click on i-button
# 1. text "About substitutions"
# 2. Validate the information.
# 3. Go back
# Disable the toggle button
# Validate filters are not showing.
# Validate text "No substitutions will be provided for this order."
# Validate "Edit" link is not disabled for any of the products.
# Click on "Done" button and Validate logo and "Choose substitution preferences" link.
#------------------------------------------------------------------------------
general:
  platform: ios
  tags: ps-001-ios, #ca-function-run
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #  
  - name: Main
    flow:

      - log: Start Main

      # Get TimeStamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      - log:
          message: Disabling Prefered Substitution
          color: CYAN_BOLD_BRIGHT
  - name: Disabling Prefered Substitution
    flow:

            # Navigate onboarding to home
            - executeFunction:
                name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
            - log:
                message: navigated from onboarding to home
                color: YELLOW 

            # Verifying home screen
            - executeFunction:
                name: ca.test.functions.home.headerElements.validateIosHomePage
            - executeFunction:    
                name: ca.test.functions.home.livingDesign.validateIosBottomNavigation
            # Navigate to sign in page
            - executeFunction:
                name: ca.test.functions.home.navigateHomeToSignInIos
            - log:
                message: navigated to signin page
                color: YELLOW 
            # Sign In to the account
            - executeFunction:
                name: ca.test.functions.global.authentication.signInAccountIos
                params:
                  - name: email
                    string: ca.test.data.ps001.emailios
                  - name: password
                    string: ca.test.data.ps001.passwordios
            - executeFunction:
                name: ca.test.functions.home.verifyUserNameInTopleft
            - log:
                message: Singed in
                color: YELLOW 

            # Clear Cart
            - executeFunction:
                name:  ca.test.functions.cart.removeCartItems
            - log:
                message: cart cleared 
                color: YELLOW 

            # Selecting store in home page
            - executeFunction:
               name: ca.test.functions.global.authentication.storeSelect
               params:
                - name: Zip_Code
                  string: ca.test.data.onboarding.zipcodeL5V6N2
                - name: storeName
                  string: ca.test.search.storeNameL5V6N2
            - log:
               message: Updated the store to L5V6N2!
               color: YELLOW 

          # #product search:
            - executeFunction:
                name: ca.functions.searchPage.searchItemArray
                params:
                  - name: items
                    string: ca.test.data.PS-001.goItemArray
                  - name: quantity
                    string: ca.test.data.PS-001.GO_Item_Qty
                  - name: checkNonPromotionBadges
                    string: true

          #   - executeFunction:
          #       name: ca.test.functions.productSearch.searchAProductIos
          #       params:
          #         - name: product
          #           string: ca.test.data.product.GO_L1

          # navigate to cart
            - executeFunction:
                name: ca.test.functions.global.navigation.goToCartIos
            - log:
                message: Navigated to cart
                color: YELLOW

            #Add product to cart - GO - dynamic product addition                    
            - executeFunction:
                name: ca.test.functions.dynamicProduct

          # book  pickup slot
            - executeFunction:
                name: ca.test.functions.cart.pickup.changeStoreClick

            - executeFunction:
                name: ca.test.functions.bookASlot.reserveTimePage.standardSlotSelection

          # Clicking book a slot button
            - executeFunction:
                name: ca.test.functions.bookASlot.reserveTimePage.bookASlotButton 
          
          # Proceed to Checkout
            - executeFunction:
                name: ca.test.functions.cart.proceedToCheckOut

          # open to SubstitutePreferences
            - executeFunction:
                name: ca.test.functions.checkOut.chooseSubstitutePreferences
          
          # validate Pref sub page
            - executeFunction:
                name: ca.test.functions.checkOut.chooseSubstitutePreferences_validation

        # Validate i button of sub pref
            - executeFunction:
                name: ca.test.functions.checkOut.chooseSubstitutePreferences_ibuttonValidation


        # Disable the toggle button and Validate filters are not showing, text "No substitutions will be provided for this order", "Edit" link is not disabled for any of the products.
            - executeFunction:
                name: ca.test.functions.checkOut.chooseSubstitutePreferences_disableValidation
#------------------------------------------------------------------------------

            - storeIn:
                key: testStatus
                value: passed
  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: PS-001-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps