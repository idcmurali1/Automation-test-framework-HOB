general:
  platform: ios
  tags: cart-007-ios, ca-function-run, cart_ios
  testCaseId: cart-007-ios
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #  

  - name: Items can be removed, increase/decrease, making quantity zero in cart page.
    flow:
            - log:
                message: Items can be removed, increase/decrease, making quantity zero in cart page.
                color: CYAN_BOLD_BRIGHT

            # Navigate onboarding to home
            - executeFunction:
                name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
            - log:
                message: navigated from onboarding to home
                color: YELLOW

            # Navigate to sign in page
            - executeFunction:
                name: ca.test.functions.home.navigateHomeToSignInIos
            - log:
                message: navigated to sign in page
                color: YELLOW 
  
            # Sign In to the account
            - executeFunction:
                name: ca.test.functions.global.authentication.signInAccountIos
                params:
                  - name: email
                    string: ca.test.data.cart007.emailios
                  - name: password
                    string: ca.test.data.cart007.passwordios 
            - executeFunction:
                name: ca.test.functions.home.verifyUserNameInTopleft
            - log:
                message: signed in
                color: YELLOW 

            #Clear Cart
            - executeFunction:
                name:  ca.test.functions.cart.removeCartItems
            - log:
                message: cart cleared
                color: YELLOW 

            # Add product to cart - MX
            # Product Search
            - executeFunction:
                name: ca.functions.searchPage.searchItemArray
                params:
                  - name: items
                    string: ca.test.data.cart007.mxItemArray
                  - name: quantity
                    string: ca.test.data.product_1_qty
                  - name: checkNonPromotionBadges
                    string: true  
            - storeIn:
                key: go_item
                value: ${productTitle}
            - log:
               message: added a GO product to cart!
               color: YELLOW 

          #clear search box
            - executeFunction:
                name: ca.test.functions.productSearch.clearSearch
            - log:
               message: search box cleared!
               color: YELLOW 
 
          # Add product to cart - GM - 1P
          # Product Search
            - executeFunction:
                name: ca.functions.searchPage.searchItemArray
                params:
                  - name: items
                    string: ca.test.data.cart007.gmItemArray
                  - name: quantity
                    string: ca.test.data.product_1_qty
                  - name: checkNonPromotionBadges
                    string: true  
            - log:
               message: searched a GM product!
               color: YELLOW 

            - storeIn:
                key: gm_item
                value: ${productTitle}

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

          # navigate to cart
            - executeFunction:
                name: ca.test.functions.global.navigation.goToCartIos
            - log:
                    message: Navigated to cart
                    color: YELLOW 

          # Remove GO item from cart
            - executeFunction:
                name: ca.test.functions.cart.removeItemFromCart
                params:
                  - name: Product_Name
                    string: ${go_item}
                    
            # increase qty - cart
            - executeFunction:
                name: ca.test.functions.cart.qtyIncrement
                params:
                  - name: productName
                    string: ${gm_item}
                  - name: quantity
                    string: ca.test.data.cart007.productQty.increment
            - log:
                message: qty increased for GM item
                color: YELLOW 
                                   
            # decrease qty - cart
            - executeFunction:
                name: ca.test.functions.cart.qtyDecrement
                params:
                  - name: productName
                    string: ${gm_item}
                  - name: quantity
                    string: ca.test.data.cart007.productQty.decrement
            - log:
                    message: qty decreased for GM item
                    color: YELLOW 

            # verify empty cart
            - executeFunction:
                name: ca.test.functions.cart.qtyDecrement
                params:
                  - name: productName
                    string: ${gm_item}
                  - name: quantity
                    string: ca.test.data.cart007.productQty.decrementZero
            - log:
                message: qty decreased to zero
                color: YELLOW           
        
            # Validate the empty cart
            - executeFunction:
                name: ca.test.functions.cart.emptyCartValidation      
            - log:
                message: empty cart validated
                color: YELLOW 

#------------------------------------------------------------------------------
            - storeIn:
                    key: testStatus
                    value: passed
  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: cart-007-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps  