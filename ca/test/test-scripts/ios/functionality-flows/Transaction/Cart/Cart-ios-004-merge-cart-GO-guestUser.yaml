general:
  platform: ios
  tags: cart-004-ios, ca-function-run, cart_ios
  testCaseId: cart-004-ios
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #  
  - name: As guest user add product to the cart. Login as registered user and validate the products in cart(validate product merged).
    flow:
            - log:
                message: As guest user add product to the cart. Login as registered user and validate the products in cart(validate product merged).
                color: CYAN_BOLD_BRIGHT

            # Navigate onboarding to home
            - executeFunction:
                name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
            - log:
                message: Navigated onboarding to home
                color: YELLOW 

            # Selecting store in home page
            - executeFunction:
               name: ca.test.functions.global.authentication.storeSelect
               params:
                - name: Zip_Code
                  string: ca.test.data.orleansZipCode
                - name: storeName
                  string: ca.test.data.orleansStoreName
            - log:
               message: Updated the store to K1C1T1!
               color: YELLOW   

          # Add product to cart - GM
          # Product Search
            - executeFunction:
                name: ca.functions.searchPage.searchItemArray
                params:
                  - name: items
                    string: ca.test.data.cart004.gmItemArray1
                  - name: quantity
                    string: ca.test.data.product_1_qty
                  - name: checkNonPromotionBadges
                    string: true  
            - log:
               message: searched a GM product!
               color: YELLOW 

            - storeIn:
                key: gm_item
                value: ${productTitle}
            - storeIn:
                key: gm_item_price
                value: ${productCost}

          # go To Shop Tab
            - executeFunction:
                name: ca.test.functions.global.navigation.goToShopTab

          # Navigate to sign in page
            - executeFunction:
                name: ca.test.functions.home.navigateHomeToSignInIos
            - log:
                message: Navigated to sign in page
                color: YELLOW 

            # Sign In to the account
            - executeFunction:
                name: ca.test.functions.global.authentication.signInAccountIos
                params:
                  - name: email
                    string: ca.test.data.cart004.emailios
                  - name: password
                    string: ca.test.data.cart004.passwordios
            - executeFunction:
                name: ca.test.functions.home.verifyUserNameInTopleft
            - log:
                message: Singed in as registered user.
                color: YELLOW 

          # Add product to cart - GM2
          # Product Search
            - executeFunction:
                name: ca.functions.searchPage.searchItemArray
                params:
                  - name: items
                    string: ca.test.data.cart004.gmItemArray2
                  - name: quantity
                    string: ca.test.data.product_1_qty
                  - name: checkNonPromotionBadges
                    string: true  
            - log:
               message: searched a GM product!
               color: YELLOW 
            - storeIn:
                key: gm_item_2
                value: ${productTitle}

            # Product SRP to PDP page
            - executeFunction:
                name: ca.test.functions.pdp.srpToPdp
                params:
                  - name: productName
                    string: ${gm_item_2}
            - log:
               message: Navigate to PDP of GM product!
               color: YELLOW 

          # PDP page header container validation
            - executeFunction:
                name: ca.test.functions.pdp.productHeaderContainer
            - log:
               message: PDP details validated for GM product!
               color: YELLOW 

            #closing PDP page
            - executeFunction:
                name: ca.test.functions.PDPpage.closePDPpage
            - log:
               message: Closed PDP of GM product!
               color: YELLOW 

            - storeIn:
                key: gm_item_price_2
                value: ${productCost}

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

          # navigate to cart
            - executeFunction:
                name: ca.test.functions.global.navigation.goToCartIos
            - log:
                message: Navigated to cart
                color: YELLOW

          # Cart product details validation
            - executeFunction:
                name: ca.test.functions.cart.ProductDetailsValidation
                params:
                  - name: Product_Name
                    string: ${gm_item}
                  - name: productPrice
                    string: ${gm_item_price}
                  - name: productQty
                    string: ca.test.data.cart004.product_Quantity
            - log:
               message: GM product validated in cart!
               color: YELLOW 
               
          # Cart product details validation
            - executeFunction:
                name: ca.test.functions.cart.ProductDetailsValidation
                params:
                  - name: Product_Name
                    string: ${gm_item_2}
                  - name: productPrice
                    string: ${gm_item_price_2}
                  - name: productQty
                    string: ca.test.data.cart004.product_Quantity
            - log:
               message: GM product validated in cart!
               color: YELLOW 

            #Terminate and relaunch the app
            - executeFunction:
                name: ca.test.functions.utils.terminateApp
            - executeFunction:
                name: ca.test.functions.utils.relaunchApp 
            
            # Clear Cart
            - executeFunction:
                name:  ca.test.functions.cart.removeCartItems
            - log:
                message: cart cleared!
                color: YELLOW

#------------------------------------------------------------------------------
            - storeIn:
                key: testStatus
                value: passed
  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: cart-004-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps  