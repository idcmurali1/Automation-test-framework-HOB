general:
  platform: ios
  tags: cart-003-ios, ca-function-run, cart_ios
  testCaseId: cart-003-ios
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #

  - name: Validating MX item grouping with GO and GM products.
    flow:
            - log:
                message: Validating MX item grouping with GO and GM products.
                color: CYAN_BOLD_BRIGHT

            # Navigate onboarding to home
            - executeFunction:
                name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
            - log:
                message: Navigated onboarding to home
                color: YELLOW 

            # Navigate to sign in page
            - executeFunction:
                name: ca.test.functions.home.navigateHomeToSignInIos
            - log:
                message: Navigated to sign in page
                color: YELLOW

            # Sign In to the account
            - executeFunction:
                name: ca.test.functions.global.authentication.signInAccountIos
                params:
                  - name: email
                    string: ca.test.data.cart003.emailios
                  - name: password
                    string: ca.test.data.cart003.passwordios
            - executeFunction:
                name: ca.test.functions.home.verifyUserNameInTopleft
            - log:
               message: Signed In as registered user!
               color: YELLOW

            # Selecting store in home page
            - executeFunction:
               name: ca.test.functions.global.authentication.storeSelect
               params:
                - name: Zip_Code
                  string: ca.test.data.orleansZipCode
                - name: storeName
                  string: ca.test.data.orleansStoreName

            - log:
                message: Updated the store to L5V6N2!
                color: YELLOW

            # Clear Cart
            - executeFunction:
                name:  ca.test.functions.cart.removeCartItems
            - log:
                message: cart cleared!
                color: YELLOW

          # Add product to cart - GO
          # Product Search
            - executeFunction:
                name: ca.test.functions.productSearch.searchAProductIos
                params:           
                  - name: product
                    string: ca.test.data.cart03.GO_Item    
            - log:
               message: searched a GO product!
               color: YELLOW 

            - executeFunction:
                name: ca.test.functions.productSearch.extractingFirstProductName
            - storeIn:
                key: go_item
                value: ${productTitle}
            - executeFunction:
                name: ca.test.functions.productSearch.addToCartCostExtractionSRP
            - storeIn:
                key: go_item_price
                value: ${productCost}
            - executeFunction:
                name: ca.test.function.cart.calculateDynamicSubtotal
                params:
                  - name: quantity
                    string: ca.test.data.product_1_qty
            - log:
                message: ${totalPrice}
                color: YELLOW
            - log: 
                message: Extracting and Storing product name and cost in variables.
                color: YELLOW

          # Add to cart
            - executeFunction:
                name: ca.test.functions.srp.addToCartIos
            - log:
               message: added a GO product to cart!
               color: YELLOW 

          # Add product to cart - MX
          # Product Search
            - executeFunction:
                name: ca.test.functions.productSearch.searchAProductIos
                params:           
                  - name: product
                    string: ca.test.data.cart03.MX_Item     
            - log:
               message: searched a MX product!
               color: YELLOW 

            - executeFunction:
                name: ca.test.functions.productSearch.extractingFirstProductName
            - storeIn:
                key: mx_item
                value: ${productTitle}
            - executeFunction:
                name: ca.test.functions.productSearch.addToCartCostExtractionSRP
            - storeIn:
                key: mx_item_price
                value: ${productCost}
            - executeFunction:
                name: ca.test.function.cart.calculateDynamicSubtotal
                params:
                  - name: quantity
                    string: ca.test.data.product_1_qty
            - log:
                message: ${totalPrice}
                color: YELLOW
            - log: 
                message: Extracting and Storing product name and cost in variables.
                color: YELLOW

          # Add to cart
            - executeFunction:
                name: ca.test.functions.srp.addToCartIos 
            - log:
               message: added a MX product to cart!
               color: YELLOW 

          # Add product to cart - GM - 1P
          # Product Search
            - executeFunction:
                name: ca.test.functions.productSearch.searchAProductIos
                params:           
                - name: product
                  string: ca.test.data.cart03.GM_Item 
            - log:
               message: searched a GM product!
               color: YELLOW 

            - executeFunction:
                name: ca.test.functions.productSearch.extractingFirstProductName
            - storeIn:
                key: 1p_item
                value: ${productTitle}
            - executeFunction:
                name: ca.test.functions.productSearch.addToCartCostExtractionSRP
            - storeIn:
                key: 1p_item_price
                value: ${productCost}
            - executeFunction:
                name: ca.test.function.cart.calculateDynamicSubtotal
                params:
                  - name: quantity
                    string: ca.test.data.product_1_qty
            - log:
                message: ${totalPrice}
                color: YELLOW
            - log: 
                message: Extracting and Storing product name and cost in variables.
                color: YELLOW

          # Add to cart
            - executeFunction:
                name: ca.test.functions.srp.addToCartIos
            - log:
               message: added a GM-1P product to cart!
               color: YELLOW 

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

          # navigate to cart
            - executeFunction:
                name: ca.test.functions.global.navigation.goToCartIos
            - log:
                message: Navigated to cart
                color: YELLOW
                
          # Cart product details validation - GO
            - executeFunction:
                name: ca.test.functions.cart.verifyProductTitle
                params:
                  - name: productName
                    string: ${go_item}
            - log:
                message: GO product details validated
                color: YELLOW  
                
          # Cart product details validation - MX
            - executeFunction:
                name: ca.test.functions.cart.verifyProductTitle
                params:
                  - name: productName
                    string: ${mx_item}
            - log:
                message: MX product details validated
                color: YELLOW  
                
          # Cart product details validation - GM
            - executeFunction:
                name: ca.test.functions.cart.verifyProductTitle
                params:
                - name: productName
                  string: ${1p_item}
            - log:
                message: GM product details validated
                color: YELLOW  

          # Validate the groupging - GO
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeSC
                  - name: productName
                    string: ${go_item}
            - log: 
                message: GO is under Scheluded cart.
                color: GREEN_BOLD

          # Validate the groupging - MX
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeSC 
                  - name: productName
                    string: ${mx_item}
            - log: 
                message: MX is under Scheluded cart.
                color: GREEN_BOLD

          # Validate the groupging - GM
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping
                  - name: productName
                    string: ${1p_item}
            - log: 
                message: GM is under unScheluded cart.
                color: GREEN_BOLD

          # save for later - GO
            - executeFunction:
                name: ca.test.functions.cart.saveForLater
                params:
                  - name: productName
                    string: ${go_item}
            - log:
                message: GO to save for later!
                color: YELLOW  
                
          # Validate the grouping - MX
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping
                  - name: productName
                    string: ${mx_item}
            - log: 
                message: MX moved unscheduled cart.
                color: GREEN_BOLD

          # Validate the grouping - GM
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping
                  - name: productName
                    string: ${1p_item}
            - log: 
                message: GM is under unScheluded cart.
                color: GREEN_BOLD

            # Validate the Product under sfl
            - executeFunction:
                name: ca.test.functions.cart.validateInSFL
                params:
                  - name: Product_Name
                    string: ${go_item}
                  - name: catagory
                    string: "GO"
            - log:
                message: GO present under save for later!
                color: YELLOW  

          # save for later - GM
            - executeFunction:
                name: ca.test.functions.cart.saveForLater
                params:
                  - name: productName
                    string: ${1p_item}
            - log:
                message: GM to save for later!
                color: YELLOW  

          # Validate the grouping - MX
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping
                  - name: productName
                    string: ${mx_item}
            - log: 
                message: MX moved unschedule cart.
                color: GREEN_BOLD

            # Validate the Product under sfl
            - executeFunction:
                name: ca.test.functions.cart.validateInSFL
                params:
                  - name: Product_Name
                    string: ${1p_item}
                  - name: catagory
                    string: "GM"
            - log:
                message: GM present under save for later!
                color: YELLOW  

          # Move GO item back to cart and remove GO from SFL
            - executeFunction:
                name: ca.test.functions.cart.moveToCartFromSFL
                params:
                  - name: productName
                    string: ${go_item}
            - log:
                message: Moved GO to cart from SFL
                color: YELLOW  

          # Validate the groupging - GO
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeSC
                  - name: productName
                    string: ${go_item}
            - log: 
                message: GO is under Schelude cart.
                color: GREEN_BOLD

          # Validate the groupging - MX
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeSC
                  - name: productName
                    string: ${mx_item}
            - log: 
                message: MX is under Schelude cart.
                color: GREEN_BOLD

          # Move GM item back to cart and remove GM from SFL
            - executeFunction:
                name: ca.test.functions.cart.moveToCartFromSFL
                params:
                  - name: productName
                    string: ${1p_item}
            - log:
                message: Moved GM to cart from SFL
                color: YELLOW  

          # Validate the groupging - GO
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeSC
                  - name: productName
                    string:  ${go_item}
            - log: 
                message: GO is under Schelude cart.
                color: GREEN_BOLD

          # Validate the groupging - MX
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeSC
                  - name: productName
                    string: ${mx_item}
            - log: 
                message: MX is under Schelude cart.
                color: GREEN_BOLD

          # Validate the groupging - GM
            - executeFunction:
                name: ca.test.functions.cart.validatingProductGrouping
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping
                  - name: productName
                    string: ${1p_item}
            - log: 
                message: GM is under unSchelude cart.
                color: GREEN_BOLD

            # Book a delivery slot
            - executeFunction:
                name: ca.test.functions.cart.deliverySlotIos 
            - log:
                message: Booked a delivery slot!
                color: YELLOW

            # Proceed to Checkout
            - executeFunction:
                name: ca.test.functions.cart.checkout.proceedToCheckOutIos 

            #verify fulfillmentType in checkout
            - executeFunction:
                name: ca.test.functions.checkOut.validateCheckOutOrderCard
                params:
                  - name: fulfillmentType
                    string: ca.test.data.cart008.fullfillmentType
            - log:
                message: fulfillmentType verified in checkout!
                color: GREEN_BOLD_BRIGHT

            # verify store details in checkout
            - executeFunction:
                name: ca.test.functions.checkOut.assertingStoreAddress
                params:
                  - name: storeName
                    string: ca.test.data.cart003.storeNameDisplay   
                  - name: storeAddress
                    string: ca.test.data.cart003.storeAddressDisplay     

            # Validating order card in check out page
            - executeFunction:
                name: ca.test.functions.checkOut.validateCheckOutOrderCard
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping

            #verify deliveryAddress in checkout
            - executeFunction:
                name: ca.test.functions.checkOut.assertingDeliveryAddress
                params:
                  - name: fulfillmentType
                    string: ca.test.data.fulfillmentTypeShipping
                  - name: addressFirstLine
                    string: ca.test.data.cart003.deliveryAddressDisplay
            - log:
                message: delivery addrress verified in checkout!
                color: GREEN_BOLD_BRIGHT

#------------------------------------------------------------------------------
            - storeIn:
                key: testStatus
                value: passed
  - name: After
    after: true
    flow:
      - log:
          message: cart-003-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps  