general:
  platform: ios
  tags: pdp-001, ca-function-run
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: false
    endTestOnFailure: false
    flow:
      - log: Execute before scenarios.

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
  - name: Validating badges in PDP page.
    flow:
      - log:
          message: Validating badges in PDP page.
          color: GREEN_BOLD

      # Onboarding to app and Sign In as registered user 
      - log:
          message: Onboarding to app and Sign In as registered user
          color: CYAN_BOLD_BRIGHT
  
      # Navigate onboarding to home
      - executeFunction:
          name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome

      # Verifying home screen
      - executeFunction:
          name: ca.test.functions.home.headerElements.validateIosHomePage
      - executeFunction:    
          name: ca.test.functions.home.livingDesign.validateIosBottomNavigation

      # Navigate to sign in page
      - executeFunction:
          name: ca.test.functions.home.navigateHomeToSignInIos
   
      # Login us registered user
      - executeFunction:
          name: ca.test.functions.global.authentication.signInAccountIos
          params:
            - name: email
              string: ca.test.data.flow007_fn.emailios
            - name: password
              string: ca.test.data.flow007_fn.passwordios
      - executeFunction:
          name: ca.test.functions.home.verifyUserNameInTopleft  
              
      # Clear Cart
      - executeFunction:
          name:  ca.test.functions.cart.removeCartItems 
      - log:
          message: Onboarding to app and Signed In as registered user, cart cleared!
          color: GREEN_BOLD_BRIGHT
#------------------------------------------------------------------------------------------------------------------#

      # 1. Clearance: Searching a product and validation Promotional badge in SRP
      - log: 
          message: Searching for a GM product
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.function.home.walmartFavourites
          params:
            - name: walmartFavourites
              string: ca.test.data.badges.clearance
            - name: productCategory
              string: ca.test.data.badges.productCategory
            - name: titleClearance
              string: ca.test.data.badges.clearancePicks
      - log: 
          message: Scrolling to product with clearance badge
          color: GREEN_BOLD

      # Verifying Promotional badge
      - executeFunction:
          name: ca.test.functions.productSearch.basedOnPromotionalBadge
          params:
            - name: promotionalBadge
              string: ca.test.data.badges.clearance
      - log: 
          message: Extracting product name with clearance badge
          color: GREEN_BOLD

      # Name Extraction Based On Promotional Badge
      - executeFunction:
          name: ca.test.functions.productSearch.nameExtractionBasedOnPromotionalBadge
          params:
            - name: promotionalBadge
              string: ca.test.data.badges.clearance
      - log: 
          message: Storing the product name in variable
          color: GREEN_BOLD
      - storeIn:
          key: ClearanceProduct
          value: ${itemName}

      # Navigate SRP to PDP
      - log: 
          message: Navigating to PDP page of the product.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productName
              string: ${ClearanceProduct}

      # Validating promotional badge in PDP page
      - log: 
          message: Validating promotional badge in PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.pdp.validatingPromotionalDetails
          params:
            - name: productName
              string: ${ClearanceProduct}
            - name: promotionalBadge
              string: ca.test.data.badges.PDP.clearance # ca.test.data.badges.clearance
              # workaround Only in PDP clearance label have small "c"
      
      # Closing PDP
      - log: 
          message: Closing PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.pdp001.gmRollbackBadgeArray
            - name: quantity
              string: ca.test.data.pdp001.gmRollbackBadgeQty
            - name: promotionalBadge
              string: ca.test.data.badges.rollback
            - name: checkPromotionBadges
              string: true          
      - log: 
          message: Scrolling to product with rollback badge
          color: GREEN_BOLD
 
      #  Navigating to PDP page of the product
      - log: 
          message: Navigating to PDP page of the product.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productTitle
              string: ${productTitle}

      # Validating promotional badge in PDP page
      - log: 
          message: Validating promotional badge in PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.pdp.validatingPromotionalDetails
          params:
            - name: productTitle
              string: ${productTitle}
            - name: promotionalBadge
              string: ca.test.data.badges.rollback

      # Closing PDP
      - log: 
          message: Closing PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage 

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.pdp001.gmReducedPriceBadgeArray
            - name: quantity
              string: ca.test.data.pdp001.gmReducedPriceBadgeQty
            - name: promotionalBadge
              string: ca.test.data.badges.reducedPrice 
            - name: checkPromotionBadges
              string: true       

      # Navigating to PDP page of the product
      - log: 
          message: Navigating to PDP page of the product.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productTitle
              string: ${productTitle}

      # Validating promotional badge in PDP page
      - log: 
          message: Validating promotional badge in PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.pdp.validatingPromotionalDetails
          params:
            - name: productTitle
              string: ${productTitle}
            - name: promotionalBadge
              string: ca.test.data.badges.reducedPrice
      
      # Closing PDP
      - log: 
          message: Closing PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      #clear search box
      - executeFunction:
          name: ca.test.functions.productSearch.clearSearch
      - log: 
          message: Searching for a GO product
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.pdp001.goRollbackBadgeArray
            - name: quantity
              string: ca.test.data.pdp001.goRollbackBadgeQty
            - name: promotionalBadge
              string: ca.test.data.badges.rollback
            - name: checkPromotionBadges
              string: true             

      # Navigating to PDP page of the product
      - log: 
          message: Navigating to PDP page of the product.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productTitle
              string: ${productTitle}

      # Validating promotional badge in PDP page
      - log: 
          message: Validating promotional badge in PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.pdp.validatingPromotionalDetails
          params:
            - name: productTitle
              string: ${productTitle}
            - name: promotionalBadge
              string: ca.test.data.badges.rollback
      
      # Closing PDP page
      - log: 
          message: Closing PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      #clear search box
      - executeFunction:
          name: ca.test.functions.productSearch.clearSearch    
      - log: 
          message: Searching for a GO product
          color: GREEN_BOLD

      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.pdp001.goMultisaveBadgeArray
            - name: quantity
              string: ca.test.data.pdp001.goMultisaveBadgeQty
            - name: promotionalBadge
              string: ca.test.data.badges.multiSave
            - name: checkPromotionBadges
              string: true         

      # Navigating to PDP page of the product
      - log: 
          message: Navigating to PDP page of the product.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productTitle
              string: ${productTitle}

      # Validating promotional badge in PDP page
      - log: 
          message: Validating promotional badge in PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.pdp.validatingMultiSaveBadge
          params:
            - name: badgeText
              string: ca.test.data.badges.multiSave

      # Closing PDP page
      - log: 
          message: Closing PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage
          
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - log:
          message: pdp-001-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps