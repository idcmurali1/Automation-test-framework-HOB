general:
  platform: ios
  tags: pdp-003, ca-function-run
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: false
    endTestOnFailure: false
    flow:
      - log: Execute before steps 
       # Navigate onboarding to home
      - log:
          message: Onboarding to app 
      - executeFunction:
          name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
    
    # Navigate to sign in page
      - executeFunction:
          name: ca.test.functions.home.navigateHomeToSignInIos
       
      # Login us registered user
      - executeFunction:
          name: ca.test.functions.global.authentication.signInAccountIos
          params:
            - name: email
              string: ca.test.data.flow004_fn.emailios
            - name: password
              string: ca.test.data.flow004_fn.passwordios  

      - executeFunction:
          name: ca.test.functions.accountPage.navigateToShop        

      - log:
           message: Signed In as registered user!
           color: YELLOW 

      # Clear Cart
      - executeFunction:
          name:  ca.test.functions.cart.removeCartItems      

      # Select store from home page
      - log: 
          message: Selecting store at HomePage.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.global.authentication.storeSelect
          params:
            - name: Zip_Code
              string: ca.test.data.spruceGroveZipCode
            - name: storeName
              string: ca.test.data.spruceGroveStoreName
      - log:
          message: Navigating to my address page using deep link to cancel saved address.
          color: GREEN_BOLD

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
  - name: Validate the shipping address and store in PDP. Adding address and updating store in PDP and asserting same in PDP and HP.
    flow:
      - log:
          message: Validate the shipping address and store in PDP. Adding address and updating store in PDP and asserting same in PDP and HP.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.functions.searchPage.searchItemArray
          params:
            - name: items
              string: ca.test.data.pdp003.gmItemArray
            - name: quantity
              string: ca.test.data.pdp003.gmItemQty
            - name: checkNonPromotionBadges
              string: true    

      - storeIn:
          key: gm_item
          value: ${productTitle}
 
      # Navigating to PDP page 
      - log: 
          message: Navigating to PDP page of the product.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.prod.srpToPdpPage
          params:
            - name: productName
              string: ${productTitle}
    
      # Pdp product header validation
      - log:
          message: Validating product header tile in PDP.
          color: GREEN_BOLD                             
      - executeFunction:
          name: ca.test.functions.pdp.productHeaderContainer 
      
      # Pdp product header fulfillment details validation
      - executeFunction:
          name: ca.test.functions.pdp.primaryBuyBoxContainerMerchandise
          params:
            - name: storeName
              string: ca.test.data.pdp03.store
            - name: addressFirstLine
              string: ca.test.data.pdp003.address
            - name: deliveryFromStore
              string: ca.test.data.pdp003.address
            - name: productType
              string: ca.test.data.productType.GM

      # adding address from PDP
      - log:
          message: Clicking add address button.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.pdp.changeAddressButton
      - log:
          message: Clicking add new address button in address selection page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.function.cart.deliveryFromStore.addNewAddress 
                           
      # Address can be added from PDP and validate in PDP
      - log:
          message: Adding address from PDP and validate in PDP
          color: CYAN_BOLD_BRIGHT
      - executeFunction:
          name: ca.test.functions.deliveryAddress.addAddressHomeIos
          params:
          - name: firstName
            string: ca.test.data.deliveryaddress.ios.firstname
          - name: lastName
            string: ca.test.data.deliveryaddress.ios.lastname
          - name: streetAddress
            string: ca.test.data.seeTimes002.streetAddress
          - name: city
            string: ca.test.data.seeTimes002.city
          - name: state
            string: ca.test.data.seeTimes002.state
          - name: zipcode
            string: ca.test.data.seeTimes002.zipcode
          - name: phoneNumber
            string: ca.test.data.deliveryaddress.ios.phonenumber
          - name: page
            string: Home  
      - log:
          message: Validating store and delivery address in PDP page.
          color: GREEN_BOLD

      # Pdp product header fulfillment details validation
      - executeFunction:
          name: ca.test.functions.pdp.primaryBuyBoxContainerMerchandise
          params:
            - name: storeName
              string: ca.test.data.orleansStoreNameAssertion
            - name: addressFirstLine
              string: ca.test.data.pdp03.addressAssertion
            - name: deliveryFromStore
              string: ca.test.data.pdp03.addressAssertion
            - name: productType
              string: ca.test.data.productType.GM
      - log:
          message: Clicking change store button in PDP.
          color: GREEN_BOLD

      # change store from PDP
      - executeFunction:
          name: ca.test.functions.pdp.changeStoreButton
      - log:
          message: Searching and selecting store.
          color: GREEN_BOLD     

      - executeFunction:
          name: ca.test.functions.pdp.changeStore.selectStore
          params:
            - name: Zip_Code
              string: ca.test.data.orleansZipCode
            - name: storeName
              string: ca.test.data.orleansStoreName

      # Validating store and delivery address in PDP page
      - log:
          message: Validating store and delivery address in PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.pdp.primaryBuyBoxContainerMerchandise
          params:
            - name: storeName
              string: ca.test.data.orleansStoreNameAssertion
            - name: addressFirstLine
              string: ca.test.data.pdp03.addressAssertion
            - name: deliveryFromStore
              string: ca.test.data.pdp03.addressAssertion
            - name: productType
              string: ca.test.data.productType.GM

      # Closing PDP
      - log: 
          message: Closing PDP page.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      # Navigating back to home
      - log: 
          message: Navigating back to home.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.navigateBackToHome

      # Asserting store in HP
      - log: 
          message: Asserting store in HP.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.HP.validateStoreinHP
          params:
            - name: storeName
              string: ca.test.data.orleansStoreNameAssertion

      # Asserting delivery address in HP
      - log:
          message: Asserting delivery address in HP.
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.HP.validateAddressinHP
          params:
            - name: address_HP
              string: ca.test.data.seeTimes002.address

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - storeIn:
          key: testStatus
          value: passed
  
  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: pdp-003-ios
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps         
      - log:
          message: Navigating to my address page using deep link to cancel saved address.
          color: GREEN_BOLD
          
      # - executeFunction: - 
      #     name: ca.test.functions.global.navigation.goToDeepLink - Deeplink issue - CAPREPURCH-2155
      #     params:
      #       - name: deepLinkUrl
      #         string: ca.test.data.accountPage.deepLink

      - executeFunction:
          name: ca.test.functions.home.navigateHomeToAccountPage

      - log:
          message: Opening addresses page in my account.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.accountPage.goToAddresses

      - log:
          message: Cancelling address saved from cart page.
          color: GREEN_BOLD

      - executeFunction:
          name: ca.test.functions.accountPage.removeAddress
          params:
            - name: addressFirstLine
              string: ca.test.android.data.deliveryAddress.Ottawa    