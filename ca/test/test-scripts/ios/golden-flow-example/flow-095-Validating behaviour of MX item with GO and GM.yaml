general:
  platform: ios
  tags: flow-095, E2E-iOS-English
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #

  - name: Main
    flow:
      - log: Start Main

      # Get TimeStamp
      - getTimestamp:
          asDate: true
          storeIn: timestamp

      # Navigate onboarding to home
      - executeFunction:
          name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
          params:
            - name: ZIP_CODE
              string: ca.test.data.flow095.zipCode

      # Navigate to sign in page
      - executeFunction:
          name: ca.test.functions.home.signIn

      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.data.flow095.emailIos
            - name: password
              string: ca.test.data.flow095.passwordIos

      # Selecting store in home page
      - executeFunction:
          name: ca.test.functions.home.storeSelect
          params:
            - name: Zip_Code
              string: ca.test.data.onboarding.zipcodeON
            - name: storeName
              string: ca.test.search.storeName

      # Add three products to cart from GM, GO and MX using transact-ability API.
      - executeFunction:
          name: ca.test.functions.astro.addToCart
          params:
            - name: payLoad
              string: ca.test.data.flow095.addToCartPayLoad

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *          

      # Navigate to cart
      - executeFunction:
          name: ca.test.functions.global.navigation.goToCartIos

      # Move GO product to Save for later.
      - executeFunction:
          name: ca.test.functions.cart.saveForLater
          params:
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Move GM product to Save for later.    
      - executeFunction:
          name: ca.test.functions.cart.saveForLater
          params:
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Validate MX is under unscheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.flow095.MX_name

      # Move GO back to cart.
      - executeFunction:
          name: ca.test.functions.cart.moveToCartFromSFL
          params:
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Validate GO are grouped under scheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickuoOrDeliveryFromStore
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Validate MX Product grouped under scheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.flow095.MX_name

      # Move GM product back to cart.
      - executeFunction:
          name: ca.test.functions.cart.moveToCartFromSFL
          params:
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Validate GM is grouped under unscheduled cart
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Validate GO Product grouped under scheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickuoOrDeliveryFromStore
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Validate MX Product grouped under scheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickuoOrDeliveryFromStore
            - name: productName
              string: ca.test.data.flow095.MX_name

      # Move GO product to save for later
      - executeFunction:
          name: ca.test.functions.cart.saveForLater
          params:
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Validate GM is under unscheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Validate MX is grouped under unscheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.flow095.MX_name

      # Move GO item back to cart.
      - executeFunction:
          name: ca.test.functions.cart.moveToCartFromSFL
          params:
            - name: productName
              string: ca.test.data.flow095.GO_name

      # navigate to reserve time page
      - executeFunction:
          name: ca.test.functions.cart.reserveTimePage
      
      # Reserve time page validation
      - executeFunction:
          name: ca.test.functions.reserveTimePageValidation

      # Reserve a Standard slot
      - executeFunction: 
          name: ca.test.functions.bookASlot.reserveTimePage.standardSlotSelection

      # Clicking book a slot button
      - executeFunction:
          name: ca.test.functions.bookASlot.reserveTimePage.bookASlotButton

      # move GO item to save for later.
      - executeFunction:
          name: ca.test.functions.cart.saveForLater
          params:
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Validate GM is under unscheduled cart
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypeShipping
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Validate MX under scheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickuoOrDeliveryFromStore
            - name: productName
              string: ca.test.data.flow095.MX_name

      # Move GM to save for later.
      - executeFunction:
          name: ca.test.functions.cart.saveForLater
          params:
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Validate MX is grouped under scheduled cart.
      - executeFunction:
          name: ca.test.functions.cart.validatingProductGrouping
          params:
            - name: fulfillmentType
              string: ca.test.data.fulfillmentTypePickup
            - name: productName
              string: ca.test.data.flow095.MX_name

      # Remove GO from save for later.
      - executeFunction:
          name: ca.test.functions.cart.removeFromSFL
          params:
            - name: productName
              string: ca.test.data.flow095.GO_name

      # Remove GM from save for later.
      - executeFunction:
          name: ca.test.functions.cart.removetFromSFL
          params:
            - name: productName
              string: ca.test.data.flow095.GM_name

      # Remove the MX item from cart
      - executeFunction:
          name: ca.test.functions.cart.removeItemFromCart
          params:
            - name: productName
              string: ca.test.data.flow095.MX_name
      
      # empty cart validation
      - executeFunction:
          name: ca.test.functions.cart.emptyCartValidation

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *          
      - storeIn:
          key: testStatus
          value: passed
  
  - name: After
    after: true
    flow:
      - log:
          message: flow-095
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.utils.afterSteps