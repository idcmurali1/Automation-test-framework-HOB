#*****************************************************************************************
## RegisteredUser - multi SKU >$199 - Pickup - CC WMC
# Validations: Sales Financing links and Emi information in Cart, Sales financing checkbox and details on checkout page, Sales financing details in checkout subtotal session.
# Scenarios covered:
# Navigate onboarding to home and clear cart through astro
# Navigate to sign in page and signin
# Checking and selecting Store in HP
# Search a product and add through srp
# Navigate to cart and validate the product details
# change pickup instead, validate the slaes financing options and links in cart
# After checkout, remove existing card and add a WMC card with new address
# Validate the Walmart Reward Financing and checkbox in checkout page
# validate Sales financing details in checkout subtotal session and place the order.
#*****************************************************************************************
general:
  platform: ios
  tags: flow-078 , ca_authpoc, E2E-iOS-English
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #

  - name: Main
    flow:
      - log: Start Main

      # Get TimeStamp
      - getTimestamp:
          asDate: true
          storeIn: timestamp
          
      #temporary#
      - executeFunction:
          name: ca.test.functions.utils.avoidTestPopup

      # Navigate onboarding to home
      - executeFunction:
          name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
          params:
            - name: ZIP_CODE
              string: ca.test.data.store.zipCode

      # Astro - Clear Cart
      - executeFunction:
          name: ca.functions.utils.astro.clearCart
          params:
            - name: custEmail
              string: ca.test.ios.data.flow078.email 
            - name: password
              string: ca.test.ios.data.flow078.pwd 

      # Navigate to sign in page
      - executeFunction:
          name: ca.test.functions.home.signIn    
      
      # Sign In to the account
      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.ios.data.flow078.email  
            - name: password
              string: ca.test.ios.data.flow078.pwd  

      # Validating home page customer greeting
      - executeFunction:
          name: ca.test.functions.home.verifyUserNameHomePage
          params:
            - name: usergreeting
              string: Walmart

      - executeFunction:
          name: ca.test.functions.utils.terminateApp

      - executeFunction:
          name: ca.test.functions.utils.relaunchApp

      # Checking and selecting Store
      - executeFunction:
          name: ca.test.functions.home.storeSelect
          params:
            - name: Zip_Code
              string: ca.test.data.onboarding.zipcode
            - name: storeName
              string: ca.test.data.onboarding.storeName

      # Product Search
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:           
            - name: product
              string: ca.test.data.flow078.searchProduct.product_1_sku

      # Navigating to PDP from SRP
      - executeFunction:
          name: ca.test.functions.productSearch.srpToPdpPage
          params:
            - name: productName
              string: ca.test.data.flow078.searchProduct.product_1_name

      - executeFunction:
          name: ca.test.functions.productDetailsPage.saleFinancing
          params:
            - name: productName
              string: ca.test.data.flow078.searchProduct.product_1_name
            - name: weeklyFinancing
              string: ca.test.data.flow078.searchProduct.product_1_weeklyValue

      # Add to cart
      - executeFunction:
          name: ca.test.functions.PDPpage.addToCart
          params:
            - name: quantity
              string: ca.test.data.flow078.searchProduct.product_1_qty

      #close PDP page
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      #clear search box
      - executeFunction:
          name: ca.test.functions.productSearch.clearSearch

      # Product Search
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:           
            - name: product
              string: ca.test.data.flow078.searchProduct.product_2_sku

      # Navigating to PDP from SRP
      - executeFunction:
          name: ca.test.functions.productSearch.srpToPdpPage
          params:
            - name: productName
              string: ca.test.data.flow078.searchProduct.product_2_name

      - executeFunction:
          name: ca.test.functions.productDetailsPage.saleFinancing
          params:
            - name: productName
              string: ca.test.data.flow078.searchProduct.product_2_name
            - name: weeklyFinancing
              string: $17.49

      # Add to cart
      - executeFunction:
          name: ca.test.functions.PDPpage.addToCart
          params:
            - name: quantity
              string: ca.test.data.flow078.searchProduct.product_1_qty

      #close PDP page
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      #clear search box
      - executeFunction:
          name: ca.test.functions.productSearch.clearSearch

      # Product Search
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:           
            - name: product
              string: ca.test.data.flow078.searchProduct.product_3_sku

      # Navigating to PDP from SRP
      - executeFunction:
          name: ca.test.functions.productSearch.srpToPdpPage
          params:
            - name: productName
              string: ca.test.data.flow078.searchProduct.product_3_name

      - executeFunction:
          name: ca.test.functions.productDetailsPage.saleFinancing
          params:
            - name: productName
              string: ca.test.data.flow078.searchProduct.product_3_name

      # Add to cart
      - executeFunction:
          name: ca.test.functions.PDPpage.addToCart
          params:
            - name: quantity
              string: ca.test.data.flow078.searchProduct.product_3_qty

      #close PDP page
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      # Validate cart quantity
      - executeFunction:
           name: ca.test.functions.cart.assertCartQuantity
           params:
            - name: cartQuantity
              string: ca.test.data.flow078.assertCardQuantity

      # Asserting cart total
      - executeFunction:
          name: ca.test.functions.cart.assertCartTotal
          params:
            - name: subTotal
              string: ca.test.data.flow078.cartSubtotal

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      # Navigate to cart
      - executeFunction:
          name: ca.test.functions.global.navigation.goToCartIos

#       # # product price validation 1
#       # - executeFunction:
#       #     name: ca.test.functions.cart.verifyProductTitleWithPrice
#       #     params:
#       #       - name: productName
#       #         string: ca.test.data.cart078.productName_1
#       #       - name: productPrice
#       #         string: ca.test.data.cart078.productPrice_1
#       #       - name: quantity
#       #         string: ca.test.data.cart078.product_1_qty
      
#       # product price validation 2
#       - executeFunction:
#           name: ca.test.functions.cart.verifyProductTitleWithPrice
#           params:
#             - name: productName
#               string: ca.test.data.cart078.productName_2
#             - name: productPrice
#               string: ca.test.data.cart078.productPrice_2
#             - name: quantity
#               string: ca.test.data.cart078.product_2_qty

#       # product price validation 3
#       - executeFunction:
#           name: ca.test.functions.cart.verifyProductTitleWithPrice
#           params:
#             - name: productName
#               string: ca.test.data.cart078.productName_3
#             - name: productPrice
#               string: ca.test.data.cart078.productPrice_3
#             - name: quantity
#               string: ca.test.data.cart078.product_3_qty

#      #Selecting Pickup Instead
#       - executeFunction:
#           name: ca.test.functions.cart.selectPickupOptionsIos 

#       # # validate the slaes financing options
#       # - executeFunction:
#       #     name: ca.test.functions.cart.verifySFPresence
#       #     params:
#       #       - name: priceAndDate
#       #         string: ca.test.data.cart078.priceandDate_cart

# ## Do Not Delete
# # #clicking of the links not working (temp -commented due to the SF link not clickable in cart issue. 79 only not commented to check the link is working or not)
#       # # Validate SF links in cart
#       # - executeFunction:
#       #     name: ca.test.functions.cart.validateSFlinks 
# #...........................................................................
# # Sales financing checkbox and details on checkout page.
#       # Proceed to Checkout
#       - executeFunction:
#           name: ca.test.functions.cart.proceedToCheckOutIos

#       # CheckOut page order review validation
#       - executeFunction:
#           name: ca.test.functions.checkOut.validateCheckOutOrderCartIos
#           params:
#             - name: fulfillment
#               string: ca.test.data.flow072.fulfillmentType

#       # Navigating edit payment page
#       - executeFunction:
#           name: ca.test.functions.checkOut.editPayment
      
#       # remove the existing card from wallet page
#       - executeFunction:
#           name: ca.test.functions.checkout.removeCardDetailsAndAddress

#       # Adding card details in wallet page
#       - executeFunction:
#           name: ca.test.functions.checkout.addCardDetailsAndAddress
#           params:
#             - name: number
#               string: ca.test.data.flow078.checkout.wallet.addCard.rewardsCard.number
#             - name: expiration
#               string: ca.test.data.flow078.checkout.rewardsCard.wallet.addCard.expiration
#             - name: cvv
#               string: ca.test.data.flow078.checkout.rewardsCard.wallet.addCard.cvv
#             - name: fName
#               string: ca.test.data.flow078.checkout.wallet.addCard.cardHolderFirstName
#             - name: lName
#               string: ca.test.data.flow078.checkout.wallet.addCard.cardHolderLastName
#             - name: mobileNumber
#               string: ca.test.data.flow078.checkout.wallet.addCard.address.mobileNumber
#             - name: streetAddress
#               string: ca.test.data.flow078.checkout.wallet.addCard.address
#             - name: city
#               string: ca.test.data.flow078.checkout.wallet.addCard.address.city
#             - name: state
#               string: ca.test.data.flow078.checkout.wallet.addCard.address.province
#             - name: zipcode
#               string: ca.test.data.flow078.checkout.wallet.addCard.address.postalCode
#             - name: cardLast4digits
#               string: ca.test.data.flow078.checkout.wallet.cardLastDigits
#             - name: wmcPin
#               string: ca.test.data.flow078ios.Cvv
      
#       # # Validate the Walmart Reward Financing
#       # - executeFunction:
#       #     name: ca.test.functions.checkout.validateCheckbox
#       #     params:
#       #       - name: priceAndDate
#       #         string: ca.test.data.cart078.priceandDate_co

# #       # check the checkbox of Walmart Reward Financing
# #       - executeFunction:
# #           name: ca.test.functions.checkout.checkTheCheckbox
# # #...........................................................................
# # # Sales financing details in checkout subtotal session.
# #       - executeFunction:
# #           name: ca.test.functions.checkout.validateSFunderSubtotal

#       # Order placement
#       - executeFunction:
#           name: ca.test.functions.checkOut.PlacingOrder
# #...........................................................................
      - storeIn:
          key: testStatus
          value: passed
  
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps     
  