#*****************************************************************************************
## Registered user should not be able to see Sales Financing option in checkout page when shipping address is Quebec.
# Sales Financing links in PDP and cart, Emi information in PDP and Cart.
# Sales financing checkbox and details not present in checkout page.
#Scenario covered:
# Navigate onboarding to home, clear cart through astro
# Navigate to sign in page and signin
# Checking and selecting Store, Selecting address at home page
# Search a product and Go to PDP
#validate the slaes financing options and links, A2C
# Navigate to cart, product price validation - >$199, Sf options and links
# set the address to Quebec, validate the SF option not there 
# Proceed to Checkout, validate the SF option not there
#*****************************************************************************************
general:
  platform: ios
  tags: flow-079, ca_authpoc, E2E-iOS-English
  inherit:
    filesRunAll:
      - ca-errors-helpers.yaml

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * #

  - name: Main
    flow:
      - log: Start Main

      # Get TimeStamp
      - getTimestamp:
          asDate: true
          storeIn: timestamp
          
      #temporary#
      - executeFunction:
          name: ca.test.functions.utils.avoidTestPopup

      # Navigate onboarding to home
      - executeFunction:
          name: ca.test.functions.global.onboarding.navigateiosOnboardingToHome
          params:
            - name: ZIP_CODE
              string: ca.test.data.store.zipCode

      # Astro - Clear Cart
      - executeFunction:
          name: ca.functions.utils.astro.clearCart
          params:
            - name: custEmail
              string: ca.test.ios.data.flow079.email 
            - name: password
              string: ca.test.ios.data.flow079.pwd

      # Navigate to sign in page
      - executeFunction:
          name: ca.test.functions.home.signIn    
      
      # Sign In to the account
      - executeFunction:
          name: ca.test.functions.loginPage.userLogin
          params:
            - name: email
              string: ca.test.ios.data.flow079.email  
            - name: password
              string: ca.test.ios.data.flow079.pwd 

      # Validating home page customer greeting
      - executeFunction:
          name: ca.test.functions.home.verifyUserNameHomePage
          params:
            - name: usergreeting
              string: Walmart

      - executeFunction:
          name: ca.test.functions.utils.terminateApp

      - executeFunction:
          name: ca.test.functions.utils.relaunchApp

      # Checking and selecting Store
      - executeFunction:
          name: ca.test.functions.home.storeSelect
          params:
            - name: Zip_Code
              string: ca.test.data.onboarding.zipcode
            - name: storeName
              string: ca.test.data.onboarding.storeName

      # Product Search
      - executeFunction:
          name: ca.test.functions.productSearch.searchAProduct
          params:           
            - name: product
              string: ca.test.data.flow079.srp.product.sku

      # Product SRP to PDP page
      - executeFunction:
          name: ca.test.functions.productSearch.srpToPdpPage
          params:
            - name: productName
              string: ca.test.data.flow079.srp.product.name

      - executeFunction:
          name: ca.test.functions.productDetailsPage.saleFinancing
          params:
            - name: productName
              string: ca.test.data.flow079.srp.product.name
            - name: monthlyFinancing
              string: $77
            - name: weeklyFinancing
              string: $115.00

      # Add to cart
      - executeFunction:
          name: ca.test.functions.PDPpage.addToCart
          params:
            - name: quantity
              string: ca.test.data.flow079.product_1_Qty
          
      #close PDP page
      - executeFunction:
          name: ca.test.functions.PDPpage.closePDPpage

      # Validate cart quantity
      - executeFunction:
           name: ca.test.functions.cart.assertCartQuantity
           params:
            - name: cartQuantity
              string: ca.test.data.flow079.cartQuantity

      # Asserting cart total
      - executeFunction:
          name: ca.test.functions.cart.assertCartTotal
          params:
            - name: subTotal
              string: ca.test.data.flow079.assertCartTotal

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

#       # Navigate to cart
#       - executeFunction:
#           name: ca.test.functions.global.navigation.goToCartIos

#       - executeFunction:
#           name: ca.test.functions.cart.verifyProductDetails
#           params:
#             - name: productName
#               string: ca.test.data.flow079.srp.product.name
#             - name: productPrice
#               string: $459.98
#             - name: productQty
#               string: ca.test.data.flow079.product_1_Qty

#       # validate the slaes financing options
#       - executeFunction:
#           name: ca.test.functions.cart.verifySFPresence
#           params:
#             - name: priceAndDate
#               string: ca.test.data.cart079.priceandDate_cart
# ## Do Not Delete
# # #clicking of the links not working (79 only not commented to check the link is working or not)
#       # Validate SF links in cart
#       - executeFunction:
#           name: ca.test.functions.cart.validateSFlinks 

#       # set the address to Quebec
#       - executeFunction:
#           name: ca.test.functions.cart.changeShippingAddress
#           params:
#             - name: Address
#               string: 3354 Innes Rd
#             - name: address
#               string: ca.test.data.cart079.AddressFL

#      # validate the SF option not there  
#       - executeFunction:
#           name: ca.test.functions.cart.verifySFnotPresent
#           params:
#             - name: priceAndDate
#               string: ca.test.data.cart077.priceandDate
# #...........................................................................
# # Sales financing checkbox and details not present in checkout page.
#       # Proceed to Checkout
#       - executeFunction:
#           name: ca.test.functions.cart.proceedToCheckOutIos

#       # validate the SF option not there
#       - executeFunction:
#           name: ca.test.functions.cart.verifySFnotPresent
#           params:
#             - name: priceAndDate
#               string: ca.test.data.cart077.priceandDate
# #...........................................................................
      - storeIn:
          key: testStatus
          value: passed
  
  - name: After
    after: true
    flow:
      - executeFunction:
          name: ca.test.functions.utils.afterSteps