functions:
  - name: ca.test.functions.productSearch.searchAProductAndAddToCart
    platform: android
    flow:
      - verifyIdentifier: 
          present: 
            - identifier: ca.test.mappings.home.searchBarSelected
      - click:
          identifier: ca.test.mappings.home.searchBarSelected
      - enterText:
          identifier: ca.test.mappings.home.searchBarSelected
          string: ${gmItem}
          pressEnter: true
          sleep:
            duration: 3000
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.srp.threeWaysToOrder
          then:
            - click:
                identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.srp.threeWaysToOrder
          then:
            - click:
                identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.srp.productTile
          then:
            - click:
                identifier: ca.test.mapping.srp.AddToCart


  # Search for a product
  - name: ca.test.functions.productSearch.searchAProduct
    platform: android
    flow:
      - log: 
          message: Searching for product.
          color: GREEN_BOLD
      - click:
          identifier: ca.test.mappings.home.searchBarSelected
      - enterText:
          identifier: ca.test.mappings.home.searchBarSelected
          string: ${product}
          pressEnter: true
      - sleep:
          duration: 3000
      - log:
          message: "Product ${product} searched"
          color: GREEN_BOLD
      - executeFunction:
          name: ca.test.functions.productSearch.threeWaysToOrder
      # - if:
      #     identifier:
      #       present:
      #         - identifier: ca.test.mappings.home.myItems.closeButton
      #     then:
      #       - click:
      #           identifier: ca.test.mappings.home.myItems.closeButton

  # Three ways to ship popup window gotItClick
  - name: ca.test.functions.productSearch.threeWaysToOrder
    platform: android
    flow:
      - loop:
          begin: 1
          end: 3
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: ca.test.mapping.srp.threeWaysToOrder
                then:
                  - click:
                      identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
      - log:
          message: "Accepting the three ways pop in SRP page"
          color: GREEN_BOLD

  - name: ca.test.functions.productSearch.addItemToCartBasedOnCartValue
    platform: android
    flow:
      - loop:
          begin: 1
          end: 75
          mode: increment
          flow:
            - if: 
                identifier:
                  present:
                    - identifier: ca.test.mapping.addToCartText
                then:
                  - click:
                      identifier: ca.test.mapping.addToCartText
                      wait: 1000
                else: 
                  - scroll:
                      direction: down
                      untilIdentifier: ca.test.mapping.addToCartText
                  - click:
                      identifier: ca.test.mapping.addToCartText
                      wait: 3000
            - if:
                identifier:
                  present:
                    - identifier: ca.test.mappings.cart.unableToAddToCart
                then:
                  - click:
                      identifier: ca.test.mappings.cart.unableToAddToCartButton
                  - scroll:
                      direction: down
                      untilIdentifier: ca.test.mapping.addToCartText
            - getString:
                identifier: ca.test.mappings.cartSummarySubTotal
                extractNumbers: true
                storeIn: cartItemsCounts
            - log: "Cost: $cartItemsCounts"
            - if:
                condition: "(${cartItemsCounts} > ${subTotal})"
                then:
                  - break: true

  # Adding multiple quantity of same product
  - name: ca.test.functions.productSearch.addMultipleQty
    platform: android
    flow:
      - click:
          identifier: ca.test.mapping.srp.AddToCart
      - click:
          identifier: ca.test.mapping.srp.addMultipleQty
      
  ####### iOS  #####

  # Search a product and add to cart ios              

  - name: ca.test.functions.productSearch.searchAProductAndAddToCartIos
    platform: ios
    flow:
      - verifyIdentifier: 
          present: 
            - identifier: ca.test.mappings.home.searchBarSelected
      - click:
          identifier: ca.test.mappings.home.searchBarSelected
      - enterText:
          identifier: ca.test.mappings.home.searchBarSelected
          string: ${SearchItem}
          pressEnter: true
          sleep:
            duration: 5000
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.srp.threeWaysToOrder
          then:
            - click:
                identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
      # - if:
      #     identifier:
      #       present:
      #         - identifier: ca.test.mapping.srp.threeWaysToOrder
      #     then:
      #       - click:
      #           identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
      - sleep:
          duration: 3000      
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.srp.productTile
          then:
            - click:
                identifier: ca.test.mapping.srp.AddToCart

  - name: ca.test.functions.productSearch.searchAProductIos
    platform: ios
    flow:
      - log:
          message: "Searching for ${product}"
          color: GREEN_BOLD
      - click:
          identifier: ca.test.mappings.home.searchBarSelected
      - enterText:
          identifier: ca.test.mappings.home.searchBarSelected
          string: ${product}
          pressEnter: true
      # Handling filter popup    
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.filter.popUpDesc
          then:
            - goBack: true
            - click:
                identifier: ca.test.mappings.home.searchBarSelected
            - enterText:
                identifier: ca.test.mappings.home.searchBarSelected
                string: ${product}
                pressEnter: true
      - sleep:
          duration: 5000
      - executeFunction:
          name: ca.test.functions.productSearch.threeWaysToOrder        

  - name: ca.test.functions.productSearch.searchAProduct
    platform: ios
    flow:
      - log:
          message: "Searching for ${product}"
          color: GREEN_BOLD
      - click:
          identifier: ca.test.mappings.home.searchBarSelected
      - enterText:
          identifier: ca.test.mappings.home.searchBarSelected
          string: ${product}
          pressEnter: true
      - sleep:
          duration: 5000
      - executeFunction:
          name: ca.test.functions.productSearch.threeWaysToOrder

  # Three ways to ship popup window gotItClick -ios
  - name: ca.test.functions.productSearch.threeWaysToOrder
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.srp.threeWaysToOrder
          then:
            - click:
                identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
  
  # Srp Page Validation for Search and Browse 
  - name: ca.test.functions.productSearch.srpPageValidaionSearchAndBrowse
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: ca.test.mappings.home.searchBarSelected
            - identifier: ca.test.mappings.navBar.cartIcon
            - identifier: ca.test.mappings.srp.sortAndFilter
            - identifier: ca.test.mappings.srp.priceRange
            # - identifier: ca.test.mappings.srp.brands-not in srp
            - identifier: ca.test.mappings.srp.primaryText
            - identifier: ca.test.mappings.srp.productTile
            - identifier: ca.test.mappings.srp.AddToCart
            # - identifier: ca.test.mappings.srp.productTileImage
            # - identifier: ca.test.mappings.srp.productPrice
            # - identifier: ca.test.mappings.srp.productTileBrand
            # - identifier: ca.test.mappings.srp.productName
            # - identifier: ca.test.mappings.srp.productRatingsStar             

  # Add to cart based on product name and also increase quantity
  - name: ca.test.functions.productSearch.addToCart
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.srp.productSearch.addTocart
          then:
            - scroll:
                direction: down
                untilIdentifier: ca.test.mappings.srp.productSearch.addTocart
      - click:
          identifier: ca.test.mappings.srp.productSearch.addTocart
#      - verifyIdentifier:
#          notPresent:
#            - identifier: ca.test.mappings.srp.productSearch.addTocart
      - if:
          condition: ${quantity} > 1
          then:
            - loop:
                begin: 1
                end: ${quantity}
                mode: increment
                flow:
                  - sleep:
                      duration: 3000
                  - if:
                      identifier:
                        notPresent:
                          - identifier: ca.test.mappings.home.carouselIncreaseQuantity
                      then:
                        - click:
                            identifier: ca.test.mappings.home.carouselQuantityBarClick
                  - click:
                      identifier: ca.test.mappings.home.carouselIncreaseQuantity
      - log:
          message: "--------------------Product added to cart--------------------"
          color: GREEN_BOLD

  # Search and Browse 
  - name: ca.test.functions.productSearch.addToCartSearchAndBrowse
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mapping.srp.AddToCart
          then:
            - scroll:
                direction: down 
                untilIdentifier: ca.test.mapping.srp.AddToCart

      - click:
           identifier: ca.test.mapping.srp.AddToCart           


  # SRP Page Validation - ios 
  - name: ca.test.functions.productSearch.srpPageValidaion  
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: ca.test.mappings.home.searchBarSelected
            - identifier: ca.test.mappings.navBar.cartIcon
            - identifier: ca.test.mappings.srp.sortAndFilter
            - identifier: ca.test.mappings.srp.priceRange
            # - identifier: ca.test.mappings.srp.brands-not in srp
            - identifier: ca.test.mappings.srp.primaryText
            - identifier: ca.test.mappings.srp.productTile
            - identifier: ca.test.mappings.srp.productTileImage
            - identifier: ca.test.mappings.srp.AddToCart
            # - identifier: ca.test.mappings.srp.productPrice
            # - identifier: ca.test.mappings.srp.productTileBrand
            # - identifier: ca.test.mappings.srp.productName
            # - identifier: ca.test.mappings.srp.productRatingsStar
      # - if:
      #     condition: $(offerProduct)==Yes
      #     then:
      #       - verifyIdentifier:
      #         present:
      #            -identifier: ca.test.mappings.srp.productOffer
      #       - getString:
      #          identifier: ca.test.mappings.srp.productOffer
      #          attribute: content-desc
      #          storeIn: offerName            
      # - log: The product is having $(offerName)tag 

  # Add to cart from srp
  - name: ca.test.functions.srp.addToCartIos
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mapping.srp.AddToCart
      - click:
          identifier: ca.test.mapping.srp.AddToCart 

  # SRP Page Validation - ios 
  - name: ca.test.functions.productSearch.srpPageValidaionMultivariant 
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: ca.test.mappings.home.searchBarSelected
            - identifier: ca.test.mappings.navBar.cartIcon
            - identifier: ca.test.mappings.srp.sortAndFilter
            - identifier: ca.test.mappings.srp.priceRange
            # - identifier: ca.test.mappings.srp.brands-not in srp
            - identifier: ca.test.mappings.srp.primaryText
            - identifier: ca.test.mappings.srp.productTile
            # - identifier: ca.test.mappings.srp.productTileImage
            # - identifier: ca.test.mappings.srp.productPrice
            # - identifier: ca.test.mappings.srp.productTileBrand
            # - identifier: ca.test.mappings.srp.productName
            # - identifier: ca.test.mappings.srp.productRatingsStar

  - name: ca.test.functions.productSearch.navigateBackToHome
    platform: android
    flow:
      - try:
          flow:
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.tabBar.shop
                then:
                  - scroll:
                      direction: up
                      untilIdentifier: ca.test.mappings.tabBar.shop
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.tabBar.shop
          catch:
            flow:
            - if:
                identifier:
                  present:
                    - identifier: ca.test.mappings.tabBar.shop
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: ca.test.mappings.tabBar.shop
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.tabBar.shop
      - click:
          identifier: ca.test.mappings.tabBar.shop

  # Add to cart based on product name and also increase quantity
  - name: ca.test.functions.dftb.addToCart
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.dftb.addTocart
          then:
            - scroll:
                direction: down
                untilIdentifier: ca.test.mappings.dftb.addTocart
      - click:
          identifier: ca.test.mappings.dftb.addTocart
# #      - verifyIdentifier:
# #          notPresent:
# #            - identifier: ca.test.mappings.srp.productSearch.addTocart
#       - if:
#           condition: ${quantity} > 1
#           then:
#             - loop:
#                 begin: 1
#                 end: ${quantity}
#                 mode: increment
#                 flow:
#                   - sleep:
#                       duration: 3000
#                   - if:
#                       identifier:
#                         notPresent:
#                           - identifier: ca.test.mappings.home.carouselIncreaseQuantity
#                       then:
#                         - click:
#                             identifier: ca.test.mappings.home.carouselQuantityBarClick
#                   - click:
#                       identifier: ca.test.mappings.home.carouselIncreaseQuantity
#       - log:
#           message: "--------------------Product added to cart--------------------"
#           color: GREEN_BOLD        
            
  - name: ca.test.functions.productSearch.addToCart
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.srp.productSearch.addTocart
          then:
            - scroll:
                direction: down
                untilIdentifier: ca.test.mappings.srp.productSearch.addTocart
                scrollLimit: 5
                timeout: 15000
      - click:
          identifier: ca.test.mappings.srp.productSearch.addTocart
      - if:
          condition: ${quantity} > 1
          then:
            - loop:
                begin: 1
                end: ${quantity}
                mode: increment
                flow:
                  - sleep:
                      duration: 3000
                  - click:
                      identifier: ca.test.mappings.srp.productTitle.quantityIncrement
      - log:
          message: "--------------------Product added to cart--------------------"
          color: GREEN_BOLD
 
  # - name: ca.test.functions.productSearch.choosemorethan35
  #   platform: ios
  #   flow:
  #     - loop:
  #         begin: 1
  #         end: 20
  #         storeIndex: i
  #         mode: increment
  #         flow:
  #           - verifyIdentifier:
  #               present:
  #                 - identifier: ca.test.mappings.product.dynamicProductbyPrice
  #           - getString:
  #               identifier: ca.test.mappings.product.dynamicProductbyPrice
  #               storeIn: price
  #           - executeNode:
  #               file: ca/test/helpers/sanitizeSrpPrice.js #ca/test/helpers/sanitizePrice.js
  #               args:
  #                 - value: price
  #               getResponse:
  #                 storeIn: cleanedPriceFinal
  #           - if:
  #               condition: cleanedPriceFinal >= 35
  #               then:
  #                 - click:
  #                     identifier: ca.test.mappings.product.dynamicProductbyPrice
  #                 - verifyIdentifier:
  #                     present:
  #                       - identifier: ca.test.mapping.pdp.addtocart
  #                 - click:
  #                     identifier: ca.test.mapping.pdp.addtocart
  #               else:
  #                 - break: true
  #     - log:
  #         message: "--------------------Dynamic Product slected successfully--------------------"
  #         color: GREEN_BOLD

  - name: ca.test.functions.productSearch.navigateBackToHome
    platform: ios
    flow:
      - try:
          flow:
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.tabBar.shop 
                then:
                  - scroll:
                      direction: up
                      untilIdentifier: ca.test.mappings.tabBar.shop
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.tabBar.shop
          catch:
            flow:
            - if:
                identifier:
                  present:
                    - identifier: ca.test.mappings.tabBar.shop
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: ca.test.mappings.tabBar.shop
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.tabBar.shop
      - click:
          identifier: ca.test.mappings.tabBar.shop

  - name: ca.test.function.productSearch.UsingDynamicProductArrayList
    platform: ios
    flow: 
      - storeIn:
          key: ProductTitleArray
          value: 'null'
      - storeIn:
          key: ProductPriceArray
          value: 'null'
      - storeIn:
          key: IndexValue
          value: 'null'
      - loop:
          each: ${ProductArray}
          storeIndex: i
          storeElement: x
          flow: 
            - if: 
                condition: ${Cartqty} < ${i}
                then:
                  - log:
                      message: Breaking the loop as required cart value is achieved.
                      color: GREEN_BOLD
                  - break: true     
            - log:
                message: Searching with sku $x.
                color: GREEN_BOLD
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.home.searchBarSelected    
            - enterText:
                identifier: ca.test.mappings.home.searchBarSelected
                string: ${x}
                pressEnter: true
                clearField: true
                clickFirst: true
            - sleep:
                duration: 5000
            - log: 
                message: Checking for any error in search result.
                color: GREEN_BOLD
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.DFTB.outOfStock
                then:
                  - sleep:
                      duration: 5000
                  - if:
                      condition: ${i} == "0"
                      then:
                        - if:
                            identifier:
                              present:
                                - identifier: ca.test.mapping.srp.threeWaysToOrder
                            then:
                              - log:
                                  message: Accepting three ways to shipping pop up.
                                  color: GREEN_BOLD
                              - click:
                                  identifier: ca.test.mapping.srp.threeWaysToOrderGotItButton
                  - click:
                      identifier: //XCUIElementTypeButton[@name="stepper.incrementButton"]
                  - log:
                      message: Checking for unable to add to cart pop up.
                      color: GREEN_BOLD
                  - if: 
                      identifier:
                        timeout: 15000
                        present:
                          - identifier: //XCUIElementTypeStaticText[@name="UnavailableItemsViewController.titleLabel"]
                      then: 
                        - log:
                            message: Product is unable to add to cart. Handling the pop and searching for other product.
                            color: RED_BOLD
                        - click:
                            identifier: ca.test.mappings.global.closeIcon
                      else:
                        - arithmetic:
                            expression: ${i} + 1
                            storeIn: CartQuantity                       
                        - log: 
                            message: Cart quantity = ${CartQuantity}
                            color: GREEN_BOLD
                        - getString:
                            identifier: //XCUIElementTypeOther[@name="ProductImageView.stackView"]
                            storeIn: ProductTitle
                            attribute: label
                        - log: 
                            message: "Product added to cart getting product name: ${ProductTitle}"
                            color: GREEN_BOLD
                        - getString:
                            identifier: //XCUIElementTypeStaticText[@name="GreenPriceView.primaryPriceLabel"]
                            storeIn: ProductPrice
                            attribute: label
                        - log: 
                            message: "Product added to cart getting product price: ${ProductPrice}"
                            color: GREEN_BOLD
                        - if:
                            condition: ${i} == "0"
                            then:
                              - executeNode:
                                  file: ca/test/helpers/ProductTitleArray.js
                                  args:
                                    - value: ${ProductTitle}
                                    - value: ${ProductPrice}
                                    - value: 'null'
                                    - value: 'null'
                                  getValue:
                                    - key: ProductTitleArray
                                      storeIn: ProductTitleArray
                                    - key: ProductPriceArray
                                      storeIn: ProductPriceArray
                                    - key: SubTotal
                                      storeIn: TotalPrice
                              - log: 
                                  message: "Product name list array: ${ProductTitleArray}"
                                  color: GREEN_BOLD
                              - log: 
                                  message: "Product price list array: ${ProductPriceArray}"
                                  color: GREEN_BOLD
                              - log: 
                                  message: "Total price of product added to cart= ${TotalPrice}"
                                  color: GREEN_BOLD
                            else:
                              - executeNode:
                                  file: ca/test/helpers/ProductTitleArray.js
                                  args:
                                    - value: ${ProductTitle}
                                    - value: ${ProductPrice}
                                    - value: ${ProductPriceArray}
                                    - value: ${ProductTitleArray}
                                  getValue:
                                    - key: ProductTitleArray
                                      storeIn: ProductTitleArray
                                    - key: ProductPriceArray
                                      storeIn: ProductPriceArray
                                    - key: SubTotal
                                      storeIn: TotalPrice
                              - log: 
                                  message: "Product name list array: ${ProductTitleArray}"
                                  color: GREEN_BOLD
                              - log: 
                                  message: "Product price list array: ${ProductPriceArray}"
                                  color: GREEN_BOLD
                              - log: 
                                  message: "Total price of product added to cart= ${TotalPrice}"
                                  color: GREEN_BOLD         
                else:
                  - log:
                      message: Search result page shows OOS while searching for product sku $x.
                      color: RED_BOLD   

  - name: ca.test.functions.productSearch.clearFeild
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: //XCUIElementTypeNavigationBar[@name="Search.SearchResultsView"]/XCUIElementTypeSearchField/XCUIElementTypeOther
          then:
            - sleep:
                duration: 1000    
            - click:
                identifier: ca.test.mappings.home.ClearSymbol