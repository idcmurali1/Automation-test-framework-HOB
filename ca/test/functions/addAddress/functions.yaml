functions:

  - name: ca.test.functions.deliveryAddress.addAddress
    platform: android
    flow: 
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.deliveryAddress.add.title
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.firstName
          string: ${firstName}
          clickFirst: true
          clearField: true
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
          string: ${lastName}
          clickFirst: true
          clearField: true
      - goBack: true
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
      - sleep:
          duration: 3000
      # Accept location permission pop up if displayed
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.deliveryAddress.add.allowLocationPermission
          then:
            - click:
                identifier: ca.test.mappings.deliveryAddress.add.allowLocationPermission
      - sleep:
          duration: 2000
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
          string: ${streetAddress}
          clickFirst: true
          clearField: true
      - sleep:
          duration: 3000
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.city
          string: ${city}
          clickFirst: true
      - goBack: true
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.province
          string: ${state}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.zipcode
          string: ${zipcode}
      - goBack: true
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.phoneNumber
          string: ${phoneNumber}
      - goBack: true
      - sleep:
          duration: 2000
      - click:
          identifier: ca.test.mappings.accountPage.setDefaultAddressCheckBox
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.saveButton
      - sleep:
          duration: 2000
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.deliveryAddress.addAddress.addressSuggestion
          then:
            - click:
                identifier: ca.test.mappings.deliveryAddress.addAddress.addressSuggestion.selectCurrentAddress
            - click:
                identifier: ca.test.mappings.deliveryAddress.addAddress.saveAddress
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.global.infoMessage
          then: 
            - click:
                identifier: ca.test.mappings.deliveryAddress.add.saveButton
      - sleep:
          duration: 5000

#choose address for delivery after sign in
  - name: ca.test.functions.addAddressInDeliveryFromStore
    platform: android
    flow:
    - if:
        identifier:
          present:
            - identifier: ca.test.mappings.deliveryFromStore.addAddressButton
        then:
          - click:
              identifier: ca.test.mappings.deliveryFromStore.addAddressButton
        else:
          - click:
              identifier: ca.test.mappings.deliveryChange
    - storeIn:
        key: addressToSelect
        value: ${address}
    - if:
        identifier:
          present:
            - identifier: ca.test.mapping.deliveryAddressSelect
        then:
          - click:
              identifier: ca.test.mapping.deliveryAddressSelect
  
  - name: ca.test.functions.deliveryAddress.addAddressIos
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.account.deliveryAddress.addAddress
          then:
            - click:
                identifier: ca.test.mappings.account.deliveryAddress.addAddress  
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.deliveryAddress.add.title
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.title
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.firstName
          string: ${firstName}
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
          string: ${lastName}
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
          string: ${streetAddress}
          pressEnter: true
      - executeFunction:
          name: ca.test.functions.utils.handlingKeyboard  
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.city
    #   - click: 
    #       identifier: ca.test.mappings.wallet.done
      - sleep:
          duration: 3000
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.city
          string: ${city}
      - click: 
          identifier: ca.test.mappings.wallet.done
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.province
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.province.pickWheel
          string: ${state}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.zipcode
          string: ${zipcode}
      - click: 
          identifier: ca.test.mapping.checkout.keyboard
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.phoneNumber
          string: ${phoneNumber}
      - click: 
          identifier: ca.test.mapping.checkout.keyboard
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.saveButton
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.deliveryAddress.confirmSuggestion
          then:
            - click:
                identifier: ca.test.mappings.deliveryAddress.confirmSuggestion
      - sleep:
          duration: 3000
      - if:
          condition: ${page} == 'Home'
          then:
            - verifyIdentifier:
                present: 
                    - identifier: ca.test.mappings.homePage.globalIntentCenter.deliveryLocation
            - loop:
                begin: 0
                end: 3
                mode: increment
                flow:
                    - if:
                        identifier:
                            notPresent:
                            - identifier: ca.test.mappings.homePage.globalIntentCenter.howWantYourItems
                        then:
                        - click:
                            identifier: ca.test.mappings.homePage.globalIntentCenter.deliveryLocation
                        else:
                        - break: true
            - if:
                identifier:
                    present:
                    - identifier: ca.test.mappings.homePage.globalIntentCenter.expandedView
                then:
                    - click:
                        identifier: ca.test.mappings.homePage.globalIntentCenter.expandedView
          else:
            - goBack: true
                
  #add address from PDP
  - name: ca.test.functions.pdp.addAddressPdpIos
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.pdp.shippingAddress
          then:
            - verifyIdentifier:
                timeout: 1000
                present:
                  - identifier: ca.test.mappings.cart.deliveryFromStore.address # ca.test.mappings.pdp.shipping
            - click:
                identifier: ca.test.mappings.cart.deliveryFromStore.address # ca.test.mappings.pdp.shipping
          else:
            - scroll:
                direction: down
                untilIdentifier: ca.test.mappings.pdp.shippingAddress
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.cart.deliveryFromStore.address #  ca.test.mappings.pdp.shipping
            - click:
                identifier: ca.test.mappings.cart.deliveryFromStore.address # ca.test.mappings.pdp.shipping
      - verifyIdentifier:
         timeout: 1000
         present:
           - identifier: ca.test.mappings.cart.deliveryFromStore.addNewAddress
      - click:
          identifier: ca.test.mappings.cart.deliveryFromStore.addNewAddress
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.firstName
          string: ${firstName}
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
          string: ${lastName}             
    #   - click:
    #       identifier: ca.test.mappings.deliveryAddress.add.streetAddress
    #   - sleep:
    #       duration: 3000
      # Accept location permission pop up if displayed
    #   - if:
    #       identifier:
    #         present:
    #           - identifier: ca.test.mappings.deliveryAddress.add.allowLocationPermission
    #       then:
    #         - click:
    #             identifier: ca.test.mappings.deliveryAddress.add.allowLocationPermission
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
          string: ${streetAddress}
          pressEnter: true
      - click: 
          identifier: ca.test.mappings.streetadress.option   
      - sleep:
          duration: 3000
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.city
          string: ${city}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.province
          string: ${state}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.zipcode
          string: ${zipcode}
      - click: 
          identifier: ca.test.mapping.checkout.keyboard
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.phoneNumber
          string: ${phoneNumber}
      - click: 
          identifier: ca.test.mapping.checkout.keyboard
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.saveButton
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.deliveryAddress.confirmSuggestion
          then:
            - click:
                identifier: ca.test.mappings.deliveryAddress.confirmSuggestion
      - sleep:
          duration: 3000
      - click: 
          identifier: ca.mappings.tabBar.shop

 #add address from Home
  - name: ca.test.functions.pdp.validateAddressHome
    platform: ios
    flow:
      - sleep:
          duration: 1000
      - verifyIdentifier:
          present:
            - identifier: ca.mappings.tabBar.shop
      - click: 
          identifier: ca.mappings.tabBar.shop
      - if:
          identifier:
            present:
              - identifier: ca.test.mapping.cart.shippingAddress
          then:
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mapping.cart.shippingAddress

# add address from GM cart
  - name: ca.test.functions.deliveryAddress.addAddressHomeIos
    platform: ios
    flow:
      - if:
          identifier:
            present:
            - identifier: ca.test.mapping.cart.shippingAddressCart
          then:
            - click:
                identifier: ca.test.mapping.cart.shippingAddressCart
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.cart.deliveryFromStore.addNewAddress
            timeout: 10000
          then:
            - click:
                identifier: ca.test.mappings.cart.deliveryFromStore.addNewAddress 
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.deliveryAddress.seeTimesAdd.title
      - click:
          identifier: ca.test.mappings.deliveryAddress.seeTimesAdd.title
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.firstName
          string: ${firstName}
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
          string: ${lastName}
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
          string: ${streetAddress}
          pressEnter: true
      - sleep:
          duration: 500
      - scroll:
            direction: up
            scrollLimit: 1            
      - sleep:
          duration: 3000
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.city
          string: ${city}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.province
          string: ${state}
      - executeFunction:
          name: ca.test.functions.utils.handlingKeyboard    
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.zipcode
          string: ${zipcode}
      - click:
          identifier: ca.test.mapping.checkout.keyboard
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.phoneNumber
          string: ${phoneNumber}
      - click:
          identifier: ca.test.mapping.checkout.keyboard
      - if:
            identifier:
              present:
                - identifier: ca.test.mappings.deliveryAddress.add.saveButton
            then:
              - click:
                  identifier: ca.test.mappings.deliveryAddress.add.saveButton

#add address from PDP - with co-ordinates
  - name: ca.test.functions.pdp.addAddressPdpIos_co
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.pdp.shippingAddress
          then:
            - sleep:
                duration: 1000
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.cart.deliveryFromStore.address # ca.test.mappings.pdp.shipping
            - click:
                identifier: ca.test.mappings.cart.deliveryFromStore.address # ca.test.mappings.pdp.shipping
                coordinates: 95%, 50%
          else:
            - sleep:
                duration: 1000
            - scroll:
                direction: down
                untilIdentifier: ca.test.mappings.pdp.shippingAddress
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.cart.deliveryFromStore.address #  ca.test.mappings.pdp.shipping
            - click:
                identifier: ca.test.mappings.cart.deliveryFromStore.address # ca.test.mappings.pdp.shipping
                coordinates: 95%, 50%
      - sleep:
          duration: 500
      - verifyIdentifier:
         present:
           - identifier: ca.test.mappings.cart.deliveryFromStore.addNewAddress
      - click:
          identifier: ca.test.mappings.cart.deliveryFromStore.addNewAddress
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.firstName
          string: ${firstName}
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.lastName
          string: ${lastName}             
    #   - click:
    #       identifier: ca.test.mappings.deliveryAddress.add.streetAddress
    #   - sleep:
    #       duration: 3000
      # Accept location permission pop up if displayed
    #   - if:
    #       identifier:
    #         present:
    #           - identifier: ca.test.mappings.deliveryAddress.add.allowLocationPermission
    #       then:
    #         - click:
    #             identifier: ca.test.mappings.deliveryAddress.add.allowLocationPermission
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.streetAddress
          string: ${streetAddress}
          pressEnter: true
      - click: 
          identifier: ca.test.mappings.streetadress.option   
      - sleep:
          duration: 3000
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.city
          string: ${city}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.province
          string: ${state}
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.zipcode
          string: ${zipcode}
      - click: 
          identifier: ca.test.mapping.checkout.keyboard
      - enterText:
          identifier: ca.test.mappings.deliveryAddress.add.phoneNumber
          string: ${phoneNumber}
      - click: 
          identifier: ca.test.mapping.checkout.keyboard
      - click:
          identifier: ca.test.mappings.deliveryAddress.add.saveButton
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.deliveryAddress.confirmSuggestion
          then:
            - click:
                identifier: ca.test.mappings.deliveryAddress.confirmSuggestion
      - sleep:
          duration: 3000
      - click: 
          identifier: ca.mappings.tabBar.shop

 #add address from Home
  - name: ca.test.functions.pdp.validateAddressHome
    platform: ios
    flow:
      - sleep:
          duration: 1000
      - verifyIdentifier:
          present:
            - identifier: ca.mappings.tabBar.shop
      - click: 
          identifier: ca.mappings.tabBar.shop
      - if:
          identifier:
            present:
              - identifier: GlobalIntentCenter.BannerCollapsedChevron
          then:
            - click:
                identifier: GlobalIntentCenter.BannerCollapsedChevron
      - sleep:
          duration: 5000
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: //XCUIElementTypeButton[@name="Delivery.  . , 2 of 2"] | //XCUIElementTypeButton[@name="Delivery.  . selected, 2 of 2"]
      - click:
          identifier: //XCUIElementTypeButton[@name="Delivery.  . , 2 of 2"] | //XCUIElementTypeButton[@name="Delivery.  . selected, 2 of 2"]        
      - sleep:
         duration: 5000
      - verifyIdentifier:
          label:
            - identifier: ca.test.mappings.gicHome.delivery.address
              equals: ${Address} 
      - click:
          identifier: GlobalIntentCenter.BannerExpandedChevron
