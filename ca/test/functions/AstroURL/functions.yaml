functions:

  - name: ca.test.functions.astro.createAccount
    platform: android
    flow:
      - log: 
          message: Create Account
          color: GREEN_BOLD
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/customer
          requestMethod: POST
          wait: 5000
          header:
            - key: Content-Type
              value: application/json
            - key: market
              value: ca
          readTimeout: 30000 
          requestBody: ${payLoad}
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - '"astroStatus":"SUCCESS"'
          retriesOnFail: 5
          retryDelay: 2000
      - log: 
          message: "--------------------Account created successfully--------------------"
          color: GREEN_BOLD
      - sleep:
          duration: 20000

  - name: ca.test.functions.astro.clearCart
    flow:
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/customer/${custEmail}/clearcart
          requestMethod: DELETE
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
          wait: 10000
          verifyResponseBodyContains:
            - 'SUCCESS'
          verifyResponseCode: 200
          retriesOnFail: 5
          retryDelay: 2000
        
  - name: ca.test.functions.astro.placeOrder.S2H
    flow:
      - log: Create an order
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/order
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
          readTimeout: 60000
          requestMethod: POST
          requestBody: ${payLoad}
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - '"astroStatus":"SUCCESS"'
          getValue:
            - key: astroDetails.orderDetails.orderId
              storeIn: orderNo
            - key: astroDetails.orderDetails.orderPriceInfo.subTotal
              storeIn: subTotalAstro
            - key: astroDetails.orderDetails.orderPriceInfo.taxTotal
              storeIn: totalTax
            - key: astroDetails.orderDetails.orderPriceInfo.total
              storeIn: estimate_total
          retriesOnFail: 5
          retryDelay: 5000
      - log: ${orderNo}
      - log: ${subTotalAstro}
      - log: ${totalTax}
      - log: ${estimate_total}
      - sleep:
          duration: 15000
      - log: "Order created successful"

  - name: ca.test.functions.astro.placeOrder.scheduledPickup
    flow:
      - log: Create an order
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/order
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
          readTimeout: 60000
          requestMethod: POST
          requestBody: ${payLoad}
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - '"astroStatus":"SUCCESS"'
          getValue:
            - key: astroDetails.orderDetails.orderId
              storeIn: orderNo
            - key: astroDetails.orderDetails.orderPriceInfo.subTotal
              storeIn: subTotalAstro
            - key: astroDetails.orderDetails.orderPriceInfo.taxTotal
              storeIn: totalTax
            - key: astroDetails.orderDetails.orderPriceInfo.total
              storeIn: estimate_total
          retriesOnFail: 5
          retryDelay: 5000
      - log: ${orderNo}
      - log: ${subTotalAstro}
      - log: ${totalTax}
      - log: ${estimate_total}
      - sleep:
          duration: 15000
      - log: "Order created successful"

  - name: ca.test.functions.astro.moveOrder
    flow:
      - log: Move Order Api Called
      - callAPI:
          url: http://astro.walmart.com/api/v3/teflon/order/${orderNo}
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
          readTimeout: 60000
          requestMethod: PUT
          requestBody: ${astroBody}
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - 'SUCCESS'
          retriesOnFail: 5
          retryDelay: 5000
      - sleep:
          duration: 15000
      - log: Order Moved Successfully

############################################################################## IOS ##############################################################################

  - name: ca.test.functions.astro.placeOrder.GO
    flow:
      - log: Create an order
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/order
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
          readTimeout: 60000
          requestMethod: POST
          requestBody: '{"customerEmailAddress": "${email}", "password": "${password}", "storeId": 5540, "fulfillmentGroups": [{"orderType": "SCHEDULED_PICKUP", "items": [{"offerId": "206002", "skuId": "206002", "quantity": 3}, {"offerId": "206498", "skuId": "206498", "quantity": 6}]}], "paymentMethod": ["VISA"]}'
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - '"astroStatus":"SUCCESS"'
          getValue:
            - key: astroDetails.orderDetails.orderId
              storeIn: orderNo
            - key: astroDetails.orderDetails.orderPriceInfo.subTotal
              storeIn: subTotalAstro
            - key: astroDetails.orderDetails.orderPriceInfo.taxTotal
              storeIn: totalTax
            - key: astroDetails.orderDetails.orderPriceInfo.total
              storeIn: estimate_total
          retriesOnFail: 5
          retryDelay: 5000
      - log: ${orderNo}
      - log: ${subTotalAstro}
      - log: ${totalTax}
      - log: ${estimate_total}
      - sleep:
          duration: 10000
      - log: "Order created successful"
      - sleep:
          duration: 10000

  - name: ca.test.functions.astro.createAccount
    platform: ios
    flow:
      - log: 
          message: Create Account
          color: GREEN_BOLD
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/customer
          requestMethod: POST
          wait: 5000
          header:
            - key: Content-Type
              value: application/json
            - key: market
              value: ca
          readTimeout: 30000 
          requestBody: ${payLoad}
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - '"astroStatus":"SUCCESS"'
          retriesOnFail: 5
          retryDelay: 2000
      - log: 
          message: Account created successfully
          color: GREEN_BOLD
      - sleep:
          duration: 20000

  - name: ca.test.functions.astro.promoCode
    flow:
      - log: 
          message: Promo Code Api Called
          color: GREEN_BOLD
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/customer?promo=${promoCode}
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
          readTimeout: 60000
          requestMethod: PUT
          requestBody: '{"customerEmailAddress": "${email}","password": "${password}"}'
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - 'SUCCESS'
          retriesOnFail: 5
          retryDelay: 5000
      - sleep:
          duration: 15000
      - log: Promo Code Successfully Applied

  - name: ca.test.functions.astro.addToCart
    flow:
      - log: 
          message: Product add to cart started.
          color: GREEN_BOLD
      - callAPI:
          url: http://astro.walmart.com/api/v2/teflon/item/transactability
          header:
            - key: market
              value: ca
            - key: Content-Type
              value: application/json
            - key: Cookie
              value: DYN_USER_ID=a659e6e3-6756-4c26-acdc-214cb68d8a43 
          readTimeout: 60000
          requestMethod: POST
          requestBody: ${payLoad}
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - 'SUCCESS'
          retriesOnFail: 5
          retryDelay: 5000
      - sleep:
          duration: 15000
      - log: 
          message: Product added to cart
          color: GREEN_BOLD

  - name: ca.test.functions.astroUrl.addBalance
    flow:
      - log: 
          message: Call API to add balance to Gift Card.
          color: GREEN_BOLD
      - callAPI:
          url: https://stg1.paymentservices.walmart.com/paymentservices/kuber/v1/paycards/${pihash}/addbalance
          header:
            - key: WM_TENANT_ID
              value: "1"
            - key: WM_VERTICAL_ID
              value: "0"
            - key: WM.SRV.LOCALEID
              value: "eng_CAN"
            - key: WM_SVC.VERSION
              value: "1.1.0"
            - key: WM_SVC.ENV
              value: "stg"
            - key: WM_SVC.NAME
              value: "paymentservices"
            - key: WM.SRV.DEVICEID
              value: "walmart.ca"
            - key: WM_QOS.CORRELATION_ID
              value: "100110011001"
            - key: WM_CONSUMER.ID
              value: "1aa40068-1921-418e-84e3-ed752ddf4cde"
            - key: Content-Type
              value: "application/json"
            - key: WM_PMID
              value: FDCGC
          readTimeout: 60000
          requestMethod: POST
          requestBody: '{"instrument" : {"pmid" : "FDCGC", "pihash" : "${pihash}"}, "clientreqid" : "${timestamp}", "addamount" : {"currencyAmount" : ${gcAmount}, "currencyUnit" : "CAD"}}'
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - 'SUCCESS'
          retriesOnFail: 5
          retryDelay: 5000
      - sleep:
          duration: 15000
      - log: 
          message: Gift card balance added successful.
          color: GREEN_BOLD

  - name: ca.test.functions.astroUrl.checkBalance
    flow:
      - log:
          message: Calling API to check gift card balance.
          color: GREEN_BOLD
      - callAPI:
          url: https://stg1.paymentservices.walmart.com/paymentservices/kuber/v1/paycards/${pihash}/balance
          header:
            - key: WM_TENANT_ID
              value: "1"
            - key: WM_VERTICAL_ID
              value: "0"
            - key: WM.SRV.LOCALEID
              value: "eng_CAN"
            - key: WM_SVC.VERSION
              value: "1.1.0"
            - key: WM_SVC.ENV
              value: "stg"
            - key: WM_SVC.NAME
              value: "paymentservices"
            - key: WM.SRV.DEVICEID
              value: "walmart.ca"
            - key: WM_QOS.CORRELATION_ID
              value: "100110011001"
            - key: WM_CONSUMER.ID
              value: "1aa40068-1921-418e-84e3-ed752ddf4cde"
            - key: Content-Type
              value: "application/json"
            - key: WM_PMID
              value: FDCGC
          readTimeout: 60000
          requestMethod: GET
          wait: 10000
          verifyResponseCode: 200
          verifyResponseBodyContains:
            - 'SUCCESS'
          getValue:
            - key: balanceamount.currencyAmount
              storeIn: balance
          retriesOnFail: 5
          retryDelay: 5000
      - sleep:
          duration: 15000


# Order cancellation api
# Required params: Order ID
  - name: ca.test.functions.oms.orderCancellation
    flow:
      - try:
          flow:
            - log: 
                message: Call API to cancel order.
                color: GREEN_BOLD
            - if:
                condition: ${orderId} == null
                then:
                  - log:
                      message: "No order Id generated."
                      color: GREEN_BOLD
                else:
                  - callAPI:
                      url: http://ca-comsrs-stg.walmart.com/smcfs/order/cancelOrder
                      header:
                        - key: Accept
                          value: "application/json"
                        - key: Accept-Encoding
                          value: "gzip, deflate"
                        - key: Cache-Control
                          value: "no-cache"
                        - key: Content-Type
                          value: "application/json"
                        - key: Cookie
                          value: "NSC_mc-89035662-1-682398003=14b5a3d9922af01db9c92036ce78feafe2e9a108fb66ae9898e30413d3fa445795a5ff55"
                        - key: Host
                          value: "ca-comsrs-stg.walmart.com"
                        - key: Postman-Token
                          value: "366c67c2-c004-4187-9c12-0a8b96c19212,c63703e1-573b-4bfb-97c5-074f116ba208"
                        - key: User-Agent
                          value: "PostmanRuntime/7.20.1"
                        - key: WM_CONSUMER.ID
                          value: API_GW_CID
                        - key: WM_CONSUMER.TENANT_ID
                          value: "1"
                        - key: WM_QOS.CORRELATION_ID
                          value: ca-cca-app
                        - key: WM_SVC.ENV
                          value: "qa"
                        - key: WM_SVC.NAME
                          value: order-service
                        - key: WM_SVC.VERSION
                          value: 6.0.0
                        - key: cache-control
                          value: no-cache
                      readTimeout: 60000
                      requestMethod: POST
                      requestBody: '{"payload": {"order": {"orderNo": "${orderId}","entryType": "CCA","auditTransactionId":"cca-cancel-${orderId}-2636gfdlfjhabjkljkgfdgfhgf","notes": [{"enteredBy": "Abcccdeg","noteText": "Cancellation","reasonCode": "Product code","reasonDescription": "Product Description"}]}}}'
                      wait: 10000
                      verifyResponseCode: 200
                      retriesOnFail: 10
                      retryDelay: 5000
                  - sleep:
                      duration: 15000
                  - log: 
                      message: Order cancelled.
                      color: GREEN_BOLD
          catch:
            flow:
              - log:
                  message: "No order Id generated."
                  color: GREEN_BOLD

  - name: ca.test.functions.astroUrl.createGiftCard
    flow:
      # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp
      - log: 
          message: Call API to creating gift card.
          color: GREEN_BOLD
      - callAPI:
          url: https://stg2-ext.paymentservices.walmart.com/paymentservices/kuber/v1/paycards
          header:
            - key: WM_TENANT_ID
              value: "1"
            - key: WM_VERTICAL_ID
              value: "0"
            - key: WM.SRV.LOCALEID
              value: "eng_CAN"
            - key: WM_SVC.VERSION
              value: "1.1.0"
            - key: WM_SVC.ENV
              value: "stg"
            - key: WM_SVC.NAME
              value: "paymentservices"
            - key: WM.SRV.DEVICEID
              value: "walmart.ca"
            - key: WM_QOS.CORRELATION_ID
              value: "100110011001"
            - key: WM_CONSUMER.ID
              value: "1aa40068-1921-418e-84e3-ed752ddf4cde"
            - key: Content-Type
              value: "application/json"
            - key: WM_PMID
              value: "FDCGC"
          readTimeout: 60000
          requestMethod: PUT
          requestBody: '{"clientreqid": "9d5534f2-2221-4244-${timestamp}", "pmid": "FDCGC", "startbalance": {"currencyAmount": ${giftCardAmount},"currencyUnit": "CAD"}}'
          wait: 10000
          verifyResponseCode: 200
          retriesOnFail: 10
          retryDelay: 5000
          getValue:
            - key: account
              storeIn: giftCardNumber
            - key: pin
              storeIn: giftCardPin
      - log: 
          message: Gift Card Created.
          color: GREEN_BOLD