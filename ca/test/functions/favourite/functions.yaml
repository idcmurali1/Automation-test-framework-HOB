functions:
################################################################## Android #####################################################################      
# Function to create items from Carousel to fav list
  - name: ca.test.functions.home.addToFavFromCarousel
    flow:
      - if:
          condition: ${page} == 'carousel'
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.home.carouselProductAddToCartUsingContDesc
                then:
                  - sleep:
                      duration: 2000
                  - executeFunction:
                      name: ca.test.functions.utils.scrollToView
                      params:
                        - name: scrollContainer
                          string: ${scrollContainer}
                        - name: untilIdentifier
                          string: ca.test.mappings.home.carouselProductAddToCartUsingContDesc
                        - name: searchDirection
                          string: right
                  - log:
                      message: "--------------------Scrolling to right--------------------"
                      color: GREEN_BOLD
                  - verifyIdentifier:
                      present:
                        - identifier: ca.test.mappings.favourite.productName
            - if:
                condition: ${page} == 'SRP'
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: ca.test.mappings.srpPage.productTileListView
                      then:
                        - scroll:
                            direction: down
                            untilIdentifier: ca.test.mappings.srpPage.productTileListView
                            position: center
      - loop:
          begin: 1
          end: 5
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: ca.test.mappings.srpPage.removeProductFromFavourites
                then:
                  - log: "Product are already in favourites, removing from favourites"
                  - click:
                      identifier: ca.test.mappings.srpPage.removeProductFromFavourites
                  - sleep:
                      duration: 2000
                  - if:
                      identifier:
                        present:
                          - identifier: ca.test.mappings.srpPage.addProductToFavourites
                      then:
                        - log: 
                            message: "Product removed from favourites."
                            color: GREEN_BOLD
                        - break: true
      - if:
          identifier:
            notPresent: 
              - identifier: ca.test.mappings.srpPage.addProductToFavourites
          then:
            - failTest:
                message: Product is not removed from favourites
      - loop:
          begin: 1
          end: 5
          mode: increment
          flow:
            - click:
                identifier: ca.test.mappings.srpPage.addProductToFavourites
            - if:
                identifier:
                  present:
                    - identifier: ca.test.mappings.srpPage.removeProductFromFavourites
                then:
                  - log:
                      message: "Product added to favourites."
                      color: GREEN_BOLD
                  - break: true
      - if:
          identifier:
            notPresent: 
              - identifier: ca.test.mappings.srpPage.removeProductFromFavourites
          then:
            - failTest:
                message: Product not added to favourites

# Favourite page validation
  - name: ca.test.functions.myItems.validateFavPage
    platform: android
    flow:
      - scroll:
          direction: up
      - click:
          identifier: ca.test.mappings.tabBar.MyItems
      - click:
          identifier: ca.test.mappings.myItems.favouriteTab                 
      - verifyIdentifier:
          timeout: 10000
          present: 
            - identifier: ca.test.mappings.myItems.reOrderTab  
            - identifier: ca.test.mappings.myItems.favouriteTab           
            - identifier: ca.test.mappings.myItems.estimateText 
            - identifier: ca.test.mappings.myItems.addAllToCartButton  
            - identifier: ca.test.mappings.myItems.estimateTotal 
            - identifier: ca.test.mappings.myItems.itemCount
            - identifier: ca.test.mappings.myItems.removelink  
            - identifier: ca.test.mappings.myItems.needDropDown  
            - identifier: ca.test.mappings.myItems.addToCartButton 

# Add to Cart from Favourite page
# Estimated Total price validation commented for now  CAPREPURCH-189
  - name: ca.test.functions.myItems.favouriteAddToCart
    platform: android
    flow:
      - storeIn:
          key: need
          value: "1"
      - storeIn:
          key: quantity
          value: "1"
      - verifyIdentifier:
          present:
            # - identifier: ca.test.mappings.srpPage.productTileListView
            - identifier: ca.test.mappings.favourites.productPrice
            - identifier: ca.test.mappings.favourites.pricePerQuantity
            - identifier: ca.test.mappings.favourites.need
            - identifier: ca.test.mappings.favourites.removebutton
            - identifier: ca.test.mappings.favourites.addToCartButton
      - click:
          identifier: ca.test.mappings.favourites.addToCartButton
      - log:
          message: "Product added to cart from favourites."
          color: GREEN_BOLD
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: ca.test.mappings.amendOrder.qtydecrease
            - identifier: ca.test.mappings.global.productQtyPlus
            - identifier: ca.test.mappings.global.addToCartText
      - if:
          condition: ${quantity} > 1
          then:
            - log:
                message: "Updating product quantity to ${quantity}."
                color: GREEN_BOLD
            - loop:
                begin: 1
                end: ${quantity}
                mode: increment
                storeIndex: x
                flow:
                  - log:
                      message: "Increasing product quantity."
                      color: GREEN_BOLD
                  - click:
                      identifier: ca.test.mappings.global.productQtyPlus
                  - arithmetic:
                      expression: $x + 1
                      storeIn: y
                  - verifyIdentifier:
                      text:
                        - identifier: ca.test.mappings.global.addToCartText
                          equals: $y
                  - log:
                      message: "$y quantity of ${productName} added to cart."
                      color: GREEN_BOLD
      - if:
          condition: $need > 1
          then:
            - log: 
                message: "Updating need"
                color: GREEN_BOLD
            - getString:
                identifier: ca.test.mappings.myItems.estimateTotal
                attribute: text
                storeIn: value
            - executeNode:
                file: ca/test/helpers/sanitizePrice.js
                args:
                  - value: ${value}
                getResponse:
                  storeIn: value
            - click:
                identifier: ca.test.mappings.favourites.needDropdown
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.favourites.needQty
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: ca.test.mappings.favourites.needQty
                      withinIdentifier: ca.test.mappings.favourites.qtyContainBox
            - click:
                identifier: ca.test.mappings.favourites.needQty
            # - verifyIdentifier:
            #     timeout: 15000
            #     present:
            #       - identifier: ca.test.mappings.favouritesButtonPopUpMessage
            - log:
                message: "Need updated sucessfully"
                color: GREEN_BOLD
            - getString:
                identifier: ca.test.mappings.favourites.pricePerQuantity
                attribute: text
                storeIn: perQuantityPrice            
            - executeNode:
                file: ca/test/helpers/sanitizePrice.js
                args:
                  - value: ${perQuantityPrice}
                getResponse:
                  storeIn: perQuantityPrice 
            - arithmetic:
                expression: $value + (${perQuantityPrice} * ($need - 1))
                storeIn: z
            - verifyIdentifier:
                text:
                  - identifier: ca.test.mappings.myItems.estimateTotal
                    contains: $$z
            - log:
                message: Estimate total is updated
                color: GREEN_BOLD

# Add to Cart from Favourite page
  - name: ca.test.functions.myItems.favouriteAddToCart
    platform: ios
    flow:
      - if:
          condition: ${need} == null
          then:
            - storeIn:
                key: need
                value: 1
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.favourites.productTileListView
            - identifier: ca.test.mappings.favourites.need
            - identifier: ca.test.mappings.favourites.removebutton
            - identifier: ca.test.mappings.favourites.addToCartButton
      - log: ${need}
      - if:
          condition: ${need} > 1
          then:
            - log:
                message: "Updating need to ${quantity}."
                color: GREEN_BOLD
            - log:
                message: "Increasing product quantity."
                color: GREEN_BOLD
            - click:
                identifier: ca.test.mappings.favourites.needButton
            - enterText:
                string: 2
                identifier: ca.test.mappings.favourites.needButtonPickerWheel
            - click:
                identifier: Done
            - sleep:
                duration: 5000
      - click:
          identifier: ca.test.mappings.favourites.addToCartButton
      - log:
          message: "Product added to cart from favourites."
          color: GREEN_BOLD
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: ca.test.mappings.favourites.addToCartText
      # - verifyIdentifier:
      #     label:
      #       - identifier: ca.test.mappings.favourites.addToCartButton
      #         contains: ${need}
      - log:
          message: "${need} quantity of ${productName} added to cart."
          color: GREEN_BOLD

  - name: ca.test.functions.myItems.validatingFavouritesPage
    flow:
      - sleep:
          duration: 10000
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.myItems.estimateTotal
            - identifier: ca.test.mappings.myItems.estimateTotalText
            - identifier: ca.test.mappings.myItems.itemsCount
      - arithmetic:
          expression: ${productCount}
          storeIn: count
      - if:
          condition: ${count} > 1
          then:
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.myItems.addAllToCartButton
      - try:
          flow:
            - verifyIdentifier:
                text:
                  - identifier: ca.test.mappings.myItems.estimateTotal
                    contains: ${estimateTotalFav}
                  - identifier: ca.test.mappings.myItems.itemsCount
                    equals: ${productCount}
          catch:
            flow:
              - verifyIdentifier:
                  label:
                    - identifier: ca.test.mappings.myItems.estimateTotal
                      contains: ${estimateTotalFav}
                    - identifier: ca.test.mappings.myItems.itemsCount
                      equals: ${productCount}

  - name: ca.test.functions.myItems.validatingFavouritesPage
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.myItems.estimateTotal
            - identifier: ca.test.mappings.myItems.estimateTotalText
            - identifier: ca.test.mappings.myItems.addAllToCartButton
            - identifier: ca.test.mappings.myItems.itemsCount
      - if:
          condition: ${count} > 1
          then:
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.myItems.addAllToCartButton
      - verifyIdentifier:
         present:
           - identifier: ca.test.mappings.myItems.estimateTotal
      - verifyIdentifier:
          text:
            - identifier: ca.test.mappings.myItems.estimateTotal
              contains: ${estimateTotalFav}
            - identifier: ca.test.mappings.myItems.itemsCount
              equals: ${productCount}                    
    
  - name: ca.test.functions.myItems.addAllItemsToCart
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.myItems.addAllToCartButton
      - click:
          identifier: ca.test.mappings.myItems.addAllToCartButton
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: ca.test.mappings.myItems.addToCartBanner

#Function to add to fav from SRP
  - name: ca.test.functions.myItems.addItemToFavFromSRP
    platform: android
    flow:
      - verifyIdentifier:
          present:
              - identifier: ca.test.mappings.favourite.productName
              - identifier: ca.test.mappings.Fav_Icon_Product_1
      - click:
          identifier: ca.test.mappings.Fav_Icon_Product_1
      - if:
          identifier:
            present:
                - identifier: ca.test.mappings.productAddedToFavouritePopUpMessage
          then:
            - log:
                message: "Product added to favourites."
                color: GREEN_BOLD
            - break: true
          else:
            - getString:
                identifier: ca.test.mappings.favouritesButtonPopUpMessage
                attribute: text
                storeIn: errorMessage
            - log: ${errorMessage}



  - name: ca.test.functions.srp.addingToFavourites
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.srpPage.productName
            - identifier: ca.test.mappings.srpPage.productAddToFavourite
      - click:
          identifier: ca.test.mappings.srpPage.productAddToFavourite
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.srpPage.removeProductFromFavourites

# Function to validate Guest user validation for favourite
  - name: ca.test.functions.home.guestUserValidation
    platform: android
    flow:
      - scroll:
          direction: up
      - click:
          identifier: ca.test.mappings.tabBar.MyItems
      - click:
          identifier: ca.test.mappings.myItems.reOrderTab                 
      - verifyIdentifier:
          timeout: 3000
          present: 
            - identifier: ca.test.mappings.myItems.signInButton # ca.walmart.ecommerceapp.qa:id/tempo_shared_default_messaging_button  
      - click:
          identifier: ca.test.mappings.myItems.signInButton  
      - verifyIdentifier:
          present: 
            - identifier: ca.test.mappings.global.authentication.emailField
      - click:
          identifier: ca.test.mappings.global.backButton                   
      - click:
          identifier: ca.test.mappings.myItems.favouriteTab       
      - verifyIdentifier:
          text:
            - identifier: ca.test.mappings.myItems.favouriteTab.guestMessage # ca.walmart.ecommerceapp.qa:id/lists_empty_title
              contains: "This list is lonely"

      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.srpPage.productName
            - identifier: ca.test.mappings.srpPage.productAddToFavourite
      - click:
          identifier: ca.test.mappings.srpPage.productAddToFavourite
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.srpPage.removeProductFromFavourites            

#Function to add to fav from PDP
  - name: ca.test.functions.myItems.addItemToFavFromPDP
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.favourite.pdpTilePage
          then:
            - sleep:
                duration: 2000
      - verifyIdentifier:
          present:
              - identifier: ca.test.mappings.favourite.pdpTilePage
              - identifier: ca.test.mappings.srpPage.productAddToFavourite
      - click:
          identifier: ca.test.mappings.srpPage.productAddToFavourite 

################################################################## IOS #####################################################################             

# Function to create items from Carousel to fav list
  - name: ca.test.functions.myItems.addItemFavPageIos
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.Fav_Icon_Product_1 #ca.test.mappings.Fav_Icon_Product_1_Selected
          then:
            - sleep:
                duration: 2000
            - scroll:
                direction: right
                position: center
                untilIdentifier: ca.test.mappings.Fav_Icon_Product_1 #ca.test.mappings.Fav_Icon_Product_1_Selected
            - click:
                identifier: ca.test.mappings.Fav_Icon_Product_1
          else:
            - click:
                identifier: ca.test.mappings.Fav_Icon_Product_1

# Function to validate Favourite page Validation
  - name: ca.test.functions.home.headerElements.validateFavPageIos
    platform: ios 
    flow:
      - scroll:
          direction: up
      - click:
          identifier: ca.test.mappings.tabBar.MyItems
      - click:
          identifier: ca.test.mappings.myItems.favouriteTab                 
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: ca.test.mappings.myItems.reOrderTab   
            - identifier: ca.test.mappings.myItems.favouriteTab  
            # - identifier: ca.test.mappings.myItems.estimateText
            # - identifier: ca.test.mappings.myItems.estimateTotal
            - identifier: ca.test.mappings.myItems.itemCount 
            # - identifier: ca.test.mappings.myItems.addToCartAllItems 

# Product validation in favourite page
  - name: ca.test.functions.myItems.favouriteProductIos 
    platform: ios
    flow:
      - storeIn:
          key: quantity
          value: "1"
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.srpPage.productTileListView
            # - identifier: ca.test.mappings.favourites.productPrice
            # - identifier: ca.test.mappings.favourites.pricePerQuantity
            - identifier: ca.test.mappings.myItems.needText 
            - identifier: ca.test.mappings.myItems.removelink  
            - identifier: ca.test.mappings.myItems.addToCart
      - click:
          identifier: ca.test.mappings.myItems.addToCart 
      - log:
          message: "Product added to cart from favourites."
          color: GREEN_BOLD

#Function to add to fav from PDP
  - name: ca.test.functions.myItems.addItemToFavFromPDP
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.favourite.productNameTitle
          then:
            - sleep:
                duration: 2000
      - verifyIdentifier:
          present:
              - identifier: ca.test.mappings.favourite.productNameTitle
              - identifier: ca.test.mappings.srpPage.addProductToFavourites
      - click:
          identifier: ca.test.mappings.srpPage.addProductToFavourites
      # - if:
      #     identifier:
      #       present:
      #           - identifier: ca.test.mappings.productAddedToFavouritePopUpMessage
      #     then:
      #       - log:
      #           message: "Product added to favourites."
      #           color: GREEN_BOLD
      #       - break: true
      #     else:
      #       - getString:
      #           identifier: ca.test.mappings.favouritesButtonPopUpMessage
      #           attribute: text
      #           storeIn: errorMessage
      #       - log: ${errorMessage}


# Product validation in favourite page
  - name: ca.test.functions.myItems.favouriteProductPage
    platform: ios
    flow:
      - storeIn:
          key: quantity
          value: "1"
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.srpPage.productTileListView
            # - identifier: ca.test.mappings.favourites.productPrice
            # - identifier: ca.test.mappings.favourites.pricePerQuantity
            - identifier: ca.test.mappings.myItems.needText 
            - identifier: ca.test.mappings.myItems.removelink  
            - identifier: ca.test.mappings.myItems.addToCart

# add all to cart from fav Page
  - name: ca.test.functions.myItems.allAddToCart
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.favourite.addAllToCartBtn
      - click:
          identifier: ca.test.mappings.favourite.addAllToCartBtn
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.fav.successmsg
          then:
            - click:
                identifier: ca.test.mappings.favourite.addAllToCartBtn

# navigate to fav page via account
  - name: ca.test.functions.account.navigateFavPage
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.tabBar.account
      - click:
          identifier: ca.test.mappings.tabBar.account
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.account.MyItems
          then:
            - scroll:
                direction: down
                untilIdentifier: ca.test.mappings.account.MyItems
      - click: 
          identifier: ca.test.mappings.account.MyItems
      - verifyIdentifier:
          present:
              - identifier: ca.test.mappings.account.favourites
      - click: 
          identifier: ca.test.mappings.account.favourites

 
 
 # remove products from fav
  - name: ca.test.functions.account.removeFromFavPage
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.tabBar.MyItems
      - click:
          identifier: ca.test.mappings.tabBar.MyItems
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.account.favourites
      - click:
          identifier: ca.test.mappings.account.favourites
      - sleep:
          duration: 500
      - loop:
          begin: 1
          end: 3
          mode: increment
          flow:
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.favourites.noFavProducts
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: ca.test.mappings.myItems.removelink
                  - click:
                     identifier: ca.test.mappings.myItems.removelink
                  # - verifyIdentifier:
                  #     present:
                  #       - identifier: ca.test.mappings.favourites.removebutton
                  # - click:
                  #    identifier: ca.test.mappings.favourites.removebutton   
                  - if:
                      identifier:
                        notPresent:
                          - identifier: ca.test.mappings.favourites.removebutton_oos
                      then:
                        - sleep:
                            duration: 500
                        - verifyIdentifier:
                            present:
                              - identifier: ca.test.mappings.favourites.removebutton
                        - click:
                            identifier: ca.test.mappings.favourites.removebutton
                      else:
                        - verifyIdentifier:
                            present:
                              - identifier: ca.test.mappings.favourites.removebutton_oos
                        - click:
                            identifier: ca.test.mappings.favourites.removebutton_oos
                        - sleep:
                            duration: 500
      - click:
          identifier: ca.test.mappings.tabBar.shop

#Function to add to fav from SRP
  - name: ca.test.functions.myItems.addItemToFavFromSRP
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: ca.test.mappings.srp.productTile
          then:
            - sleep:
                duration: 2000
      - verifyIdentifier:
          present:
              - identifier: ca.test.mappings.srp.productTile
              - identifier: ca.test.mappings.Fav_Icon_SRP # ca.test.mappings.Fav_Icon_Product_1
      - click:
          identifier: ca.test.mappings.Fav_Icon_SRP # ca.test.mappings.Fav_Icon_Product_1
      - sleep:
          duration: 1000
# add products from fav
  - name: ca.test.functions.account.addOneFromFavPage
    platform: ios
    flow:
      # - loop:
      #     begin: 1
      #     end: 3
      #     mode: increment
      #     flow:
            - if:
                identifier:
                  notPresent:
                    - identifier: ca.test.mappings.favourites.noFavProducts
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: ca.test.mappings.favourite.addCartBtnFavPage
                  - click:
                     identifier: ca.test.mappings.favourite.addCartBtnFavPage
                  - sleep:
                     duration: 500

# click Shop button
  - name: ca.test.functions.account.naviagteToShop
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.tabBar.shop
      - click:
          identifier: ca.test.mappings.tabBar.shop

# validate Fav page as guest user
  - name: ca.test.functions.favourite.GuestUserValidation
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: ca.test.mappings.tabBar.MyItems
          then:
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.tabBar.MyItems
            - click:
                identifier: ca.test.mappings.tabBar.MyItems
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.myItems.reOrderTab
            - click:
                identifier: ca.test.mappings.myItems.reOrderTab
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.myItems.favouriteTab
                  - identifier: ca.test.mappings.accout.ReorderPageWelcomeText
                  - identifier: ca.test.mappings.accout.ReorderPageSigninText
                  - identifier: ca.test.mapping.seeTimes.signInseetimes
            - click:
                identifier: ca.test.mapping.seeTimes.signInseetimes 
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.signIn.signInTtitle
                  - identifier: ca.test.mappings.signIn.crossSympol
            - click:
                identifier: ca.test.mappings.signIn.crossSympol
            - click:
               identifier: ca.test.mappings.tabBar.MyItems
            - click:
                identifier: ca.test.mappings.myItems.favouriteTab
            - sleep:
                duration: 500
            - verifyIdentifier:
                present:
                  - identifier: ca.test.mappings.favourites.noFavProducts
                  - identifier: ca.test.mappings.favourite.text
          else:
            - sleep:
                duration: 500
            - executeFunction:
                name: ca.test.functions.favourite.GuestUserValidation

  - name: ca.test.functions.favouritePage.removeItem
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.favouritesPage.removeButton
      - click:
          identifier: ca.test.mappings.favouritesPage.removeButton
      - verifyIdentifier:
          present:
            - identifier: ca.test.mappings.favourites.removeItem
            - identifier: ca.test.mappings.favourites.deleteItem
      - click:
          identifier: ca.test.mappings.favourites.deleteItemConfirmation
      - verifyIdentifier:
          notPresent:
            - identifier: ca.test.mappings.cart.verifyProductTitle