#-------------------------------------------------------------------------------------------------------------------
# TC: 005
# UserType: Registered user
# Flow : Onboard -> Search GM -> A2C -> Login -> XO
# Fulfillment: Shipping
# A2C Experience: Search
#-------------------------------------------------------------------------------------------------------------------
general:
  testCaseId: TC-005
  tags: wcp-005 #p1-mx-ea-teflon, p1-bodega-ea-teflon

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: Exclusivos online

      - executeFunction:
          name: functions.global.tapAccountBtn

      - executeFunction:
          name: functions.accountPage.tapSignInBtn

      # - executeFunction:
      #     name: functions.login.createUserAccount

      - executeFunction: # TODO: temporary workaround until OTP Astro issue used for Create Account is fixed...
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: teflon-wcp-005-b@walmart.com
            - name: userPassword
              string: Walmart$123
            # Old Data Used (kept as comments in case required):
            # - name: userEmail
            #   string: teflon-wcp-001@walmart.com
            # - name: userPassword
            #   string: Walmart$123

      - executeFunction:
          name: functions.global.tapShopBtn

      - executeFunction:
          name: functions.cartPage.clearCart

      - executeFunction:
          name: functions.searchField.enterText
          params:
            - name: searchText
              string: 'Oven'

      # Verify item displayed
      - executeFunction:
          name: functions.searchResultPage.verifySearchResultsDisplayed

      - executeFunction:
          name: functions.searchResultPage.verifyInternationalSellerTagDisplayed

      - executeFunction:
          name: functions.searchResultPage.validateFiltersOnSearchResultsPage
          params:
            - name: filter
              string: brand

      - executeFunction:
          name: functions.searchResultPage.validateFiltersOnSearchResultsPage
          params:
            - name: filter
              string: price

      - executeFunction:
          name: functions.searchResultPage.validateFiltersOnSearchResultsPage
          params:
            - name: filter
              string: general

      - executeFunction:
          name: functions.searchResultPage.validatePriceSlider

      - executeFunction:
          name: functions.searchResultPage.addFirstAvailableProductToCart

      - executeFunction:
          name: functions.global.tapCartIcon

      - executeFunction:
          name: functions.cartPage.scrollToTopOfCart

      - executeFunction:
          name: functions.cartPage.validateItemDetails

      - executeFunction:
          name: functions.cartPage.verifyAddressList

      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn
      
      - executeFunction:
          name: functions.checkoutPage.selectPaymentMethod

      - sleep:
          duration: 10000
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - storeIn:
          key: testStatus
          value: passed
  #After Scenarios
  - name: After
    after: true
    flow:
      - log:
          message: flow-005
          color: GREEN_BOLD