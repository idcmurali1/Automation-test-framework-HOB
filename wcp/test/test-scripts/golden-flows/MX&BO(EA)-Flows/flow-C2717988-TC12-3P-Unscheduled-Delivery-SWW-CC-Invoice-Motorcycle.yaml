# ================================================================================================================================
# TC: 12
# Flow: TC 12 : Payment Information: CC  +  Delivery (3P - Motorcycle  (SWW) , S2H) + Invoice
# ================================================================================================================================

general:
  testCaseId: C2717988
  tags: C2717988, p1-mx-ea-prod, p1-bodega-ea-prod, p1-mx-mh-e2e-prod, p1-mx-mh-e2e-teflon

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:   
    #Account used:
    # prodwcp+6@gmail.com/prodwcp+2@gmail.com/prodwcp+12@gmail.com/prodwcp+13@gmail.com
    # The above account has invoice information
      - if: 
          condition: ${platform} == 'Android'
          then:
            - storeIn:
                key: userEmail
                value: data.wcp012.android.email
      - if: 
          condition: ${platform} == 'iOS'
          then:
            - storeIn:
                key: userEmail
                value: data.wcp012.ios.email

      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore

      - executeFunction:
          name: functions.global.tapAccountBtn
      
      - executeFunction:
          name: functions.accountPage.tapSignInBtn

      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: data.global.password.Password1

      - executeFunction:
          name: functions.global.tapShopBtn
      - executeFunction:
          name: functions.cartPage.clearCart

      - executeFunction:
          name: functions.searchPage.addToCartUsingItemArray
          params:
            - name: productArray
              string: data.tc12.MotorCycle3P

      - executeFunction:
          name: functions.global.tapCartIcon

      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn

      - executeFunction:
          name: functions.addAddressBottomSheet.handleSelectAddressPopUp
          params:
            - name: invoiceColoniaName
              string: data.defaultAddress.coloniaName

      - executeFunction:
          name: functions.checkoutPage.assertPageLoaded   

     #Validate invoice request message pop out
     #For Android, we need to click on "Place Order" button to trigger the error message pop-up.
      - if:
            condition: ${platform} == 'Android'
            then:
                - executeFunction:
                    name: functions.checkoutPage.tapPlaceOrderButton

      - executeFunction:
          name: functions.checkoutPage.validateInvoiceDisplayed

      - executeFunction:
          name: functions.checkoutPage.validateErrorWithoutInvoice
          
      - executeFunction:
          name: functions.checkoutPage.selectInvoice

      - executeFunction:
          name: functions.checkoutPage.selectExistingInvoiceFromSheet
          params:
            - name: validateInvioceName
              string: "true"

     #Validate invoice request message is not showing any more
      - executeFunction:
          name: functions.checkoutPage.validateNoInvoiceRequest
      
      - executeFunction:
          name: functions.checkoutPage.validateSelectedInvoiceTaxPayerInformation
      
      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: functions.utils.after
