# ================================================================================================================================
# TC: 013
# Flow: TC-013: 3P SOS with internatinal tag with validation for SFL and move to cart functionality
#               Payment Information: Master CC
# ================================================================================================================================

general: 
  testCaseId: C2720136
  tags: C2720136, p1-mx-ea-prod, p1-bodega-ea-prod, p1-mx-mh-e2e-teflon, p1-mx-mh-e2e-prod

scenarios: 

  - name: Before
    before: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main 
    flow: 

      - if: 
          condition: ${platform} == 'Android'
          then:
            - storeIn:
                key: userEmail
                value: data.wcp013.android.email
      - if: 
          condition: ${platform} == 'iOS'
          then:
            - storeIn:
                key: userEmail
                value: data.wcp013.ios.email

      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore

      - executeFunction:
          name: functions.global.tapAccountBtn
      
      - executeFunction:
          name: functions.accountPage.tapSignInBtn

      # Log in
      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: data.global.password.Password1

      # Tap shop button
      - executeFunction: 
          name: functions.global.tapShopBtn
      
      # Clear cart
      - executeFunction:
          name: functions.cartPage.clearCart

      # Get the first available item and add into cart
      - executeFunction:
          name: functions.searchPage.addToCartUsingItemArrayList-GetProductDetails
          params:
            - name: productArray
              string: data.global.3PSOSwithInternationalTagItems

      # Verify International Tag
      - executeFunction:
          name: functions.searchResultsPage.verifyInternationalTag

      # Navigating to cart.
      - executeFunction:
          name: functions.global.tapCartIcon
      - executeFunction:
          name: functions.cartPage.scrollToTopOfCart    

      # Validating item details in cart
      - executeFunction:
          name: functions.cartPage.validateItemDetails

      # Moving item from cart to save for later.
      - executeFunction:
          name: functions.cartPage.moveAndVerifyProductMoveToSFL
          params:
            - name: productName
              string: ${productName}

      # Moving item to cart from save for later.
      - executeFunction:
          name: functions.cartPage.moveAndValidateProductToCartFromSFL
          params:
            - name: productName
              string: ${productName}

      # Validating money box
      - executeFunction:
          name: functions.cartPage.validateMoneybox

      # Navigating to checkout.
      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn

      # Handling select address popup.
      - executeFunction:
          name: functions.addAddressBottomSheet.handleSelectAddressPopUp
          params:
            - name: invoiceColoniaName
              string: data.defaultAddress.coloniaName
      # CheckOut Page

      - executeFunction:
          name: functions.checkoutPage.validateItemDetails
      # # Transaction & Post-Transaction validation on Teflon
      # - if:
      #     condition: ${environment} == 'Teflon'
      #     then:
      #       - executeFunction:
      #           name: functions.checkoutPage.scrollToCVVTextfield

      #       - executeFunction:
      #           name: functions.checkoutPage.addCVV
      #           params:
      #             - name: CVV
      #               string: data.global.card.cvv.123
          
      #       #Click Place Order
      #       - executeFunction:
      #           name: functions.checkoutPage.tapPlaceOrderButton

# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#       - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      # - if:
      #     condition: ${environment} == 'Teflon'
      #     then:
      #       - executeFunction:
      #           name: functions.thankYouPage.verifyThankYouPageDisplayed

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: functions.utils.after