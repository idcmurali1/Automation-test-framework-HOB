general:
  testCaseId: C2728491
  tags: C2728491,wcp-011, p1-ca-en-teflon,p1-ca-en-prod

scenarios:
  - name: Before
    before: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:

      # Navigate to HomePage and validate HomePage is Loaded
      - executeFunction: 
          name: functions.onboardingToHomePage.usingPostalCode 
          params: 
            - name: PostalCode 
              string: data.onboarding.userPostalCode

      - executeFunction:
          name: functions.login.storeEmail
          params:
            - name: userAndroidEmail
              string: data.wcp011.user.email.android
            - name: useriOSEmail
              string: data.wcp011.user.email.ios
      
      # Select ON Province address from GIC[Pending]

      # Click on Login and Select Sign in or create account
      # Login with an existing user and ensure user is logged in
      - executeFunction:
          name: functions.global.tapAccountBtn
      - executeFunction:
          name: functions.accountPage.tapSignInBtn
      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: data.global.password.Password
      - executeFunction:
          name: functions.global.tapShopBtn
      - executeFunction:
          name: functions.cartPage.clearCart

      # Search for a Charity and 1P item(subtotal should be more than 199$) 
      # validate if search results are displayed..
      # Validate Item Page experience with sales financing details
     
      - executeFunction:
          name: functions.utils.getTheFirstAvailableItemAndNavigateToPDPWithDeepLink
          params:
            - name: productArray
              string: data.wcp.1PItems.salesFinacningItemsArray

      
      - executeFunction:
           name: functions.productDetailsPage.verifyFinancingOptions

      - executeFunction:
          name: functions.productDetailsPage.tapClose

      # Navigate to cart and ensure items are added to cart and correct total is displayed.
      - executeFunction:
          name: functions.global.tapCartIcon
   # Validate cart Page experience with sales financing details
      - executeFunction:
          name: functions.cartPage.verifyFinancingOptions

    # Select intent as delivery from store[Pending]
      # Select ON Province address from cart page[Pending]
      

      # Navigate to ROP and validate
      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn

      # Navigate to ROP and validate fulfilment header.
      
      - if:
          condition: ${environment} == 'Teflon'
          then:
            # Select financing option(Walmart rewards cart)
            - executeFunction:
                name: functions.checkoutPage.selectSalesFinancingOptions

            # Click Place Order
            - executeFunction:
                name: functions.checkoutPage.tapPlaceOrderButton


# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#       - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      
            # Order Confirmation Page
            # Validate Thank You page Header
            - executeFunction:
                  name: functions.thankYouPage.verifyThankYouPageDisplayed

            - executeFunction:
                name: functions.utils.terminateApp

            # Validate if cart has become empty after placing Order.[Pending]

            # Navigate to ODP
            - executeFunction:
                name: functions.global.navigateToODPUseDeeplink

            # Validate the user is able to access ODP
            - executeFunction:
                name: functions.orderDetailPage.verifySectionDisplayed

            # TODO: This function needs an update for handling Digital delivery.
            # # Validate correct items are displayed[Pending]
            # # Validate Delivery and Payment information(Sales Financing) are displayed.
            # - executeFunction:
            #     name: functions.orderDetailPage.verifyDeliveryType
            #     params:
            #       - name: expectedDeliveryType
            #         string: data.global.deliveryText.delivery
            
            - executeFunction:
                name: functions.orderDetailPage.verifyCardPayment
                params:
                  - name: expectedCardLastFourDigit
                    string: data.global.creditCard.wmc.5551.last4DigitsOnly
                  - name: isSalesFinancingApplied
                    string: true

      # Validate Delivery and Payment information(Sales Financing) are displayed[Pending]

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: functions.utils.after