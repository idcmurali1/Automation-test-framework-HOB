general:
  testCaseId: C2728489
  tags: wcp-003,p1-ca-en-teflon

scenarios:

  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

  - name: Main
    flow:

     # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
     # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      # Onboarding
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore

    # Create account through astro
      - executeFunction:
          name: functions.astroApi.createNewAccountWithCreatePayload
      
      # Sign in
      - executeFunction:
          name: functions.global.tapAccountBtn
      - executeFunction:
          name: functions.accountPage.tapSignInBtn

      - executeFunction: 
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: ${password}
 
      - executeFunction:
          name: functions.global.tapAccountBtn
      
      # Enroll in trial membership
      - executeFunction:
          name: functions.walmartDeliveryPass.startTrialMembership
      
      # Cancel the subscription
      - executeFunction:
          name: functions.walmartDeliveryPass.cancelDeliveryPassMembership
      
      # Renew the membership
      - executeFunction:
          name: functions.walmartDeliveryPass.renewDeliveryPassMembership

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: functions.utils.after