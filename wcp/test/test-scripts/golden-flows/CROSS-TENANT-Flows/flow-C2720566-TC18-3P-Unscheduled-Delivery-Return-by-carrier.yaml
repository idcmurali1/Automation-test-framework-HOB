# ================================================================================================================================
# TC: 018
# Flow: TC-018: Items:  3P  Return by Carrier
# ================================================================================================================================
general:
  testCaseId: C2720566
  tags: C2720566, p1-mx-ea-teflon, p1-bodega-ea-teflon, p1-ca-en-teflon, p1-mx-mh-e2e-teflon
  combineScenarios: true

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:


      # Create account using astro api.
      - log:
          message: PREREQUISITE — Creating user account using Astro API...
          color: GREEN_BOLD
      - executeFunction:
          name: functions.astroApi.createNewAccountWithCreatePayload
          params:
            - name: paymentMethod
              string: data.default.astroAPI.createAccount.paymentMethod.CCVisa 


      # Create  3P order using astro api.
      - log:
          message: PREREQUISITE — Creating  3P order using Astro API...
          color: GREEN_BOLD
      - executeFunction:
          name: functions.astroApi.createOrder
          params:
            - name: emailId
              string: ${userEmail}
            - name: payload
              string: data.tc026.createOrderPayload

    # Move 3p item using astro api
      - log:
          message: PREREQUISITE — Move 3P item using Astro API...
          color: GREEN_BOLD
      - executeFunction:
          name: functions.astroApi.moveOrder
          params:
            - name: orderId
              string: ${returnedOrderNumber}
            - name: payload
              string: data.noveOrder.mpDelivery


      # Onboard to aplication and select EA options.
      - log:
          message: "Onboard to the application and select EA option... "
          color: GREEN_BOLD
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore


      # Click on login and select sign in.
      - log:
          message: "Click on Login and Select Sign in..."
          color: GREEN_BOLD
      - executeFunction:
          name: functions.global.tapAccountBtn
      - executeFunction:
          name: functions.accountPage.tapSignInBtn

      - log:
          message: PREREQUISITE — Return order using Astro API...
          color: GREEN_BOLD
      - executeFunction:
          name: functions.astroApi.returnOrder
          params:
            - name: orderId
              string: ${returnedOrderNumber}
            - name: payload
              string: data.returnOrder.tc18.3PReturnPayload

      # Login with existing user.
      - log:
          message: "Login with existing user and ensure user is logged in..."
          color: GREEN_BOLD
      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: ${password}

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      # Initiate return for eligible items.
      - log:
          message: "For both items initiate return..."
          color: GREEN_BOLD
      - executeFunction:
          name: functions.accountPage.tapPurchaseHistory
      - executeFunction:
          name: functions.orderHistoryPage.validateOrderCardBasedOnOrderId
          params:
            - name: orderId
              string: ${returnedOrderNumber}
      - executeFunction:
          name: functions.orderHistoryPage.tapOnViewOrderDetailsBtn
          params:
            - name: orderId
              string: ${returnedOrderNumber}
              
      - executeFunction:
          name:  functions.orderDetailPage.validateReturnInprogressMsg
      # - executeFunction:
      #     name: functions.orderDetailsPage.deliveryReturnbyCarrier

      
      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    flow:
      - executeFunction:
          name: functions.utils.after