 #================================================================================================================================
# TC: C2736708
# Flow: Digital Item Checkout
# ================================================================================================================================
general:
  testCaseId: C2736708
  tags:  p1-ca-en-teflon, p1-ca-en-prod , p1-us-en-prod , C2736708
  combineScenarios: true

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:

      - executeFunction:
          name: functions.utils.setMarketInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:

      # Onboarding&Sign in
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
      
      - executeFunction:
          name: functions.global.tapAccountBtn

      - executeFunction:
          name: functions.accountPage.tapSignInBtn

      - if:
         condition: ${platform} == 'Android'
         then:
           - storeIn:
               key: userEmail
               value: data.wcpDigital.android.email
      - if:
          condition: ${platform} == 'iOS'
          then:
            - storeIn:
                key: userEmail
                value: data.wcpDigital.iOS.email

      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: data.global.password.PasswordDigital   

      # Navigate to home page
      - executeFunction:
          name: functions.global.tapShopBtn

      - executeFunction:
          name: functions.cartPage.clearCart

      #Add 1 item into cart / Add 1 item into cart from PDP multiseller page (2 item added on production, 1 item added on teflon)
      # - if:
      #     condition: ${environment} == 'Production'
      #     then:
      #       - if:
      #           condition: ${market} == 'US' # US market select shipping intent to skip reserving time
      #           then:
      #             - executeFunction:
      #                 name: functions.global.gic.selectShippingIntent
      #                 params:
      #                   - name: page
      #                     string: 'home'
      #       - executeFunction:
      #           name: functions.searchPage.getTheFirstAvailableItemAndNavigateToPDP
      #           params:
      #             - name: productArray
      #               string: data.wcp.DigitalItem

      #       - executeFunction:
      #           name: functions.productDetailsPage.tapAddToCart

      - executeFunction:
          name: functions.searchPage.getTheFirstAvailableItemAndNavigateToPDP
          params:
            - name: productArray
              string: data.wcp.DigitalItem

      - executeFunction:
          name: functions.productDetailsPage.tapAddToCart
      - executeFunction:
          name: functions.productDetailsPage.validateDigitalItem

      - executeFunction:
          name: functions.productDetailsPage.tapClose

      - executeFunction:
          name: functions.global.tapCartIcon

      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn

      - executeFunction:
          name: functions.checkoutPage.storeValueToExpectedFulfillmentTypeAsDigitalDelivery

      - executeFunction:
          name: functions.checkout.validateFufillmentType 

      - executeFunction:
          name: functions.checkoutPage.ValidateDigitalDeliveryInRop

      - executeFunction:
          name: functions.checkoutPage.walletPopup.tapCloseBtn

      - if:
          condition: ${environment} == 'Teflon'
          then:

            - executeFunction:
                name: functions.checkoutPage.addCVV
                params:
                  - name: CVV
                    string: data.global.card.cvv.123

            - executeFunction:
                name: functions.checkoutPage.enterPhoneNumber

            - executeFunction:
                name: functions.checkoutPage.tapPlaceOrderButton

            - if:
                condition: ${platform} == 'iOS'
                then:
                  - executeFunction:
                      name: functions.thankYouPage.notRatingApp

            - executeFunction:
                name: functions.thankYouPage.getOrderNumber

            - executeFunction:
                name: functions.global.navigateToODPUseDeeplink

      - storeIn:
          key: testStatus
          value: passed

  #After Scenarios
  - name: After
    after: true
    executeOnFailure: false
    flow:
      - executeFunction:
          name: functions.utils.after
              



