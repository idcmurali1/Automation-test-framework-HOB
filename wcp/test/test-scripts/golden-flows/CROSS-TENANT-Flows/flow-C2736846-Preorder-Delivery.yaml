general:
  testCaseId: C2736846
  tags: wcp-preorder, p1-us-prod, p1-ca-en-prod, p1-ca-fr-prod, C2736846

scenarios:

  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: functions.utils.setMarketInfo

  - name: Main
    flow:

     # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
     # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      # Onboarding
      - executeFunction:
          name: functions.onboardingToHomePage.usingPostalCode
          params:
            - name: PostalCode
              string: data.onboarding.userPostalCode
            - name: ShoppingExperience
              string: data.onboarding.onlineExclusiveStore
      
      # Sign in
      - executeFunction:
          name: functions.global.tapAccountBtn
      - executeFunction:
          name: functions.accountPage.tapSignInBtn
      - if:
          condition: ${platform} == 'Android'
          then:
            - storeIn:
                key: userEmail
                value: data.wcp.preorder.android.email
          else:
            - storeIn:
                key: userEmail
                value: data.wcp.preorder.ios.email

      - executeFunction:
          name: functions.loginPage.userAuthentication
          params:
            - name: userEmail
              string: ${userEmail}
            - name: userPassword
              string: data.global.password.Password

      - executeFunction:
          name: functions.global.tapShopBtn

      - executeFunction:
          name: functions.cartPage.clearCart

      - executeFunction:
          name: functions.searchPage.getTheFirstAvailableItemAndNavigateToPDP
          params:
            - name: productArray
              string: data.globalShared_preOrder
            - name: badges
              string: 'PO'

      - executeFunction:
          name: functions.productDetailsPage.validatePreOrderCta

      - executeFunction:
          name: functions.productDetailsPage.tapAddToCart

      - executeFunction:
          name: functions.productDetailsPage.tapClose

      - executeFunction:
          name: functions.global.tapCartIcon

      - executeFunction:
          name: functions.cartPage.validatePreorderLabelIsDisplayed 

      - executeFunction:
          name: functions.cartPage.tapContinueToCheckoutBtn

      - executeFunction:
          name: functions.checkoutPage.tapViewDetailsBtn

      - executeFunction:
          name: functions.checkoutPage.itemDetails.validateArrivalDateIsDisplayed

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: functions.utils.after