functions:

#--------------------------------------------------------------------------------------------------------------------
  
  # Description: This function verify item count
  # params:      [itemCount]   Verify product quantity add to cart.
  - name: functions.productDetailsPage.verifyItemCount
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: productDetailsPage.itemCount
              contains: ${itemCount}
      - log:
          message: "End functions: productDetailsPage.verifyItemCount"
          color: BLUE

#--------------------------------------------------------------------------------------------------------------------

  # Description: Validate tag in product details page.
  # Params:      ${itemBadge}   Validate badges in the PDP.
  - name: functions.productDetailsPage.validateBadge
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: productDetailsPage.badgeLabel
              contains: ${itemBadge}
      - log:
          message: "End functions: productDetailsPage.validateBadge"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: Clicks on Address Button
  # No params
  - name: functions.productDetailsPage.tapAddressBtn
    flow:
      - scroll:
          direction: down
          untilIdentifier: productDetailsPage.marketplaceReturnInfo
          position: center
      - loop:
          begin: 0
          end: 5
          mode: increment
          storeIndex: i
          flow:
            - arithmetic:
                expression: 20 * ${i}
                storeIn: coordinates
            - click:
                identifier: productDetailsPage.addressBtn
                coordinates: ${coordinates}% ,95%
            - if:
                identifier:
                  present:
                    - identifier: selectAddressPage.title
                then:
                  - break: true
      - log:
          message: "End functions: productDetailsPage.tapAddressBtn"
          color: BLUE 

  #-----------------------------------------------------------------------------------------------------------------
  
  # Description: This function validates delivery address in product details page.
  # Params:      ${streetAddress}
  # Works for:   [ MX [✓]   MX-Bodega [✓]   US [__] ]
  - name: functions.productDetailsPage.verifyDeliveryAddress
    platform: android
    flow:
      - log:
          message: Expected Delivery address - "${streetAddress}".
          color: CYAN
      - try:
          flow:
            - verifyIdentifier:
                text:
                  - identifier: productDetailsPage.addressBtn
                    contains: ${streetAddress}
          catch:
            flow:
              - getString:
                  identifier: productDetailsPage.addressBtn
                  attribute: text
                  storeIn: returnedAddress
              - failTest:
                  message: Returned Delivery address - "${returnedAddress}".
      - log:
          message: "End functions: productDetailsPage.verifyDeliveryAddress"
          color: BLUE

 

#--------------------------------------------------------------------------------------------------------------------

  # Description: Get product name for product added to cart
  # No Params
  - name: functions.productDetailsPage.getProductName
    platform: android
    flow:
      - getString:
          identifier: productDetailsPage.productName
          storeIn: productName
          attribute: text
      - log: 
          message: "Product name added to cart: ${productName}"
          color: CYAN
      - log:
          message: "End Functions: productDetailsPage.getProductName"
          color: BLUE      
#--------------------------------------------------------------------------------------------------------------------
  # Description: This function helps in getting product price from product details page.
  # No params
  - name: functions.productDetailsPage.getProductPrice
    platform: android
    flow:
      - log:
          message: Getting product price...
          color: GREEN_BOLD
      - getString:
          identifier: productDetailsPage.productPrice
          storeIn: productPrice
          attribute: text
      - log: 
          message: "Current product price: ${productPrice}"
          color: GREEN_BOLD
      - executeNode:
          file: wcp/test/helpers/Price/cleanPrice.js
          args:
            - value: ${productPrice}
          getResponse:
            storeIn: sanitizedPrice
      - log:
          message: "Sanitized produce price: ${sanitizedPrice}"
          color: GREEN_BOLD
      - log:
          message: "End functions: productDetailsPage.getProductPrice"
          color: BLUE  
  #--------------------------------------------------------------------------------------------------------------------          
 
  # Description: This function helps in getting product quantity from product details page.
  # No params
  - name: functions.productDetailsPage.getProductQuantity
    platform: android
    flow:
      - log:
          message: Getting product quantity...
          color: GREEN_BOLD
      - getString:
          identifier: productDetailsPage.itemCount
          storeIn: itemCount
          attribute: text
      - log: 
          message: "Current product quantity: ${itemCount}"
          color: GREEN_BOLD
      - executeNode:
          file: wcp/test/helpers/productPage/extractItemQuantity.js
          args:
            - value: ${itemCount}
          getResponse:
            storeIn: productQuantity    
      - storeIn:
         key: cartItemCount
         value: ${productQuantity}
      - log:
          message: "Sanitized produce quantity: ${productQuantity}"
          color: GREEN_BOLD
      - log:
          message: "End functions: productDetailsPage.getProductQuantity"
          color: BLUE  
  #--------------------------------------------------------------------------------------------------------------------            

  # Description: This function is used to add maximum quantity of an item to cart
  # No param 
  - name: functions.productDetailsPage.addMaxQuantityItemToCart
    platform: android
    doWhile: true
    flow:
      - verifyIdentifier:
          enabled:
          - identifier: productDetailsPage.incrementButton
            value: true
          timeout: 10000
      - click:
          identifier: productDetailsPage.incrementButton
          wait: 1000
      - log:
          message: "End Functions: productDetailsPage.addMaxQuantityItemToCart"
          color: BLUE
#--------------------------------------------------------------------------------------------------------------------                  
  
  # Description: This function is used to add assert that the product details are the expected ones. 
  # Params: 
  #     ${productName}  [Mandatory]  Expected product name to be displayed.
  #     ${productPrice}  [Mandatory]  Expected product price to be displayed.
  - name: functions.productDetailsPage.assertProductDetailsConsistency
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: productDetailsPage.productName
              contains: ${productName}
      - verifyIdentifier:
          text:
            - identifier: productDetailsPage.productPrice
              contains: ${productPrice}
      - log:
          message: "End function: functions.productDetailsPage.assertProductDetails"
          color: BLUE