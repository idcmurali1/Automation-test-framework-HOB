functions:

#--------------------------------------------------------------------------------------------------------------------

  # Description: Validate Notification page
  # No Params
  - name: functions.onboarding.validateOboardingPage
    platform: android
    flow: 
      - if:
          condition: ${market} == 'US'
          then:
            - verifyIdentifier:
                text:
                  - identifier: onboarding.welcomeToWalmartPg.welcomeSubtitle
                    equals: data.onboarding.welcomeToWalmartPg.welcomeSubtitle
      - if:
          condition: ${market} == 'MX'
          then:
            - verifyIdentifier:
                text:
                  - identifier: onboarding.welcomeToWalmartPg.welcomeSubtitle
                    equals: android.mx.data.onboarding.welcomeToWalmartPg.welcomeSubtitle
          else:
            - verifyIdentifier:
                text:
                  - identifier: onboarding.welcomeToWalmartPg.welcomeSubtitle
                    equals: data.onboarding.welcomeToWalmartPg.welcomeSubtitle
                  - identifier: onboarding.welcomeToWalmartPg.welcomeDisclaimer
                    equals: data.onboarding.welcomeToWalmartPg.welcomeDisclaimer
      - log:
          message: "End function: onboarding.validateOboardingPage"
          color: BLUE

#--------------------------------------------------------------------------------------------------------------------

  # Description: This function validate notification page
  # No Params
  - name: functions.onboarding.validateNotificationPage
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: onboarding.getNotification.title
            - identifier: onboarding.getNotification.allowBtn
            - identifier: onboarding.getNotification.maybeLaterBtn
          text:
            - identifier: onboarding.getNotification.notificationSubtitle
              equals: data.onboarding.getNotification.notificationSubtitle
      - log:
          message: "End function: onboarding.validateNotificationPage"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: Validate onboarding share location page & learn more link pop up
  # No Params
  - name: functions.onboarding.validateShareLocation$LearnMoreLink
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: onboarding.locationScreenText
            - identifier: onboarding.sharePreciseLocation
            - identifier: onboarding.enterZip$PostalCodeButton
      - getString:
          identifier: onboarding.shareLocation.subTitle
          attribute: text
          storeIn: subTitle
      - executeNode:
          file: wcp/test/helpers/compareTwoString.js
          args:
            - value: ${subTitle}
            - value: data.onboarding.shareLocation.subTitle
          getResponse:
            storeIn: result
      - if:
          condition: "!${result}"
          then:
            - failTest:
                message: "Share your location subtitle mismatch"
      - if:
          condition: ${market} == 'US' || ${market} == 'CA'
          then:
            - click:
                identifier: onboarding.shareLocation.learnNowLink
                coordinates: 80%,90%
            - verifyIdentifier:
                present:
                  - identifier: onboarding.shareLocation.learnNowLink.title
                  - identifier: onboarding.shareLocation.learnNowLink.description
            - click:
                identifier: global.closeBtn
      - log:
          message: "End function: onboarding.shareLocationPgValidation"
          color: BLUE
          
#--------------------------------------------------------------------------------------------------------------------
  
  # Description: This function validate share your postal code page
  # No Params
  - name: function.onboarding.validateShareYourPostalCodePage
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: onboarding.shareLocation.locationIcon
            - identifier: onboarding.sharePostalCode.title
            - identifier: onboarding.sharePostalCode.searchButton
            - identifier: onboarding.sharePostalCode.useCurrentLocationLink
          text:
            - identifier: onboarding.sharePostalCode.enterZip$PostalCodeText
              equals: data.onboarding.sharePostalCode.enterZip$PostalCodeText
            - identifier: onboarding.sharePostalCode.searchButton
              equals: data.onboarding.sharePostalCode.searchButton
            - identifier: onboarding.sharePostalCode.useCurrentLocationLink
              equals: data.onboarding.sharePostalCode.useCurrentLocationLink
      - if:
          condition: ${market} == 'MX'
          then:
            - verifyIdentifier:
                text:
                  - identifier: onboarding.shareLocation.title
                    equals: android.mx.data.onboarding.shareLocation.title
          else:
            - verifyIdentifier:
                text:
                  - identifier: onboarding.shareLocation.title
                    equals: data.onboarding.shareLocation.title
      - log:
          message: "End functions: onboarding.validateShareYourPostalCodePage"
          color: BLUE

#--------------------------------------------------------------------------------------------------------------------

  # Description: This function validate personalised experience page
  # No Params
  - name: functions.onboarding.validatePersonalisedExperienceScreen
    platform: android 
    flow:
      - if:
          condition: ${market} == 'CA'
          then:
            - verifyIdentifier:
                timeout: 30000
                present:
                  - identifier: onboarding.personalizedExperience
                text:
                  - identifier: onboarding.personalisedExperience.subTitle
                    equals: data.mappings.onboarding.personalisedExperience.subTitle
      - log:
          message: "End functions: onboarding.validatePersonalisedExperienceScreen"
          color: BLUE         

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function handles personalised experience by allowing it.
  # No Params
  - name: functions.onboarding.personalisedExperience.tapAllow
    platform: android
    flow:  
      - if:
          condition: ${market} == 'CA'
          then:
            - verifyIdentifier:
                timeout: 15000
                present:
                  - identifier: onboarding.personalizedExperience    
            - click:
                identifier: onboarding.personalizedExperienceAllowButton
      
      - log:
          message: "End function: onboarding.personalisedExperience.tapAllow"
          color: BLUE
  
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function handles personalised experience by allowing it.
  # No Params
  - name: functions.onboarding.sharePostalCode.validateErrorMsg
    flow:
      - verifyIdentifier:
          present:
            - identifier: onboarding.postalCodeErrorMsg
          text:
            - identifier: ca.test.mappings.onboarding.postalCodeErrorMsg
              equals: data.onboarding.sharePostalCode.invalidZip$PostalCodeErr
      - log:
          message: "End functions: onboarding.sharePostalCode.validateErrorMsg"
          color: BLUE

  #-----------------------------------------------------------------------------------------------------------

  # Description: Navigate to expo deep link for MX Market for WCP variation
  # Param  ${deepLinkUrl}  [Mandatory]  Expo link for WCP variation
  # Param  ${deeplinkMarketPrefix}  [Mandatory]  validating the deeplink prefix for specific market
  - name: functions.onboarding.navigation.goToDeepLink
    platform: android
    flow:
      - verifyValue:
            identifier: ${deepLinkUrl}
            contains: ${deeplinkMarketPrefix}
      - log: 
          message: "Market is ${market} and the deeplink contains ${deeplinkMarketPrefix} "
          color:  GREEN_BOLD
        # - openLink: ${deepLinkUrl}
      - executeAppiumScript:
              method: "mobile: deepLink"
              params:
                - key: url
                  value: ${deepLinkUrl}
                - key: package
                  value: ${appPackage}
      - log: 
          message: "End functions: functions.onboarding.navigation.goToDeepLink"
          color: BLUE


  #--------------------------------------------------------------------------------------------------------------------
  - name: functions.onboarding.enableMergeHallwaysExpo
    platform: android
    flow:
      - if:
          condition: ${environment} == 'Teflon'
          then:
            - sleep:
                duration: 5000
            - executeFunction:
                name: functions.debugPanel.changeEnvToTelfon
                params:
                  - name: debugPanel
                    string: debugPannel.deepLink
      - sleep:
          duration: 5000
      - executeFunction:
          name: functions.debugPanel.setExpoVariation
          params:
            - name: expoVariant
              string: data.onbording.expo.variation.vlaue
            - name: debugPanel
              string: walmartmx://debugPanel
      # relaunch app
      - sleep:
          duration: 5000
      - log: INFO | Re-launch APP ...
      - executeFunction:
          name: functions.utils.relaunchApp
      # validate gic is displayed and MH is setting properly 
      - sleep:
          duration: 15000
      - if:
          condition: ${environment} == 'Teflon'
          then:
            - log: INFO | Re-launch 2 APP ...
            - executeFunction:
                name: functions.utils.relaunchApp
            - sleep:
                duration: 15000
      - log:
          message: "End function: onboarding.enableMergeHallwaysExpo"
          color: BLUE