functions:

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function validates the slot is available or not
  # No params
  - name: functions.reserveATime.checkSlotAvailability
    flow:
      - storeIn:
          key: isSlotAvailable
          value: false
      - if:
          identifier:
            present:
              - identifier: reserveATime.firstSlot
            notPresent:
              - identifier: reserveATime.bookSlotDate.slotFullText
          then: 
            - storeIn:
                key: isSlotAvailable
                value: true
      - log:
          message: "End functions: reserveATime.checkSlotAvailability"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function verify selected slot on reshedule slot page
  # No params
  - name: functions.reserveATime.checkRescheduleSlotAvailability
    flow:
      - storeIn:
          key: isSlotAvailable
          value: false
      - if:
          identifier:
            notPresent:
              - identifier: reserveATime.bookSlotDate.Reschedule.Selectedslot
          then: 
            - storeIn:
                key: isSlotAvailable
                value: true
      - log:
          message: "End functions: reserveATime.checkSlotAvailability"
          color: BLUE
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function taps on pickup button in reserve a time page
  # No params
  - name: functions.reserveATime.tapPickupBtn
    flow:
      - click:
          identifier: reserveATime.pickupToggleBtn
      - sleep:
          duration: 5000
      - log:
          message: "End functions: reserveATime.tapPickupBtn"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function taps on delivery from store tab
  # No params
  - name: functions.reserveATime.tapDeliveryFromStoreBtn
    flow:
      - click:
          identifier: reserveATime.deliveryFromStoreToggleBtn
      - sleep:
          duration: 2000
      - log:
          message: "End functions: reserveATime.tapDeliveryFromStoreBtn"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function taps on first slot.
  # No params
  - name: functions.reserveATime.tapFirstSlotBtn
    flow:
      - click:
          identifier: reserveATime.firstSlot
      - if:
          condition: ${market} == 'US' 
          then:
            - executeFunction:
                name: functions.reserveATime.handleSlotNotAvailableError
      - log:
          message: "End functions: reserveATime.tapFirstSlotBtn"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function taps on date on which slot needs to be booked
  # No params
  - name: functions.reserveATime.tapBookSlotDateBtn
    flow:
      - click:
          identifier: reserveATime.bookSlotDate
      - sleep:
          duration: 2000
      - log:
          message: "End functions: reserveATime.tapBookSlotDateBtn"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function click on refresh link and update the selected slot
  # No params
  - name: functions.reserveATime.handleSlotNotAvailableError
    flow:
      - if:
          identifier:
            present:
              - identifier: reserveATime.slotNotAvailableError
          then:
            - click:
                identifier: reserveATime.slotNotAvailableError
            - click:
                identifier: reserveATime.firstSlot
      - log:
          message: "End functions: reserveATime.handleSlotNotAvailableError"
          color: BLUE
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function taps on reserve button in slot page
  # No params
  - name: functions.reserveATime.tapReserveBtn
    flow:
      - click:
          identifier: reserveATime.reserveBtn
      - log:
          message: "End functions: reserveATime.tapReserveBtn"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This functions check if the add address popup is displayed
  # No Param
  - name: functions.reserveATime.addAddressDisplayed
    flow:
      - storeIn:
          key: returnedIsDisplayed
          value: false
      - if: 
          identifier:
            present:
              - identifier: reserveATime.addAddressTitle
          then:
            - storeIn:
                key: returnedIsDisplayed
                value: true
            - log:
                message: "End function: reserveATime.addAddressDisplayed (Displayed)"
                color: BLUE
          else: 
            - log:
                message: "End function: reserveATime.addAddressDisplayed (Not displayed)"
                color: BLUE

  # ----------------------------------------------------------------------------------------------------------------          

  # Description: This method taps on add address button
  # No Param
  - name: functions.reserveATime.tapAddAddress
    flow:
      - click:
          identifier: reserveATime.addAddressButton
      - log:
          message: "End function: reserveATime.tapAddAddress"
          color: BLUE
  # ----------------------------------------------------------------------------------------------------------------

  # Description: This method taps on add address button
  # No Param
  - name: functions.reserveATime.selectFirstAddress
    flow:
      - click:
          identifier: reserveATime.selectFirstAddress
      - log:
          message: "End function: reserveATime.selectFirstAddress"
          color: BLUE
  # ----------------------------------------------------------------------------------------------------------------  

  # Description: This method taps on save add address button
  # No Param
  - name: functions.reserveATime.tapSaveAddress
    flow:
      - click:
          identifier: reserveATime.saveAddress
      - log:
          message: "End function: reserveATime.tapSaveAddress"
          color: BLUE
  # ----------------------------------------------------------------------------------------------------------------  

  # Description: This method validate select address bottom sheet
  # No Param
  - name: function.reserveATime.validateSelectAddressSheet
    flow:   
     - verifyIdentifier:
         present:
            - identifier: reserveATime.selectAddressTitle
            - identifier: reserveATime.selectFirstAddress
     - log:
        message: "End function: reserveATime.validateSelectAddressSheet "
        color: BLUE
  # ----------------------------------------------------------------------------------------------------------------             

  # Description: This method validate select address bottom sheet
  # No Param
  - name: functions.reserveATime.tapUnschedulePickupBtn
    flow:
      - if: 
          identifier:
            present:
              - identifier: reserveATime.unschedulePickupButton
          then:
            - click:
                identifier: reserveATime.unschedulePickupButton
      - log:
          message: "End function: reserveATime.tapUnschedulePickupBtn"
          color: BLUE
  
  # ----------------------------------------------------------------------------------------------------------

  # Description: This function taps on express slot
  # No params
  - name: functions.reserveATime.checkStandardExpressSlot
    flow:
      - storeIn:
          key: isStandardExpressSlotAvailable
          value: false
      - click:
          identifier: reserveATime.ExpressSlot
      - if:
          identifier:
            notPresent:
              - identifier: reseveSlot.instaCart.messageIcon
          then: 
              - storeIn:
                  key: isStandardExpressSlotAvailable
                  value: true
      - sleep:
          duration: 2000
      - log:
          message: "End functions: functions.reserveATime.checkStandardExpressSlot"
          color: BLUE

# ---------------------------------------------------------------------------------------------------------------

  # Description: This function checks if insta slot is displayed on book slot page
  # No params
  - name: functions.reserveATime.checkInstaSlotAvaliabilty
    flow:
        - if:
            identifier:
              present:
                - identifier: reserveSlot.instaCart.slot
            then:
              - click:
                  identifier: reserveSlot.instaCart.slot
              - verifyIdentifier:
                  present:
                    - identifier: reseveSlot.instaCart.messageIcon
              - log:
                  message: "End functions: functions.reserveATime.checkInstaSlotAvaliabilty"
                  color: BLUE

# ---------------------------------------------------------------------------------------------------------

  # Description: This function checks if express slot is displayed on book slot page
  # No params
  - name: functions.reserveATime.checkExpressSlotAvaliabilty
    flow:
      - sleep:
          duration: 5000
      - storeIn:
          key: isExpressSlotAvailable
          value: false
      - if:
          identifier:
            present:
              - identifier: reserveATime.firstExpressSlot
          then: 
            - storeIn:
                key: isExpressSlotAvailable
                value: true
          else:
            - log:
                message: "Express Slot identifier is not found"
      - log:
          message: "End functions: functions.reserveATime.checkExpressSlotAvaliabilty"
          color: BLUE

# ------------------------------------------------------------------------------------------------------

  # Description: This method validate no insta cart message at the bottom
  # No Param
  - name: function.reserveATime.validateInstaCartMsgIsNotDisplayed 
    flow:   
     - verifyIdentifier:
         notPresent:
           - identifier: reseveSlot.instaCart.messageIcon
     - log:
        message: "End function: function.reserveATime.validateInstaCartMsgIsNotDisplayed"
        color: BLUE

# ------------------------------------------------------------------------------------------------------

  # Description: This function clicks on the next day slots
  # No params
  - name: functions.reserveADay.selectDay.tomorrow
    flow:
      - click:
          identifier: reserveADay.selectDay.tomorrow
      - log:
          message: "End functions: reserveATime.tapFirstSlotBtn"
          color: BLUE

# ------------------------------------------------------------------------------------------------------
  # Description: Returns the name and full address selected stores it in the variable
  #              ${selectedAddressName} ${selectedFullAddress}
  - name: functions.reserveATime.getSelectedAddress
    flow:
      - getString:
          identifier: cartPage.reserveTimePage.storeName
          attribute: text
          storeIn: selectedAddressName
      - getString:
          identifier: cartPage.reserveTimePage.storeAddress
          attribute: text
          storeIn: selectedFullAddress
      - storeIn:
          key: returnedSelectedAddressName
          value: ${selectedAddressName}
      - storeIn:
          key: returnedFullAddress
          value: ${selectedFullAddress}
      - log:
          message: "End function: functions.reserveATime.getSelectedAddress"
          color: BLUE

# ------------------------------------------------------------------------------------------------------
  # Description: Returns the Day of the Selected Delivery Slot and saves it in the global variable 
  #              ${returnedSelectedDaySlot} in the following format:
  #              <Index_of_selected_button>, <Day>, <Date>
  #              (i.e. 1, Hoy, 6/12)
  - name: functions.reserveATime.getSelectedDaySlot
    flow:
      - getString:
          identifier: cartPage.reserveATime.selecteDaySlotDayLabel
          attribute: text
          storeIn: day
      - getString:
          identifier: cartPage.reserveATime.selecteDaySlotDateLabel
          attribute: text
          storeIn: date
      - loop:
            begin: 0
            end: 3
            storeIndex: i
            mode: increment
            flow:
               - if:
                  identifier:
                    present:
                      - identifier: cartPage.reserveATime.selectedDateSlot
                  then: 
                    - log: 
                        message: "Checked slot: ${i}, selected"
                        color: CYAN
                    - arithmetic:
                        expression: ${i} + 1
                        storeIn: index
                    - break: true
                  else:
                    - log: 
                        message: "Checked slot: ${i}, not selected"
                        color: CYAN
      - storeIn:
          key: returnedSelectedDaySlot
          value: ${index}, ${day}, ${date}
      - log:
          message: "End function: functions.reserveATime.getSelectedDaySlot (Delivery slot date got: ${returnedSelectedDaySlot})"
          color: BLUE
# -------------------------------------------------------------------------------------------------------------------- 

  # Description: Returns the Time of the Selected Delivery Slot and stores it in the variable ${returnedSelectedTimeSlot} 
  # Using the following format:(i.e. 4pm-5pm)
  - name: functions.reserveATime.getSelectedTimeSlot
    flow:
      - if:
          identifier:
            present:
              - identifier: cartPage.reserveATime.selectedTimeSlotTimeLabel12HourFormat
          then:
            - getString:
                identifier: cartPage.reserveATime.selectedTimeSlotTimeLabel12HourFormat
                storeIn: currentDisplayedLabel 
            - log: 
                message: "Label of selected time slot: ${currentDisplayedLabel}"
                color: CYAN
            - executeNode:
                file: wcp/test/helpers/checkoutPage/stringCleanerForDeliverySlotAssertion.js
                args:
                  - value: ${currentDisplayedLabel}
                getResponse:
                  storeIn: parsedTimeSlot
            - storeIn:
                  key: returnedSelectedTimeSlot
                  value: ${parsedTimeSlot}
          else:
            - if:
                identifier:
                  present:
                    - identifier: cartPage.reserveATime.selectedTimeSlotTimeLabel24HourFormat
                then:
                  - getString:
                      identifier: cartPage.reserveATime.selectedTimeSlotTimeLabel24HourFormat
                      storeIn: currentDisplayedLabel 
                  - log: 
                      message: "Label of selected time slot: ${currentDisplayedLabel}"
                      color: CYAN
                  - executeNode:
                      file: wcp/test/helpers/checkoutPage/formatTo12Hour.js
                      args:
                        - value: ${currentDisplayedLabel}
                      getResponse:
                        storeIn: parsedTimeSlot
                  - storeIn:
                        key: returnedSelectedTimeSlot
                        value: ${parsedTimeSlot}
                else:
                  - failTest:
                      message: "Couldn't find any time slots."
      - log:
          message: "End function: functions.reserveATime.getSelectedTimeSlot (Delivery slot time got: ${returnedSelectedTimeSlot})"
          color: BLUE
  
  # ------------------------------------------------------------------------------------------------------
  # Description: This method validate the complete reserve slot details message after select reserve slot.
  # No Param
  - name: function.reserveATime.assertCompleteSlotReserveLabelDisplayed 
    flow:   
     - verifyIdentifier:
         notPresent:
            - identifier: reserveATime.completeReserveSlotDetailsLabel
     - log:
        message: "End function: function.reserveATime.assertCompleteSlotReserveLabelDisplayed"
        color: BLUE
  
  # ------------------------------------------------------------------------------------------------------
  # Description: This method validate the confirmation black box message after reserve delivery slot.
  # No Param
  - name: function.reserveATime.assertDeliverySlotConfirmationBlackBoxMessage 
    flow:   
     - verifyIdentifier:
         notPresent:
           - identifier: reserveATime.confirmationDeliverySlotBlackBoxMessage
     - log:
        message: "End function: function.reserveATime.assertDeliverySlotConfirmationBlackBoxMessage"
        color: BLUE

  # ----------------------------------------------------------------------------------------------------------------
  # Description: This method taps on specific address button
  # No Param
  - name: functions.reserveATime.selectGivenAddress
    flow:
      - click:
          identifier: cartPage.addressList.specificAddress
      - log:
          message: "End function: reserveATime.selectGivenAddress"
          color: BLUE        

# -------------------------------------------------------------------------------------------------------------------- 

  # Description: This function update the delivery address and validate the address details on BAS.
  # Params:   ${expectedAddressName}  Expected delivery address name. 
  #           ${expectedFullAddress}  Expected delivery full address.
  - name: functions.reserveATime.updateDeliveryAddress
    flow:
      - executeFunction:
          name: functions.reserveATime.tabChangeAddressLink
      - executeFunction:
          name: function.reserveATime.validateSelectAddressSheet
      - executeFunction:
          name: functions.reserveATime.selectDeliveryAddress_getAddressDetails
          params:
            - name: radioBtnIndex
              string: "1"
      - executeFunction:
          name: functions.reserveATime.tapSaveAddress
      - executeFunction:
          name: functions.reserveATime.validateDeliveryAddress
      - log: 
          message: "End function: reserveATime.updateDeliveryAddress"
          color: BLUE


  #----------------------------------------------------------------------------------------------------------------

  # Description: This functions clicks on the change address link.
  # No Param
  - name: functions.reserveATime.tabChangeAddressLink
    flow:
      - click:
          identifier: reserveATime.changeAddressLink
      - log:
          message: "End function: reserveATime.tabChangeAddressLink"
          color: BLUE
  
  #----------------------------------------------------------------------------------------------------------------

  # Description: This functions validate free delivery text for dp members
  # No Param
  - name: functions.reserveATime.dpMember.freeDeliveryTextAboveThreshold
    flow:
      - verifyIdentifier:
          present:
            - identifier: reserveATime.deliveryFromStore.freeDeliveryWMembersLabel
      - log:
          message: "End function: reserveATime.dpMember.freeDeliveryTextAboveThreshold"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function selects specific slot in reserve a time page   # Changed slot since the first slots sometimes is reserved for higher risk and a popup regarding this is coming separetly.
  # No params
  - name: functions.reserveATime.tapSlotBtn
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: reserveATime.specificSlot
          then:
            - scroll:
                direction: down
                untilIdentifier: reserveATime.specificSlot
                position: center
                scrollLimit: 1
      - click:
          identifier: reserveATime.specificSlot
      - log:
          message: "End functions: reserveATime.tapSlotBtn"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------        
  # Description: This function check the Add Address popup is displayed or not, and if its displayed it will close the popup screen
  - name: functions.reserveAtime.closeAddAddresspopup.Ifdisplayed
    flow:
      - executeFunction:
          name: functions.reserveATime.addAddressDisplayed
      - if:
         condition: ${returnedIsDisplayed} == true
         then:
           - executeFunction:
               name: functions.reserveATime.closeAddAddresspopup

           - log:
              message: "Add Address popup closed"
         else:
           - log:
              message: "Add Address popup not dispalayed"
      - log:
          message: "End of function: functions.reserveAtime.closeAddAddresspopup.Ifdisplayed"
          color: BLUE
  
  #-------------------------------------------------------------------------------------------------------------------- 
  #Description: This function will close the Add Address popup screen in reserve A time page
  - name: functions.reserveATime.closeAddAddresspopup
    flow:
      - if:
          identifier:
            present:
              - identifier: reserveATime.AddAddresspopup.closebtn
          then:
            - click:
                identifier: reserveATime.AddAddresspopup.closebtn
      - log:
          message: "End of function: functions.reserveATime.closeAddAddresspopup"
          color: BLUE