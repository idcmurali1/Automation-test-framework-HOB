functions:

#--------------------------------------------------------------------------------------------------------------------

  # Description: This function validate shipping charge in review order page
  # No params
  - name: functions.checkoutPage.validateShippingCharge
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: checkoutPage.shippingChargeText
      - verifyIdentifier:
          present:
            - identifier: checkoutPage.shippingChargeText
            - identifier: checkoutPage.shippingChargeValue

      - getString:
          identifier: checkoutPage.shippingChargeValue
          attribute: text
          storeIn: productPrice
      - executeNode:
          file: wcp/test/helpers/Price/cleanPrice.js
          args:
            - value: ${productPrice}
          getResponse:
            storeIn: cleanProductPrice
      - storeIn:
          key: shippingChargeAmountcheckoutPage
          value: ${cleanProductPrice} 
      - log:
          message: Shipping charge is ${shippingChargeAmountcheckoutPage}
      - if:
          condition: ${shippingChargeAmountcheckoutPage} > 0 && ${shippingChargeAmountcheckoutPage} != 'Free'
          then:
            - log:
                message: Shipping charge is present
      - if:
          condition: ${shippingChargeAmountcheckoutPage} == ${shippingChargeAmountCartPage}
          then:
            - log:
                message: Shipping charge is same in cart and review order page
      - log:
          message: "End function: checkoutPage.validateShippingCharge"
          color: BLUE 

  #--------------------------------------------------------------------------------------------------------------------
  # Description: This function hide key board on checkout page
  # No param     
  - name: functions.checkout.hideKeyboard
    platform: android
    flow:
      - hideKeyboard: true
      - log:
          message: "End functions: checkout.hideKeyboard"
          color: BLUE 

  #-------------------------------------------------------------------------------------------------------------------- 
  # Description: This function check if the paypal is already added to the profile.
  # Params: No params
  - name: functions.checkoutPage.paymentMethod.isPaypalAlreadyAuthenticated
    flow:
      - storeIn:
          key: returnedIsDisplayed
          value: false
      - scroll:
          direction: down
          untilIdentifier: checkoutPage.walletSummary
          position: center
          timeout: 10000
          scrollLimit: 5
      - if:
          identifier:
            present:
              - identifier: checkoutPage.paymentMethod.payPalModule
          then:
            - storeIn:
                key: returnedIsDisplayed
                value: true
            - log:
                message: "Paypal is attached to the profile..."
                color: CYAN
          else:
            - log:
                message: "Paypal is not attached to the profile..."
                color: CYAN
      - log: 
          message: "End function: checkoutPage.paymentMethod.isPaypalAdded"
          color: BLUE

  #-------------------------------------------------------------------------------------------------------------------- 
  # Description: This function select the paypal if its already attached to the profile.
  # Params: No params
  - name: functions.checkoutPage.paymentMethod.selectAttachedPaypalPayment
    platform: android
    flow:
      - click:
          identifier: checkoutPage.paymentMethod.selectPaypal
      - click:
          identifier: checkOutPage.paypalPopUp.confirmButton
      - log:
          message: "End function: checkoutPage.paymentMethod.selectAttachedPaypalPayment"          
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------

  # Description: Validates MSI options displayed
  # No params
  - name: functions.checkoutPage.selectMsiOption
    platform: android
    flow:
      - click:
          identifier: checkoutPage.msiOptionBtn
      - sleep:
          duration: 500
      - log:
          message: "End function: functions.checkoutPage.selectMsiOption"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: This function selects MCI option in the checkout page
  # No param 
  - name: functions.checkoutPage.selectMCIoption
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: checkoutPage.MCIsection.header
            - identifier: checkoutPage.MCIsection.option
      - click:
          identifier: checkoutPage.msiOptionBtn
      - log:
          message: "End functions: checkoutPage.selectMCIoption"
          color: BLUE


#--------------------------------------------------------------------------------------------------------------------
 # Description: This function will be used to get the taxpayer's name displayed in the invoice section on the checkout page.
  # No Param
  - name: functions.checkoutPage.getSelectedInvoiceTaxPayerName
    platform: android
    flow:  
      - getString:
          identifier: checkoutpage.invoiceTaxPayerFullName
          attribute: text
          storeIn: displayedInvoiceTaxPayerFullName
      - log:
          message: "End function:  functions.checkoutPage.getSelectedInvoiceTaxPayerName; Get Name as: &{displayedInvoiceTaxPayerFullName}"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: This function verifies selected pickup store is displayed on checkout page
  # No param 
  - name: functions.checkoutPage.verifyPickupAddress
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: checkoutPage.fulfillmentAddressText
              contains: ${fulfillmentAddressText}
      - log:
          message: "End function: checkoutPage.verify.pickupAddress"
          color: BLUE
  #--------------------------------------------------------------------------------------------------------------------

  # Description: This function validates the MCI options displayed in the review order page.
  # No params
  - name: functions.checkoutPage.validateMciOptionsDisplayed
    platform: android
    flow:
      - executeFunction:
          name: functions.utils.scrollToElement
          params:
            - name: scrollToElement
              string: checkoutPage.invoiceCheckBox
      - verifyIdentifier:
          present:
          #  - identifier: checkOutPage.installmentLabel
            - identifier: checkOutPage.installmentItemsThumbnail
            - identifier: checkOutPage.installmentEligibleItemsCount
            - identifier: checkOutPage.installmentDetailsView
            - identifier: checkOutPage.installmentSelectorView
      - log: 
          message: "End function: checkoutPage.validateMciOptionsDisplayed"
          color: BLUE

#--------------------------------------------------------------------------------------------------------------------

  # Description: Asserts the fulfillment name in checkout.
  # Params:   ${returnedSelectedAddressName}  [Mandatory]  Expected Address Name.
  - name: functions.checkoutPage.assertFulfillmentAddressName
    platform: android  
    flow:
      - getString:
          identifier: checkoutPage.fulfillmentAddressText
          storeIn: displayedAddressName
      - if:
          condition: ${displayedAddressName} == ${returnedSelectedAddressName}
          then:
            - log:
                message: "Successful assertion for fulfillment name in checkout"
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Fulfillment name is not correctly displayed in checkout"
      - log:
          message: "End function: checkoutPage.assertFulfillmentAddressName"
          color: BLUE

#--------------------------------------------------------------------------------------------------------------------
  # Description: Asserts the fulfillment address in checkout.
  # Params:   ${displayedFulfillmentAddress}  [Mandatory]  Expected Fulfillment Address.
  - name: functions.checkoutPage.assertFulfillmentAddress
    platform: android  
    flow:
      - getString:
          identifier: checkoutPage.fulfillmentAddress
          attribute: text          
          storeIn: displayedFulfillmentAddress
      - if:
          identifier: 
            text:
              - identifier: checkoutPage.fulfillmentAddress
                contains: ${displayedFulfillmentAddress}        
          then:
            - log:
                message: "Successful assertion for fulfillment address in checkout"
                color: GREEN_BOLD
          else:
            - failTest:
                message: "Fulfillment address is not correctly displayed in checkout"
      - log:
          message: "End function: checkoutPage.assertFulfillmentAddress"
          color: BLUE
#--------------------------------------------------------------------------------------------------------------------
 # Description: Validate if the fufillment type is contains expected text
  - name: functions.checkout.validateFufillmentType
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: checkoutPage.fulfillmentMethod
              contains: ${expectedFulfillmentType}
      - log:
          message: "End function: checkout.validateFufillmentType" 
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: navigate to checkout page from PayPal Page
  - name: function.checkout.navigateBackFromPayPalPage
    platform: android
    flow:
      - executeFunction:
          name: functions.global.tapBackBtn
      - executeFunction:
          name: functions.global.tapBackBtn
      - log:
          message: "End function: checkout.navigateBackFromPayPalPage" 
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: navigate to checkout page from PayPal Page
  # Params:      ${customTip} - Custom tip amount to apply to the order.
  - name: functions.checkoutPage.enterCustomTip
    platform: android
    flow:
      - click:
          identifier: checkoutPage.driverTip.customTipCta
      - enterText:
          identifier: checkoutPage.driverTip.customTipField
          string: ${customTip}
          clearField: true
          pressEnter: true
      - log:
          message: "End function: checkoutPage.enterCustomTip"
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: This function validates the suggested driver tip based on the order value.
  # Params: ${suggestTipCount} Suggest tip count.
  #         ${tipPercentage} Suggest tip percentage.
  - name: functions.checkoutPage.driverTip.validateSuggestTipPercentage
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: checkoutPage.driverTip.suggestTipPercentages # <-- ${suggestTipCount}
              contains: ${tipPercentage}
      - log:
          message: "End function: checkoutPage.driverTip.validateSuggestTipPercentage" 
          color: BLUE

  #--------------------------------------------------------------------------------------------------------------------
  # Description: This function validates selected tip amount.
  # Params: ${tipAmount} Tip amount to validate.
  - name: functions.checkoutPage.driverTip.validateTipAmount
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: checkoutPage.driverTip.selectedTipAmount
              contains: ${tipAmount}
      - log:
          message:  "End function:checkoutPage.driverTip.validateTipAmount"
          color: BLUE

  #-----------------------------------------------------------------------------------------------------------------

  # Description: This function validate the sales financing detils in review order page and also checkbox 
  #              the financing option
  # No params
  - name: functions.checkoutPage.selectSalesFinancingOptions
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: checkoutPage.paymentMethod.salesFinancingDetails
          position: center
          scrollLimit: 5
          timeout: 60000
      - verifyIdentifier:
          present:
            - identifier: checkoutPage.paymentMethod.cardType
            - identifier: checkoutPage.paymentMethod.salesFinancingDetails
            - identifier: checkoutPage.paymentMethod.salesFinancingTitle
            - identifier: checkoutPage.paymentMethod.salesFinancingDescription
            - identifier: checkoutPage.paymentMethod.salesFinancingCheckBox
      - verifyIdentifier:
          checked:
            - identifier: checkoutPage.paymentMethod.salesFinancingCheckBox
              value: false
      - click:
          identifier: checkoutPage.paymentMethod.salesFinancingCheckBox
      - verifyIdentifier:
          checked:
            - identifier: checkoutPage.paymentMethod.salesFinancingCheckBox
              value: true
      - log:
          message: "End functions: checkoutPage.moneyBox.assertFeeNotPresent"
          color: BLUE

  #-----------------------------------------------------------------------------------------------------------------

  # Description: This function generates a JSON object containing all the elements in the money box for the checkout page.
  #     Note: The function currently retrieves the following elements:
  #           * Subtotal
  #           * Tax
  #           * 3P seller fee
  #           * Pickup and delivery fee
  #           * Estimated total
  #     TODO: This function may require validation to handle fees other than those mentioned above, as it may produce 
  #           unexpected results if the money box contains additional or different fees.
  # No params
  - name: functions.checkoutPage.getMoneyBoxData
    platform: android
    flow:
      - numberOfChildElements:
          identifier: checkoutPage.moneyBox.feeSummaryContainer
          storeIn: indexCount
          filterBy: checkoutPage.moneyBox.feeSummary.feeLabel
      - loop:
          begin: 0
          end: ${indexCount}
          mode: increment
          storeIndex: i
          flow:
            - getString:
                identifier: checkoutPage.moneyBox.feeSummary.feeLabel
                storeIn: feeLabel
                attribute: text
                index: ${i}
            - getString:
                identifier: checkoutPage.moneyBox.feeSummary.feeValue
                storeIn: feeValue
                attribute: text
                index: ${i}
            - executeNode:
                file: wcp/test/helpers/checkoutPage/getMoneyBox.js
                args:
                  - value: ${feeLabel}
                  - value: ${feeValue}
                  - value: ${moneyBoxValueArray}
                getResponse:
                  storeIn: moneyBoxValueArray
      - log:
          message: 'Money box data in JSON format: ${moneyBoxValueArray}'
          color: CYAN
      - log:
          message: "End functions: checkoutPage.getMoneyBoxData"
          color: BLUE

  #-----------------------------------------------------------------------------------------------------

  # Description: This function handles the associate discount pop-up that comes up when tapping on Continue to checkout button
  # No Params Required

  - name: functions.checkoutPage.handleAssociateDiscountPopUp
    flow:
      - if:
          identifier:
            present:
              - identifier: cartPage.continueToCheckout.applyAssociateDiscount.popUp.header
          then:
            - click:
                identifier: global.closeBtn
      - log:
          message: "End function: checkoutPage.handleAssociateDiscountPopUp"
          color: BLUE_BOLD
  #-----------------------------------------------------------------------------------------------------------------

  # Description: This functions validates below minimum fee
  # Params expectedbelowOrderMinFee
  - name: functions.checkout.validateBelowMinimumFee
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: checkout.POSSection.belowOrderMinFeeLabel
          text:
            - identifier: checkout.POSSection.belowOrderMinFeeValue
              contains: ${expectedbelowOrderMinFee}           
      - log:
          message: "End functions: checkout.validateBelowMinimumFee"
          color: BLUE

  #-----------------------------------------------------------------------------------------------------------------
  # Description: This functions validates the shared PickupPerson information is correct or not
  # Param [required]: FirstName, Lastname
  - name: functions.checkoutPage.assertPickupPersonInformation
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: checkoutPage.pickupPersonName
              equals: ${FirstName} ${LastName}
      - log:
          message: "End of function: checkoutPage.assertPickupPersonInformation"
          color: BLUE
  #--------------------------------------------------------------------------------------------------------------------
