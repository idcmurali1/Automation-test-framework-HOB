functions:

  - name: us.b2b.functions.home.navigateHomeToSignIn
    platform: ios
    flow:      
      - click:
          identifier: us.b2b.mappings.tabBar.account
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.b2b.mappings.account.signInButton
      - click:
          identifier: us.b2b.mappings.account.signInButton
      - try:
          flow:
            - verifyIdentifier:
                timeout: 3000
                present:
                  - identifier: us.b2b.mappings.global.authentication.emailField
            - storeIn:
                key: signInValidated
                value: true
          catch:
            flow:
              - log: login page loading failed
      - if:
          condition: ${signInValidated}
          then:
            - log: 
                message: SignIn page loaded
                color: GREEN_BOLD
            - storeIn:
                key: signInValidated
                value: false
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - SIGN-IN ERROR"

  - name: us.b2b.functions.browsePage.deepLinkValidations
    platform: ios
    flow:
      - executeFunction:
          name: us.b2b.functions.utils.getR2Array
          params:
            - name: data
              string: ${deepLinkUrls}
      - loop:
          each: ${r2Array}
          storeIndex: linkCount
          storeElement: deepLinkData
          flow:
            - if:
                condition: ${inputLinks} == null
                then:
                  - storeIn:
                      key: inputLinks
                      value: '"${deepLinkData}"'
                else:
                  - storeIn:
                      key: inputLinks
                      value: '${inputLinks}, "${deepLinkData}"'
            - try:
                flow:
                  - executeNode:
                      file: us/us-b2b/helpers/validateDeepLinkFormat.js
                      args:
                        - value: ${deepLinkData}
                      getResponse:
                        storeIn: deepLinkFormat
                  - log: ${deepLinkData}
                  - log: ${deepLinkFormat}
                  - verifyValue:
                      identifier: $deepLinkFormat
                      contains: 'valid'
                  - log: ${deepLinkData}
                  - openLink: ${deepLinkData}
                  - executeFunction:
                      name: us.b2b.functions.global.navigation.openDeepLink
                  - sleep:
                      duration: 10000
                  - if:
                      identifier:
                        present:
                          - identifier: us.b2b.mappings.global.authentication.emailField
                      then:
                        - log: Sign In required
                        - executeNode:
                            file: us/us-b2b/helpers/getDeepLinkType.js
                            args:
                              - value: ${deepLinkData}
                            getResponse:
                              storeIn: deepLinkType
                        - if:
                            condition: ${deepLinkType} == 'BPlus'
                            then:
                              - executeFunction:
                                  name: us.b2b.functions.global.authentication.signInAccount
                                  params:
                                      - name: email
                                        string: #
                                      - name: password
                                        string: #
                            else:
                              - executeFunction:
                                  name: us.b2b.functions.global.authentication.signInAccount
                                  params:
                                      - name: email
                                        string: anirudh.krishnan@walmart.com
                                      - name: password
                                        string: E2epassword$
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.b2b.mappings.global.authentication.emailField
                        - identifier: us.b2b.mappings.storyPage.errorTitle
                        - identifier: us.b2b.mappings.storyPage.errorMessage
                        - identifier: us.b2b.mappings.storyPage.errorButton
                        - identifier: us.b2b.mappings.storypage.errorButtonSecondary
                        - identifier: us.b2b.mappings.storypage.errorNoSearch
                  - if:
                      identifier:
                        present:
                          - identifier: us.b2b.mappings.homePage.element
                      then:
                        - verifyIdentifier:
                            visible:
                              - identifier: us.b2b.mappings.homePage.element
                                value: false
                      else:
                        - log: 'Deeplink loaded properly'                       
                  - if:
                      condition: ${deepLinkStatus} == null
                      then:
                        - storeIn:
                            key: deepLinkStatus
                            value: '{"${deepLinkData}":"PASS"}'
                      else:
                        - storeIn:
                            key: deepLinkStatus
                            value: '${deepLinkStatus}, {"${deepLinkData}":"PASS"}'
                catch:
                  flow:
                    - if:
                        condition: ${deepLinkStatus} == null
                        then:
                          - storeIn:
                              key: deepLinkStatus
                              value: '{"${deepLinkData}":"FAIL"}'
                        else:
                          - storeIn:
                              key: deepLinkStatus
                              value: '${deepLinkStatus}, {"${deepLinkData}":"FAIL"}'
            - executeFunction:
                name: us.b2b.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: 'walmartb2b://home'
            - verifyIdentifier:
                present:
                  - identifier: us.b2b.mappings.homePage.element
            - sleep:
                duration: 1000
