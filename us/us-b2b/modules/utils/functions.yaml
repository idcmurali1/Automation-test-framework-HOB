functions:

  - name: us.b2b.functions.utils.getR2Array
    flow:
      - executeNode:
          file: us/us-b2b/helpers/generateR2Array.js
          args:
            - value: ${data}
          getResponse:
            storeIn: r2Array

  - name: us.b2b.functions.utils.sm-deep-link.afterSteps
    flow:
      - if:
          condition: ${moduleId} != null && ${inputLinks} != null
          then:
            - storeIn:
                key: finalStatus
                value: '{ "moduleId":"${moduleId}", "pageInfo": "${pageInfo}","link":[ ${inputLinks} ],"status": [ ${deepLinkStatus} ] }'
            - log: $finalStatus
            - executeNode:
                file: us/e2e-tests/helpers/validateIfFileExists.js
                args:
                  - value: 'sm-deep-link-results-${id}.json'
                getResponse:
                  storeIn: fileCreated
            - if:
                condition: ${fileCreated} != 'created'
                then:
                  - executeNode:
                      file: us/e2e-tests/helpers/removeFile.js
                      args:
                        - value: 'sm-deep-link-results-${id}.json'
                  - createFile:
                      file: ./sm-deep-link-results-${id}.json
                      string: $finalStatus
                  - log: File created
                else:
                  - log: File already existing
          else:
            - log: Skipping file creation
            - storeIn:
                key: inputLinks
                value: 'null'
            - storeIn:
                key: deepLinkStatus
                value: 'null'
            - failTest:
                message: Test failed (Retry available)