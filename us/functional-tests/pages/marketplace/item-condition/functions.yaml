functions:

########################################################### iOS ################################################

# Function to open an Item Page and tap on item conditions (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.flow
    platform: ios
    flow:
      #Search for item
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.newItemButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.newItemButton
            - identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - log: 'Item Condition for new and preowned present'
      - click:
          identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - sleep:
          duration: 300
      - click:
          identifier: us.mappings.itemDetails.itemConditions.secondaryBoostedOffer
      - sleep:
          duration: 1000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.moreSellerTableView
      - log: 'More Seller table vie presented'

# Function to open an Item Page and tap on item conditions and check new and preowned item conditions(Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.new.preowned.conditions.flow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.new.itemTitle
      - log: 'Item Condition valid new title present'
      #Search for item
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.newItemButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.newItemButton
            - identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - log: 'Item Condition for new and preowned present'
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.newItemButton.priceLabel
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.product.priceLabel
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.item.carousel
      - log: 'Price shown in Price component is same as Price shown for New radio button and image carousel present'

# Function to open an Item Page and tap on item conditions and select preowned flow (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.preowned.selection.flow
    platform: ios
    flow:
      #Search for item
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.newItemButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.newItemButton
            - identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - log: 'Item Condition for new and preowned present'
      - click:
          identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - sleep:
          duration: 300
      - scroll:
          direction: up
          untilIdentifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preowned.itemTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preowned.itemTitle
      - log: 'Item details title contains pre-owned'
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preownedItemButton.priceLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preownedItemButton.priceLabel
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.product.preowned.priceLabel
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.item.carousel
      - log: 'Pre-Owned Price shown in Price component is same as Price shown for New radio button and image carousel present'

# Function to open an Item Page and tap on item conditions and select preowned flow via conditionGroupCode (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.preowned.conditionGroupCode.flow
    platform: ios
    flow:
      #Search for item
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.newItemButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.newItemButton
            - identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - log: 'Item Condition for new and preowned present'
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preownedItemButton.priceLabel
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.product.preowned.priceLabel
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.item.carousel
      - log: 'Pre-Owned Price shown in Price component is same as Price shown for New radio button and image carousel present'
      - scroll:
          direction: up
          untilIdentifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preowned.itemTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.galaxy.preowned.itemTitle
      - log: 'Item details title contains pre-owned'

# Function to open an Item Page and Verify SEM handling for new offers (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.sem.new.offers.flow
    platform: ios
    flow:
      #Search for item
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.mario.magazine.newItemButton.priceButton
      - verifyIdentifier:
          displayed:
            - identifier: us.mappings.itemDetails.itemConditions.mario.magazine.newItemButton.priceButton
              value: true
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - log: 'Item Condition for new and preowned present and new item button is selected'
      
# Function to open an Item Page and verify nonNew flow (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.nonNew.flow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.harry.potter.preowned.itemTitle
            - identifier: us.mappings.itemDetails.itemConditions.mario.harry.potter.item.carousel
      - log: 'Item details title contains non-new and hero images'
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.secondaryBoostedOffer
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.itemDetails.itemConditions.secondaryBoostedOffer
          notPresent:
            - identifier: us.mappings.itemDetails.itemConditions.preOwnedItemButton
      - log: 'Verify that the condition badge shows up.'
      - log: 'Verified that It does not show a radio button UI.'

# # Function to verify a search result flow (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.searchResult.flow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.mario.american.magazine.product.priceLabel
      - log: 'Verify that there is options-from label'


# Function to open an Item Page and Verify SEM handling for preowned offers (Project Mario)
  - name: us.mappings.ios.itemDetails.projectMario.itemConditions.sem.preowned.offers.flow
    platform: ios
    flow:
      #Search for item
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.mario.magazine.preownedItemButton.priceButton
      - verifyIdentifier:
          displayed:
            - identifier: us.mappings.itemDetails.itemConditions.mario.magazine.preownedItemButton.priceButton
              value: true
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.itemConditions.secondaryBoostedOffer
      - log: 'Item Condition for new and preowned present and preowned item button is selected'

# Function to open an Item Page and Verify variant selector handling for non-new winning offers
  - name: us.mappings.ios.itemDetails.item.sharing.contains.conditionGroupCode.flow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.preowned.itemTitle
      - log: 'Item details contains prewoned title'
      - scroll:
          direction: down
          untilIdentifier: us.mappings.itemDetails.itemConditions.secondaryBoostedOffer
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.itemDetails.itemConditions.secondaryBoostedOffer
      - log: 'Item details secondary boosted offer present'
      - scroll:
          direction: up
          untilIdentifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.item.shareButton
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.item.shareButton
      - log: 'Item Share button present'
      - click:
          identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.item.shareButton
      - sleep:
          duration: 200
      - log: 'Share Button clicked'
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.more.shareButton
      - log: 'Item More Share button present'
      - click:
          identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.more.shareButton
      - log: 'Item More Share button clicked'
      - sleep:
          duration: 200
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.iOS.reminderButton
      - log: 'iOS Reminder Share button present'
      - click:
          identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.iOS.reminderButton
      - sleep:
          duration: 200
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.itemDetails.item.sharing.contains.conditionGroupCode.iOS.reminder.link
      - log: 'iOS Item Details Shareable URL contains valid link'

# Function to open an Item Page and Verify variant selector handling for non-new winning offers
  - name: us.mappings.ios.itemDetails.verify.nonnew.winning.offer.variant.seeOption.flow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemDetails.item.nonnew.winning.offer.variant.seeOption.first.button
            - identifier: us.mappings.itemDetails.item.nonnew.winning.offer.variant.seeOption.second.button
      - log: 'Item details title contains non-new and hero images'

########################################################### Android ################################################

  # Function to verify the multuple buy box shows up in Item Page with New and Restored offer (Project Mario)
  - name: us.functions.item.details.verifyBuyBoxMultipleOffers
    platform: android
    flow:
      # Scroll doesn't work so I use drag to scroll
      - drag:
          from:
            x: 50%
            y: 60%
          to:
            x: 50%
            y: 40%
      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.buyBoxMultipleOffers.newOffer
            - identifier: us.mappings.item.details.buyBoxMultipleOffers.restoredOffer
      - log: "'New' and 'Restored'  offers are displayed"

    
  # Function to click on Resotered offer and verify the More condition banner shows up (Project Mario)  
  - name: us.functions.item.details.verifyMoreConditionBanner
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.buyBoxMultipleOffers.restoredOffer

      - click: 
          identifier: us.mappings.item.details.buyBoxMultipleOffers.restoredOffer  
      - log: "Click on 'Restored' offer"

      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.buyBoxMultipleOffers.moreCondtionsBanner
      - log: "`More conditions from other sellers` is displayed"


  # Function to verify new offer is selected and has the same price as product (Project Mario)
  - name: us.functions.item.details.verifyProductAndNewOfferPrice
    platform: android
    flow:
      - verifyIdentifier:
          checked:
            - identifier: us.mappings.item.details.itemConditionsRadioSelectionGroup.newOffer
              value: true

      - log: "New offer is selected"

      # Fetch the price from the new offer radio button
      - getString:
          identifier: us.mappings.item.details.itemConditionsRadioSelectionGroup.newOffer.itemConditionsPrice
          attribute: text
          storeIn: newOfferPrice

      # Fetch product price
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.productPrice

      - getString:
          identifier: us.mappings.item.details.productPrice
          attribute: text
          storeIn: productPrice

      # Compare the two prices
      - if:
          condition: ${productPrice} != ${newOfferPrice}
          then:
            - failTest:
                message: "Price mismatch! Product Price: ${productPrice}, New Offer Price: ${newOfferPrice}"
          else:
            - log: "Price match verified! Product Price: ${productPrice}, New Offer Price: ${newOfferPrice}"


 # Function to verify restored offer is selected and has the same price as product (Project Mario)
  - name: us.functions.item.details.verifyProductAndRestoredfferPrice
    platform: android
    flow:
      - verifyIdentifier:
          checked:
            - identifier: us.mappings.item.details.itemConditionsRadioSelectionGroup.restoredOffer
              value: true

      - log: "Restored offer is selected"

      # Fetch the price from the new offer radio button
      - getString:
          identifier: us.mappings.item.details.itemConditionsRadioSelectionGroup.restoredOffer.itemConditionsPrice
          attribute: text
          storeIn: restoredOfferPrice

      # Fetch product price
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.productPrice

      - getString:
          identifier: us.mappings.item.details.productPrice
          attribute: text
          storeIn: productPrice

      # Compare the two prices
      - if:
          condition: ${productPrice} != ${restoredOfferPrice}
          then:
            - failTest:
                message: "Price mismatch! Product Price: ${productPrice}, Resotered Offer Price: ${restoredOfferPrice}"
          else:
            - log: "Price match verified! Product Price: ${productPrice}, Resotered Offer Price: ${restoredOfferPrice}"
              

  # Function to verify product's title doesn't contains"Restored" (Project Mario)
  - name: us.functions.item.details.verifyProductTitleWithoutRestored
    platform: android
    flow:
     - scroll:
          direction: up
          untilIdentifier: us.mappings.item.details.productTitle
     - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.productTitleWithoutRestored
     - log: "Product's title doesn't contain 'Restored'"

  # Function to verify product's title contains "Restored" (Project Mario)
  - name: us.functions.item.details.verifyProductTitleContainRestored
    platform: android
    flow:
     - scroll:
          direction: up
          untilIdentifier: us.mappings.item.details.productTitle
     - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.productTitleContainRestored
     - log: "Product's title contains 'Restored'"

  # Function to verify product's title contains "Options from" (Project Mario)
  - name: us.functions.item.details.verifySearchResultsContainOptions
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.details.searchResult
      - log: "Search result contains 'Options from'"

  # Function to verify product's title contains "Restored" (Project Mario)
  - name: us.functions.item.details.verifyConditionBadge
    platform: android
    flow:
      - scroll:
          direction: up
          untilIdentifier: us.mappings.item.badge.restoredBadge
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.badge.restoredBadge
      - log: "Product's Badges contains 'Restored'"

    # Function to click add to cart on item page
  - name: us.mappings.item.details.addToCart
    platform: android
    flow:
      - verifyIdentifier:
            present:
              - identifier: us.mappings.item.addToCartButton
      - click:
          identifier: us.mappings.item.addToCartButton
      - log: "Add to cart success"

  # Function to verify Other condition (More seller) bottom sheet works as expected
  # params: ${productTitle}               [Mandatory]  product's title 
  - name: us.mappings.item.details.verifyOtherConditionBottomSheetShowsCorrectly
    platform: android
    flow:    
     - verifyIdentifier:
            present:
              - identifier: us.mappings.item.otherConditionBottomSheet.currentlyViewing.text
    # Get the title text from the Wining offer
     - getString:
        identifier: us.mappings.item.otherConditionBottomSheet.wingingOffer.title
        attribute: text
        storeIn: winningOfferTitle

    # Compare the winging offer's title with the productTitle
     - if:
        condition: ${winningOfferTitle} != ${productTitle}
        then:
          - failTest:
              message: "Title mismatch! Winging offer's Title: ${winningOfferTitle}, Product's Title: ${productTitle}"
        else:
          - log: "Currently viewing offer same as main page."

  - name: unified.us.functions.item.localMarketPlace.itemFeeValidation
    platform: android
    flow:
      # Scroll doesn't work so I use drag to scroll
      - drag:
          from:
            x: 50%
            y: 60%
          to:
            x: 50%
            y: 40%
      - click:
          identifier: us.mappings.item.localmarketPlace.delivery
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.localmarketPlace.deliveryTilewithSLA
            - identifier: us.mappings.item.localmarketPlace.fulfilledByWalmart
            - identifier: us.mappings.item.localmarketPlace.deliveryChargesWithFee
            - identifier: us.mappings.item.localmarketPlace.w+signUpModule

