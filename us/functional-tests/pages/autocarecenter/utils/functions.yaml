functions: 

  - name: us.functions.services.acc.utils.createWorkOrder
    flow:
      - log: Creating WorkOrder 
      - callAPI:
          url: https://stg.workorder.acc.walmart.com/api/v1/locations/${storeNumber}/workorders
          requestMethod: POST
          disableCertificateChecks: true
          header: 
            - key: WM_CONSUMER.ID
              value: bcca7724-cbab-4e71-bc65-ce1ee1f3b871
            - key: WM_SVC.NAME 
              value: ACC-WORKORDER-SERVICE
            - key: WM_SVC.ENV
              value: stg 
            - key: x-user
              value: b0r0091
            - key: Content-Type
              value: application/json
            - key: x-token
              value: MTAyOTYyMDE4hy4OsxKZ51/Cjf8j38JNwgqCneo4oTBsSTMlOaRBHVW4HpE6xD2V59OyxjgfGeUHXijNnc8j9nwmDkUDjH4Crhzy8KEhkC/Uo3ID8yQ74SfdUzQW1StTrCiI3thYlt7Ucru/bRQZ4hu5JpN5uYzDEt5QpxCKWpEJKwrrWwi4j1AJnaDppV26kJi3YPfj6J2bdkoFeHYDwM0ting7R4v8DBTz6S40IP8ZwKy4gRhHAnPRuAP4P54Vby0TFsvO2j0SUkPejifdHrmmFkcN07E6KzBh64g/3ohkkHDljaAL5bSBKnb3rKNZXyv/jiZ18fWxe+1Vz4uinIEzkreBGwIhh24Kb8dUOlUUE6yWylBuocW8LUNYDkrE2VHIw8SIcZfC
            - key: Cookie
              value: '_abck=C8305DC3BE6494B898534BF9B8A0E3C9~-1~YAAQLjovFzlujOGRAQAANgiFBgw68C9aazWWM7IPdwubSUz2knG7NDlot12xfuO5i8OLlC895T9jaZRfcSKxcMENR37ufCjxKFiie8/7u57ciGkPnB4/Qa937j29bQheiFYL3HPuvqGf/ooZedhHlGzAfrqzwglwC9umsaO4Us9257RU6wla5hpd3TjqwyHeRyf6UNU1n6kM7FAB+jgVANlD1a4F/aXUGx8yq+TuX9YIkegwOLETxeFS8bvY1SqGVaOhdA6Up/09o9PotqMOJuhlpHLY1JZgxu3vFODE30YgoCtGzhtoJv9/JMXa/6sgLLuJDzAbZkCve9xxbRdpSNnWOWFf0HcZyfl54hTp~-1~-1~-1; _lat=30b5e5652005e16f0c4d550289838e87cprof; _msit=e39b52f8eb470762288185453855db61wmjet; vtc=W1jGPoC0vwAjdfnWht8IMc'          
          readTimeout: 180000
          requestBody: ${payload}
          verifyResponseCode: 200
          retriesOnFail: 0
          retryDelay: 2000
      - log: 
          message: WorkOrder created successfully
          color: GREEN_BOLD
      - sleep:
          duration: 2000

  - name: us.functions.services.acc.utils.createACCustomer
    flow:
      - log: Creating ACC Customer
      - executeFunction:
          name: us.functions.services.acc.utils.getAccCustomer
          params:
            - name: firstName
              string: ${firstName}
            - name: lasttName
              string: ${lasttName}
            - name: phoneNumber
              string: ${phoneNumber}
      - if:
          condition: "${accCustomerInfo} == '[]'"
          then: 
            - callAPI:
                url: https://stg.customer.acc.walmart.com/api/v1/customers
                requestMethod: POST
                disableCertificateChecks: true
                header: 
                  - key: WM_CONSUMER.ID
                    value: bcca7724-cbab-4e71-bc65-ce1ee1f3b871
                  - key: WM_SVC.NAME 
                    value: ACC-CUSTOMER-SERVICE
                  - key: WM_SVC.ENV
                    value: stg 
                  - key: x-user
                    value: b0r0091
                readTimeout: 180000
                requestBody: ${customerPayload}
                verifyResponseCode: 200
                retriesOnFail: 0
                retryDelay: 2000
                getValue:
                  - key: id
                    storeIn: accId
                  - key: customerId
                    storeIn: accCustomerId
                  - key: wmtProfileId
                    storeIn: wmtProfileId
                  - key: linkSource
                    storeIn: linkSource
            - log: 
                message: Customer created successfully, firstName:${firstName},lastName:${lasttName}, phoneNumber:${phoneNumber}, email:${email}, customerId:${accCustomerId}, wmtProfileId:${wmtProfileId}, linkSource:${linkSource}, id:${accId}
                color: GREEN_BOLD
            - sleep:
                duration: 2000
          else: 
            - log: 
                message: Customer already exists, firstName:${firstName},lastName:${lasttName}, phoneNumber:${phoneNumber}, email:${email}, customerId:${accCustomerId}, wmtProfileId:${wmtProfileId}, linkSource:${linkSource}, id:${accId}
                color: GREEN_BOLD
            - sleep:
                duration: 2000
  
  - name: us.functions.services.acc.utils.unlinkAccCustomer
    flow:
      - log: Unlink Acc Customer
      - callAPI:
          url: https://stg.customer.acc.walmart.com/api/v1/customers/${customerId}
          requestMethod: PUT
          disableCertificateChecks: true
          header: 
            - key: WM_CONSUMER.ID
              value: ${customerId}
            - key: WM_SVC.NAME 
              value: ACC-CUSTOMER-SERVICE
            - key: WM_SVC.ENV
              value: stg
            - key: Content-Type
              value: application/json
            - key: Cookie
              value: '_abck=C8305DC3BE6494B898534BF9B8A0E3C9~-1~YAAQLjovFzlujOGRAQAANgiFBgw68C9aazWWM7IPdwubSUz2knG7NDlot12xfuO5i8OLlC895T9jaZRfcSKxcMENR37ufCjxKFiie8/7u57ciGkPnB4/Qa937j29bQheiFYL3HPuvqGf/ooZedhHlGzAfrqzwglwC9umsaO4Us9257RU6wla5hpd3TjqwyHeRyf6UNU1n6kM7FAB+jgVANlD1a4F/aXUGx8yq+TuX9YIkegwOLETxeFS8bvY1SqGVaOhdA6Up/09o9PotqMOJuhlpHLY1JZgxu3vFODE30YgoCtGzhtoJv9/JMXa/6sgLLuJDzAbZkCve9xxbRdpSNnWOWFf0HcZyfl54hTp~-1~-1~-1; _lat=30b5e5652005e16f0c4d550289838e87cprof; _msit=e39b52f8eb470762288185453855db61wmjet; vtc=W1jGPoC0vwAjdfnWht8IMc'
          readTimeout: 180000
          requestBody: ${unlinkAccCustomerPayload}
          verifyResponseCode: 200
          retriesOnFail: 0
          retryDelay: 2000
          getValue:
            - key: wmtProfileId
              storeIn: wmtProfileId
            - key: linkSource
              storeIn: linkSource
      - log: 
          message: Unlink Customer successfully, firstName:${firstName},lastName:${lasttName}, phoneNumber:${phoneNumber}, email:${email}, customerId:${customerId}, wmtProfileId:${wmtProfileId}, linkSource:${linkSource}, id:${id}
          color: GREEN_BOLD
      - sleep:
          duration: 2000

  - name: us.functions.services.acc.utils.getAccCustomer
    flow:
      - log: Get Acc Customer
      - callAPI:
          url: https://stg.customer.acc.walmart.com/api/v1/customers?firstName=${firstName}&lastName=${lasttName}&phoneNumber=${phoneNumber}
          requestMethod: GET
          disableCertificateChecks: true
          header: 
            - key: WM_CONSUMER.ID
              value: bcca7724-cbab-4e71-bc65-ce1ee1f3b871
            - key: WM_SVC.NAME 
              value: ACC-CUSTOMER-SERVICE
            - key: WM_SVC.ENV
              value: stg
            - key: Cookie
              value: '_abck=C8305DC3BE6494B898534BF9B8A0E3C9~-1~YAAQLjovFzlujOGRAQAANgiFBgw68C9aazWWM7IPdwubSUz2knG7NDlot12xfuO5i8OLlC895T9jaZRfcSKxcMENR37ufCjxKFiie8/7u57ciGkPnB4/Qa937j29bQheiFYL3HPuvqGf/ooZedhHlGzAfrqzwglwC9umsaO4Us9257RU6wla5hpd3TjqwyHeRyf6UNU1n6kM7FAB+jgVANlD1a4F/aXUGx8yq+TuX9YIkegwOLETxeFS8bvY1SqGVaOhdA6Up/09o9PotqMOJuhlpHLY1JZgxu3vFODE30YgoCtGzhtoJv9/JMXa/6sgLLuJDzAbZkCve9xxbRdpSNnWOWFf0HcZyfl54hTp~-1~-1~-1; _lat=30b5e5652005e16f0c4d550289838e87cprof; _msit=e39b52f8eb470762288185453855db61wmjet; vtc=W1jGPoC0vwAjdfnWht8IMc'
          readTimeout: 180000
          verifyResponseCode: 200
          retriesOnFail: 0
          retryDelay: 2000
          getResponse:
            storeIn: accCustomers
      - executeNode:
          file: us/functional-tests/helpers/extractAccCustomer.js
          args:
            - value: ${accCustomers}
          getResponse:
            storeIn: accCustomerInfo
          getValue:
            - key: id
              storeIn: id
            - key: email
              storeIn: accmail
            - key: customerId
              storeIn: customerId
            - key: wmtProfileId
              storeIn: wmtProfileId
            - key: linkSource
              storeIn: linkSource
      - log: 
          message: Get Customer successfully, firstName:${firstName},lastName:${lasttName}, phoneNumber:${phoneNumber}, email:${email}, customerId:${customerId}, wmtProfileId:${wmtProfileId}, linkSource:${linkSource}, id:${id}
          color: GREEN_BOLD
      - sleep:
          duration: 2000