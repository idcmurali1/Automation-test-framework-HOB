functions:
  - name: us.functions.functional.checkout.reviewOrder.fcModule.validateDeliveryInstructionsModule
    flow:
      - storeIn:
          key: viewType
          value: Delivery
      - storeIn:
          key: fulfillmentType
          value: Shipping
      - executeFunction:
          name: us.functions.functional.checkout.reviewOrder.validateDeliveryInstructionsView

  - name: us.functions.functional.checkout.reviewOrder.deliveryModule.validateDeliveryInstructionsModule
    flow:
        - storeIn:
            key: viewType
            value: Delivery
        - storeIn:
            key: fulfillmentType
            value: Delivery
        - executeFunction:
            name: us.functions.functional.checkout.reviewOrder.validateDeliveryInstructionsView

  - name: us.functions.functional.checkout.reviewOrder.validateDeliveryInstructionsView
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructions.section
            - identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructions.editLink
      - executeFunction:
          name: us.functions.functional.utils.validateElementValue
          params:
            - name: identifierToVerify
              string: us.mappings.functional.checkout.reviewOrder.deliveryInstructions.heading
            - name: identifierValueToVerify
              string: Delivery instructions (optional)
      #TODO check if we change this is identifier present instead by chainging the selector in ios
      - executeFunction:
          name: us.functions.functional.utils.validateElementValue
          params:
              - name: identifierToVerify
                string: us.mappings.functional.checkout.reviewOrder.deliveryInstructions.instructions
              - name: identifierValueToVerify
                string: ${fulfillmentDeliveryInstructions}
              - name: toVerifyContent
                string: "true"
  
  # Update delivery instructions in Delivery from store module
  - name: us.functions.functional.checkout.reviewOrder.deliveryModule.updateDeliveryInstructions
    flow:
      - storeIn:
          key: viewType
          value: Delivery
      - storeIn:
          key: fulfillmentType
          value: Delivery
      - executeFunction:
          name: us.functions.functional.checkout.reviewOrder.updateDeliveryInstructions

  # Update delivery instructions in FC module
  - name: us.functions.functional.checkout.reviewOrder.fcModule.updateDeliveryInstructions
    flow:
      - storeIn:
          key: viewType
          value: Delivery
      - storeIn:
          key: fulfillmentType
          value: Shipping
      - executeFunction:
          name: us.functions.functional.checkout.reviewOrder.updateDeliveryInstructions

  # Update delivery instructions 
  - name: us.functions.functional.checkout.reviewOrder.updateDeliveryInstructions
    flow:
      - click:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructions.editLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructionsBottomSheet.deliveryInstructionsHeading
      - click:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructions.clearProperty
      - click:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructionsBottomSheet.propertyTypeButton
          wait: 2000
      - enterText:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructionsBottomSheet.gateOrCallBoxCodeTextField
          string: ${gateOrCallCode}
          clearField: true
      - enterText:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructionsBottomSheet.deliveryNotesTextBox
          string: ${fulfillmentDeliveryNotes}
          clearField: true
      - executeFunction:
          name: unified.us.functions.utils.dismissKeyboard
      - click:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructionsBottomSheet.deliveryDoorStep
      - click:
          identifier: us.mappings.functional.checkout.reviewOrder.deliveryInstructionsBottomSheet.saveDeliveryInstructions

  # Validate Local marketplace delivery instructions view
  - name: us.functions.functional.checkout.reviewOrder.lmpModule.validateLocalMarketplaceInstructionsModule
    flow:
        - storeIn:
            key: viewType
            value: MPDelivery
        - storeIn:
            key: fulfillmentType
            value: MP_Delivery
        - executeFunction:
            name: us.functions.functional.checkout.reviewOrder.validateDeliveryInstructionsView
