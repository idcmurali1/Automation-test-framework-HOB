functions:
  # NOTE Moved these functions to this new file as part of refactoring, functionality to be updated with latest
  # during unified test automation. Update to support both platforms
  - name: us.functions.functional.checkout.reviewOrder.itemDetails.validate3pShippingItemWithShippingFee
    flow:
      - storeIn:
          key: viewType
          value: Delivery
      - executeFunction:
          name: us.functions.functional.checkout.reviewOrder.fulfillment.validateItemDetails
      - click:
          identifier: us.mapings.reviewOrder.viewDetails
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemDetails.title
            - identifier: us.mappings.orderDetails.trackShipment.arrivesByText
            - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.sellerLabel
            - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.3pSellerShippingFeeLabel
            - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.sectionItem
          notPresent:
            - identifier: us.mappings.item.compareSellers.PrimarySellerPrice
      - getString:
          identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.3pSellerShippingFeeLabel
          attribute: label
          extractNumbers: true
          storeIn: shippingFee
      - click:
          identifier: us.mappings.reviewOrder.itemDetails.closeButton

  - name: us.functions.functional.checkout.reviewOrder.itemDetails.validate3pShippingMulitpleItemsWithShippingFees
    flow:
      - storeIn:
          key: viewType
          value: Delivery
      - verifyIdentifier:
          present:
            - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsSection
            - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsSection.viewButton
      - arithmetic:
          expression: ${numDifferentItems} + 1
          storeIn: numItems
      - loop:
          begin: 1
          end: ${numItems}
          storeIndex: itemIndex
          flow:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.itemContainer
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.functional.checkout.reviewOrder.itemDetails.itemContainer
                      scrollLimit: 1
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.itemPreviewImage
                label:
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.itemArriveByLabel
                    contains: Arrives by
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.itemCountLabel
                    contains: 1 item
      # Open item details and validate details
      - scroll:
          direction: up
          untilIdentifier: us.mapings.reviewOrder.viewDetails
      - click:
          identifier: us.mapings.reviewOrder.viewDetails
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemDetails.title
      - storeIn:
          key: shippingFee
          value: 0.00
      - loop:
          begin: 0
          end: ${numDifferentItems}
          storeIndex: itemIndex
          flow:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.itemArriveByLabel
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.itemArriveByLabel
                      scrollLimit: 1
            - arithmetic:
                expression: ${itemIndex} + 1
                storeIn: itemCountIndex
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.itemCountLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.sellerShippingFeeLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.soldAndShippedByLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.itemDescriptionLabel
                notPresent:
                  - identifier: us.mappings.item.compareSellers.PrimarySellerPrice
                label:
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.itemArriveByLabel
                    contains: Arrives by
            - getString:
                identifier: us.mappings.functional.checkout.reviewOrder.itemDetailsBottomSheet.sellerShippingFeeLabel
                attribute: label
                extractNumbers: true
                storeIn: sellerShippingFee
            - arithmetic:
                expression: ${shippingFee} + ${sellerShippingFee}
                storeIn: shippingFee
      - click:
          identifier: us.mappings.reviewOrder.itemDetails.closeButton