functions:
  # NOTE Moved these functions to this new file as part of refactoring, functionality to be updated with latest
  # during unified test automation. Update to support both platforms
  - name: us.functions.functional.checkout.reviewOrder.SelectPetVet
    flow:
      #Pet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAPetid
      - click:
          identifier: us.mappings.reviewOrder.SelectAPetid
      - sleep:
          duration: 2000
      - getString:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          attribute: value
          storeIn: petRx_PetName
      - log: ${petRx_PetName} selected
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1

        #Vet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVetid
      - click:
          identifier: us.mappings.reviewOrder.SelectAVetid
      - sleep:
          duration: 2000
      - getString:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          attribute: value
          storeIn: petRx_VetName
      - log: ${petRx_VetName} selected
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
          then:
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1
      - if:
          condition: ${multipleItems} == true
          then:
            #Pet Selection
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAPetid
            - click:
                identifier: us.mappings.reviewOrder.SelectAPetid
            - sleep:
                duration: 2000
            - getString:
                identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
                attribute: value
                storeIn: petFood_PetName
            - log: ${petFood_PetName} selected
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
                then:
                  - log: inside done
                  - click:
                      identifier: us.mappings.reviewOrder.PetPickerWheelDone1
            - scroll:
                direction: down
            #Vet Selection
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAVetid
            - click:
                identifier: us.mappings.reviewOrder.SelectAVetid
            - sleep:
                duration: 2000
            - getString:
                identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
                attribute: value
                storeIn: petFood_VetName
            - log: ${petFood_VetName} selected
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.PetPickerWheelDone1

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SaveButton
      - click:
          identifier: us.mappings.reviewOrder.SaveButton

  - name: us.functions.functional.checkout.reviewOrder.verifyPetRxCardDetails.after.selectingPetandVet
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.functional.checkout.reviewOrder.petRx.petRxView
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.functional.checkout.reviewOrder.petRx.petRxView
            - identifier: us.mappings.functional.checkout.reviewOrder.petRx.messageView
            - identifier: us.mappings.functional.checkout.reviewOrder.petRx.titleLabel
      - verifyIdentifier:
          value:
            - identifier: us.mappings.functional.checkout.reviewOrder.petRx.messageView
              contains: Success, Weâ€™ll contact your vet to verify.
            - identifier: us.mappings.functional.checkout.reviewOrder.petRx.titleLabel
              contains: Veterinary items

      # Verifing selected pet and vet names
      - log: Verifing selected pet and vet names
      - loop:
          begin: 1
          end: ${itemsCount}
          storeIndex: index
          mode: increment
          flow:
            - log: verifyPetRxCardDetails - ${index}
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.petRx.productLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.petRx.priceLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.petRx.unitPriceLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.petRx.imageView
                  - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.petRx.quantityLabel
                  - identifier: us.mappings.functional.checkout.reviewOrder.petRx.petVetNames
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.functional.checkout.reviewOrder.petRx.petVetNames
                then:
                  - getString:
                      identifier: us.mappings.functional.checkout.reviewOrder.petRx.petVetNames
                      attribute: label
                      storeIn: petVetName
                  - log: petVetName ${petVetName}
                  - storeIn:
                      key: selectedPetRxPetVetName
                      value: ${petRx_PetName} | ${petRx_VetName}
                  - storeIn:
                      key: selectedPetFoodPetVetName
                      value: ${petFood_PetName} | ${petFood_VetName}
                  - storeIn:
                      key: selectedPetRxPetVetName1
                      value: ${petName1} | ${vetName1}
                  - storeIn:
                      key: selectedPetRxPetVetName2
                      value: ${petName2} | ${vetName2}
            - if:
                condition: ${splitItems} == true
                then:
                  - log: Verifying - Split quantity between two selected pets and vets - ${splitItems}
                  - if:
                      condition: petVetName == selectedPetRxPetVetName1 || petVetName == selectedPetRxPetVetName2
                      then:
                        - log: "selectedPetVetName ${petVetName} is equal to ${selectedPetRxPetVetName1} or ${selectedPetRxPetVetName2}"
                      else:
                        - failTest:
                            message: "selectedPetVetName ${selectedPetVetName} is not equal to petVetName ${petVetName}"
                else:
                  - log: Verifying selected pet and vet name - ${splitItems}
                  - if:
                      condition: petVetName == selectedPetRxPetVetName || petVetName == selectedPetFoodPetVetName
                      then:
                        - log: "selectedPetVetName ${petVetName} is equal to ${selectedPetRxPetVetName} or ${selectedPetFoodPetVetName}"
                      else:
                        - failTest:
                            message: "selectedPetVetName ${selectedPetVetName} is not equal to petVetName ${petVetName}"

  - name: us.functions.functional.checkout.reviewOrder.itemDetails.validatePetRxBadge
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.viewButton
          then:
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.viewButton
            - sleep:
                duration: 1000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.itemDetailsScreen.header
            - loop:
                begin: 1
                end: ${itemsCount}
                storeIndex: sectionIndex
                mode: increment
                flow:
                  - log: validatePetRxBadge - ${sectionIndex}
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.itemName
                          contains: ${petRxBadge}
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.doneButton

  - name: us.functions.functional.checkout.reviewOrder.MultiSelectPetVet
    platform: ios
    flow:
      #Qty Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.PetSelectAQtyTextfieldid
      - click:
          identifier: us.mappings.reviewOrder.PetSelectAQtyTextfieldid
      - sleep:
          duration: 5000
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: 1
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

      #Pet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MutliSelectPet1Textfield_id
      - click:
          identifier: us.mappings.reviewOrder.MutliSelectPet1Textfield_id
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: ${petName1}
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

        #Vet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MutliSelectVet1Textfield_id
      - click:
          identifier: us.mappings.reviewOrder.MutliSelectVet1Textfield_id
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: ${vetName1}
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
          then:
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

      #2nd Pet and Vet selection
      #Pet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MutliSelectPet2Textfield
      - click:
          identifier: us.mappings.reviewOrder.MutliSelectPet2Textfield
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: ${petName2}
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

        #Vet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVet2
      - click:
          identifier: us.mappings.reviewOrder.SelectAVet2

      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: ${vetName2}
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
          then:
            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

      #Save Button
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SaveButton
      - click:
          identifier: us.mappings.reviewOrder.SaveButton

  # Add new pet details
  - name: us.functions.functional.checkout.reviewOrder.addNewPetDetails
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.checkout.reviewOrder.petInfo.title
          then:
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.petType
            - enterText:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.firstNameField
                string: ${petFirstName}
                clearField: true
            - executeFunction:
                name: us.functions.functional.util.clickKeyboardDone
            - enterText:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.lastNameField
                string: ${petLastName}
                clearField: true
            - executeFunction:
                name: us.functions.functional.util.clickKeyboardDone
            - enterText:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.birthdayField
                string: ${petBirthDay}
                clearField: true
            - executeFunction:
                name: us.functions.functional.util.clickKeyboardDone
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.genderSelect

            - click:
                identifier: us.mappings.reviewOrder.PetPickerWheelDone1

            - enterText:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.weightField
                string: ${petWeight}
                clearField: true
            - executeFunction:
                name: us.functions.functional.util.clickKeyboardDone

            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.functional.checkout.reviewOrder.petInfo.petHealth.conditionsAddField
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center

            - verifyIdentifier:
                present:
                  - identifier: us.mappings.functional.checkout.reviewOrder.petInfo.petHealth.headerLabel
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.petHealth.medicationsAddField
                wait: 1000
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.petHealth.allergiesAddField
                wait: 1000
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.petHealth.conditionsAddField
                wait: 1000
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.petInfo.continueButton
                wait: 3000

  # Add new vet details
  - name: us.functions.functional.checkout.reviewOrder.addNewVetDetails
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.checkout.reviewOrder.vetInfo.title
          then:
            - enterText:
                identifier: us.mappings.functional.checkout.reviewOrder.vetInfo.enterZipCodeField
                string: ${enterZipCode}
                clearField: true
            - executeFunction:
                name: us.functions.functional.util.clickKeyboardDone
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.vetInfo.vetName

            - sleep:
                duration: 3000

            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.vetInfo.saveButton
                wait: 3000

  - name: us.functions.functional.checkout.reviewOrder.add.newPet.and.newVet.details
    platform: ios
    flow:
      - loop:
          begin: 1
          end: 3
          storeIndex: index
          flow:
            - log: add new pet and vet index - ${index}
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.addNewPetButton
                then:
                  - click:
                      identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.addNewPetButton
                  - executeFunction:
                      name: us.functions.functional.checkout.reviewOrder.addNewPetDetails
                      params:
                        - name: petType
                          string: ${petType}
                        - name: petFirstName
                          string: ${petFirstName}${index}
                        - name: petLastName
                          string: ${petLastName}${index}
                        - name: petBirthDay
                          string: ${petBirthDay}
                        - name: petWeight
                          string: ${petWeight}

            - log: Add new vet details - ${index}
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.addNewVetButton
                then:
                  - click:
                      identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.addNewVetButton
                  - executeFunction:
                      name: us.functions.functional.checkout.reviewOrder.addNewVetDetails
                      params:
                        - name: enterZipCode
                          string: ${zipCode}

      - loop:
          begin: 1
          end: 5
          storeIndex: index
          flow:
            - log: get new pet and vet details - ${index}
            - if:
                condition: ${index} % 2 != 0
                then:
                  - log: get new pet details - ${index}
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.title
                        - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.selectedPetVetName
                  - getString:
                      identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.selectedPetVetName
                      attribute: value
                      storeIn: petName${(index + 1) / 2}
                  - log: $petName${(index + 1) / 2}, ${petName${(index + 1) / 2}} selected
                else:
                  - log: get new vet details - ${index}
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.title
                        - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.selectedPetVetName
                  - getString:
                      identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.selectedPetVetName
                      attribute: value
                      storeIn: vetName${index / 2}
                  - log: ${vetName${index / 2}}, $vetName${index / 2} selected

      - sleep:
          duration: 3000

      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.checkout.reviewOrder.editPetVetInfo.title
          then:
            - click:
                identifier: us.mappings.reviewOrder.SaveButton
