functions:
  # NOTE Moved these functions to this new file as part of refactoring, functionality to be updated with latest
  # during unified test automation. Update to support both platforms
  - name: us.functions.functional.buyNow.select.nonCaliPropAddress.and.verifyCaliProp65Warning
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.buynow.caliP65Warning.shipping.address.button
          then:
            - click:
                identifier: us.mappings.functional.buynow.caliP65Warning.shipping.address.button
            - sleep:
                duration: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.buyNow.selectAddress.titleNavigationBar
                  - identifier: us.mappings.functional.buynow.caliP65Warning.select.address.radioButton
            - click:
                identifier: us.mappings.functional.buynow.caliP65Warning.select.address.radioButton

            - sleep:
                duration: 1000

            - click:
                identifier: us.mappings.functional.buynow.caliP65Warning.select.address.continuebutton

      # validate there is no p65 warning in buynow module.
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.p65WarningView
            - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.preambleLabel
            - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.postambleLabel

  - name: us.functions.functional.checkout.reviewOrder.verifyCaliProp65Warning.and.verifyP65WarningBottomSheet
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.p65WarningView
            - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.preambleLabel
            - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.postambleLabel

      - click:
          identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.preambleLabel
          wait: 1000
      - log: caliP65Warning modal is displayed

      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.navBar
                  - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.warningTextView
                  - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.footerOkayButton
                  - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.closeButton
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.warningTextView
                    contains: ${caliP65WarningDescription}

            # Verifing list of items in cali prop65 warning bottomsheet
            - log: Verifing list of items in cali prop65 warning bottomsheet
            - loop:
                begin: 1
                end: ${itemsCount}
                storeIndex: itemIndex
                mode: increment
                flow:
                  - log: caliprop65warning items count - ${itemIndex}
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.Items
                      then:
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.Items

            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.caliP65Warning.bottomSheet.footerOkayButton

  - name: us.functions.functional.checkout.reviewOrder.verifyCaliProp65Warning.in.itemDetails
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.viewButton
          then:
            - click:
                identifier: us.mappings.functional.checkout.reviewOrder.itemDetails.viewButton
                wait: 3000
            - executeFunction:
                name: us.functions.functional.checkout.reviewOrder.verifyCaliProp65Warning.and.verifyP65WarningBottomSheet
