general:
  tags: prod-functional-bookslot, C2737763
  inherit:
    filesRunAll:
    - us-errors-helpers.yaml
  testCaseId: C2737763

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      # Get Environment Values
      - executeFunction:
          name: us.function.utils.getEnvironmentValue

      # Set Platform Values
      - executeFunction:
          name: functions.utils.setPlatformInfo

      - log: End Before test
        
    # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:
    - log: Start Main

    # Navigate onboarding to home
    - executeFunction:
        name: us.functions.global.onboarding.navigateOnboardingToHome

    # Navigate to sign in page
    - executeFunction:
        name: us.functions.home.navigateHomeToSignIn

    # Sign in with default account
    - executeFunction:
        name: us.functions.global.authentication.signInAccount
        params:
        - name: email
          string: us.data.prod.reserveSlot.changeStoreAndAddress.delivery.email
        - name: password
          string: us.data.prod.reserveSlot.changeStoreAndAddress.delivery.password

    # Navigate back to Home
    - executeFunction:
        name: us.functions.global.navigation.accountToHome

    # Navigate to cart
    - executeFunction:
        name: us.functions.global.navigation.toCartFromNavBar

    # Remove items from cart
    - executeFunction:
        name: us.functions.cart.removeAllCartItems
    - executeFunction:
        name: us.functions.cart.removeUnavailableItemsFromCart

      # Go back
    - executeFunction:
        name: us.functions.global.navigation.backNavigation

    # Open bookslot page from GIC in delivery
    - executeFunction:
        name: us.functions.loadBookingSlotScreen
        params:
          - name: page
            string: home
          - name: tab
            string: delivery

    # Store the initial value of the delivery address
    - getString:
        identifier: us.mappings.functional.reserveSlot.fulfillmentTitle
        storeIn: initialAddress
    - log: "Initial Address: ${initialAddress}"

    # Open the Change Address link
    - verifyIdentifier:
        present:
          - identifier: us.mappings.functional.reserveSlot.fulfillment.changeButton
    - click:
        wait: 3000
        identifier: us.mappings.functional.reserveSlot.fulfillment.changeButton
    - log: "Change button clicked"

    # Change to another delivery address
    - executeFunction:
        name: us.functions.functional.bookslot.changeToAnotherAddress
        params:
          - name: initialDeliveryAddress
            string: ${initialAddress}
    - sleep:
        duration: 2000

    # Store the updated value of the delivery address
    - getString:
        identifier: us.mappings.functional.reserveSlot.fulfillmentTitle
        storeIn: updatedAddress
    - log: "Updated Address: ${updatedAddress}"

    # Verify that the delivery address has changed
    - if:
        condition: ${initialAddress} != ${updatedAddress}
        then:
          - log: "Address has been successfully updated."
        else:
          - failTest:
              message: "Address update failed."

    - storeIn:
        key: testStatus
        value: passed

  - name: After
    after: true
    flow:
    - executeFunction:
        name: us.functions.utils.afterSteps
