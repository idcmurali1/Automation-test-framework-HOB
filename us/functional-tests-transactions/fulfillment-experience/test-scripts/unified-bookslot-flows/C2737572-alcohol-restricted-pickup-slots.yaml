general:
  tags: prod-functional-bookslot, C2737572
  inherit:
    filesRunAll:
    - us-errors-helpers.yaml
  testCaseId: C2737572

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      # Get Environment Values
      - executeFunction:
          name: us.function.utils.getEnvironmentValue

      # Set Platform Values
      - executeFunction:
          name: functions.utils.setPlatformInfo

      - log: End Before test

    # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:
    - log: Start Main

    # Navigate onboarding to home
    - executeFunction:
        name: us.functions.global.onboarding.navigateOnboardingToHome

    # Navigate to sign in page
    - executeFunction:
        name: us.functions.home.navigateHomeToSignIn

    # Sign in with default account
    - executeFunction:
        name: us.functions.global.authentication.signInAccount
        params:
        - name: email
          string: us.data.prod.reserveSlot.alcoholRestricted.pickup.email
        - name: password
          string: us.data.prod.reserveSlot.alcoholRestricted.pickup.password

    # Navigate back to Home
    - executeFunction:
        name: us.functions.global.navigation.accountToHome

    # Change intent to pickup
    - executeFunction:
        name: us.functions.functional.reserveSlot.changeIntent
        params:
          - name: intent
            string: Pickup

    # Navigate to cart
    - executeFunction:
        name: us.functions.global.navigation.toCartFromNavBar

    # Remove items from cart
    - executeFunction:
        name: us.functions.cart.removeAllCartItems
    - executeFunction:
        name: us.functions.cart.removeUnavailableItemsFromCart

    # Navigate back to Home
    - executeFunction:
        name: us.functions.global.navigation.accountToHome

    # Add SC item to cart 
    - executeFunction:
        name: us.functions.functional.reserveSlot.searchItemAndAddToCart
        params:
          - name: searchTerm
            string: pen

    # Add Alcohol item to cart 
    - executeFunction:
        name: us.functions.functional.reserveSlot.searchItemAndAddToCart
        params:
          - name: searchTerm
            string: light beer

    # Navigate to Cart
    - executeFunction:
        name: us.functions.global.navigation.toCartFromNavBar

    # Verify both alcohol restricted and SC items in cart
    - executeFunction:
        name: us.functions.functional.reserveSlot.verifyItemCountInCart
        params:
          - name: itemCount
            string: 2

    # Verify Alcohol restriction on Sunday and save Alcohol restricted slot
    - executeFunction:
        name: us.functions.loadBookingSlotScreen
        params:
          - name: page
            string: cart
          - name: tab
            string: pickup
    - executeFunction:
        name: us.functions.functional.reserveSlot.alcoholRestrictionOnSunday
        params:
          - name: day
            string: Sun

    # Verify alcohol restricted item has been removed
    - executeFunction:
        name: us.functions.functional.reserveSlot.verifyItemCountInCart
        params:
          - name: itemCount
            string: 1

    - storeIn:
        key: testStatus
        value: passed

  - name: After
    after: true
    flow:
    - executeFunction:
        name: us.functions.utils.afterSteps
