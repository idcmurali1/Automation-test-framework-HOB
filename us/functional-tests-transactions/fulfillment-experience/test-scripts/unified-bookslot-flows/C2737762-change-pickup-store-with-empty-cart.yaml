general:
  tags: prod-functional-bookslot, C2737762
  inherit:
    filesRunAll:
    - us-errors-helpers.yaml
  testCaseId: C2737762

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      # Get Environment Values
      - executeFunction:
          name: us.function.utils.getEnvironmentValue

      # Set Platform Values
      - executeFunction:
          name: functions.utils.setPlatformInfo

      - log: End Before test
      
      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:
    - log: Start Main

    # Navigate onboarding to home
    - executeFunction:
        name: us.functions.global.onboarding.navigateOnboardingToHome

    # Navigate to sign in page
    - executeFunction:
        name: us.functions.home.navigateHomeToSignIn

    # Sign in with default account
    - executeFunction:
        name: us.functions.global.authentication.signInAccount
        params:
        - name: email
          string: us.data.prod.reserveSlot.changeStoreAndAddress.pickup.email
        - name: password
          string: us.data.prod.reserveSlot.changeStoreAndAddress.pickup.password

    # Navigate back to Home
    - executeFunction:
        name: us.functions.global.navigation.accountToHome

    # Navigate to cart
    - executeFunction:
        name: us.functions.global.navigation.toCartFromNavBar

    # Remove items from cart
    - executeFunction:
        name: us.functions.cart.removeAllCartItems
    - executeFunction:
        name: us.functions.cart.removeUnavailableItemsFromCart

    # Go back
    - executeFunction:
        name: us.functions.global.navigation.backNavigation

    # Open bookslot page from GIC in pickup
    - executeFunction:
        name: us.functions.loadBookingSlotScreen
        params:
          - name: page
            string: home
          - name: tab
            string: pickup

    # Store the initial value of the store
    - getString:
        identifier: us.mappings.functional.reserveSlot.fulfillmentTitle
        storeIn: initialAddress
    - log: "Initial Address: ${initialAddress}"

    # Open the Change Store link
    - verifyIdentifier:
        present:
          - identifier: us.mappings.functional.reserveSlot.fulfillment.changeButton
    - click:
        wait: 3000
        identifier: us.mappings.functional.reserveSlot.fulfillment.changeButton
    - log: "Change button clicked"

    # Change to another pickup store
    - executeFunction:
        name: us.functions.functional.storeSelector.changeToAnotherStore
        params:
          - name: initialStoreAddress
            string: ${initialAddress}
    - sleep:
        duration: 2000

    # Store the updated value of the store
    - getString:
        identifier: us.mappings.functional.reserveSlot.fulfillmentTitle
        storeIn: updatedAddress
    - log: "Updated Address: ${updatedAddress}"

    # Verify that the store has changed
    - if:
        condition: ${initialAddress} != ${updatedAddress}
        then:
          - log: "Store has been successfully updated."
        else:
          - failTest:
              message: "Store update failed."

    - storeIn:
        key: testStatus
        value: passed

  - name: After
    after: true
    flow:
    - executeFunction:
        name: us.functions.utils.afterSteps
