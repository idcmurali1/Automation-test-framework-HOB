functions:
  - name: unified.us.functions.paypal.changePaymentsButton
    flow:
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.editPayment
            - name: direction
              string: down
      - click:
          identifier: us.mappings.reviewOrder.editPayment
      - sleep:
          duration: 6000
      - if:
          condition: ${platform} == 'iOS'
          then:
            - executeFunction:
                name: unified.us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.wallet.paypalButton
                  - name: direction
                    string: down
                
      - if:
          condition: ${platform} == 'Android'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wallet.paypalButton
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.wallet.paypalButton        
          then:
            - log: "Paypal Card already added Removing card to continue with scenario"            
            - executeFunction:
                name: unified.us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.account.walletPaypalCardView
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - click: 
                identifier: us.mappings.account.walletPaypalCardRemoveButton 
            - sleep:
                duration: 1000             
            - click: 
                identifier: us.mappings.account.walletPaypalCardRemoveConfirmButton
            - verifyIdentifier:
                notPresent:
                    - identifier: us.mappings.account.walletPaypalCardView
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.paypalWebView.accountDetails
                  enabled:
                    - identifier: us.mappings.paypalWebView.accountDetails
                      value: true         
                then:
                  - log: 'Remember my PayPal account Selected'
                  - click:
                      identifier: us.mappings.paypalWebView.accountDetails
                else: 
                  - log: 'Remember my PayPal account Not Selected'

      - click:
          identifier: us.mappings.wallet.paypalButton
      - sleep:
          duration: 8000    
      - if:
          condition: ${platform} == 'Android'
          then:                 
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.paypalWebView.agreeandcontinueButton
                then:
                  - click:
                      identifier: us.mappings.paypalWebView.agreeandcontinueButton     
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.paypalWebView.saveandcontinueButton
                then:
                  - click:
                      identifier: us.mappings.paypalWebView.saveandcontinueButton                      
                else:
                  - executeFunction:
                      name: unified.us.functions.paypal.logInPage       
            - sleep:
                duration: 10000

  - name: unified.us.functions.paypal.logInPage
    flow:
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.editPayment
            - name: direction
              string: down
      - click:
          identifier: us.mappings.reviewOrder.editPayment
      - sleep:
          duration: 6000
      - if:
          condition: ${platform} == 'iOS'
          then:
            - executeFunction:
                name: unified.us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.wallet.paypalButton
                  - name: direction
                    string: down
                
      - if:
          condition: ${platform} == 'Android'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wallet.paypalButton

      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.paypalWebView.accountDetails
                  enabled:
                    - identifier: us.mappings.paypalWebView.accountDetails
                      value: true         
                then:
                  - log: 'Remember my PayPal account Selected'
                  - click:
                      identifier: us.mappings.paypalWebView.accountDetails
                else: 
                  - log: 'Remember my PayPal account Not Selected'

      - click:
          identifier: us.mappings.wallet.paypalButton
      - sleep:
          duration: 8000    
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.wallet.paypalWebView.confirmationPopupTitle
                then:
                  - click:
                      identifier: us.mappings.paypal.popupContinueButton 
      - if:
          identifier:
            present:
              - identifier: us.mappings.paypalWebView.acceptCookies
          then:
            - click:
                identifier: us.mappings.paypalWebView.acceptCookies
      - if:
          identifier:
            present:
              - identifier: us.mappings.paypalWebView.emailTextField
          then:
            - click:
                identifier: us.mappings.paypalWebView.emailTextField
            - enterText:
                identifier: us.mappings.paypalWebView.emailTextField
                string: pgptest@walmart.com
                clearField: true
            - sleep:
                duration: 2000                
            - click:
                identifier: us.mappings.paypalWebView.nextButton
            - click:
                identifier: us.mappings.paypalWebView.passwordTextField
            - enterText:
                identifier: us.mappings.paypalWebView.passwordTextField
                string: testing4pgp$
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.default.keyboardDoneButton
                then:
                  - click:
                      identifier: us.mappings.default.keyboardDoneButton

            - click:
                identifier: us.mappings.paypalWebView.loginButton
            - sleep:
                duration: 5000
            - if:
                condition: ${platform} == 'iOS'
                then:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.global.notNowButton
                      then:
                        - click:
                            identifier: us.mappings.global.notNowButton
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.paypalWebView.acceptCookies
                      then:
                        - click:
                            identifier: us.mappings.paypalWebView.acceptCookies
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.paypalWebView.agreeandcontinueButton
                            then:
                              - click:
                                  identifier: us.mappings.paypalWebView.agreeandcontinueButton
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.paypalWebView.saveandcontinueButton
                            then:
                              - click:
                                  identifier: us.mappings.paypalWebView.saveandcontinueButton                      
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.orderdeatils.continueToAppButton
                            then:
                              - click:
                                  identifier: us.mappings.orderdeatils.continueToAppButton
                        - sleep:
                            duration: 5000
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.wallet.PaypalPaymentContinueButton
                            then:
                              - click:
                                  identifier:  us.mappings.wallet.PaypalPaymentContinueButton
                        - sleep:
                            duration: 3000
                      else:
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.paypalWebView.agreeandcontinueButton
                            then:
                              - click:
                                  identifier: us.mappings.paypalWebView.agreeandcontinueButton
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.paypalWebView.saveandcontinueButton
                            then:
                              - click:
                                  identifier: us.mappings.paypalWebView.saveandcontinueButton                  
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.orderdeatils.continueToAppButton
                            then:
                              - click:
                                  identifier: us.mappings.orderdeatils.continueToAppButton
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.wallet.paypalSuccessMessage   
                        - sleep:
                            duration: 5000
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.wallet.PaypalPaymentContinueButton
                            then:
                              - click:
                                  identifier: us.mappings.wallet.PaypalPaymentContinueButton
                        - sleep:
                            duration: 3000
                        - if:
                            identifier:
                              present:
                                - identifier: us.mappings.wallet.PaypalPaymentCardError
                            then:
                              - failTest:
                                  message: "ENV_FAILURE - ${env} - Unable to Add Paypal Card"
      - if:
          condition: ${platform} == 'Android'
          then:
            - click:
                identifier: us.mappings.paypalWebView.loginButton
            - click:
                identifier: us.mappings.paypalWebView.saveandcontinueButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.wallet.paypalSuccessMessage  
            - sleep:
                duration: 3000
            - click:
                identifier: us.mappings.wrs.saveButton                    


  - name: unified.us.functions.paypal.removePayPalCard
    flow:
       - executeFunction:
           name: unified.us.functions.global.navigation.goToDeepLink
           params:
             - name: deepLinkUrl
               string: walmart://home
       - executeFunction:
           name: unified.us.functions.home.closeWPlusPromotionPopUpIfDisplayed
       - executeFunction:
          name: unified.us.functions.global.navigation.toTab
          params:
            - name: tabName
              string: Account
       - executeFunction:
           name: unified.us.functions.home.closeWPlusPromotionPopUpIfDisplayed
       - executeFunction:
           name: unified.us.functions.global.navigation.goToDeepLink
           params:
             - name: deepLinkUrl
               string: walmart://wallet
       - sleep:
            duration: 1000 
       - executeFunction:
           name: unified.us.functions.utils.scrollIfNotVisible
           params:
             - name: identifier
               string: us.mappings.account.walletPaypalCardView
             - name: direction
               string: down
             - name: scrollPosition
               string: center
       - click: 
          identifier: us.mappings.account.walletPaypalCardRemoveButton 
       - sleep:
           duration: 1000             
       - click: 
           identifier: us.mappings.account.walletPaypalCardRemoveConfirmButton
       - verifyIdentifier:
           notPresent:
              - identifier: us.mappings.account.walletPaypalCardView 
