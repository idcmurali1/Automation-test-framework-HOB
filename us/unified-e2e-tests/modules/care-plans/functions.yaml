functions:

- name: unified.us.functions.carePlans.validateAddOns
  flow:
    - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.wppSection
            - name: direction
              string: down
            - name: scrollPosition
              string: center  
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.wppSection
          - identifier: us.mappings.carePlans.expertHelpSection

#Add Item to Cart and Click Decline Button 
- name: unified.us.functions.item.addItemToCartAndDeclineProtectionCoverage
  flow:
    - executeFunction:
        name: unified.us.functions.item.addItemToCart
        params:
          - name: skipPostAddToCartSteps
            string: true
    - verifyIdentifier:
        timeout: 50000
        present:
          - identifier: us.mappings.carePlans.declineButton
    - if:
        condition: ${declineUsing} == 'closeButton'
        then:
          - click:
              identifier: us.mapping.item.addWalmartProtectionPlan.closeButton
          - executeFunction:
              name: us.functions.item.postAddToCartSteps
        else:
          - click:
              identifier: us.mappings.carePlans.declineButton
          - sleep: 
              duration: 5000
    - executeFunction:
        name: unified.us.functions.item.closeItemPage

- name: unified.us.function.carePlans.viewDetailsPlan
  flow:
    - if:
        identifier:
          present:
            - identifier: us.mappings.cart.smartNudgeView
        then:
          - click:
              identifier: us.mappings.cart.smartNudgeViewClose
    - executeFunction:
        name: unified.us.functions.utils.scrollIfNotVisible
        params:
          - name: identifier
            string: us.mappings.carePlans.viewDetailPlan   
          - name: direction
            string: down
    - click:
        identifier: us.mappings.carePlans.viewDetailPlan
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.verifyDetailsPlanTitleLabel
    - click:
        identifier: us.mappings.global.closeButton

- name: unified.us.function.carePlans.viewDetailsExpertHelp
  flow:
    - executeFunction:
        name: unified.us.functions.utils.scrollIfNotVisible
        params:
          - name: identifier
            string: us.mappings.carePlans.viewDetailsExpertHelp     
          - name: direction
            string: down
    - click:
        identifier: us.mappings.carePlans.viewDetailsExpertHelp
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.verifyDetailsExpertHelpTitleLabel
    - click:
        identifier: us.mappings.global.closeButton

- name: unified.us.functions.carePlans.selectAddOns
  flow:
    - executeFunction:
        name: unified.us.functions.utils.scrollIfNotVisible
        params:
          - name: identifier
            string: us.mappings.carePlans.wppSection    
          - name: direction
            string: down
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.wppSection
          - identifier: us.mappings.carePlans.wppSectionHeader
    - click:
        identifier: us.mappings.carePlans.wppSectionHeader
    - if:
        identifier:
          present:
            - identifier: us.mappings.carePlans.wppSectionViewDetails
        then:
          - click:
              identifier: us.mappings.buyNow.closeButton
    - log: WPP section details validated!
    - if:
        identifier:
          present:
            - identifier: us.mappings.carePlans.wppOption
        then:
          - click:
              identifier: us.mappings.carePlans.wppOption
    - log: WPP module is validated and plan is selected!
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.expertHelpSectionHeader
    - click:
        identifier: us.mappings.carePlans.expertHelpSectionHeader
        wait: 3000
    - if:
        identifier:
          present:
            - identifier: us.mappings.carePlans.verifyDetailsExpertHelpTitleLabel
        then:
          - click:
              identifier: us.mappings.buyNow.closeButton
    - log: Expert help section details validated!
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.expertHelpSectionHeader
    - click:
          identifier: us.mappings.carePlans.expertHelpOption
    - if:
        identifier:
          present:
            - identifier: us.mappings.carePlans.SecondProductItem
        then:
          - click:
              identifier: us.mappings.carePlans.wppOptionSecondItem
          - click:
              identifier: us.mappings.carePlans.expertHelpOptionSecondItem
    - log: Expert help module is validated and plan is selected!

- name: unified.us.functions.carePlans.verifyWhetherCarePlansSelected
  flow:
    - if:
        identifier:
          present:
            - identifier: us.mappings.carePlans.gotItButton
        then:
          - click:
              identifier: us.mappings.carePlans.gotItButton
    - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.multibox.viewItemDetaisReviewOrder
            - name: direction
              string: down
            - name: scrollPosition
              string: center  
            - name: scrollLimit
              string: 1
    - click:
        identifier: us.mappings.multibox.viewItemDetaisReviewOrder
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.selectedAddOns
    - click:
        identifier: us.mappings.carePlans.ItemDetailsCloseButton
      
# Add Walmart Protection Plan from PAC screen
- name: unified.us.functions.carePlans.addProtectionPlanFromPACScreen
  flow:
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.pacHeader
    - click:
        identifier: us.mappings.carePlans.addAOSButtonPAC
    - sleep:
        duration: 5000
    - if:
        identifier:
          present:
            - identifier: us.mappings.global.closeButton
        then:
          - click:
              identifier: us.mappings.global.closeButton

  #apple free offers 
- name: unified.us.functions.carePlans.applefreeoffers.validateOffers
  flow:
    - verifyIdentifier:
        present:
          - identifier: us.mappings.AppleFreeOffers.Validateoffers
    - click:
        identifier: us.mappings.AppleFreeOffers.Validateoffers      
    - verifyIdentifier:
        present:
          - identifier: us.mappings.AppleFreeOffers.ValidateArcadePlan
    - verifyIdentifier:
        present:
          - identifier: us.mappings.AppleFreeOffers.CloseOffers
    - click:
        identifier: us.mappings.AppleFreeOffers.CloseOffers 

- name: unified.us.functions.carePlans.verifyCarePlansSelectedInCart
  flow:
    - executeFunction:
        name: unified.us.functions.cart.scrollToTopOfCart
    - executeFunction:
        name: unified.us.functions.utils.scrollIfNotVisible
        params:
          - name: identifier
            string: us.mappings.carePlans.selectedProtectionPlanInCart
          - name: direction
            string: down
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.selectedProtectionPlanInCart
    - log: Selected Protection plan validated in Cart!
    - executeFunction:
        name: unified.us.functions.utils.scrollIfNotVisible
        params:
          - name: identifier
            string: us.mappings.carePlans.expertHelpOption
          - name: direction
            string: down
    - verifyIdentifier:
        present:
          - identifier: us.mappings.carePlans.wppOption
          - identifier: us.mappings.carePlans.expertHelpOption          

- name: unified.us.functions.item.verifyAddToRewardCheckboxandClipRewardFromItemPage
  flow:
      - sleep:
          duration: 7000  
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params: 
            - name: identifier
              string: us.mappings.search.rewardsCheckBox
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsCheckBox
          then:          
              - click:
                  identifier: us.mappings.search.rewardsCheckBox
                  wait: 3000
              - verifyIdentifier: 
                  present:
                    - identifier: us.mappings.search.rewardsAddedItem
          else:
              - scroll:
                  direction: up
                  untilIdentifier: us.mappings.search.rewardsAddedItem
              - verifyIdentifier: 
                  present:
                      - identifier: us.mappings.search.rewardsAddedItem

- name: unified.us.functions.item.addRewardItemToList
  flow:
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.itemPage.addToListOption
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - sleep:
          duration: 2000    
      - click: 
          identifier: us.mappings.itemPage.addToListOption
      - sleep:
          duration: 4000
      - click: 
          identifier: us.mappings.item.productAddItemListPage
      - sleep:
          duration: 2000                                        
      - click: 
          identifier: us.mappings.global.saveButton
      - sleep:
          duration: 4000

- name: unified.us.functions.item.list.checkIfRewardAddedinTheList
  flow:
    - verifyIdentifier:
        present:
          - identifier: us.mappings.itemPage.clickOnFirstList
    - click: 
        identifier: us.mappings.itemPage.clickOnFirstList
    - sleep:
        duration: 2000
    - if:
        identifier:
          present:
            - identifier: us.mappings.list.earnedRewardTagWithCash
        then:
            - log: "Walmart cash reward earned tag is displayed"
        else:
          - failTest:
              message: "ENV_FAILURE - ${env} - Walmart cash reward earned tag is NOT displayed"
          
- name: unified.us.functions.item.list.clickListOption
  flow:
    - sleep:
        duration: 3000
    - if:
        identifier:
          notPresent:
            - identifier: us.mappings.itemPage.createListOptionButton
        then:
          - verifyIdentifier:
              present:
                - identifier: us.mappings.itemPage.listOption
          - click: 
              identifier: us.mappings.itemPage.listOption
          - sleep:
              duration: 3000

- name: unified.us.functions.item.verifyRewardClippingOnItemPage
  flow:
    - sleep:
        duration: 7000  
    - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params: 
            - name: identifier
              string: us.mappings.search.rewardsCheckBox
            - name: direction
              string: down
    - if:
        identifier:
          present:
            - identifier: us.mappings.search.rewardsCheckBox
        then:          
          - click:
              identifier: us.mappings.search.rewardsCheckBox
              wait: 3000

