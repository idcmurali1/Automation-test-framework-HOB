functions:

  - name: unified.us.functions.orderDetails.ost.EBTATPICKUP.verifyOrderStatus
    flow:
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderdetails.payAtPickUpTitle
            - name: direction
              string: down
            - name: scrollPosition
              string: center  
      - if:
          condition: ${platform} == 'iOS'
          then:
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.orderdetails.payAtPickUpTitle
                label:
                  - identifier: us.mappings.orderdetails.payAtPickUpTitle
                    contains: Pay at pickup    
      - if:
          condition: ${platform} == 'Android'
          then:
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.orderdetails.payAtPickUpTitle
                text:
                  - identifier: us.mappings.orderdetails.payAtPickUpTitle
                    contains: Pay at pickup

  # Function to validate EBT payment during checkout/amend
  - name: unified.us.functions.account.paymentMethod.enterEBTPin
    flow:
      - log: "Required EBT Payment PIN to Proceed Order Placement"
      - if:
          identifier:
            present:
              - identifier: us.mappings.paymentMethod.checkout.continueButton
          then:
            - click:
                identifier: us.mappings.paymentMethod.checkout.continueButton
                wait: 10000
      - sleep:
          duration: 20000
      - if:
          condition: ${platform} == 'iOS'
          then:
            - executeFunction:
                name: unified.us.functions.utils.handleTechnicalErrorPopup
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.EBTPage.cardNumber
      - loop:
          begin: 1
          end: 5
          storeIndex: index
          mode: increment
          flow:
            - click:
                identifier: us.mappings.paymentMethod.checkout.EBTPage.pin
                wait: 3000
      - click:
          identifier: us.mappings.paymentMethod.checkout.EBTPage.cardNumber
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.paymentMethod.checkout.EBTPage.submit
      - click:
          identifier: us.mappings.paymentMethod.checkout.EBTPage.submit
          wait: 5000
      - sleep: 
          duration: 5000
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.paymentMethod.checkout.EBTPage.cardNumber

 # Function to validate WIC payment during checkout/amend
  - name: unified.us.functions.account.paymentMethod.enterWICPin
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.Wic.continueButton
      - click:
          identifier:  us.mappings.paymentMethod.checkout.Wic.continueButton
          wait: 10000
      - if:
          condition: ${platform} == 'iOS'
          then:
            - executeFunction:
                name: us.functions.utils.handleTechnicalErrorPopup
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.WicPage.cardNumber
      - enterText:
          identifier: us.mappings.paymentMethod.checkout.newWicPage.pinEdit # This Identifier needs to be updated as per the Fiserv Edit Screen During Wic intiative 05/06
          string: ${pin}
      - click:
          identifier: us.mappings.paymentMethod.checkout.WicPage.cardNumber
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.paymentMethod.checkout.WicPage.submit
      - click:
          identifier: us.mappings.paymentMethod.checkout.WicPage.submit
          wait: 5000
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.paymentMethod.checkout.WicPage.cardNumber

  - name: unified.us.functions.account.paymentMethod.addCreditCardDetails
    flow:
      - if:
          condition: ${page} == 'wallet'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.accounts.wallet.addPaymentButton
            - sleep:
               duration: 7000
            - click:
                identifier: us.mappings.accounts.wallet.addPaymentButton
          else:
            - verifyIdentifier:
                timeout: 20000
                present:
                  - identifier: us.mappings.paymentMethod.addPayment.selectCardType.title
      - if:
          identifier:
            present:
              - identifier: us.mappings.accounts.wallet.addCreditDebitCardLink
          then:
              - click:
                  identifier: us.mappings.accounts.wallet.addCreditDebitCardLink
      - executeFunction:
          name: us.functions.account.paymentMethod.addCardDetails

  # Verify Gift card History from wallet
  - name: unified.us.functions.account.paymentMethod.verifyGiftCardHistory
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.wallet.verifyGiftcardTitle
            - identifier: us.mappings.wallet.verifyViewCardHistory
      - click:
          identifier: us.mappings.wallet.verifyViewCardHistory
      - sleep:
          duration: 7000
      - if:
          condition: ${platform} == 'iOS'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.wallet.verifyGiftCardHistoryTitle
                  - identifier: us.mappings.wallet.verifyGiftCardNumber
                  - identifier: us.mappings.wallet.verifyGcHistoryDateDescription
                  - identifier: us.mappings.wallet.verifyGcHistoryBalance
                  - identifier: us.mappings.paymentMethod.closeButton
            - click:
                identifier: us.mappings.paymentMethod.closeButton            
      - if: 
          condition: ${platform} == 'Android'
          then:
            - click:
                identifier: us.mappings.reserveSlot.closeButton  
            - sleep:
                duration: 4000
            - click:
                identifier: us.mappings.wallet.verifyViewCardHistory
            - sleep:
                duration: 7000
            - click:
                identifier: us.mappings.wallet.verifyGcHistoryTransaction 
            - loop:
                begin: 0
                end: 3
                mode: increment
                storeIndex: i
                flow:
                  - if:
                        identifier:
                          notPresent:
                            - identifier: us.mappings.wallet.verifyGcHistoryDesriptionDetails
                        then:
                          - executeFunction:
                              name: us.functions.account.paymentMethod.closeGiftCardHistoryPage
                          - executeFunction:
                              name: us.functions.account.paymentMethod.openGiftCardHistoryPage
                        else:
                          - executeFunction:
                              name: us.functions.account.paymentMethod.verifyGiftCardHistoryData
                          - break: true

  # Add credit/debit card from accounts
  - name: unified.us.functions.account.paymentMethod.addCreditCardDetails
    flow:
      - if:
          condition: ${platform} == 'Android'
          then:
            - executeFunction:
                name: us.functions.account.paymentMethod.selectPaymentType
            - executeFunction:
                name: us.functions.account.paymentMethod.addCardDetails
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                condition: ${page} == 'wallet'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.accounts.wallet.addPaymentButton
                  - click:
                      identifier: us.mappings.accounts.wallet.addPaymentButton
                else:
                  - verifyIdentifier:
                      timeout: 20000
                      present:
                        - identifier: us.mappings.paymentMethod.addPayment.selectCardType.title
            - click:
                identifier: us.mappings.accounts.wallet.addCreditDebitCardLink
            - executeFunction:
                name: us.functions.account.paymentMethod.addCardDetails
            - sleep:
                duration: 5000

#Delete a credit/debit card from accounts
  - name: unified.us.functions.account.paymentMethod.deleteCreditCard
    flow:
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.accounts.wallet.expandCollapseButton
                then:
                  - click:
                      identifier: us.mappings.accounts.wallet.expandCollapseButton
                      wait: 3000
      - if:
          condition: ${platform} == 'Android'
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.accounts.walletTitle
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.accounts.walletTitle
                then:
                  - click:
                      identifier: us.mappings.accounts.walletTitle
                      wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.paymentMethod.creditCard.edit
          then:
            - click:
                identifier: us.mappings.paymentMethod.creditCard.edit
                wait: 3000
            - click:
                identifier: us.mappings.paymentMethod.creditCard.delete
                wait: 3000
            - click:
                identifier: us.mappings.paymentMethod.creditCard.deleteConfirmation
                wait: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.accounts.wallet.title