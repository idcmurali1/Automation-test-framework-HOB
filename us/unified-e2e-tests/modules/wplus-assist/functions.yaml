functions:

  # W+ Assist MLP
  - name: unified.us.functions.wplus.assist.mlp
    flow: 
      - verifyIdentifier:
          text:
            - identifier: us.mappings.wplus.assist.title
              contains: Walmart+ Assist
          present:
            - identifier: us.mappings.wplus.assist.verifyEligibilityBtn
      - click:
          identifier: us.mappings.wplus.assist.verifyEligibilityBtn
          wait: 3000

 # Verifying the SheerIDs screen and Submitting the SheerIDs form
  - name: unified.us.functions.wplus.assist.sheeridscreen
    flow:
      - sleep:
          duration: 5000    
      - if:
          condition: ${platform} == 'Android'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.wplus.sheerIDScreen.title  
                  - identifier: us.mappings.wplus.sheerIDScreen.subtitle 
                  - identifier: us.mappings.wplus.sheerIDScreen.programfield 
                  - identifier: us.mappings.wplus.sheerIDScreen.firstnamefield   
                  - identifier: us.mappings.wplus.sheerIDScreen.lastnamefield 
                  - identifier: us.mappings.wplus.sheerIDScreen.DOBfield
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.programfield
                wait: 3000 
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.firstnamefield
                wait: 3000                       
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.governmentassistantprogramfield
                wait: 3000 
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.title
                wait: 3000
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.governmentassistantprogramfield
                wait: 3000 
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.title
                wait: 3000
            - hideKeyboard: true 
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wplus.sheerIDScreen.DOBfield           
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.wplus.sheerIDScreen.DOBfield
            - enterText:
                identifier: us.mappings.wplus.sheerIDScreen.DOBfield
                string: 11/11/1990
            - hideKeyboard: true
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.wplus.sheerIDScreen.currentlocationlink                        
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wplus.sheerIDScreen.emailadressfield
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.wplus.sheerIDScreen.streetaddressfield  
                  - identifier: us.mappings.wplus.sheerIDScreen.cityfield 
                  - identifier: us.mappings.wplus.sheerIDScreen.statefield 
                  - identifier: us.mappings.wplus.sheerIDScreen.zipcodefield   
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wplus.sheerIDScreen.emailadressfield
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.wplus.sheerIDScreen.emailadressfield 
                  - identifier: us.mappings.wplus.sheerIDScreen.verifymystatusbtn                                        
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wplus.sheerIDScreen.disclaimermessage
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.wplus.sheerIDScreen.disclaimermessage
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.verifymystatusbtn
                wait: 3000                                                    
      - if:
          condition: ${platform} == 'iOS'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.wplus.sheerIDScreen.title  
                  - identifier: us.mappings.wplus.sheerIDScreen.subtitle 
                  - identifier: us.mappings.wplus.sheerIDScreen.programfield 
                  - identifier: us.mappings.wplus.sheerIDScreen.firstnamefield   
                  - identifier: us.mappings.wplus.sheerIDScreen.lastnamefield 
                  - identifier: us.mappings.wplus.sheerIDScreen.DOBfield
                  - identifier: us.mappings.wplus.sheerIDScreen.currentlocationlink 
                  - identifier: us.mappings.wplus.sheerIDScreen.streetaddressfield 
                  - identifier: us.mappings.wplus.sheerIDScreen.cityfield 
                  - identifier: us.mappings.wplus.sheerIDScreen.statefield   
                  - identifier: us.mappings.wplus.sheerIDScreen.zipcodefield 
                  - identifier: us.mappings.wplus.sheerIDScreen.emailadressfield  
                  - identifier: us.mappings.wplus.sheerIDScreen.disclaimermessage 
                  - identifier: us.mappings.wplus.sheerIDScreen.verifymystatusbtn 
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.programfield
                wait: 3000
            - click:
                identifier: Done
                wait: 3000 
            - click:
                identifier: Done
                wait: 3000
            - enterText:
                identifier: us.mappings.wplus.sheerIDScreen.firstnamefield 
                string: Test  
            - enterText:
                identifier: us.mappings.wplus.sheerIDScreen.lastnamefield
                string: Test                                 
            - enterText:
                identifier: us.mappings.wplus.sheerIDScreen.DOBfield
                string: 11/11/1990   
            - click:
                identifier: Done
                wait: 3000
            - click:
                identifier: us.mappings.wplus.sheerIDScreen.verifymystatusbtn 
                wait: 3000                                                                                    
                                    
  # Active inhome/canceled membership refund details validation on select membership bottom sheet
  - name: unified.us.functions.wplus.assist.membership.verifyRefundDetails
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.functions.wplus.assist.membership.refundInfor
              contains: refunded


  # Select membership plan(Monthly/Annual)
  - name: unified.us.functions.wplus.assist.selectMembershipPlan
    flow:
      - log: Tenure is ${tenure}
      - if:
          condition: ${tenure} == 'monthly'
          then:
            - executeFunction:
                name: unified.us.functions.wplus.assist.selectMonthlyPlan
      - if:
          condition: ${tenure} == 'annual'
          then:
            - executeFunction:
                name: unified.us.functions.wplus.assist.selectAnnualPlan

    
  # Select monthly membership
  - name: unified.us.functions.wplus.assist.selectMonthlyPlan
    flow:
      - click:
          identifier: us.mappings.wplus.assist.membership.monthlyPay
          wait: 1000
      - executeFunction:
          name: unified.us.functions.wplus.assist.membership.clickContinueBtn
     
  # Select annual membership
  - name: unified.us.functions.wplus.assist.selectAnnualPlan
    flow:
      - if:
          condition: ${platform} == 'Android'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wplus.reactivate.checkBox 
            - click:
                identifier: us.mappings.wplus.reactivate.checkBox          
            - executeFunction:
                name: unified.us.functions.wplus.assist.membership.clickContinueBtn
      - if:
          condition: ${platform} == 'iOS'
          then:
            - click:
                identifier: us.mappings.wplus.assist.membership.annualPay
                wait: 3000
            - scroll:
                direction: down
                untilIdentifier: us.mappings.wplus.aquisition.legalCheckBox
            - click:
                identifier: us.mappings.wplus.aquisition.legalCheckBox
            - executeFunction:
                name: unified.us.functions.wplus.assist.membership.clickContinueBtn            
       

  # Click start free trial / change plan / switch to assist button
  - name: unified.us.functions.wplus.assist.membership.clickContinueBtn
    flow:
      - if:
          identifier:
            present: 
              - identifier: us.mappings.wplus.assist.membership.signUpBtn #'start free trial' and 'switch to W+ assist' button have same identifier on Android
          then:
            - click:
                identifier: us.mappings.wplus.assist.membership.signUpBtn
                wait: 1000
          else:
            - if:
                identifier:
                  present: 
                    - identifier: us.mappings.wplus.assist.membership.changePlanBtn
                then:
                  - click:
                      identifier: us.mappings.wplus.assist.membership.changePlanBtn
                      wait: 1000
                else:
                  - if:
                      condition: ${platform} == 'iOS'
                      then:
                      identifier:
                        present: 
                          - identifier: us.mappings.wplus.assist.membership.switchToAssistBtn
                      then:
                        - click:
                            identifier: us.mappings.wplus.assist.membership.switchToAssistBtn
                            wait: 1000
                      else:
                        - failTest:
                            message: "ENV_FAILURE - ${env} - Required primary CTA not present in the W+ assist page"

 
  # Verify My Assist Membership details on Manage Membership Screen
  # if tenure is annual, then annual verification happens
  # otherwise monthly verification happens
  # if membership type is trial, then trial verification happens
  - name: unified.us.functions.wplus.assist.manageMembership.verifyMembership
    flow:
      - log: Verifying My Membership Details on Manage Membership
      - verifyIdentifier: 
          timeout: 3000
          present: 
            - identifier: us.mappings.wplus.managemembership.walmartplusmodule.title
            - identifier: us.mappings.wplus.managemembership.managewalmartplus.cta
      - if:
          condition: ${membershipType} == 'paid'
          then:
            - verifyIdentifier: 
                timeout: 3000
                present: 
                  - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.paid.renew.title
                  - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.paid.renew.date
            - if:
                condition: ${tenure} == 'annual'
                then:
                  - log: Verifying Assist Paid Annual Tenure Details
                  - verifyIdentifier: 
                        timeout: 3000
                        present: 
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.paid.annual.title
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.paid.annual.price.title
                else:
                  - log: Verifying Assist Paid Monthly Tenure Details
                  - verifyIdentifier: 
                        timeout: 3000
                        present: 
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.paid.monthly.title
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.paid.monthly.price.title
                          - identifier: us.mappings.wplus.managemembership.nbacard.upgradetoannual.cta
            - log: Paid assist membership
      - if:
          condition: ${membershipType} == 'trial'
          then:
            - if:
                condition: ${tenure} == 'annual'
                then:
                  - log: Verifying Assist Trial Annual Tenure Details
                  - verifyIdentifier: 
                        timeout: 3000
                        present: 
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.trial.annual.title
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.trial.price.annual.title
                  - verifyIdentifier:
                      # Verify the text of price for annual and monthly membership
                      value:
                        - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.trial.price.annual.title
                          contains: $49
                else:
                  - log: Verifying Assist Trial Monthly Tenure Details
                  - verifyIdentifier: 
                        timeout: 3000
                        present: 
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.trial.monthly.title
                          - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.trial.price.monthly.title

                  - verifyIdentifier:
                      # Verify the text of price for annual and monthly membership
                      value:
                        - identifier: us.mappings.wplus.managemembership.walmartplus.planoverview.planname.assist.trial.price.monthly.title
                          contains: $6.47
            - log: Trial assist membership

  # Verify inhome membership on manage membership hub
  - name: unified.us.functions.wplus.assist.manageMembership.verifyInhomeMembership
    flow:
      - log: Inhome Tenure is ${tenure}
      - if:
          condition: ${tenure} == 'monthly'
          then:
            - verifyIdentifier: 
                text:
                  - identifier: us.mappings.manageMembership.inHome.plusUps.addOnPrice
                    contains: Cancel InHome
                  - identifier: us.mappings.wplus.inHome.plusUps.payment.description
                    contains: $7  
            - log: Monthly inhome membership
      - if:
          condition: ${tenure} == 'annual'
          then:
            - verifyIdentifier: 
                text:
                  - identifier: us.mappings.manageMembership.inHome.plusUps.addOnPrice
                    contains: Cancel InHome
                  - identifier: us.mappings.wplus.inHome.plusUps.payment.description
                    contains: $40
            - log: Annual inhome membership


  # Welcome splash after sign up
  - name: unified.us.functions.wplus.welcomeSplash
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.welcomeSplash.title
          then:
            - if:
                condition: ${memberType} == 'nonMember'  
                then:
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.wplus.welcomeSplash.subTitle
                          contains: Enjoy your free trial until
                  - log: Non member signup for assist successfully
            - if:
                condition: ${memberType} == 'student'  
                then:
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.wplus.welcomeSplash.subTitle
                          contains: Student plan
                  - log: Non member signup for student successfully
            - if:
                condition: ${memberType} == 'inhome'  
                then:
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.wplus.welcomeSplash.subTitle
                          contains: Now you can access all of the benefits of your Walmart+ membership.
                  - log: Inhome member signup for assist successfully
            - if:
                condition: ${memberType} == 'canceled'
                then:
                  # Verify refund information
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.wplus.welcomeSplash.subTitle
                          contains: You’ll receive a pro-rated refund
                  - log: Canceled active member signup for assist successfully
            - log: Close the Splash
            - click:
                identifier: us.mappings.wplus.welcomeSplash.closeBtn