functions:
  - name: unified.us.functions.scanner.assert.scannerBottomSheet
    flow:
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if: 
                condition: ${option} == 'onlineandstore'
                then: 
                  - verifyIdentifier:
                      present: 
                        - identifier: us.mappings.scanner.itemName
                  - getString:
                      identifier: us.mappings.scanner.itemName
                      attribute: label
                      storeIn: itemName
                  - log: Name =${itemName}
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.resumeStoreModeButton
          then:
            - click:
                identifier: us.mappings.scanner.resumeStoreModeButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.storePrice
            - identifier: us.mappings.scanner.onlinePrice            
            - identifier: us.mappings.scanner.productDetailsLink
      - if:
          condition: ${platform} == 'iOS'
          then:
            - click:
                identifier: us.mappings.scanner.productDetailsLink 
            - verifyIdentifier:
                value:
                  -  identifier: us.mappings.item.productTitleViewpProductTitle
                     contains : ${itemName}
      - if:
          condition: ${platform} == 'Android'
          then:                 
            - click:
                identifier: us.mappings.scanner.storePrice 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.scanner.ensurePricingDisclaimerBottomSheet
                  - identifier: us.mappings.global.closeButton
            - click:
                identifier: us.mappings.global.closeButton

  # Navigate to scanner allow location
  - name: unified.us.functions.scanner.allowLocation
    flow:
      # Accept share precise location pop up if displayed
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.checkin.sharePreciseLocation.PopUp
                then:
                  - click:
                      identifier: us.mappings.checkin.sharePreciseLocation.PopUp
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.global.onboarding.allowWhileUsingAppButton
                then:
                  - click:
                      wait: 5000
                      identifier: us.mappings.global.onboarding.allowWhileUsingAppButton
                  - sleep:
                      duration: 5000
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.checkin.sharePreciseLocation.PopUp
                      then:
                        - click:
                            identifier: us.mappings.checkin.sharePreciseLocation.PopUp
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.scanner.shareLocationButton
                then:
                  - click:
                      identifier: us.mappings.scanner.shareLocationButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.checkin.sharePreciseLocation.noThanks
                then:
                  - click:
                      identifier: us.mappings.checkin.sharePreciseLocation.noThanks                      
      - if:
          condition: ${platform} == 'Android'
          then: 
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.scanner.shareYourlocationInStorePrice
                then:
                  - click:
                      identifier: us.mappings.scanner.shareYourlocationInStorePrice
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.scanner.shareYourlocation
                then:
                  - click:
                      identifier: us.mappings.scanner.shareYourLocation.continueButton
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.scanner.enableYourLocation
                then:
                  - click:
                      identifier: us.mappings.scanner.enableYourLocation
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.checkin.location.allow
                then:
                  - click:
                      wait: 5000
                      identifier: us.mappings.checkin.location.allow
                  - sleep:
                      duration: 5000

  # Navigate to scanner and allow Would you like to access your camera request
  - name: unified.us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
    flow:
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.global.onboarding.allowLocationModalHeaderText
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.global.onboarding.allowLocation
                  - click: 
                      identifier: us.mappings.global.onboarding.allowLocation    
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.verifyWouldYouLikeToAccessCameraMessage
              - identifier: us.mappings.scanner.WouldYouLikeToAccessCameraOkButton
          then:
            - click:
                identifier: us.mappings.scanner.WouldYouLikeToAccessCameraOkButton
                wait: 1000 

  # Navigate to scanner and validate Get accurate prices bottom overlay 
  - name: unified.us.functions.scanner.validateGetAccuratePriceBottomOverlay
    flow:
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.scanner.shareLocationButton
                then:
                  - click:
                      identifier: us.mappings.scanner.shareLocationButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.getAccuratePricesTitle
              - identifier: us.mappings.scanner.getAccuratePricesContinueButton
          then: 
            - click:
                identifier: us.mappings.scanner.getAccuratePricesContinueButton

  # Navigate to scanner and validate are you at the store bottom overlay 
  - name: unified.us.functions.scanner.validateAreYouAtTheStoreBottomOverlay
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.areYouAtTheStoreTitle
              - identifier: us.mappings.scanner.TellUsYourStoreMessage
              - identifier: us.mappings.scanner.yesI'mAtTheStoreButton
          then:
            - click:
                identifier: us.mappings.scanner.yesI'mAtTheStoreButton

  # Navigate to scanner and validate shop smart with scanner bottom overlay 
  - name: unified.us.functions.scanner.shopSmartWithScannerBottomOverlay
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.shopSmartWithScannerTitle
              - identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
          then:
            - click:
                identifier: us.mappings.scanner.shopSmartWithScannerGotItButton 
            - sleep:
                duration: 3000

  # Enter barcode and verify
  - name: unified.us.functions.scanner.verifyAndEnterBarcodetext
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.typeYourBarcodeButton   
      - click:
          identifier: us.mappings.scanner.typeYourBarcodeButton
          wait: 1000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.typeYourBarcode.typeACodeTitle
            - identifier: us.mappings.scanner.typeYourBarcode.barCodeTab
      - enterText:
          identifier: us.mappings.scanner.typeYourBarcode.enterBarcodeTextField
          string: ${barcode}
      - click:
          identifier: us.mappings.scanner.typeYourBarcode.searchButton

  - name: unified.us.functions.scanner.verifyScannerItemFound
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.scanner.itemName
      - if:
          condition: ${platform} == 'iOS'
          then: 
            - getString:
                identifier: us.mappings.scanner.itemName
                attribute: label
                storeIn: itemName 
            - log: Name =${itemName}
      - click:
          identifier: us.mappings.scanner.itemName
          wait: 2000
      - if:
          condition: ${platform} == 'iOS'
          then: 
            - click:
                identifier: us.mappings.item.closeScreen
                wait: 3000
          else:       
          - click:
              identifier: us.mappings.global.closeButton
              wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.shopSimilar   
      - click:
          identifier: us.mappings.scanner.shopSimilar
          wait: 3000
      - if:
          condition: ${platform} == 'iOS'
          then: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.scanner.similarItemsLabel
                  - identifier: us.mappings.scanner.hideSimilar
            - click:
                identifier: us.mappings.scanner.hideSimilar
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.item.itemadded        
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.item.itemadded
                  - click:
                      identifier: us.mappings.item.itemadded
                  - click:
                      identifier: us.mappings.scanner.closeButton          
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.home.itemAddedToCart
                  - click:
                      identifier: us.mappings.home.itemAddedToCart
                      wait: 3000
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.cart.itemAddedToCartCount
                      label:
                        - identifier: us.mappings.cart.oneItemPresent.itemNameLabel
                          contains: ${itemName}
                else:
                  - failTest:
                      message: "DATA_FAILURE - ${env} - Searched item is OOS"
      - if:
          condition: ${platform} == 'Android'
          then: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.marketplace.compareSellerAddToCartButton
            - click:
                identifier: us.mappings.marketplace.compareSellerAddToCartButton
            - click:
                identifier: us.mappings.backButton
            - sleep:
                duration: 5000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.itemAddedToCart
            - click:
                identifier: us.mappings.home.itemAddedToCart
                wait: 3000
            - sleep:
                duration: 10000
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.cart.navBarTitle
                then:
                  - executeFunction:
                      name: unified.us.functions.cart.scrollToTopOfCart
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.scanner.itemName
                  - identifier: us.mappings.cart.itemAddedToCartCount