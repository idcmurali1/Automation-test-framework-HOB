functions:
  - name: unified.us.functions.checkout.reviewOrder.verifyThresholdFee
    flow: 
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.subTotalEffectiveAmount
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if:
          condition: ${platform} == 'Android'
          then:
            - executeFunction:
                name: us.functions.utils.fetchAmountDisplayed
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subTotalEffectiveAmount
                  - name: attribute
                    string: content-desc
                  - name: delimeter
                    string: '$'
          else:
            - executeFunction:
                name: us.functions.utils.fetchAmountDisplayed
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subTotalEffectiveAmount
                  - name: attribute
                    string: name
                  - name: delimeter
                    string: '$'  
      - if:
          condition: ${amountValue} > 35.00
          then:
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.thresholdText  
          else:     
            - if:
                condition: ${amountValue} < 35.00     
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.wplus.thresholdLabel
                        - identifier: us.mappings.wplus.reviewOrder.pos.thresholdValue
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.thresholdText
                        - identifier: us.mappings.reviewOrder.POS.threshold
                        - identifier: us.mappings.reviewOrder.thresholdValue

                  - if:
                      condition: ${platform} == 'Android'
                      then:
                        - executeFunction:
                            name: us.functions.utils.fetchAmountDisplayed
                            params:
                              - name: identifier
                                string: us.mappings.reviewOrder.thresholdValue
                              - name: attribute
                                string: text                      
                              - name: delimeter
                                string: '$'      
                      else:
                        - executeFunction:
                            name: us.functions.utils.fetchAmountDisplayed
                            params:
                              - name: identifier
                                string: us.mappings.reviewOrder.thresholdValue
                              - name: attribute
                                string: value                      
                              - name: delimeter
                                string: '$'      
                  - if:
                       condition: ${amountValue} > 0
                       then:  
                          - log :  Verified below order minimum fee is ${amountValue}   
                       else:
                         - if:
                              condition: ${amountValue} == 0
                              then:
                                - failTest:
                                    message: "FAILURE - ${env} - Below order minimum fee should never be 0"

  - name: unified.us.functions.reviewOrder.validateViewDetailsBottomsheet
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsLink
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.backOrderBadge
          then:
            - log: "The backorder label is shown as expected on review order page"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Backorder label should be shown on review order but is not"
  
  - name: unified.us.functions.reviewOrder.verifyMixedBasketConsolidation
    flow:
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.mixedBasketConsolidation.title
          then:
            - log: "Mixed Basket Consolidation is happening !!!"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Mixed Basket Consolidation is NOT happening"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.mbc.deliveryFromStore

  - name: unified.us.functions.reviewOrder.SubAndOTPItemsValidations
    flow:
      - executeFunction:
          name: unified.us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.oneTimePurchase
            - name: direction
              string: down 
      - verifyIdentifier:
          present:
            - identifier: us.mapings.reviewOrder.subscriptionLabel
            - identifier: us.mapings.reviewOrder.viewDetails
      - click:
          identifier: us.mapings.reviewOrder.viewDetails
      - sleep:
          duration: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.itemDetailsScreen.header
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.itemDetails.oneTimePurchase
                  - identifier: us.mapings.itemDetails.subscriptionLabel
                  - identifier: us.mapings.itemDetails.closeButton
            - click:
                identifier: us.mapings.itemDetails.closeButton
      - sleep:
          duration: 2000
      
  - name: unified.us.functions.reviewOrder.applyWalmartCash.wallet
    flow:
      - if:
          condition: ${platform} == 'Android'
          then:
            - sleep:
                duration: 5000
            - scroll:
                direction: up
                untilIdentifier: us.mappings.reviewOrder.applyWalmartCashButtom
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.applyWalmartCashButtom
            - click:
                identifier: us.mappings.reviewOrder.editPayment
            - sleep:
                duration: 2000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.cart.wallet.walmartCashCard
                then:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.cart.wallet.walmartCashCard.checkbox.notChecked
                      then:
                        - log: "The Walmart Cash checkbox is not checked, Will select and proceed !!!"
                        - click:
                            identifier: us.mappings.cart.wallet.walmartCashCard.checkbox.notChecked
                            wait: 1500
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.cart.wallet.walmartCashCard.checkbox.Checked
                      else:
                        - log: "The Walmart Cash checkbox is already checked !!!"
                  - click:
                      identifier: us.mappings.item.continue
                      wait: 2000
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.applyWalmartCashButtom
                else:
                  - failTest:
                      message: "ENV_FAILURE - ${env} Walmart cash card not present"

      - if:
          condition: ${platform} == 'iOS'
          then: 
            - scroll:
                direction: up
                untilIdentifier: us.mappings.reviewOrder.editPayment
            - click:
                identifier: us.mappings.reviewOrder.editPayment
            - if:
                identifier:           
                  present:
                    - identifier: us.mappings.reviewOder.walletPage
                    - identifier: us.mappings.reviewOder.walmartRewardsCard 
                then:
                  - log: "Wallet Page is loaded and Walmart cash card is present"
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.account.walmartCashCard.checkbox.notChecked
                      then:
                        - log: "The Walmart Cash checkbox is not checked, Will select and proceed !!!"
                        - click:
                            identifier: us.mappings.account.walmartCashCard.checkbox.notChecked
                            wait: 1500
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.account.walmartCashCard.checkbox.checked
                      else:
                        - log: "The Walmart Cash checkbox is already checked !!!"
                  - click:
                      identifier: us.mappings.account.walmartCashCard.confirmButton
                else:
                   - failTest:
                       message: "ENV_FAILURE - ${env} wallet page load ERROR"
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cart.wplus.rewardsEligibilityButton
          then:
            - log: "Walmart cash got applied successfully"
          else:
           - failTest:
              message: "Walmart cash was NOT applied"

  - name: unified.us.functions.marketplace.reviewOrder.restored.validations
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.viewLink
          then:
            - click:
                identifier: us.mappings.reviewOrder.viewLink
                wait: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrderScreen.itemDescription.conditionLabel
                 # - identifier: us.mappings.search.conditions.restored.item
                  - identifier: us.mappings.reviewOrder.productImage
            - log: Validated ${type} label on Review Order
            - click:
                identifier: us.mapings.itemDetails.closeButton

  - name: unified.us.functions.checkout.confirmCvvBeforePlaceOrder
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          condition: ${platform} == 'iOS'
          then:
          - if: 
              identifier:
                present:
                  - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
              then:
                # - scroll:
                #     direction: down
                #     untilIdentifier: us.mappings.reviewOrder.confirmCvv.cvvField
                - if:
                    condition: ${cvv} == null
                    then:
                      - log: "Taking default cvv value 111"
                      - storeIn:
                          key: cvv
                          value: 111
                - click:
                    identifier: us.mappings.reviewOrder.confirmCvv.cvvField            
                - enterText:
                    identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                    string: ${cvv}
                - click:
                    identifier: us.mappings.default.keyboardDoneButton
      - if:
          condition: ${platform} == 'Android'
          then:
          - if:
              identifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.walletSection
              then:
                - scroll:
                    direction: down
                    untilIdentifier: us.mappings.reviewOrder.walletSection
                    position: center
          - if:
              identifier:
                present:
                  - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
              then:
                - click:
                    identifier: us.mappings.reviewOrder.confirmCvv.cvvPutField
                - enterText:
                    identifier: us.mappings.reviewOrder.confirmCvv.cvvPutField
                    string: ${cvv}
                - goBack: true

#Validate Drone Delivery on Review Order page
  - name: unified.us.functions.reviewOrder.verifyDroneFulfillmentDetails
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: Up
          untilIdentifier: us.mappings.reviewOrder.droneDelivery.cardTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.droneDelivery.arrivesText
            - identifier: us.mappings.reviewOrder.deliveryAddress
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.totalLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.droneDelivery.fee.pos.text
            - identifier: us.mappings.reviewOrder.droneDelivery.fee.pos.price

  - name: unified.us.functions.petRxManualRefillFlow
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.managePrescriptions.pageTitle
            - identifier: us.mappings.petRx.refillNow.button
      - click:
          identifier: us.mappings.petRx.refillNow.button
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.ad.SponsoredAd.ATCbutton.increment
            - identifier: us.mappings.item.ad.SponsoredAd.ATCbutton.decrement
      - executeFunction:
          name: unified.us.functions.global.navigation.toCartFromNavBar
      - sleep:
          duration: 5000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cart.itemPresent.itemNameLabel
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.cart.itemPresent.itemNameLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.itemPresent.itemNameLabel
            - identifier: us.mappings.cart.checkoutButton
      - click:
          identifier: us.mappings.cart.checkoutButton
      - sleep:
          duration: 3000

  # Validate delivery from store charges for a paused member in review order page
  - name: unified.us.functions.pause.reviewOrder.verifyDeliveryFromStoreCharge
    flow :
      - if:
          condition: ${platform} == 'iOS'
          then:
            - if:
                identifier:
                    present:
                    - identifier: us.mappings.reviewOrder.navBarTitle
                then:
                - log: Review Order is displayed. Verify delivery from store fulfillment fee POS
                
                - verifyIdentifier:
                        present:
                            - identifier: us.mappings.reviewOrder.scheduledDeliveryfee
      - if:
          condition: ${platform} == 'Android'
          then:
            - if:
                identifier:
                    present:
                    - identifier: us.mappings.reviewOrder.navBarTitle
                then:
                - log: Review Order is displayed. Verify delivery from store fulfillment fee POS
                - scroll:
                          direction: down
                          position: center
                          untilIdentifier: us.mappings.reviewOrder.deliveryFromStore.pos.fee
                - verifyIdentifier:
                        present:
                        - identifier: us.mappings.reviewOrder.deliveryFromStore.pos.feeValue

  # This function validates the waive-off of the minimum order fee in the pharmacy review order process.
  - name: unified.us.functions.reviewOrder.pharmacy.minOrderFeeWaiveoffValidation
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.estimateTotalAmount
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.checkout.pharmacy.chargeWaiveOff


  - name: unified.us.functions.reviewOrder.curbsidePickup.verifyMultiplePickupMessage
    flow :
      - if:
          condition: ${platform} == 'iOS'
          then:
            - verifyIdentifier:
                label:
                  - identifier: us.mappings.reviewOrder.curbsidePickup.multipleLocationPickupMessage
                    contains: This order requires pickup in 3 different areas of the parking lot.
      - if:
          condition: ${platform} == 'Android'
          then:
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.reviewOrder.curbsidePickup.multipleLocationPickupMessage
                    contains: This order requires pickup in 2 different areas of the parking lot.

  - name: unified.us.functions.checkout.reviewOrder.SCDelivery.verifyAlcoholDisclosure
    flow:
      - if:
          condition: ${platform} == 'iOS'
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.alcoholDisclosureCheckbox
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureLabel
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureDescription
                  - identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton
            - click:
                identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
                    equals: 1   
            - log: 'checkbox already selected'        

      - if:
          condition: ${platform} == 'Android'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureLabel
                  - identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureDescription
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox 
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureLabel
                    equals: Alcohol disclosure (required)
                  - identifier: us.mappings.reviewOrder.alcoholDisclosureDescription
                    equals: Checking this box confirms you’re at least 21 years old and won’t resell any alcohol you purchase.
            - scroll:
                direction: down
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
      - sleep:
          duration: 3000          
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton        
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyHeader   
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyDescription
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyCloseCta
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyCloseCta      
      - sleep:
          duration: 3000

  - name: unified.us.functions.reviewOrder.verifySubscriptionTermsInReviewOrderPage
    flow:
      - executeFunction:
          name: unified.us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subscriptionTermsSectionTitle
          scrollLimit: 2        
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subscriptionTermsSectionTitle
          then:
            - log: "Subscription Terms displayed in Review Order Page"
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.termsAgreeCheckboxSubscription
                scrollLimit: 1
                position: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subscriptionTermsSection
                  - identifier: us.mappings.reviewOrder.termsAgreeCheckboxSubscription
            - click:
                identifier: us.mappings.reviewOrder.termsAgreeCheckboxSubscription
