general:
  tags: C2737148  , MP008, unified-prod-e2e, unified-prod-e2e-mp, unified-teflon-e2e-mp, unified-teflon-e2e

  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  testCaseId: C2737148
  metadata:
    - name: scenarioId
      string: 

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:

      # Get Environment Values and Setting Platform
      - executeFunction:
          name: unified.us.function.utils.getEnvironmentValueAndSetPlatformInfo      

  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  

      - if:
          condition: ${env} == 'teflon'
          then:
            - executeFunction:
                name: unified.us.functions.authentication.signInInfo
                params:
                  - name: android.email
                    string: us.data.lfBYOD.wPlus.iOS.email
                  - name: android.password
                    string: us.data.lfBYOD.wPlus.password
                  - name: ios.email
                    string: us.data.lfBYOD.wPlus.android.email
                  - name: ios.password
                    string: us.data.lfBYOD.wPlus.password

            - executeFunction:
                name: unified.us.functions.utils.astro.clearCart

      - if:
          condition: ${env} == 'production'
          then:
            - executeFunction:
                name: unified.us.functions.authentication.signInInfo
                params:
                  - name: android.email
                    string: us.data.lfBYOD.wPlus.android.prod.email
                  - name: android.password
                    string: us.data.lfBYOD.wPlus.prod.password
                  - name: ios.email
                    string: us.data.lfBYOD.wPlus.android.prod.email
                  - name: ios.password
                    string: us.data.lfBYOD.wPlus.prod.password

  - name: Main
    flow:
      - log: Start Main

      - storeIn:
          key: BYOD
          value: true
      
      # - if:
      #     condition: ${env} == 'production'
      #     then:
      #       - executeFunction:
      #           name: unified.us.functions.global.navigation.goToDeepLink
      #           params:
      #             - name: deepLinkUrl
      #               string: walmart://expo?_xf=pW6j2&wm_preview_date=1746212719622   

     # Navigate onboarding to home
      - executeFunction:
          name: unified.us.functions.global.onboarding.navigateOnboardingToHome

      # Navigate to sign in page
      - executeFunction:
          name: unified.us.functions.home.navigateHomeToSignIn

      - executeFunction:
          name: unified.us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: ${email}
            - name: password
              string: ${password}

      - executeFunction:
          name: unified.us.functions.global.navigation.accountToHome

      - if:
          condition: ${env} == 'teflon'
          then:
            - executeFunction:
                name: unified.us.functions.home.location.updateStore
                params:
                  - name: address
                    string: 200 Short Blvd, Dallas, TX 75232
                  - name: ZIP_CODE
                    string: 75232

            - executeFunction:
                name: unified.us.functions.gic.module.selectAdress.fromSelector
                params:
                  - name: deliveryAddress
                    string: ${STREET_ADDR:2101 Cedar Springs, Dallas, TX, 75248}
                  - name: deliveryAddressCard
                    string: ${STREET_ADDR:2101 Cedar Springs, Dallas, TX, 75248}               

      - if:
          condition: ${env} == 'production'
          then:
            - executeFunction:
                name: unified.us.functions.gic.module.selectAdress.fromSelector
                params:
                  - name: deliveryAddress
                    string: ${STREET_ADDR:8731 W Wagon Wheel Dr, Glendale, AZ 85305}
                  - name: deliveryAddressCard
                    string: ${STREET_ADDR:8731 W Wagon Wheel Dr, Glendale, AZ 85305}        

            - executeFunction:
                name: unified.us.functions.utils.prod.clearCart

            - executeFunction:
                name: unified.us.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: walmart://global/seller/102630798

            - executeFunction:
                name: unified.us.functions.home.localmarketplace.BYODSellerPageValidations

            - executeFunction:
                name: unified.us.functions.search.localMarketPlaceLandingPageValidations
                params:
                  - name: fulfillment
                    string: Delivery
                  - name: searchTerm
                    string: flowers
                  - name: BYOD
                    string: true  


    # Add 1P Item to the cart
      - if:
          condition: ${env} == 'teflon'
          then:
            - executeFunction:
                name: unified.us.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: walmart://ip/3512450403

      - if:
          condition: ${env} == 'production'
          then:
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: bananas

            - executeFunction: 
                name: us.functions.search.clickOnFirstItem              

      - executeFunction:
          name: unified.us.functions.item.addItemToCart

    # Add LF BYOD item to Cart          
      - if:
          condition: ${env} == 'teflon'
          then:
            - executeFunction:
                name: unified.us.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: walmart://ip/5017945474

      - if:
          condition: ${env} == 'production'
          then:
            - executeFunction:
                name: unified.us.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: walmart://ip/13267967051   

      - executeFunction:
          name: unified.us.functions.item.localMarketPlace.itemPageValidations
          params:
            - name: fulfillment
              string: Delivery                
            - name: BYOD
              string: true              

      - executeFunction:
          name: unified.us.functions.item.addItemToCart

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - executeFunction:
          name: unified.us.functions.global.navigation.toCartFromNavBar

      - executeFunction:
          name: unified.us.functions.cart.switchBetweenPickUpAndShipping
          params:
            - name: fulfillmentType
              string: us.data.fulfillment.delivery

      - executeFunction:
          name: unified.us.functions.selectBookingSlot
          params:
            - name: tab
              string: delivery
            - name: page
              string: cart
            - name: slotDay
              string: tomorrow
            - name: slotIndex
              string: 1          

      - executeFunction:
          name: unified.us.functions.cart.localMarketPlace.cartPageValidations
          params:
            - name: fulfillment
              string: Delivery
            - name: BYOD
              string: true                

      - executeFunction:
          name: unified.us.functions.reserveTime.localFinds.BYODSeller      

      #Continue to checkout
      - executeFunction:
          name: unified.us.functions.cart.continueToCheckout

      - executeFunction:
          name: unified.us.functions.reviewOrder.localMarketPlace.reviewOrderPageValidations
          params:
            - name: fulfillment
              string: Delivery
            - name: BYOD
              string: true
                       
      - if:
          condition: ${env} == 'teflon'
          then:

        # Place order
          - executeFunction:
              name: unified.us.functions.checkout.placeOrder

    # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
          - log: 'R2_SUBFLOW_POST_TRANSACTION'
    # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

          - executeFunction:
              name: unified.us.functions.orderConfirmation.getOrderNumber

          - log: ${orderNo}

          - executeFunction:
              name: unified.us.functions.thankyou.localMarketPlace.OrderConfirmationPageValidations
              params:  
                - name: fulfillment
                  string: Delivery
                - name: BYOD
                  string: true     

          # Deeplink into order details page
          - executeFunction:
              name: us.functions.global.navigation.goToDeepLink
              params:
                - name: deepLinkUrl
                  string: walmart://orders/$orderNo 

          - executeFunction:
              name: unified.us.functions.orderDetails.localMarketPlace.OrderConfirmationPageValidations
              params:
                - name: fulfillment
                  string: Delivery
                - name: BYOD
                  string: true                       

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: unified.us.functions.utils.afterSteps