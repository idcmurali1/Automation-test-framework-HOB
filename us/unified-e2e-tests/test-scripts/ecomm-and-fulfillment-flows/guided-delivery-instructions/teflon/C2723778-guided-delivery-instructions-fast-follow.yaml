general:
  tags: C2723778, us-golden-flows-ecom-p1, us-golden-flows, unified-p2-ecomm-teflon-e2e, unified-teflon-e2e
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  testCaseId: C2723778
  metadata:
    - name: scenarioId
      string: EC139
scenarios:

  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - executeFunction:
          name: unified.us.function.utils.getEnvironmentValueAndSetPlatformInfo
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    endTestOnFailure: true
    flow:
      - log: Start Main

      # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      - storeIn:
          key: customerEmail
          value: gdiff${timestamp}@walmart.com

      - storeIn:
          key: password
          value: E2epassword$

      # Create Accountusing astro api
      - executeFunction:
          name: unified.us.functions.utils.astro.createAccount
          params:
            - name: email
              string: $customerEmail
            - name: payload
              string: us.data.createAccountPayload.generic

      # Navigate onboarding to home
      - executeFunction:
          name: unified.us.functions.global.onboarding.navigateOnboardingToHome

      # Navigate to sign in page
      - executeFunction:
          name: unified.us.functions.home.navigateHomeToSignIn

       # Sign in with created account
      - executeFunction:
          name: unified.us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: $customerEmail
            - name: password
              string: $password

      # Navigate to addresses
      - executeFunction:
          name: unified.us.functions.account.naviagteToMenuItems
          params:
            - name: menuItemName
              string: Addresses

      - executeFunction:
          name: unified.us.functions.deliveryAddress.addAOrEditGdiInstructions
          params:
            - name: propertyType
              string: House
            - name: dropOffType
              string: Front
            - name: verifyDropOffOptionsForHouse
              string: true
            - name: verifyDropOffOptionsForApartment
              string: true
            - name: verifyDropOffOptionsForBusiness
              string: true
            - name: verifyDropOffOptionsForOther
              string: true
            - name: addGdiInstructionsForHouseType
              string: true
            - name: addGateCode
              string: true
            - name: gateCode
              string: 3333
            - name: addDeliveryNotes
              string: true
            - name: deliveryNotes
              string: "Leave it with someone called X"

      - executeFunction:
          name: unified.us.functions.global.navigation.accountToHome

      - executeFunction:
          name: unified.us.functions.gic.expandIfCollapsed

      - executeFunction:
          name: unified.us.functions.gic.setFulfillment
          params:
            - name: option
              string: Delivery

      - executeFunction:
          name: unified.us.functions.home.setStore
          params:
          - name: store
            string: 32144
          - name: storeName
            string: San Jose Supercenter

      - executeFunction:
          name: unified.us.functions.gic.expandIfCollapsed

      - executeFunction:
          name: unified.us.functions.gic.setFulfillment
          params:
            - name: option
              string: Delivery

      - executeFunction:
          name: unified.us.functions.gic.expandIfCollapsed

      - executeFunction:
          name: unified.us.functions.deliveryAddress.verifySavedGdiInstructions
          params:
            - name: touchPointGIC
              string: true
            - name: entryPoint
              string: GIC

      - sleep:
          duration: 5000

      - executeFunction:
          name: unified.us.functions.deliveryAddress.verifySavedGdiInstructions
          params:
            - name: touchPointBookSlotOnGIC
              string: true
            - name: entryPoint
              string: "GIC - Book Slot"

      - sleep:
          duration: 5000

    #  Fetch stock available items using fetch API
      - executeFunction:
         name: unified.us.functions.utils.getSearchableItem
         params:
           - name: source
             string: astro
           - name: itemType
             string: STORE_SCHEDULED_DELIVERY
           - name: backupItem
             string: 945213102
           - name: store
             string: 32144

      - storeIn:
         key: item1
         value: $itemFetched

      - executeFunction:
         name: unified.us.functions.global.navigation.goToDeepLink
         params:
           - name: deepLinkUrl
             string: walmart://ip/$item1

      - sleep:
          duration: 5000

      - executeFunction:
          name: unified.us.functions.deliveryAddress.verifySavedGdiInstructions
          params:
            - name: touchPointItemPage
              string: true
            - name: entryPoint
              string: "Item Page"

      - executeFunction:
          name: unified.us.functions.item.addItemToCart

      - executeFunction:
          name: unified.us.functions.global.navigation.toCartFromNavBar

      - executeFunction:
          name: unified.us.functions.deliveryAddress.verifySavedGdiInstructions
          params:
            - name: touchPointCart
              string: true
            - name: entryPoint
              string: "Cart Page"

      - executeFunction:
          name: unified.us.functions.cart.continueToCheckout

      - executeFunction:
          name: unified.us.functions.deliveryAddress.verifySavedGdiInstructions
          params:
            - name: touchPointCheckout
              string: true
            - name: entryPoint
              string: "Checkout or Review Order Page"

      - executeFunction:
          name: unified.us.functions.checkout.confirmCvvAndPlaceOrder
          params:
            - name: cvv
              string: 111

      - executeFunction:
          name: unified.us.functions.orderConfirmation.getOrderNumber

      - log: ${orderNo}

      - executeFunction:
          name: unified.us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo

      - executeFunction:
          name: unified.us.functions.deliveryAddress.verifySavedGdiInstructions
          params:
            - name: touchPointODP
              string: false
            - name: entryPoint
              string: "Order Detail Page (ODP)"

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: unified.us.functions.utils.afterSteps
