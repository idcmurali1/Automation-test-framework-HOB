general:
  tags: us-golden-flows-ecom-p1, C2644791, unified-p1-ecomm-teflon-e2e
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  testCaseId: C2644791
  metadata:
    - name: scenarioId
      string: FS007

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      # This function retrieves environment values and sets platform information.
      - executeFunction:
          name: unified.us.function.utils.getEnvironmentValueAndSetPlatformInfo

      # Log message indicating the start of the pre-transaction subflow.
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'

      # This function clears the cart for the specified customer email.

      - if:
          condition: ${platform} == 'iOS'
          then:
            - executeFunction:
                name: unified.us.functions.utils.astro.clearCart
                params:
                  - name: email
                    string: us.data.flow057.email.ios
          else:
            - executeFunction:
                name: unified.us.functions.utils.astro.clearCart
                params:
                  - name: email
                    string: us.data.flow.dscard

  - name: Main
    flow:
      # Log message indicating the start of the main flow.
      - log: Start Main

      # This function navigates from onboarding to the home screen.
      - executeFunction:
          name: unified.us.functions.global.onboarding.navigateOnboardingToHome

      # This function navigates from the home screen to the sign-in page.
      - executeFunction:
          name: unified.us.functions.home.navigateHomeToSignIn

      # This function signs in to the account using the provided email and password for both Android and iOS platforms.
      - executeFunction:
          name: unified.us.functions.global.authentication.signInAccountWithParams
          params:
            - name: android.email
              string: us.data.flow.dscard
            - name: android.password
              string: us.data.flow.dscard.password
            - name: ios.email
              string: us.data.flow057.email.ios
            - name: ios.password
              string: us.data.flow057.password

      # This function navigates from the account screen back to the home screen.
      - executeFunction:
          name: unified.us.functions.global.navigation.accountToHome

      # This function sets the store to the specified store ID and name.
      - executeFunction:
          name: unified.us.functions.home.setStore
          params:
            - name: store
              string: 32144
            - name: storeName
              string: San Jose Supercenter

      # This function retrieves a searchable item from the specified source, item type, and store.

      - executeFunction:
          name: unified.us.functions.utils.fetchFulcrumAvailableItem
          params:
            - name: itemType
              string: FC_DELIVERY
            - name: storeId
              string: 32144
      - storeIn:
          key: item1
          value: $itemFetched

      # This function navigates to a specified deep link URL.
      - executeFunction:
          name: unified.us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://ip/$item1

      # This function adds an item to the cart.
      - executeFunction:
          name: unified.us.functions.item.addItemToCart

      # Log message indicating the start of the transaction subflow.
      - log: 'R2_SUBFLOW_TRANSACTION'

      # This function navigates to the cart from the navigation bar.
      - executeFunction:
          name: unified.us.functions.global.navigation.toCartFromNavBar

      # This function continues to the checkout process or creates a new order.
      - executeFunction:
          name: unified.us.functions.cart.continueToCheckout

      # This function verifies the display of payment cards on the order review page.
      - executeFunction:
          name: unified.us.functions.checkout.reviewOrder.verifyPaymentCardsDisplay
          params:
            - name: verifyDS
              string: exists

      # This function places the order.
      - executeFunction:
          name: unified.us.functions.checkout.placeOrder

      # Log message indicating the start of the post-transaction subflow.
      - log: 'R2_SUBFLOW_POST_TRANSACTION'

      # This function handles the ratings on the order confirmation page.
      - executeFunction:
          name: unified.us.functions.orderConfirmation.ratings

      # This function retrieves the order number from the order confirmation page.
      - executeFunction:
          name: unified.us.functions.orderConfirmation.getOrderNumber

      # Log the retrieved order number.
      - log: ${orderNo}

      - executeFunction:
          name: unified.us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo

      - executeFunction:
          name: unified.us.functions.orderDetails.verifyPaymentCards
          params:
            - name: verifyDS
              string: exists

      # Store the test status as passed.
      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      # This function performs the after steps for cleanup or additional verification.
      - executeFunction:
          name: unified.us.functions.utils.afterSteps
