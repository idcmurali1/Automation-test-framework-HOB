
general:
  tags:  unified-prod-e2e, C2717104, p1-ecomm-prod-e2e 
  inherit:
    filesRunAll:
      - errors-helpers.yaml
  testCaseId: C2717104
  metadata:
    - name: scenarioId
      string: 340, RT012

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:

      #Get Environment Values
      - executeFunction:
          name: us.function.utils.getEnvironmentValue

      # Set Platfrom Values
      - executeFunction:
          name: functions.utils.setPlatformInfo

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main
    flow:
      - log: Start Main

    # Navigate onboarding to home and login
      - executeFunction:
          name: unified.us.functions.global.onboarding.navigateOnboardingToHome

      - executeFunction:
          name: unified.us.functions.home.navigateHomeToSignIn

      - executeFunction:
          name: unified.us.functions.global.authentication.signInAccountWithParams
          params:
            - name: android.email
              string: us.data.prod.wplusprod2.email
            - name: android.password
              string: us.data.prod.wplusprod2.password
            - name: ios.email
              string: unified.delivery.w+.email
            - name: ios.password
              string: unified.delivery.w+.password

      - executeFunction:
          name: unified.us.functions.global.navigation.accountToHome

    # Navigate to cart and clear it
      - executeFunction:
          name: unified.us.functions.global.navigation.toCartFromNavBar
      - executeFunction:
          name: unified.us.functions.cart.removeAllCartItems
      - executeFunction:
          name: unified.us.functions.cart.removeUnavailableItemsFromCart
      - executeFunction:
          name: unified.us.functions.global.navigation.backNavigation

    #  Setup a Unified delivery Expo
      - sleep:
          duration: 5000
      - executeFunction:
          name: unified.us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.prod.unified_delivery.expo.deeplink
      - sleep:
          duration: 5000

      - executeFunction:
          name: unified.us.test.functions.utils.relaunchApp

      - executeFunction:
          name: unified.us.functions.home.closeWPlusPromotionPopUpIfDisplayed

      #Verify GIC for pickup, delivery options
      - executeFunction:
          name: unified.us.functions.gic.verifyHotGicPickupAndDeliveryOptions 

      # Shared item verify search and item screens
      - executeFunction:
          name: unified.us.functions.search.searchItem
          params:
            - name: searchTerm
              string: TV
      - sleep:
          duration: 5000 

      - executeFunction:
          name: unified.us.functions.searchpage.verifyBadgeSLA
          params:
            - name: Account
              string: W+

      - executeFunction:
          name: unified.us.functions.search.clickOnFirstItem

      - executeFunction:
          name: unified.us.functions.unifiedDelivery.itemPage.verifyBadges
          params:
            - name: item
              string: sharedItem
            - name: Account
              string: W+

      - executeFunction:
          name: unified.us.functions.item.addItemToCart

      # Delivery only item verify search and item screens
      - executeFunction:
          name: unified.us.functions.search.searchItem
          params:
            - name: searchTerm
              string: bananas

      - executeFunction:
          name: unified.us.functions.searchpage.verifyBadgeSLA
          params:
            - name: Account
              string: deliveryOnly

      - executeFunction:
          name: unified.us.functions.search.clickOnFirstItem

      - executeFunction:
          name: unified.us.functions.unifiedDelivery.itemPage.verifyBadges
          params: 
            - name: item
              string: 'DeliveryOnlyItem' 

      - executeFunction:
          name: unified.us.functions.item.addItemToCart

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      # Go to cart
      - executeFunction:
          name: unified.us.functions.global.navigation.toCartFromNavBar

      # Verify Delivery fulfillment in cart
      - executeFunction:
          name: unified.us.functions.cart.verifyCardDetails
          params:
            - name: fulfillmentText
              string: Delivery

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: unified.us.functions.utils.afterSteps