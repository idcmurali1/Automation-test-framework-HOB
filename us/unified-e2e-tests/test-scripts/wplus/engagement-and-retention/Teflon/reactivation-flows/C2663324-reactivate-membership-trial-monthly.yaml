general:
  tags: C2663324 #covered in C2736991
  testCaseId: C2663324  
  inherit:
    filesRunAll:
     - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: "322, WP011"
scenarios:
    - name: Before
      before: true
      endTestOnFailure: true
      flow:
      #Get Environment Values
        - executeFunction:
            name: us.function.utils.getEnvironmentValue

      # Set Platfrom Values
        - executeFunction:
            name: functions.utils.setPlatformInfo

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
        - log: 'R2_SUBFLOW_PRE_TRANSACTION'
      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

       # Get timestamp
        - getTimestamp:
            asDate: false
            storeIn: timestamp

        - storeIn:
            key: customerEmail
            value: wplususer${timestamp}@walmart.com

        # Create Wplus Trial Monthly Account using astro api
        - executeFunction:
            name: unified.us.functions.utils.astro.createAccount
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createWplusAccountPayload.monthly
    
        #Cancel membership using Astro api
        - executeFunction:
            name: unified.us.functions.utils.astro.cancelPaidMembership
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createWplusAccountPayload.monthly

# #   # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
# #         - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# # # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
    - name: Main
      flow:
        - log: Start Main

        #  Navigate onboarding to home
        - executeFunction:
            name: unified.us.functions.global.onboarding.navigateOnboardingToHome

        # Navigate to SignIn
        - executeFunction:
            name: unified.us.functions.home.navigateHomeToSignIn

        # Signin
        - executeFunction:
            name: unified.us.functions.global.authentication.signInAccount
            params:
              - name: email
                string: ${customerEmail}
              - name: password
                string: E2epassword$

        - executeFunction:
            name: unified.us.functions.global.navigation.goToAccountFromTabBar

         # Navigate to Walmart+
        - executeFunction:
            name: unified.us.functions.account.navigateToWalmartPlusBenefits

        # Choose monthly plan
        - executeFunction:
            name: unified.us.functions.wplus.account.chooseWplusPlan
            params:
              - name: plan
                string: monthly
            
        #Navigate to Manage membership
        - executeFunction:
            name: unified.us.functions.wplus.navigateToManageMembershipFromBenefitsPage 
 
        # Verify Monthly Plan Activation on Manage Membership
        - executeFunction:
            name: unified.us.functions.wplus.membership.verifyMyMembershipDetails
            params:
              - name: tenure
                string: monthly
              - name: membershipType
                string: paid   

        # storing testrun result as passed
        - storeIn:
            key: testStatus
            value: passed
            
    - name: After
      after: true
      useTestConfigErrors: false
      flow:
        - executeFunction:
            name: us.functions.utils.afterSteps
