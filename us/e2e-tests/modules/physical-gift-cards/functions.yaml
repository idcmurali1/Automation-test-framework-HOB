functions:

  - name: us.functions.pgc.verifyEligiblePymentMethod
    platform: iOS
    flow:
      # - click:
      #     identifier: us.mappings.capOne.changePaymentsButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.pgc.giftCardsSectionHeader
            - identifier: us.mappings.pgc.invalidPaymentMethodMessage
      
  - name: us.functions.pgc.navigateToCart
    platform: iOS
    flow:
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.capOne.cartIcon

  - name: us.functions.pgc.placeOrder
    platform: iOS
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.capOne.changePaymentsButton
      - click:
          identifier: us.mappings.capOne.changePaymentsButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.popup.cartMergeOkayButton
          then:
            - click:
                identifier: us.mappings.popup.cartMergeOkayButton
      - click:
          identifier: us.mappings.capOne.changePaymentsButton
      - executeFunction:
          name: us.functions.pgc.verifyEligiblePymentMethod
      - click:
          identifier: mapings.capOne.paymentsOptionsContinueButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton

  - name: us.functions.pgc.selectDeliveryAddressFromSuggestion
    platform: iOS
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.pgc.selectAddressBottomSheetTitle
          then:
            - click:
                identifier: us.mappings.pgc.suggestedAddress
            - click:
                identifier: us.mappings.pgc.selectAddressContinueButton

  - name: us.functions.pgc.placeOrder
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reserveSlot.title
          then:
            - executeFunction: 
                name: us.functions.reserveSlot.curbsidePickup.bookThirdDaySlot
            - executeFunction:
                name: us.functions.pgc.dismissDeliveryConfirmationPopUp
            - executeFunction:
                name: us.functions.pgc.proceedFromReviewScreenAfterPaymentsCheck
          else:
            - executeFunction:
                name: us.functions.pgc.proceedFromReviewScreenAfterPaymentsCheck

  - name: us.functions.pgc.dismissDeliveryConfirmationPopUp
    platform: android
    flow:
      - loop:
         begin: 0
         end: 4
         storeIndex: i
         flow:
           - log: $i
           - if:
                identifier:
                  present: 
                    - identifier: us.mappings.reserveSlot.oos.itemUpdates.gotItButton
                then:
                  - click:
                      identifier: us.mappings.reserveSlot.oos.itemUpdates.gotItButton
                  - sleep:
                      duration: 5000   
                else:
                    - break: true

  - name: us.functions.pgc.verifyEligiblePymentMethod
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.pgc.invalidPaymentMethodMessage
          then:
            - log: "Erro message displayed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Error message should have been displayed"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.pgc.giftCardsSectionHeader

  - name: us.functions.pgc.verifyReturnEligibility
    platform: android
    flow:
      - click:
          identifier: us.mappings.orderDetails.startReturnButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.pgc.returnIneligibilityText
          then:
            - log: "Return ineligibility text displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Return ineligiblity text should have been displayed"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.pgc.returnIneligibilityText
      - click:
          identifier: us.mappings.orderDetails.trackShipment.backNavigation

  - name: us.functions.pgc.verifyReturnEligibility
    platform: iOS
    flow:
      - click:
          identifier: us.mappings.pgc.returnsScreenHeader
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.pgc.returnIneligibilityText
          then:
            - log: "Return ineligibility text displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Return ineligiblity text should have been displayed"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.pgc.returnIneligibilityText
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.capOne.cartIcon

  - name: us.functions.pgc.prepareToPlaceNewOrder
    platform: iOS
    flow:
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.capOne.cartIcon

  - name: us.functions.pgc.prepareToPlaceNewOrder
    platform: android
    flow:
      - click:
          identifier: us.mappings.global.navigation.backNavigation
      - scroll:
          direction: up
          untilIdentifier: us.mappings.home.seeTimes

  - name: us.functions.pgc.placeOrderInitial
    platform: iOS
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.flow051.android.itemDeeplink.1PVariableGiftCard
      - executeFunction:
          name: us.functions.item.addItemToCart
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.bottomOverlay.closeButton
          then:
            - click: 
                identifier: us.mappings.home.bottomOverlay.closeButton
            - executeFunction:
                name: us.functions.item.addItemToCart
      - click:
          identifier: us.mappings.global.navigation.backNavigationToShop
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.ppu.item.pureWeighted
      - executeFunction:
          name: us.functions.item.addItemToCart
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.bottomOverlay.closeButton
          then:
            - click: 
                identifier: us.mappings.home.bottomOverlay.closeButton
            - executeFunction:
                name: us.functions.item.addItemToCart
      - click:
          identifier: us.mappings.global.navigation.backNavigationToShop

  - name: us.functions.pgc.placeOrderInitial
    platform: android
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.flow051.iOS.itemDeeplink.1PVariableGiftCard

      - if:
          identifier:
            present: 
              - identifier: us.mappings.pgc.closeBottomSheet
          then:
            - click:
                identifier: us.mappings.pgc.closeBottomSheet
      - executeFunction:
          name: us.functions.item.addItemToCart
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.bottomOverlay.closeButton
          then:
            - click: 
                identifier: us.mappings.home.bottomOverlay.closeButton
            - executeFunction:
                name: us.functions.item.addItemToCart
      - click:
          identifier: us.mappings.global.navigation.backNavigationToShop
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.flow059.itemdeeplink.sc
      - executeFunction:
          name: us.functions.item.addItemToCart
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.bottomOverlay.closeButton
          then:
            - click: 
                identifier: us.mappings.home.bottomOverlay.closeButton
            - executeFunction:
                name: us.functions.item.addItemToCart
      - click:
          identifier: us.mappings.global.navigation.backNavigationToShop

  - name: us.functions.pgc.reOrder
    platform: iOS
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.flow051.itemDeeplink.3PGiftCard
      - executeFunction:
          name: us.functions.item.addItemToCart
      - click:
          identifier: us.mappings.global.navigation.backNavigationToShop
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://ip/967762968
      - executeFunction:
          name: us.functions.item.addItemToCart

      - executeFunction:
          name: us.functions.pgc.navigateToCart

      - executeFunction:
          name: us.functions.cart.continueToCheckoutOrNewOrder

      - executeFunction:
          name: us.functions.pgc.getReadyToSelectSlot

      - executeFunction:
          name: us.functions.digital-delivery.verifyOrderConfirmationScreenPGC

      - executeFunction:
          name: us.functions.digital-delivery.getOrderNumber

      - executeFunction:
          name:  us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: FC_DELIVERY
            - name: status
              string: Shipped

      - executeFunction:
          name:  us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: FC_DELIVERY
            - name: status
              string: Delivered

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/${orderNo}

      - executeFunction:
          name: us.functions.pgc.verifyReturnEligibility
      - click:
          identifier: us.mappings.orderDetails.backButton
      - click:
          identifier: us.mappings.orderDetails.backButton

  - name: us.functions.pgc.reOrder
    platform: android
    flow:
      - executeFunction:
          name:  us.functions.global.navigation.goToHomeFromTabBar

      - executeFunction:
          name: us.functions.global.navigation.toCartFromNavBar

      - executeFunction:
          name: us.functions.pgc.switchFulfilmentType

      - executeFunction:
          name: us.functions.cart.continueToCheckoutOrNewOrder

      # - executeFunction:
      #     name: us.functions.carePlans.conditionallyProceedToReviewOrder

      # - executeFunction:
      #     name: us.functions.pgc.dismissDeliveryConfirmationPopUp

      - executeFunction:
          name: us.functions.pgc.placeOrder

      - executeFunction:
          name: us.functions.digital-delivery.getOrderNumber

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/${orderNo}

      - executeFunction:
          name:  us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: FC_DELIVERY
            - name: status
              string: Shipped

      - executeFunction:
          name:  us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: FC_DELIVERY
            - name: status
              string: Delivered

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/${orderNo}

      - executeFunction:
          name: us.functions.pgc.verifyReturnEligibility

  - name: us.functions.pgc.addPGCToCart
    platform: android
    flow:
      - sleep:
          duration: 3000

      - if:
          identifier:
            present: 
              - identifier: us.mappings.cancellation.errorMessageCTA
          then:
            - click:
                identifier: us.mappings.cancellation.errorMessageCTA

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.flow051.android.itemDeeplink.1PVariableGiftCard



      # - executeFunction:
      #     name: us.functions.global.navigation.goToDeepLink
      #     params:
      #       - name: deepLinkUrl
      #         string: us.data.ppu.item.pureWeighted

      # - executeFunction:
      #     name: us.functions.item.addItemToCart


  - name: us.functions.pgc.switchFulfilmentType
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.taxesLineItem
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.cart.switching.section
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.switching.section
          then:
            - click:
                identifier: us.mappings.cart.switching.section
      - sleep:
          duration: 10000

  - name: us.functions.pgc.prepareToAddNewPaymentMethod
    platform: android
    flow:
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.accounts.wallet.addPaymentButton
  
  - name: us.functions.pgc.navigateToAccountsTab
    platform: android
    flow:
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.search.backButton

  - name: us.functions.pgc.reserveSlotOnHomeScreenDelivery
    platform: android
    flow:
      - click:
          identifier: us.mappings.home.seeTimes
      - executeFunction:
          name: us.functions.reserveSlot.scheduledDelivery.bookSlot

  - name: us.functions.pgc.amendMixedBagOrder
    platform: android
    flow:
      - click:
          identifier: us.mappings.search.backButton
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.ppu.item.pureWeighted
      - executeFunction:
          name: us.functions.item.addItemToCart
      - executeFunction:
          name: us.functions.global.navigation.toCartFromNavBar
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.amend.addToExistingOrderFlow
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.itemAddedConfimationMessage
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.amend.itemAddedConfimationMessage
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.itemAddedConfimationMessage
            - identifier: us.mappings.amend.viewDetailsLink
      - click:
          wait: 10000
          identifier: us.mappings.amend.viewDetailsLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.navBarTitle

  - name: us.functions.pgc.amendMixedBagOrder
    platform: iOS
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.ppu.item.pureWeighted
      - executeFunction:
          name: us.functions.item.addItemToCart
      - executeFunction:
          name: us.functions.global.navigation.toCartFromNavBar
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.amend.addToExistingOrderFlow
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.itemAddedConfimationMessage
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.amend.itemAddedConfimationMessage
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.itemAddedConfimationMessage
            - identifier: us.mappings.amend.viewDetailsLink
      - click:
          wait: 10000
          identifier: us.mappings.amend.viewDetailsLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.navBarTitle

  - name: us.functions.pgc.proceedFromReviewScreenAfterPaymentsCheck
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.capOne.changePaymentsButton
      - click:
          identifier: us.mappings.capOne.changePaymentsButton
      - executeFunction:
          name: us.functions.pgc.verifyEligiblePymentMethod
      - click:
          identifier: us.mappings.reviewOrder.wallet.continueButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton

  - name: us.functions.pgc.verifyReviewOrderScreen
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.pgc.reviewOrderScreenHeader
            - identifier: us.mappings.subs.orderPickedUpSubsOrderDetailPage.viewButton
      - click:
          identifier: us.mappings.subs.orderPickedUpSubsOrderDetailPage.viewButton
      - click: 
          identifier: us.mappings.digitalDelivery.ItemDetailsCloseButton
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.pgc.donationSection
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.pgc.donationSection
  
  - name: us.functions.pgc.cancelStoreDeliverySection
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.pgc.cancelSCItems
      - click:
          identifier: us.mappings.pgc.cancelSCItems
      - click:
          identifier: (//android.widget.Button)[5]
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cancellation.cancellationReasonQuestionFullOrder
      - click:
          identifier: us.mappings.cancellation.reasonRadioButton
      - click:
          identifier: us.mappings.cancellation.confirmCancellationButton
      - scroll:
          direction: up
          untilIdentifier: us.mappings.orderDetails.statusMsgLabel
          position: center
      - verifyIdentifier:
          text:
            - identifier: us.mappings.orderDetails.statusMsgLabel
              equals: Canceled

  - name: us.functions.pgc.getReadyToSelectSlot
    platform: iOS
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reserveSlot.title
          then:
            - executeFunction:
                name: us.functions.reserveSlot.curbsidePickup.bookThirdDaySlot
          else:
            - log: Skipping reserve slot step
      - executeFunction:
          name: us.functions.pgc.placeOrder
      - if:
          identifier:
            present: 
              - identifier: us.mappings.buynow.buynowUnavailable.okButton
          then:
            - click:
                identifier: us.mappings.buynow.buynowUnavailable.okButton
            - click:
                identifier: us.mappings.reviewOrder.placeOrderButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.buynow.buynowUnavailable.okButton
          then:
            - click:
                identifier: us.mappings.buynow.buynowUnavailable.okButton
            - click:
                identifier: us.mappings.reviewOrder.placeOrderButton

  - name: us.functions.pgc.prod.validateItemPageOfCustomAmount1PPGC
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.pgc.brandNameWalmart  #Updated 3/15/22
      - scroll:
          direction: down
          untilIdentifier: us.mappings.pgc.costTile1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.pgc.costTile1
            - identifier: us.mappings.pgc.costTile2
            - identifier: us.mappings.pgc.costTile3

  - name: us.functions.pgc.prod.validateItemPageOfCustomAmount1PPGC
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.itemPage.brandName
#Scroll Not working
      - drag:
                      from:
                        x: 50%
                        y: 60%
                      to:
                        x: 50%
                        y: 35%
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.pgc.costtile
      # - executeFunction:
      #     name: us.functions.utils.scrollIfNotVisible
      #     params:
      #       - name: identifier
      #         string: us.mappings.pgc.customCosttile
      #       - name: direction
      #         string: down
      #       - name: scrollPosition
      #         string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.pgc.customCosttile
      # - enterText:
      #     identifier: us.mappings.pgc.customCosttile
      #     string: 30
      #     pressEnter: true    
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.item.primaryHeroPriceOnSticky
      #     text:
      #       - identifier: us.mappings.item.primaryHeroPriceOnSticky
      #         contains: $30.00


  - name: us.functions.pgc.1PFixed
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.pgc.amounttile
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.pgc.customCosttile            
  