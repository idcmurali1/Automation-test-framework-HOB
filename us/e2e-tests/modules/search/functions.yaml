functions:
############################## iOS #######################################
  # Search for Item
  - name: us.functions.search.searchItem
    platform: ios
    flow:
      # Click on search tab in sticky bar
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tabBar.search
      - click:
          identifier: us.mappings.tabBar.search
          doubleClick: true
      # # Navigate back to default search page if already a search result is displayed from previous search
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.home.searchBarBackNavigation
      #     then:
      #       - click:
      #           identifier: us.mappings.home.searchBarBackNavigation
      #     else:
      #       - log: Search item ${searchTerm}
      # Verify, click and enter search text in search field
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBar
      - click:
          identifier: us.mappings.home.searchBar
          wait: 3000
      - enterText:
          identifier: us.mappings.home.searchBar
          string: ${searchTerm}
          pressEnter: true

      # Close pop up to select intent is displayed
      - executeFunction:
          name: us.functions.search.closeHowDoYouWantYourOrderBottomTray

      # Clear filters if any applied
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.clearAllFilters
          then:
            - click:
                identifier: us.mappings.search.clearAllFilters
                wait: 3000

      # Scroll to first search result and verify display
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.firstItem 
            - name: direction
              string: down
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.firstItem
          then:
            - log: "successfully found an item for the above search criterion"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - No item found for the searched keyword"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.search.firstItem

  - name: us.functions.cart.clickStartShopping
    platform: ios
    flow:
      - sleep:
         duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.amend.startShoppingButton
          then:
            - click:
                identifier: us.mappings.amend.startShoppingButton
                wait: 3000


  # Search and add 1st Item to cart
  - name: us.functions.search.addItemtoCart
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.search.addFirstItemToCart
          params:
            - name: expectedItemCount
              string: ${expectedItemCount}

  # Add 1st item from search results to cart
  - name: us.functions.search.addFirstItemToCart
    platform: ios
    flow:
      # Variable stores if ATC button is displayed or not
      - storeIn:
          key: buttonAvailable
          value: false
      - loop:
          begin: 1
          end: 3
          storeIndex: i
          flow:
            - log: Try - $i [ Search with text ${searchTerm} ]

            # Search for the item
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: ${searchTerm}

            # Validate if Add to cart button available, if not retry search once more  
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.item.addToCartButton
                then:
                  # Workaround - Instead of ATC from search, clicking on item ATC directly without scroll
                  # Util JIRA - https://jira.walmart.com/browse/CEPG-157700 is closed

                  # # Scroll serach results if Add to cart button is present but not visible on screen
                  # - executeFunction:
                  #     name: us.functions.utils.scrollIfNotVisible
                  #     params:
                  #       - name: identifier
                  #         string: us.mappings.item.addToCartButton
                  #       - name: direction
                  #         string: down
                  #       - name: scrollPosition
                  #         string: center
                  - log: ADD TO CART button found
                  - storeIn:
                      key: buttonAvailable
                      value: true
                  - break: true
                else:
                  - scroll:
                      direction: down
                      scrollLimit: 1
                  - storeIn:
                      key: buttonAvailable
                      value: true
                  - break: true

      # Fail if Add to cart button is not visible else Add to cart and validate
      - if:
          condition: ${buttonAvailable} == false
          then:
            - failTest:
                message: "DATA_FAILURE - ${env} - No ADD TO CART button found for search term ${searchTerm}"
          else:
            - click:
                identifier: us.mappings.item.addToCartButton
                wait: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.navBar.cartIconWithCount
            - executeFunction:
                name: us.functions.item.handlePAC

  # Search and add 1st Item to cart (Temp work around until search item page issue is fixed)
  - name: us.functions.search.clickOnFirstItem
    platform: ios
    flow:
      # Click on first item with specific detail (Currently each weight item only is covered)
      - if:
          condition: ${subFilter} != null
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.subFilterItemsFromSearchResult
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - click:
                identifier: us.mappings.search.subFilterItemsFromSearchResult
            - verifyIdentifier:
                timeout: 110000
                present:
                  - identifier: us.mappings.itemPage.itemName
          else:
            # Skip sponsored items displayed in search and click on first item without sponsor
            - if:
                condition: ${excludeSponsored}
                then:
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.search.excludeSponsoredFromSearchResult
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                        - name: limit
                          string: 10
                  - click:
                      identifier: us.mappings.search.excludeSponsoredFromSearchResult                
                else:
                  # Click on first search displayed item
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.search.firstItem
                        - name: direction
                          string: down
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.search.firstItem   
              # Added coordinates to avoid clicking on ATC button on grid view. 
                  - click:
                      identifier: us.mappings.search.firstItem
                      # coordinates: 90%,5%
            - log : check if item details page is showing
            - verifyIdentifier:
                timeout: 110000
                present:
                  - identifier: us.mappings.itemPage.itemName

      # # Retry mechanism added incase item page is not loaded
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.item.closeItemDetailsPage
      #     then:    
      #       - verifyIdentifier:
      #           timeout: 20000
      #           present:
      #             - identifier: us.mappings.item.addToCartButton
      #     else: 
      #       - log: Still on search result page
      #       - click:
      #           identifier: us.mappings.search.firstItem
      #       - verifyIdentifier:
      #           timeout: 30000
      #           present:
      #             - identifier: us.mappings.item.closeItemDetailsPage
      #       - verifyIdentifier:
      #           timeout: 20000
      #           present:
      #             - identifier: us.mappings.item.addToCartButton

  # Search and add 1st Item to cart for buyNow  #Joel Added 2/18/22
  - name: us.functions.search.clickOnFirstItem.buyNow
    platform: ios
    flow:
      # - executeFunction:
      #     name: us.functions.search.verifySortandFilterPage
      # - click: 
      #     identifier: us.mappings.search.filterfacet.pillPickupAndShipping        
      # - click: 
      #     identifier: us.mappings.search.filterfacet.sortAndFilter.closeButton      
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.firstItem.id #us.mappings.search.firstItem
          then: #Added 1/19/22 due to DCT
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.firstItem.id #us.mappings.search.firstItem
                position: center           
            - click:
                identifier: us.mappings.search.firstItem.id #us.mappings.search.firstItem
          else:
            - log: Cant click First item due to prompts.
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.prompt.fulfillmentFilter.closeButton #//XCUIElementTypeStaticText[@name="GlassCalloutView.textLabel"]  #GlassCalloutView.textLabel # close #us.mappings.item.closeItemDetailsPage
              - log: Fulfillment prompt with Close is present, click to dismiss
          then:    
            - click:
                identifier: us.mappings.search.prompt.fulfillmentFilter.closeButton
                wait: 3000 # us.mappings.item.addToCartButton
            - verifyIdentifier:
                timeout: 20000
                notPresent:
                  - identifier: us.mappings.search.prompt.fulfillmentFilter.closeButton                
            - log: prompt closed successfully
            - log: now Select First item again
            - click:
                identifier: us.mappings.search.firstItem                
          else: 
            - log: Fulfillment prompt already closed, now viewing item page.

  - name: us.functions.search.handleAccLdPopUp
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.popUp
          then:
            - click:
                identifier: us.mappings.home.popUpCloseButton
                coordinates: 50% , 50%

        #################### SFS ##########################

  - name: us.functions.sfs.itemPageVerifyShippingInfo
    platform: ios
    flow:
      - sleep:
         duration: 5000
      - loop:
         begin: 0
         end: 4
         storeIndex: i
         flow:
           - log: $i
           - scroll:
               direction: down
               scrollLimit: 2
           - if: 
               identifier:
                 notPresent: 
                   - identifier: us.mappings.item.sfs.shippingInfo
               then:
                 - log: 'shipping info not present trying ${i} time'
                 - click: 
                     identifier: us.mappings.item.closeButton
                 - executeFunction:
                     name: us.functions.global.navigation.goToDeepLink
                     params:
                       - name: deepLinkUrl
                         string: us.data.flow060.ios.itemDeeplink2.s2sTire
               else:
                    - log: 'Badge found'
                    - verifyIdentifier:
                        present:
                          - identifier: us.mappings.item.sfs.shippingInfo
                    - break: true

  - name: us.functions.search.mpSellerLink
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.cart.marketplace.sellerInfo
      - click:
          identifier: us.mappings.cart.marketplace.sellerInfo
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.contactMpSellerPage         
      - click:
          identifier: us.mappings.search.contactMpSellerPage.backButton

  - name: us.functions.search.verifyUnlockWithSignInLink
    platform: ios
    flow:
      - sleep:
          duration: 7000  
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.unlockRewardText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.unlockRewardText
            - identifier: us.mappings.search.signInLink
      - click:
          identifier:  us.mappings.search.signInLink     

  - name: us.functions.search.verify.item.UnlockWithSignInLink
    platform: ios
    flow:
      - sleep:
          duration: 7000  
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.unlockRewardText
      - click:
          identifier: us.mappings.search.searchShelf.productTile
      - sleep:
          duration: 10000 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.unlockRewardText
            - identifier: us.mappings.search.signInLink
      - click:
          identifier:  us.mappings.search.signInLink 

  - name: us.functions.search.verifyAddToRewardCheckboxandClipReward
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.rewardsCheckBox
          scrollLimit: 12
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsCheckBox
          then:
            - click:
                identifier: us.mappings.search.rewardsCheckBox
                wait: 3000
            - verifyIdentifier:
                present:
                    - identifier: us.mappings.search.rewardsAddedItem
            - executeFunction:
                name: us.functions.item.verifyReward.mustBuy
            - click:
                identifier: us.mapings.search.addButtonAfterClipCash
                wait: 3000
          else:
            - log: No cash eligible available at this moment, please update new prod wplus account
      - loop:
          begin: 1
          end: 3
          mode: increment
          flow:
              - if:
                  identifier:
                    present:
                      - identifier: us.mapping.item.addWalmartProtectionPlan.closeButton
                  then:
                      - click:
                          identifier: us.mapping.item.addWalmartProtectionPlan.closeButton


  # Function to close pop up to select intent (pickup/delivery/shipping) is displayed while searching
  - name: us.functions.search.closeHowDoYouWantYourOrderBottomTray
    platform: ios
    flow:
      - try:
          flow:
            - verifyIdentifier:
                timeout: 5000
                present:
                  - identifier: us.mappings.search.howDoYouWantYourOrderBottomTray
            - click:
                identifier: us.mappings.search.howDoYouWantYourOrderBottomTrayCloseButton
          catch:
            flow:
              - log: How do you want pop up not displayed

  - name: us.functions.search.verifyibottaRewardsLinkOfItem
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTileRewards

  - name:  us.functions.search.ibottaRewardsItem
    platform: ios
    flow:
      - loop:
          each: ${ibottaRewardsItem}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - storeIn:
                  key: ibottaRewardsItem
                  value: $items                      
              - sleep: 
                  duration: 5000                       
              # - if:
              #     identifier:
              #       present:
              #         - identifier: us.mappings.search.productTileRewards
              - if:
                  identifier:
                    notPresent:
                      - identifier: us.mappings.cart.outofStockError               
                  then:
                    - log: ibottaRewardsItem is in stock
                    - break: true

  # Function to close prompt pop up if displayed
  - name: us.functions.search.promptGotItButton 
    platform: ios
    flow: 
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.prompt.gotItButton
          then:
            - click: 
                identifier: us.mappings.search.prompt.gotItButton
            - log: Prompt to user was present!  
          else:
            - log: Prompt to user was not present!

  - name: us.functions.search.validateItemTile
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTile.optionsButton
            - identifier: us.mappings.myItems.itemTile.productTitle # us.mappings.search.productTitle
      - verifyIdentifier:
          label:
            - identifier: us.mappings.myItems.itemTile.productTitle # us.mappings.search.productTitle
              contains: Gift Card

######### Badging2.0 iOS #########

# NO Intent
  - name: us.functions.search.noIntent.verifyBadgingSLA
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.pickup
              - identifier: us.mappings.search.badging.delivery
              - identifier: us.mappings.search.badging.shipping
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla

# Pickup Intent
  - name: us.functions.search.pickupIntent.verifyBadgingSLA 
    platform: ios
    flow:
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.search.badging.delivery
            - identifier: us.mappings.search.badging.shipping

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.pickup
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla

# Delivery Intent
  - name: us.functions.search.deliveryIntent.verifyBadgingSLA 
    platform: ios
    flow:
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.search.badging.pickup
            - identifier: us.mappings.search.badging.shipping

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.delivery
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla

# Shipping Intent
  - name: us.functions.search.shippingIntent.verifyBadgingSLA 
    platform: ios
    flow:
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.search.badging.pickup
            - identifier: us.mappings.search.badging.delivery

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.shipping
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla                  

############################## Android #######################################

  # Search for Item
  - name: us.functions.search.searchItem
    platform: android
    flow:
      - loop:
          begin: 1
          end: 3
          mode: increment
          flow:
            - if:
                identifier:
                  notPresent: 
                    - identifier: us.mappings.tabBar.search
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.home.searchBarSelected
                  - click:
                      identifier: us.mappings.home.searchBarSelected
                else: 
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.tabBar.search
                  - click:
                      wait: 3000
                      identifier: us.mappings.tabBar.search
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.home.searchBarSelected
                  - click:
                      identifier: us.mappings.home.searchBarSelected 
                      wait: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - enterText:
                identifier: us.mappings.home.searchBarSelected
                string: ${searchTerm}
                pressEnter: true
                clickFirst: true
            - sleep:
                duration: 10000
            - hideKeyboard: true
            - executeFunction:
                name: us.functions.search.closeHowDoYouWantYourOrderBottomTray
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.wlus.switchToOriginalApp.closeIcon
                then:
                    - click:
                        identifier: us.mappings.wlus.switchToOriginalApp.closeIcon          

            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.firstItem
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.search.firstItem
                else:
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.search.firstItem
                        - name: direction
                          string: down
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.search.firstItem
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.home.searchBarSelected
                then:
                  - terminateApp: true
                  - openLink: walmart://home
                else:
                  - break: true
             
  - name: us.functions.search.addFitmentDetails
    platform: android
    flow:
      - scroll:
          direction: up
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.fitmentDetailsChangeButton
          then:
            - click:
                identifier: us.mappings.search.fitmentDetailsChangeButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.removeVehicleButton
                then:
                  - click:
                      identifier: us.mappings.search.removeVehicleButton
                  - storeIn:
                      key: oldFitmentScreen
                      value: true
            - if:
                condition: ${oldFitmentScreen} != true
                then:
                  - loop:
                      begin: 0
                      end: 8
                      storeIndex: j
                      flow:
                        - click:
                            identifier: us.mappings.search.editVehicleButton
                        - click:
                            identifier: us.mappings.search.removeVehicleButton
                        - click:
                            identifier: us.mappings.search.removeVehicleConfirmation
                        - sleep:
                            duration: 3000
                        - if: 
                            identifier:
                              present: 
                                - identifier: us.mappings.search.fitmentDetailsChangeButton
                            then:
                              - click:
                                  identifier: us.mappings.search.fitmentDetailsChangeButton
                            else:
                              - break: true
      - sleep:
          duration: 4000

      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.fitment.selectYeardropdown
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.addVehicleButton
            - click:
                identifier: us.mappings.search.addVehicleButton
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.fitment.addFitmentDetailsPage
                  - name: direction
                    string: up  
          else:
            - storeIn: 
                key: scopeRequired
                value: true

      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitment.addFitmentDetailsPage
      - click:
          identifier:  us.mappings.search.fitment.selectYeardropdown  
      - click:
          identifier:  us.mappings.search.fitment.year  
      - click:
          identifier:  us.mappings.search.fitment.selectMakedropdown
          wait: 3000

      - if:
          condition: ${scopeRequired}
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.fitment.make
                  - name: direction
                    string: down  
                  - name: identifierScope
                    string: us.mappings.search.fitment.listView
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.fitment.make
                  - name: direction
                    string: down               
      - click:
          identifier:  us.mappings.search.fitment.make 
      - click:
          identifier:  us.mappings.search.fitment.selectModeldropdown 
      - if:
          condition: ${scopeRequired}
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.fitment.model
                  - name: direction
                    string: down  
                  - name: identifierScope
                    string: us.mappings.search.fitment.listView
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.fitment.model
                  - name: direction
                    string: down    
      - click:
          identifier:  us.mappings.search.fitment.model
      - click:
          identifier:  us.mappings.search.fitment.selectSubmodeldropdown  
      - click:
          identifier:  us.mappings.search.fitment.submodel
      - scroll:
              direction: down
              untilIdentifier: us.mappings.search.fitment.selectTireSizedropdown
      - click:
          identifier:  us.mappings.search.fitment.selectTireSizedropdown  
      - click:
          identifier:  us.mappings.search.fitment.tireSize
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitment.viewResultButton
            - name: direction
              string: down
      - sleep:
          duration: 5000 
      - click:
          identifier:  us.mappings.search.fitment.viewResultButton
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.viewResultButton 
          then:
            - click:
                identifier: us.mappings.search.fitment.viewResultButton

  - name: us.functions.search.searchOilChangeInstallationService
    platform: android
    flow:      
      - if:
          identifier:
            notPresent: 
              - identifier: us.mappings.tabBar.search
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected
          else: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tabBar.search
            - click:
                wait: 3000
                identifier: us.mappings.tabBar.search
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected 
                wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected
      
      # Verify, click and enter search text in search field
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected
      - click:
          identifier: us.mappings.home.searchBarSelected
          wait: 3000
      - enterText:
          identifier: us.mappings.home.searchBarSelected
          string: ${searchTerm}
          pressEnter: false
      - click:
          identifier: us.mappings.search.acc.autoserviceoilchange
      - sleep:
          duration: 10000

  - name: us.functions.search.preOrderItems
    platform: ios
    flow:  
      - loop:
          each: ${preOrderItems}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - sleep: 
                  duration: 5000  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.producttile.preorderLabel
                  then:
                    - executeFunction:
                        name: us.functions.search.validatepreOrderItemDetails   
                    - storeIn:
                        key: preOrder
                        value: true                            
                    - break: true
      - if:
          condition: ${preOrder} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - No preorder items present" 

  - name: us.functions.search.changeFitmentDetails
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitmentDetailsChangeButton
            - name: direction
              string: down      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitmentDetailsChangeButton
      - click:
          identifier: us.mappings.search.fitmentDetailsChangeButton
      - sleep:
          duration: 4000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitment.changeFitmentDetailsPage
      - if:
          identifier:
            present:
              - identifier: us.mappings.global.onboarding.technicalErrorDismissButton
          then:
            - click:
                identifier: us.mappings.global.onboarding.technicalErrorDismissButton
                wait: 5000
            - click:
                identifier: us.mappings.search.fitmentDetailsChangeButton
                wait: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.addVehicle
          then:
            - click:
                identifier: us.mappings.search.fitment.addVehicle
            - sleep:
                duration: 3000
          else:
              - getString:
                  identifier: us.mappings.search.fitment.yearGetText
                  attribute: text
                  storeIn: year
      - click:
          identifier: us.mappings.search.fitment.selectYeardropdown
      - storeIn:
          key: year
          value: ${modifyyear}
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.year 
          then:
            - click:
                identifier: us.mappings.search.fitment.year
                wait: 3000
          else:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.fitment.year 
            - click:
                identifier: us.mappings.search.fitment.year
                wait: 3000
      - sleep:
          duration: 5000
      - click:
          identifier:  us.mappings.search.fitment.selectMakedropdown
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitment.make
            - name: direction
              string: down  
      - click:
          identifier:  us.mappings.search.fitment.make
          wait: 3000
      - sleep:
         duration: 5000
      - click:
          identifier:  us.mappings.search.fitment.selectModeldropdown  
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitment.model
            - name: direction
              string: down
      - click:
          identifier:  us.mappings.search.fitment.model
          wait: 3000
      - sleep:
          duration: 5000
      - click:
          identifier:  us.mappings.search.fitment.selectSubmodeldropdown
      - click:
          identifier:  us.mappings.search.fitment.submodel
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.selectTireSizedropdown
          then:
            - click:
                identifier:  us.mappings.search.fitment.selectTireSizedropdown
            - sleep:
                duration: 3000            
            - click:
                identifier:  us.mappings.search.fitment.tireSize
      - sleep:
          duration: 3000 
      - click:
          identifier:  us.mappings.search.fitment.viewResultButton
      - sleep:
          duration: 5000
      - if:
          condition: ${scrollRequired} == true
          then:
            - scroll:
                direction: down
            - storeIn:
                key: scrollRequired
                value: false
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
          then:
            - click:
                identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
                wait: 3000
            - sleep:
                duration: 4000
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.fitment.selectSubmodeldropdown 
          then:
            - click:
                identifier:  us.mappings.search.fitment.selectSubmodeldropdown  
            - click:
                identifier:  us.mappings.search.fitment.submodel
            - click:
                identifier:  us.mappings.search.fitment.selectTireSizedropdown
            - sleep:
                duration: 3000            
            - click:
                identifier:  us.mappings.search.fitment.tireSize
            - sleep:
                duration: 3000  
            - click:
                identifier: us.mappings.search.fitment.viewResultButton 
            - sleep:
                duration: 3000
            - loop:
                begin: 0
                end: 6
                storeIndex: j
                flow:               
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.search.fitment.viewResultButton 
                      then:
                        - click:
                            identifier: us.mappings.search.fitment.viewResultButton
                      else:
                        - break: true

  - name: us.functions.search.validateVariantOptions
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.variantSwatches
            - name: direction
              string: down
      - verifyIdentifier:
         present:
           - identifier: us.mappings.search.variantSwatches
      - log: Validated variant options is displayed in search shelf

  - name: us.functions.search.validateFitmentDetails
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitmentIcon
            - name: direction
              string: up 
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitmentStatusMessage
          then:
            - log: "Fitment status message properly displayed"
          else:
            - click:
                identifier: us.mappings.home.searchBarSelected 
                wait: 3000
            - sleep:
                duration: 2000
            - click:
                identifier: us.mappings.wplus.earlyaccessScreen.productListHeader
            - sleep:
               duration: 3000

      # commenting As part of the new widget theme changes by @glass-android-fitment-us, you cant able to see fitmentStatusMessage in android https://walmart.slack.com/archives/C011X7AGVA7/p1714382058017159?thread_ts=1714377994.569629&cid=C011X7AGVA7
      # - if:
      #     identifier:
      #       notPresent:
      #         - identifier: us.mappings.search.fitmentStatusMessage
      #     then:
      #       - failTest:
      #           message: "ENV_FAILURE - ${env} - Fitment message should have been displayed but was not"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitmentIcon
            - identifier: us.mappings.search.fitmentDetails

  - name: us.functions.search.verifyFitmentDetailsWithDifferentFulfillmentType
    platform: ios
    flow:
      - scroll:
          direction: up
      - executeFunction:
          name: us.functions.gic.changeFulfillment
          params:
            - name: option
              string: ${option}      
      - executeFunction:
          name: us.functions.search.addMoreInfoWidget
      - if:
          condition: ${available}
          then:         
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.fitmentWidget
          else:
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.search.fitmentWidget

  - name: us.functions.search.verifyFitmentDetailsWithDifferentFulfillmentType
    platform: android
    flow:
      - scroll:
          direction: up
      - executeFunction:
          name: us.functions.gic.changeFulfillment
          params:
            - name: option
              string: ${option}

      - executeFunction:
          name: us.functions.search.addMoreInfoWidget
          
      - if:
          condition: ${available}
          then:         
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.fitmentWidget
          else:
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.search.fitmentWidget      

  - name: us.functions.search.addMoreInfoWidget
    platform: ios
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.fitment.viewResultButton
          then:
            - click:
                identifier: us.mappings.search.fitment.viewResultButton
            - sleep:
                duration: 2000

  - name: us.functions.search.addMoreInfoWidget
    platform: android
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
          then:
            - click:
                identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
                wait: 3000
            - click:
                identifier: us.mappings.search.addMoreInfoSaveButton
          else:
            - if:
                identifier:
                  present: 
                    - identifier: us.mappings.search.fitment.viewResultButton 
                then:
                  - click:
                      identifier: us.mappings.search.fitment.viewResultButton

  - name: us.functions.search.verifyUnlockWithSignInLink
    platform: android
    flow:
      - sleep:
          duration: 7000  
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.unlockRewardText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.unlockRewardText
            - identifier: us.mappings.search.signInLink
      - click:
          identifier:  us.mappings.search.signInLink

  - name: us.functions.search.verify.item.UnlockWithSignInLink
    platform: android
    flow:
      - sleep:
          duration: 7000  
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.unlockRewardText
      - click:
          identifier: us.mappings.item.product.details 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.unlockRewardText
            - identifier: us.mappings.search.signInLink
      - click:
          identifier:  us.mappings.search.signInLink 

  - name: us.functions.search.verifyibottaRewardsLinkOfItem
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTileRewards
            # - identifier: us.mappings.search.rewardsTitle

  - name:  us.functions.search.ibottaRewardsItem
    platform: android
    flow:
      - loop:
          each: ${ibottaRewardsItem}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - storeIn:
                  key: ibottaRewardsItem
                  value: $items                       
              - sleep:
                  duration: 5000                      
              - if:
                  identifier:
                    notPresent:
                      - identifier: us.mappings.cart.outofStockError 
                  then:
                    - log: ibottaRewardsItem is in stock
                    - break: true 

  - name:  us.functions.search.bvShellRewardsItem
    platform: android
    flow:
      - loop:
          each: ${bvShellRewardsItem}
          storeElement: items
          storeIndex: itemIndex
          flow:
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: $items
            - sleep:
                duration: 5000                      
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.cart.outofStockError 
                then:
                  - log: bvShellRewardsItem is in stock
                  - break: true

  - name:  us.functions.search.bvShellRewardsItem
    platform: ios
    flow:
      - loop:
          each: ${bvShellRewardsItem}
          storeElement: items
          storeIndex: itemIndex
          flow:
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: $items
            - sleep:
                duration: 5000                      
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.cart.outofStockError 
                then:
                  - log: bvShellRewardsItem is in stock
                  - break: true

  - name: us.functions.search.verifyAddToRewardCheckboxandClipReward
    platform: android
    flow:
      - sleep:
          duration: 7000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.rewardsCheckBox
          scrollLimit: 4
      - try:
          flow:         
            - verifyIdentifier: 
                present:
                  - identifier: us.mappings.search.rewardsCheckBox      
            - click:
                identifier: us.mappings.search.rewardsCheckBox
                wait: 3000
          catch:
            flow:
              - log: unable to find reward checkbox and hence checking for reward added item
              - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: identifier
                      string: us.mappings.search.rewardsAddedItem
                    - name: direction
                      string: up
      - verifyIdentifier: 
          present:
              - identifier: us.mappings.search.rewardsAddedItem
      - click:
          identifier: us.mappings.search.rewardsAddedItem
      - sleep:
          duration: 3000
      - executeFunction:
          name: us.functions.item.verifyReward.mustBuy

  - name: us.functions.search.verifyAddToRewardCheckboxandClipRewardOnSearchpage
    platform: android
    flow:
      - sleep:
          duration: 7000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.rewardsCheckBox
          scrollLimit: 4
      - try:
          flow:         
            - verifyIdentifier: 
                present:
                  - identifier: us.mappings.search.rewardsCheckBox      
            - click:
                identifier: us.mappings.search.rewardsCheckBox
                wait: 3000
          catch:
            flow:
              - log: unable to find reward checkbox and hence checking for reward added item
              - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: identifier
                      string: us.mappings.search.rewardsAddedItem
                    - name: direction
                      string: up

  - name: us.functions.itemPage.closeItemPage
    platform: android
    flow:
      - click:
          identifier: us.mappings.myItems.reorder.subscription.stepper.closeBtn                    

  - name: us.functions.search.closeHowDoYouWantYourOrderBottomTray
    platform: android
    doWhile: true
    flow:
      # - sleep: 
      #     duration: 5000
      # - if:
      #     identifier:
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.search.howDoYouWantYourOrderBottomTray
      - click:
          identifier: us.mappings.search.howDoYouWantYourOrderBottomTrayCloseButton

  - name: us.functions.search.validateItemTile
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTile.optionsButton
            - identifier: us.mappings.myItems.itemTile.productTitle
            - identifier: us.mappings.search.fulfilmentType
      - verifyIdentifier:
          text:
            - identifier: us.mappings.myItems.itemTile.productTitle
              contains: Gift Card

  # add 1st item from search results to cart
  - name: us.functions.search.addFirstItemToCart
    platform: android
    flow:
      - storeIn:
          key: buttonAvailable
          value: false
      - loop:
          begin: 1
          end: 3
          storeIndex: i
          flow:
            - log: Try - $i [ Search with text ${searchTerm} ]

            # Search for the item
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: ${searchTerm}

            # Scroll serach results if Add to cart button not visible
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.addToCartButton
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center

            # Validate if Add to cart button available, if not retry search once more  
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.search.addToCartButton
                then:
                  - log: ADD TO CART button found
                  - storeIn:
                      key: buttonAvailable
                      value: true
                  - break: true

      # Fail if Add to cart button is not visible else Add to cart and validate
      - if:
          condition: ${buttonAvailable} == false
          then:
            - failTest:
                message: "DATA_FAILURE - ${env} - No ADD TO CART button found for search term ${searchTerm}"
          else:
            - click:
                identifier: us.mappings.search.addToCartButton
                wait: 3000
            - sleep:
                duration: 5000  # Wait time to make sure cart count is updated before validation
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.search.searchPagePAC 
                then:
                  - click:
                     identifier: us.mappings.global.closeButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.navBar.cartIconWithCount

  # Search and add 1st Item to cart
  - name: us.functions.search.addItemtoCart
    platform: android
    flow:
      - executeFunction:
          name: us.functions.search.addFirstItemToCart
          params:
            - name: expectedItemCount
              string: ${expectedItemCount}

  # Click on First Item    
  - name: us.functions.search.clickOnFirstItem
    platform: android
    flow:
      - if:
          condition: ${noAds} || ${excludeSponsored}
          then:
            - if:
                condition: ${excludeSponsored}
                then:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.search.sponsoredTitle
                      then:
                        - scroll:
                            direction: down
                        - if:
                            identifier:
                              notPresent:
                                - identifier: us.mappings.search.sponsoredTitle
                            then:
                              - scroll:
                                  direction: down
                              - break: true
            - scroll:
                direction: down
                scrollLimit: 1
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.titleOfFirstItemFromSearchResult
            - click:
                identifier: us.mappings.search.firstItem #us.mappings.search.firstItemFromSearchResult
          else:
            - if:
                condition: ${subFilter} != null
                then:
                  - scroll:
                      direction: down
                      scrollLimit: 1
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.search.subFilterItemsFromSearchResultATCButton
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - click:
                      identifier: us.mappings.search.subFilterItemsFromSearchResult
                else:
                  - if:
                      condition: ${excludeSponsored}
                      then:
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.search.excludeSponsoredFromSearchResult
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                              - name: scrollLimit
                                string: 10
                        - scroll:
                            direction: down
                            scrollLimit: 1
                        - click:
                            identifier: us.mappings.search.excludeSponsoredFromSearchResult 
                      else:
                        - if:
                            identifier:
                              notPresent:
                                - identifier: us.mappings.search.secondItem
                            then:
                              - scroll:
                                  direction: down
                                  untilIdentifier: us.mappings.search.firstItem
                                  position: center
                        - click:
                            identifier: us.mappings.search.firstItem
      - verifyIdentifier:
          timeout: 80000
          present:
            - identifier: us.mappings.item.itemDetailsView
      - storeIn:
          key: subFilter
          value: 'null'
      - storeIn:
          key: noAds
          value: false
      - storeIn:
          key: excludeSponsored
          value: false

  # Navigate to sortand filterpill
  - name: us.functions.search.verifySortandFilterPage
    platform: android
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.pillSortnFilter
      - click: 
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - sleep:
          duration: 3000
      - click: 
          identifier: us.mappings.search.filterfacet.sortandFilter.sortBy
      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.pagetitle
            - identifier: us.mappings.search.filterfacet.sortAndFilter.closeButton
            - identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
            # - identifier: us.mappings.search.filterfacet.sortandFilter.sortBy

  - name: us.functions.search.sort.applyFilterOption
    platform: android
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortandFilter.FilterRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortandFilter.FilterRadioButton
          #Clear all button is no longer present in this initial apply , removoing this check ! Applying other filters clear all filter will be present.
      # - try:
      #     flow:
      #       - verifyIdentifier:
      #           timeout: 30000
      #           present:
      #             - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
        # Bug - CEPG-227506 
          # catch:
          #   flow:
          #     - failTest:
          #         message: "ENV_FAILURE - ${env} - Clear filter button missing after filter selection"
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 8000

  # Apply best Match filter
  - name: us.functions.search.sort.applybestMatchFilter
    platform: android
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 8000

  - name: us.functions.search.validatepreOrderItemDetails
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.producttile.preorderLabel
            - identifier: us.mappings.search.preorderCTA
            - identifier: us.mappings.search.preorderItem.releaseDateLabel
      - verifyIdentifier:
          text:
            - identifier: us.mappings.search.producttile.preorderLabel
              equals: Preorder
      - getString:
          identifier: us.mappings.search.preorderItem.releaseDateLabel
          attribute: text
          storeIn: ReleaseDateText
      - log: Verified fulfillment options on search page - '$ReleaseDateText'

  - name: us.function.sfs.searchPageVerifyBadge
    platform: android
    flow:
      - loop:
         begin: 0
         end: 4
         storeIndex: i
         flow:
           - log: $i
           - if: 
               identifier:
                 notPresent: 
                   - identifier: us.mappings.search.sfs.2DayBadge
               then:
                 - log: 'Badge not present trying ${i} time'
                 - executeFunction:
                     name: us.functions.search.searchItem
                     params:
                       - name: searchTerm
                         string: ${searchTerm}
               else:
                    - log: 'Badge found'
                    - verifyIdentifier:
                        present:
                          - identifier: us.mappings.search.sfs.2DayBadge
                    - break: true  

  - name: us.functions.sfs.itemPageVerifyShippingInfo
    platform: android
    flow:
      - sleep:
         duration: 5000
      - loop:
         begin: 0
         end: 4
         storeIndex: i
         flow:
           - log: $i
           - scroll:
               direction: down
               scrollLimit: 2
           - if: 
               identifier:
                 notPresent: 
                   - identifier: us.mappings.item.sfs.shippingInfo
               then:
                 - log: 'shipping info not present trying ${i} time'
                 - click: 
                     identifier: us.mappings.item.closeButton
                 - executeFunction:
                     name: us.functions.search.searchItem
                     params:
                       - name: searchTerm
                         string: ${searchTerm}
                 - executeFunction:
                    name: us.functions.global.navigation.goToItemPageFromSearchResult
               else:
                    - log: 'Badge found'
                    - verifyIdentifier:
                        present:
                          - identifier: us.mappings.item.sfs.shippingInfo
                    - break: true

##################### SFS #######################################

  - name: us.function.sfs.searchPageVerifyBadge
    platform: ios
    flow:
      - loop:
         begin: 0
         end: 4
         storeIndex: i
         flow:
           - log: $i
           - if: 
               identifier:
                 notPresent: 
                   - identifier: us.mappings.search.sfs.2DayBadge
               then:
                 - log: 'Badge not present trying ${i} time'
                 - executeFunction:
                     name: us.functions.search.searchItem
                     params:
                       - name: searchTerm
                         string: ${searchTerm}
               else:
                    - log: 'Badge found'
                    - verifyIdentifier:
                        present:
                          - identifier: us.mappings.search.sfs.2DayBadge
                    - break: true  

  - name: us.functions.search.validatepreOrderItemDetails
    platform: ios
    flow:
      - verifyIdentifier:
            present:
              - identifier: us.mappings.search.preorderCTA
              - identifier: us.mappings.search.preorderItem.releaseDateLabel
              - identifier: us.mappings.search.preorderItem.arrivesByLabel
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.preorderItem
              contains: Preorder              

  - name: us.functions.search.navigateToRewardEligibleItemPage
    platform: ios    
    flow:
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.rewardsEligibleItem
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.search.rewardsEligibleItem
      #     scrollLimit: 2
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsCheckBox
          then:
            - click:
                identifier: us.mappings.search.rewardsEligibleItem
                wait: 3000
          else:
            - log: No cash eligible available at this moment, please update new prod wplus account

  - name: us.functions.search.navigateToRewardEligibleCashPage
    platform: ios    
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.rewardsEligibleItemCashPage
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsCheckBox
          then:
            - click:
                identifier: us.mappings.search.rewardsEligibleItemCashPage
          else:
            - log: No cash eligible available at this moment


  # click on sort and filter applied button
  - name: us.functions.search.clickSortandFilterApplied
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingApplied
      - click:
          identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingApplied

  # Navigate to sortandfilterpill
  - name: us.functions.search.verifySortandFilterPage
    platform: ios
    flow:  
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.sortBy.priceLow
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.search.filterfacet.pillSortnFilter
      - click: 
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - sleep: 
          duration: 2000  
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
          then:
            - click: 
                identifier: us.mappings.search.filterfacet.sortByCollapsedButton
      - sleep: 
          duration: 2000  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.pagetitle
            - identifier: us.mappings.search.filterfacet.sortAndFilter.closeButton
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
            - identifier: us.mappings.search.filterfacet.sortAndFilter.departmentsButton
            - identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton

  # Verify and Apply best Match filter
  - name: us.functions.search.sort.applybestMatchFilter
    platform: ios
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
            
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 8000

  # Verify and Apply Retailer filter
  - name: us.functions.search.sort.applyRetailerFilter
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.search.clickSortandFilterApplied
      - sleep: 
          duration: 5000
      
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.filterfacet.retailerCollapsedButton
          scrollLimit: 10
          position: center
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.retailerCollapsedButton
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSection.walmartButton
          then:            
              - click: 
                  identifier: us.mappings.search.filterfacet.retailerCollapsedButton
                  wait: 3000
      - verifyIdentifier:
          timeout: 3000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSection.walmartButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSection.walmartButton
          wait: 3000      
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 2000

  # click on sort and filter applied button
  - name: us.functions.search.clickSortandFilterWhenTwoFiltersApplied
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingAppliedForTwoFilters
      - click:
          identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingAppliedForTwoFilters

  # clear sort and filter applied 
  - name: us.functions.search.clearSortandFilterApplied
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
          wait: 1000     
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
      
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortnFilter

  - name: us.functions.search.applyAndVerifySubscriptionFilter
    platform: ios
    flow:
      - scroll:
          direction: up
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.Subscription.pill
          then:
              - click:
                    identifier:  us.mappings.search.filterfacet.pillSortAndFilter.sortingApplied
              - sleep:
                  duration: 2000
              - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: identifier
                      string: us.mappings.sortAndFilter.Subscription
                    - name: direction
                      string: down
              - click:
                    identifier:  us.mappings.sortAndFilter.Subscription
              - click:
                    identifier:  us.mappings.search.filterfacet.brand.viewResultsButton
          else:
              - click:
                    identifier:  us.mappings.Subscription.pill
      - sleep: 
          duration: 5000

      # - executeFunction:
      #     name: us.functions.utils.scrollIfNotVisible
      #     params:
      #       - name: identifier
      #         string: us.mappings.search.searchShelf.verifySubscriptionFilterResults
      #       - name: direction
      #         string: down
      #       - name: scrollPosition
      #         string: center
      # - if:
      #     identifier:
      #       notPresent:
      #         - identifier: us.mappings.search.searchShelf.verifySubscriptionFilterResults
      #     then:
      #         - failTest:
      #             message: "FAILURE - ${env} - 'Subscription' label is not present"

  # Apply and verify Instore filter
  - name: us.functions.search.applyAndVerifyInStoreFilter
    platform: ios
    flow:
      - scroll:
          direction: up
      - click:
          identifier: us.mappings.choice.inStore.filter
      - sleep: 
          duration: 5000

      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.filterfacet.pillSortnFilter     
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.searchShelf.verifyInstoreFilterResults
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.searchShelf.verifyInstoreFilterResults
          then:
              - failTest:
                  message: "FAILURE - ${env} - 'In stock' label is not present"

  # Clear Instore  filter
  - name: us.functions.search.clearInstoreFilter
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.choice.inStore.filter
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.choice.inStore.filter
      - click:
          identifier: us.mappings.choice.inStore.filter
          wait: 1000

  # Apply and verify shipping filter
  - name: us.functions.search.applyPickupOrShippingOrDeliveryFilter
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier:  us.mappings.search.filterfacet.pillPickupAndShipping
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.search.filterfacet.pillPickupAndShipping
            - click: 
                identifier: us.mappings.search.filterfacet.pillPickupAndShipping
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.filterfacet.pillPickupAndShipping
            - click: 
                identifier: us.mappings.search.filterfacet.pillPickupAndShipping
      # - scroll:
      #     direction: up
      #     untilIdentifier: us.mappings.search.filterfacet.pillPickupAndShipping

      - if: 
          condition: ${option} == 'Shipping'
          then:
            - click: 
                identifier: us.mappings.search.filterfacet.PickupAndShipping.shippingRadioButton
          else:
              - if:
                  condition: ${option} == 'Pickup'
                  then:
                   - click: 
                       identifier: us.mappings.search.filterfacet.PickupAndShipping.pickupRadioButton
                  else:
                      - if:
                          condition: ${option} == 'Delivery'
                          then:
                            - click: 
                                identifier: us.mappings.search.filterfacet.PickupAndShipping.deliveryRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.PickupAndShipping.viewResultsButton                  

  - name: us.functions.search.ad.validateSkylineAd
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.skylineLogo
            - identifier: us.mappings.search.ad.skylineTitle
            - identifier: us.mappings.search.ad.skylineClick
            - identifier: us.mappings.search.ad.skylineSponsoredText

  - name: us.functions.search.ad.validateSkylineAd
    platform: ios
    flow:
      - sleep: 
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.skyline
      - click:
          identifier: us.mappings.search.ad.skyline
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.validateSkylikeAdClick

  # Apply and verify retailer filter
  - name: us.functions.search.applyRetailerFilter
    platform: ios
    flow:
      - sleep:
          duration: 5000    
      - executeFunction:
           name: us.functions.utils.scrollIfNotVisible
           params:
             - name: identifier
               string: us.mappings.search.filterfacet.pillSortnFilter
             - name: direction
               string: up
      - click:
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - loop:
          begin: 1
          end: 5
          mode: increment
          flow:
            - scroll:
                direction: down
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.filterfacet.retailerCollapsedButton
                then:
                  - break: true        
      # - click:
      #     identifier: us.mappings.search.filterfacet.retailerCollapsedButton
      - if:
          condition: ${option} == 'Walmart'
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.search.filterfacet.walmartSellerCollapsedButton
                then:
                    - click:
                        identifier: us.mappings.search.filterfacet.retailerCollapsedButton
            - click:
                identifier: us.mappings.search.filterfacet.walmartSellerCollapsedButton
          else:
              - if:
                  condition: ${option} == 'Pro-Sellers'
                  then:
                   - if:
                       identifier:
                         notPresent:
                           - identifier: us.mappings.search.filterfacet.proSellerCollapsedButton
                       then:
                           - click:
                               identifier: us.mappings.search.filterfacet.retailerCollapsedButton
                   - executeFunction:
                        name: us.functions.utils.scrollIfNotVisible
                        params:
                          - name: identifier
                            string: us.mappings.search.filterfacet.proSellerCollapsedButton
                          - name: direction
                            string: down
                   - click:
                       identifier: us.mappings.search.filterfacet.proSellerCollapsedButton
                  else:
                      - if:
                          condition: ${option} == 'Marketplace-Sellers-fulfilled-by-Walmart'
                          then:
                            - if:
                                identifier:
                                  notPresent:
                                    - identifier: us.mappings.search.filterfacet.walmartMpSellerCollapsedButton
                                then:
                                    - click:
                                        identifier: us.mappings.search.filterfacet.retailerCollapsedButton
                            - executeFunction:
                                  name: us.functions.utils.scrollIfNotVisible
                                  params:
                                    - name: identifier
                                      string: us.mappings.search.filterfacet.walmartMpSellerCollapsedButton
                                    - name: direction
                                      string: down
                            - click: 
                                identifier:  us.mappings.search.filterfacet.walmartMpSellerCollapsedButton
      - click:
          identifier: us.mappings.search.filterfacet.brand.viewResultsButton
          wait: 4000

  - name: us.functions.search.ad.validateSbaAd
    platform: android
    flow:
      - sleep:
          duration: 10000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.ad.sba_brandLogo
          then:
            - failTest:
                message: "ENV_FAILURE - ${env} - sponsored_brand_amplifier(sba) ad is not present"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sba_brandLogo
            - identifier: us.mappings.search.ad.sba_brandPrimaryText
            - identifier: us.mappings.search.ad.sba_brandSecondaryText
            - identifier: us.mappings.search.ad.sbaProducts
            - identifier: us.mappings.search.ad.sbaProductRatings
            - identifier: us.mappings.search.ad.sbaProductReviews

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.ad.sbaLayout
          then:
              - verifyIdentifier:
                  present:            
                    - identifier: us.mappings.search.ad.sbaLayout   

      - verifyIdentifier:
          text:
            - identifier: us.mappings.search.ad.sba_brandSecondaryText
              contains: us.data.sbaAd.prod.textSponsored
      - click:
          identifier: us.mappings.search.ad.sba_brandLogo
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected
            - identifier: us.mappings.search.backButton
            - identifier: us.mappings.search.filterfacet.appliedBrand
      - click:
          identifier: us.mappings.search.backButton

  - name: us.functions.search.ad.validateSBAItems
    platform: android    
    flow:
      - sleep: 
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.SBA.FirstItemTile
      - scroll:
          direction: left
          withinIdentifier: us.mappings.search.ad.sbaProducts
          scrollLimit: 1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.SBA.OtherItemTiles     

  - name: us.functions.search.ad.verifySBAAdAfterApplyingFilter
    platform: android    
    flow:
      - sleep:
          duration: 5000
      - click: 
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - sleep:
          duration: 3000
      - click: 
          identifier: us.mappings.search.filterfacet.sortandFilter.sortBy
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 8000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.SBA.FirstItemTile
            - identifier: us.mappings.search.SBA.OtherItemTiles

  - name: us.functions.search.ad.verifySBAATC
    platform: android    
    flow:
      - scroll:
          direction: up
          untilIdentifier: us.mappings.search.ad.sba_brandLogo
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.SBA.ATCButton
          then:
            - log: 'Button present'
            - click:
                identifier: us.mappings.search.SBA.ATCButton

            - verifyIdentifier:
                text:
                  - identifier: us.mappings.search.SBA.stepperValue
                    contains: 1                                 
            - click:
                identifier: us.mappings.search.SBA.ATCButton
            - sleep:
                duration: 3000
            - click:
                identifier: us.mappings.search.SBA.ATCButton
            - click:
                identifier: us.mappings.search.SBA.IncrementStepper
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.search.SBA.stepperValue
                    contains: 2     
            - click:
                identifier: us.mappings.search.SBA.ATCButton
            - sleep:
                duration: 3000
            - click:
                identifier: us.mappings.search.SBA.ATCButton
            - click:
                identifier: us.mappings.search.SBA.DecrementStepper
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.search.SBA.stepperValue
                    contains: 1                   
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.navBar.cartIconEmpty
                    notContains: 0 
            - click:
                identifier: us.mappings.search.SBA.SBAProduct
            - verifyIdentifier:
                timeout: 20000
                present:
                  - identifier: us.mappings.item.itemDetailsView 
            - executeFunction:
               name: us.functions.item.closeItemPage
          else:
            - click:
                identifier: us.mappings.search.SBA.SBAProduct   
            - verifyIdentifier:
                timeout: 20000
                present:
                  - identifier: us.mappings.item.itemDetailsView
            - executeFunction:
                name: us.functions.item.addItemToCart

  - name: us.functions.search.ad.SBAPagination
    platform: android    
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.search.ad.sbaProducts
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.searchShelf.lastItemInPage
          withinIdentifier: us.mappings.search.ad.sbaProductsContainer
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.search.searchShelf.lastItemInPage

  - name: us.functions.search.ad.validateSearchInGridAd
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.productTile.sponseredLabel
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTile.sponseredLabel
            - identifier: mapings.search.atcStepper
            - identifier: us.mappings.search.ad.sbaProductRatings
            - identifier: us.mappings.search.ad.sbaProductReviews
            - identifier: us.mappings.search.ad.productFulfillmentInfo
      - verifyIdentifier:
          text:
            - identifier: us.mappings.search.productTile.sponseredLabel
              contains: Sponsored
      - click:
          identifier: mapings.search.atcStepper

      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: mapings.search.atcIncrementStepper
            - identifier: mapings.search.atcDecrementStepper
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.productTile.optionsButton
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTile.optionsButton
      - click:
          identifier: us.mappings.search.productTile.optionsButton
      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.productNameTileGeneric

  - name: us.functions.search.ad.validateSbaAd
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - scroll:
          direction: up
          untilIdentifier: us.mappings.search.ad.sba_brandView
          position: center
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.ad.sba_brandView
          then:
            - failTest:
                message: "ENV_FAILURE - ${env} - sponsored_brand_amplifier(sba) ad is not present"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sba_brandView
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.firstProductNameTitle           
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.firstProductNameTitle
      - scroll:
          direction: up
          untilIdentifier: us.mappings.search.ad.sba_brandView              
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.ad.sba_brandView
              contains: us.data.sbaAd.prod.textSponsored              
      - click:
          identifier: us.mappings.search.ad.sba_brandView
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.search.backButton
            - identifier: us.mappings.search.firstItem
      - click:
          identifier: us.mappings.global.navigateBackArrow

  - name: us.functions.search.ad.validateSBAItems
    platform: ios
    flow:
      - sleep: 
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.SBA.FirstItemTile
            - identifier: us.mappings.search.SBA.OtherItemTiles
      - scroll:
          direction: left
          withinIdentifier: us.mappings.search.ad.sbaProducts
          scrollLimit: 1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.SBA.OtherItemTiles  

  - name: us.functions.search.ad.verifySBAAdAfterApplyingFilter
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - click: 
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
          then:
            - click: 
                identifier: us.mappings.search.filterfacet.sortandFilter.sortBy
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.bestMatchRadioButton
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 8000
      - scroll:
          direction: up
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.SBA.FirstItemTile
            - identifier: us.mappings.search.SBA.OtherItemTiles

  - name: us.functions.search.ad.verifySBAATC
    platform: ios
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.SBA.ATCButton
          then:
            - log: 'Button present'
            - click:
                identifier: us.mappings.search.SBA.ATCButton
            - click:
                identifier: us.mappings.search.SBA.ATCButton

            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.SBA.IncrementStepper
                  # - identifier: us.mappings.search.SBA.DecrementStepper # commenting due to dynamic ATC button
            - click:
                identifier: us.mappings.search.SBA.IncrementStepper

            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.navBar.cartIconEmpty
            - sleep: 
                duration: 5000
            - click:
                identifier: us.mappings.search.SBA.FirstItemTile
            - verifyIdentifier:
                timeout: 20000
                present:
                  - identifier: us.mappings.item.itemDetailsView
            - executeFunction:
                name: us.functions.item.closeItemPage              
          else:
            - click:
                identifier: us.mappings.search.SBA.FirstItemTile  
            - sleep:
                duration: 10000
            - verifyIdentifier:
                timeout: 20000
                present:
                  - identifier: us.mappings.item.itemDetailsView
            - executeFunction:
                name: us.functions.item.addItemToCart

  - name: us.functions.search.ad.validateSearchInGridAd
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.productTile.sponseredLabel
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTile.sponseredLabel
            - identifier: us.mappings.search.addToCartButtonByIndex
            - identifier: us.mappings.search.firstProductNameTitle
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.productTile.sponseredLabel
              contains: Sponsored
      - click:
          identifier: us.mappings.search.addToCartButtonByIndex

  - name: us.functions.search.applyGiftFilter
    platform: ios
    flow:
      - scroll:
          direction: up
          untilIdentifier: us.mappings.search.filterfacet.pillSortnFilter
      - click:
          identifier: us.mappings.search.filterfacet.pillSortnFilter  
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.filterfacet.sortAndFilter.giftingSection.giftEligibleButton
          then:          
              - scroll:
                  direction: down 
                  untilIdentifier: us.mappings.search.filterfacet.sortAndFilter.giftingSection.giftEligibleButton
          else: 
              - scroll:
                  direction: down 
                  untilIdentifier: us.mappings.search.filterfacet.giftCollapsedButton
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.filterfacet.sortAndFilter.giftingSection.giftEligibleButton
          then:             
            - click:
                identifier: us.mappings.search.filterfacet.giftCollapsedButton  
            - scroll:
                direction: down      
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.giftingSection.giftEligibleButton
      - click:
          identifier: us.mappings.search.filterfacet.brand.viewResultsButton


  - name: us.functions.search.navigateToRewardEligibleItemPage
    platform: android    
    flow:
      - sleep:
          duration: 7000 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.rewardsCheckBox
            - name: direction
              string: down
            - name: scrollPosition
              string: center
            - name: scrollLimit
              string: 3
      - try:
          flow:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.rewardsCheckBox
            - log: Checkbox is present
          catch:
            flow:
              - storeIn:
                  key: checkboxNotFound
                  value: true
              - log: checkboxNotFound is ${checkboxNotFound}
      - if: 
          condition: ${checkboxNotFound}
          then: 
              - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: identifier
                      string: us.mappings.search.rewardsAddedItem
                    - name: direction
                      string: down
                    - name: scrollPosition
                      string: center 
              - executeFunction:
                  name: us.functions.item.verifyReward.mustBuy        
              - click:
                  identifier: us.mappings.search.rewardsAddedItem
          else:   
              - executeFunction:
                  name: us.functions.item.verifyReward.mustBuy                         
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.search.rewardsCheckBox
              - click:
                  identifier: us.mappings.search.rewardsTitleHasCheckBox


  - name: us.functions.search.clickSortandFilterApplied
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingApplied
      - click:
          identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingApplied

  # Apply Retailer filter
  - name: us.functions.search.sort.applyRetailerFilter
    platform: android
    flow:
      - executeFunction:
          name: us.functions.search.clickSortandFilterApplied

      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.filterfacet.sortAndFilter.retailerSectionButton

      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSectionButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSectionButton
          wait: 3000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.filterfacet.sortAndFilter.retailerSection.walmartButton
      - verifyIdentifier:
          timeout: 3000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSection.walmartButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.retailerSection.walmartButton
          wait: 3000      
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
          wait: 2000

  # click on sort and filter applied button
  - name: us.functions.search.clickSortandFilterWhenTwoFiltersApplied
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingAppliedForTwoFilters
      - click:
          identifier: us.mappings.search.filterfacet.pillSortAndFilter.sortingAppliedForTwoFilters
#Click on sort & filter when one filter is applied 
  - name: us.functions.search.clickSortandFilteronefilterapplied
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortAndFilter.Onefilterselected
      - click:
          identifier: us.mappings.search.filterfacet.pillSortAndFilter.Onefilterselected

  # clear sort and filter applied 
  - name: us.functions.search.clearSortandFilterApplied
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll
          wait: 1000     
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton
      - sleep:
          duration: 10000
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.search.filterfacet.pillSortnFilter

  # Apply and verify Instore filter
  - name: us.functions.search.applyAndVerifyInStoreFilter
    platform: android
    flow:
      - scroll:
          direction: up
      - click:
          identifier: us.mappings.choice.inStore.filter
          wait: 7000     

      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.searchShelf.verifyInstoreFilterResults
      - verifyIdentifier:
          timeout: 4000
          present:
            - identifier: us.mappings.search.searchShelf.verifyInstoreFilterResults

 #Apply and verify Subscription filter

  - name: us.functions.search.applyAndVerifySubscriptionFilter
    platform: android
    flow:
      - scroll:
          direction: up
      - sleep: 
          duration: 5000
      - if:
          identifier: 
            present:
              - identifier: us.mappings.search.filter.subscriptionFilter             
          then:
            - click:
                identifier: us.mappings.search.filter.subscriptionFilter
                wait: 1000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.filter.subscriptionFilter
          then:
              - failTest:
                  message: "FAILURE - ${env} - 'Subscription' label is not present"


  # Clear Instore  filter
  - name: us.functions.search.clearInstoreFilter
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.choice.inStore.filter
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.choice.inStore.filter
      - click:
          identifier: us.mappings.choice.inStore.filter
          wait: 1000

  # Apply and verify shipping filter
  - name: us.functions.search.applyPickupOrShippingOrDeliveryFilter
    platform: android
    flow:
      - click: 
          identifier: us.mappings.search.filterfacet.pillPickupAndShipping
      - if: 
          condition: ${option} == 'Shipping'
          then:
            - click: 
                identifier: us.mappings.search.filterfacet.PickupAndShipping.shippingRadioButton
          else:
              - if:
                  condition: ${option} == 'Pickup'
                  then:
                   - click: 
                       identifier: us.mappings.search.filterfacet.PickupAndShipping.pickupRadioButton
                  else:
                      - if:
                          condition: ${option} == 'Delivery'
                          then:
                            - click: 
                                identifier: us.mappings.search.filterfacet.PickupAndShipping.deliveryRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.PickupAndShipping.viewResultsButton                                                                       

  # Apply and verify Brand filter
  - name: us.functions.search.applyGiftFilter
    platform: android
    flow:
      - sleep:
          duration: 10000
      - click:
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - sleep:
          duration: 4000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.search.filterfacet.gifting
          position: center

      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.filterfacet.giftCollapsedButton
          then:
              - click:
                  identifier: us.mappings.search.filterfacet.giftCollapsedButton   
                  wait: 1000 

      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.giftingSection.giftEligibleButton 
          wait: 5000
      - sleep:
          duration: 10000
      - click:
          identifier: us.mappings.search.filterfacet.brand.viewResultsButton
      - sleep:
          duration: 10000

  # Apply and verify retailer filter
  - name: us.functions.search.applyRetailerFilter
    platform: android
    flow:
      - click: 
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.filterfacet.retailerFilterButton
          then:
            - log: "The Retailer filter option is NOT visible, Scrolling down !!!"
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.filterfacet.retailerFilterButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.filterfacet.retailerCollapsedButton
          then:
            - click:
                identifier: us.mappings.search.filterfacet.retailerCollapsedButton
            - log: "The Retailer filter option is Collapsed, clicked on Expand button !!!"
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.filterfacet.retailerExpandedButton
          else:
            - log: "The Retailer filter option is already expanded !!!"
      - if: 
          condition: ${option} == 'Walmart'
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.search.filterfacet.walmartSellerCollapsedButton
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.search.filterfacet.walmartSellerCollapsedButton
            - click: 
                identifier: us.mappings.search.filterfacet.walmartSellerCollapsedButton
          else:
              - if:
                  condition: ${option} == 'Pro-Sellers'
                  then:
                   - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.search.filterfacet.walmartMpSellerCollapsedButton
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                   - click: 
                       identifier: us.mappings.search.filterfacet.proSellerCollapsedButton
                  else:
                      - if:
                          condition: ${option} == 'Marketplace-Sellers-fulfilled-by-Walmart'
                          then:
                            - executeFunction:
                                name: us.functions.utils.scrollIfNotVisible
                                params:
                                  - name: identifier
                                    string: us.mappings.search.filterfacet.walmartMpSellerCollapsedButton
                                  - name: direction
                                    string: down
                                  - name: scrollPosition
                                    string: center
                            - click: 
                                identifier: us.mappings.search.filterfacet.walmartMpSellerCollapsedButton
      - sleep:
          duration: 10000
      - click: 
          identifier: us.mappings.search.filterfacet.retailer.viewResultsButton
          wait: 5000
      - sleep:
          duration: 5000

  - name: us.functions.search.mpSellerLink
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.marketplace.mpSellerLink
      - click:
          identifier: us.mappings.marketplace.compareSellerButton         
      - click:
          identifier: ${sellerName} #us.mappings.marketplace.mpSellerLink  #updated 1/27/22
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.contactMpSellerPage         
      - click:
          identifier: us.mappings.search.contactMpSellerPage.backButton
          wait: 3000
      - click:
          identifier: us.mappings.search.contactMpSellerPage.backButton

  - name: us.functions.search.selectGrocerytab
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params: 
            - name: identifier
              string: us.mappings.services.grocery
            - name: direction
              string: down
      - click:
          identifier: us.mappings.services.grocery
          wait: 1000
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.department.shopAll
          then:
              - click:
                  identifier: us.mappings.search.department.shopAll    
                  wait: 1000 

  - name: us.functions.search.validateSkylineAd
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.ad.skylineLogo
            - identifier:  us.mappings.item.ad.skylineHeadline
            - identifier: us.mappings.search.ad.skylineSponsoredText
      - verifyIdentifier:
          text:
            - identifier: us.mappings.search.ad.skylineSponsoredText
              contains: Sponsored 
      - click:
          identifier: us.mappings.item.ad.skylineLogo
      - sleep:
          duration: 3000    
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.wplus.earlyaccessScreen.productListHeader
          then:
            - verifyIdentifier:
                 present:
                  - identifier: us.mappings.search.ad.skylineCarouselHeading
          else:         
            - click:
                identifier: us.mappings.wplus.earlyaccessScreen.productListHeader

  - name: us.functions.search.skyline_Ad_onSearchPage_retry
    platform: android
    flow:
      - loop:
          each: ${adItems}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - sleep: 
                  duration: 5000  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.item.ad.skylineLogo
                  then:
                    - log: 'Skyline ad is present'
                    - executeFunction:
                        name: us.functions.search.validateSkylineAd
                    - storeIn:
                        key: skylinead
                        value: true                            
                    - break: true
      - if:
          condition: ${skylinead} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - No skyline ad present for five items"

      - executeFunction:
          name: us.functions.item.closeItemPage 

  - name: us.functions.search.sbaAdonSearchPage
    platform: android
    flow:
      - loop:
          each: ${adItems}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - sleep: 
                  duration: 5000  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.ad.sba_brandLogo
                  then:
                    - log: 'Sba ad is present'
                    - executeFunction:
                        name: us.functions.search.ad.validateSbaAd
                    - storeIn:
                        key: sbaAd
                        value: true                            
                    - break: true
      - if:
          condition: ${sbaAd} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - No sba ad present for the given items"

  - name: us.functions.search.skyline_Ad_onItemPage_retry
    platform: ios
    flow:
      - loop:
          each: ${adItems}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - sleep: 
                  duration: 5000  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.ad.skyline
                  then:
                    - log: 'Skyline ad is present'
                    - executeFunction:
                        name: us.functions.search.ad.validateSkylineAd
                    - storeIn:
                        key: skylinead
                        value: true                            
                    - break: true
      - if:
          condition: ${skylinead} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - No skyline ad present for five items"

  - name: us.functions.search.sfsItemonSearchPage
    platform: android
    flow:
      - loop:
          each: ${sfsItems}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - sleep: 
                  duration: 5000  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.addToCartButton
                  then:
                    - log: 'Sfs Item is present'
                    - executeFunction:
                        name: us.function.sfs.searchPageVerifyBadge
                        params:
                          - name: searchTerm
                            string: $items                   
                    - storeIn:
                        key: sfspresent
                        value: true                            
                    - break: true
      - if:
          condition: ${sfspresent} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - sfs item is not present"

  - name: us.functions.search.addFitmentDetails
    platform: ios
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.fitmentDetailsChangeButton
          then:
              - click:
                  identifier: us.mappings.search.fitmentDetailsChangeButton
              - sleep:
                  duration: 2000
              - if:
                  identifier:
                    visible:
                      - identifier: us.mappings.search.removeVehicleButton
                        value: "true"
                  then:
                    - click:
                        identifier: us.mappings.search.removeVehicleButton
                    - storeIn:
                        key: oldFitmentScreen
                        value: true
              - if:
                  condition: ${oldFitmentScreen} != true
                  then:
                    - loop:
                        begin: 0
                        end: 5
                        flow:
                          - if: 
                              identifier:
                                present: 
                                  - identifier: us.mappings.search.fitmentDetailsChangeButton
                              then:
                                - click:
                                    identifier: us.mappings.search.editVehicleButton
                                - click:
                                    identifier: us.mappings.search.newRemoveVehicleButton
                                - click:
                                    identifier: us.mappings.search.removeVehicleConfirmation
                                - sleep:
                                    duration: 3000
                          - if: 
                              identifier:
                                present: 
                                  - identifier: us.mappings.search.fitmentDetailsChangeButton
                              then:
                                - click:
                                    identifier: us.mappings.search.fitmentDetailsChangeButton
                              else:
                                - break: true
      - sleep:
          duration: 4000
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.search.addVehicleButton
          then: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.addVehicleButton
            - click:
                identifier:  us.mappings.search.addVehicleButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.viewSubstitutionPopUpCloseButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPopUpCloseButton
                coordinates: 50% , 50%                  
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitment.addFitmentDetailsPage
            - name: direction
              string: up
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitment.addFitmentDetailsPage
      - click:
          identifier:  us.mappings.search.fitment.selectYeardropdown
      - sleep:  
          duration: 2000
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${year}  
      - click:
          identifier: done  
      - click:
          identifier:  us.mappings.search.fitment.selectMakedropdown
          wait: 3000
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${make}
      - click:
          identifier: done 
      - click:
          identifier:  us.mappings.search.fitment.selectModeldropdown
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${model} 
      - click:
          identifier: done 
      - click:
          identifier:  us.mappings.search.fitment.selectSubmodeldropdown
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${submodel} 
      - click:
          identifier: done
      - click:
          identifier:  us.mappings.search.fitment.selectTireSizedropdown   
      - click:
          identifier: done
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitment.viewResultButton
            - name: direction
              string: down
      - click:
           identifier:  us.mappings.search.fitment.viewResultButton 

  - name: us.functions.search.changeFitmentDetails
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitmentDetailsChangeButton
      - if:
          condition: ${scroll}
          then:
            - scroll:
                direction: down
      - click:
          identifier: us.mappings.search.fitmentDetailsChangeButton
      - sleep:
          duration: 4000
      - verifyIdentifier:
          timeout: 80000
          present:
            - identifier: us.mappings.search.fitment.changeFitmentDetailsPage
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.addVehicle
          then:
            - click:
                identifier: us.mappings.search.fitment.addVehicle
            - sleep:
                duration: 3000
      - click:
          identifier:  us.mappings.search.fitment.selectYeardropdown
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${year}
      - click:
          identifier: done 
      - click:
          identifier:  us.mappings.search.fitment.selectMakedropdown
          wait: 3000   
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${make}
      - click:
          identifier: done 
      - click:
          identifier:  us.mappings.search.fitment.selectModeldropdown
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${model} 
      - click:
          identifier: done  
      - scroll:
          direction: down
      - click:
          identifier:  us.mappings.search.fitment.selectSubmodeldropdown
      - enterText:
          identifier: us.mappings.search.fitment.pickerWheel 
          string: ${submodel} 
      - click:
          identifier: done
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.selectTireSizedropdown
          then:               
            - click:
                identifier:  us.mappings.search.fitment.selectTireSizedropdown
            - click:
                identifier: done   
      - click:
          identifier:  us.mappings.search.fitment.viewResultButton
      - sleep:
          duration: 3000
      - loop:
         begin: 0
         end: 3
         mode: increment
         storeIndex: i
         flow:
           - log: $i
           - if:
               identifier:
                 present:
                   - identifier: us.mappings.search.fitmentWidgetNeedMoreInfo
               then:
                 - if:
                     identifier:
                       present:
                         - identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
                     then:
                       - click:
                           identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
                 - click:
                     identifier:  us.mappings.search.fitment.selectSubmodeldropdown
                 - enterText:
                     identifier: us.mappings.search.fitment.pickerWheel 
                     string: ${submodel} 
                 - click:
                     identifier: done
                 - click:
                     identifier:  us.mappings.search.fitment.selectTireSizedropdown
                 - click:
                     identifier: done
                 - sleep:
                     duration: 2000
                 - click:
                     identifier: us.mappings.search.fitment.viewResultButton
                 - sleep:
                     duration: 2000
               else:
                 - break: true

  - name: us.functions.search.verifyFitmentSponseredFitsYourVehicle
    platform: ios
    flow: 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitmentSponseredFitsYourVehicle
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.search.fitmentSponseredFitsYourVehicle
      - sleep:
          duration: 3000
      - verifyIdentifier:
          label:
            - identifier: us.mappings.item.verifyStatusFitmentGoodFitMessage
              contains: This tire is a good fit
              
  - name: us.functions.search.verifyFitmentSponseredFitsYourVehicle
    platform: android
    flow: 
      - sleep:
          duration: 3000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.fitmentSponseredFitsYourVehicle
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.search.fitmentSponseredFitsYourVehicle
      - sleep:
          duration: 3000
 # commenting As part of the new widget theme changes by @glass-android-fitment-us, you cant able to see fitmentStatusMessage in android https://walmart.slack.com/archives/C011X7AGVA7/p1714382058017159?thread_ts=1714377994.569629&cid=C011X7AGVA7
      # - executeFunction:
      #     name: us.functions.utils.scrollIfNotVisible
      #     params:
      #       - name: identifier
      #         string: us.mappings.item.verifyStatusFitmentGoodFitMessage
      #       - name: direction
      #         string: down
      #       - name: scrollPosition
      #         string: center
      # - verifyIdentifier:
      #     text:
      #       - identifier: us.mappings.item.verifyStatusFitmentGoodFitMessage
      #         contains: This tire is a good fit 

  - name: us.functions.search.validateFitmentDetails
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitmentStatusMessage
            - identifier: us.mappings.search.fitmentDetailsChangeButton

  - name: us.functions.search.sort.applyPriceLowFilter
    platform: ios
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.priceLowRadioButton
      - click: 
          identifier: us.mappings.search.filterfacet.sortAndFilter.sort.priceLowRadioButton
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.search.filterfacet.sortAndFilter.sort.clearAll    
      - sleep:
          duration: 5000       
      - click:
          identifier: us.mappings.search.filterfacet.sortAndFilter.applyButton

  - name: us.functions.search.pdp.buyOnWalmart
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.verizon
          then:
            - click:
                identifier: us.mappings.search.pdp.verizon
            - sleep:
                duration: 10000
            - click:
                identifier: us.mappings.search.pdp.buyOnWalmart
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.buyOnWalmart.yes
          then:
            - click:
                identifier: us.mappings.search.pdp.buyOnWalmart.yes
            - sleep:
                duration: 15000

  - name: us.functions.search.hubAndSpokeStorePickuItems
    platform: ios
    flow:
      - storeIn:
          key: itempresent
          value: false 
      - loop:
          each: ${pickupItemHubSpoke}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - click:
                  identifier: us.mappings.tabBar.search              
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.home.searchBar
              - click:
                  identifier: us.mappings.home.searchBar
                  wait: 3000
              - enterText:
                  identifier: us.mappings.home.searchBar
                  string: ${items}
                  pressEnter: true
              - executeFunction:
                  name: us.functions.search.closeHowDoYouWantYourOrderBottomTray  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.zeroResultsMessage
                  then:
                    - log: No search result for item - $items
                  else:
                    - if:
                        identifier:
                          notPresent:
                            - identifier: us.mappings.search.outOfStockBadge
                        then:
                          - log: Pickup Item is in stock 
                          - storeIn:
                              key: itempresent
                              value: true                            
                          - break: true
      - if:
          condition: ${itempresent} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - Pickup item is not present"


  - name: us.functions.search.pdp.rewardAddToCart
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.search.pdp.validatePdpPage
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.addReward
          then:
            - click:
                identifier: us.mappings.search.pdp.addReward
            - click:
                identifier: us.mappings.search.addToCartButton
            - sleep:
                duration: 8000
          else:
            - failTest:
                message: Reward Not Applicable For The Selected Product

  - name: us.functions.search.pdp.addUnclippedRewardItemToCart
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.search.pdp.validatePdpPage
      - scroll:
          direction: down
      - scroll:
            direction: up
            position: center
            untilIdentifier: us.mappings.search.rewardsCheckBox
      - click:
          identifier: us.mappings.search.addToCartButton
      - sleep:
          duration: 8000

  - name: us.functions.search.pdp.cloeePdpPage
    platform: ios
    flow:
      - click:
          identifier: us.mappings.search.pdp.close

  - name: us.functions.search.pdp.validatePdpPage
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.search.pdp.productTitle
            - identifier: us.mappings.search.pdp.productPrice
            - identifier: us.mappings.search.pdp.productImage
            - identifier: us.mappings.search.pdp.brandName
            #- identifier: us.mappings.search.pdp.brandShareBtn
#            - identifier: us.mappings.search.pdp.saveToFavBtn
            #- identifier: us.mappings.search.pdp.close
#            - identifier: us.mappings.search.pdp.buyNow
            - identifier: us.mappings.search.pdp.addToCart

  - name: us.functions.search.pdp.validateFulfillmentDetails
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.pdp.sellerInfo
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.pdp.sellerInfo
          else:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.pdp.sellerInfo
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.pdp.shippingFulFillment
#      - verifyIdentifier:
#          label:
#            - identifier: us.mappings.search.pdp.shippingFulFillment
#              contains: ${addressFirstLine}
      - log:
          message: Address validation is Successful - ${addressFirstLine}
          color: GREEN_BOLD
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.pdp.soldBySeller
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.pdp.soldBySeller
              contains: ${soldby}
      - log:
          message: Seller validation is Successful - ${soldby}
          color: GREEN_BOLD
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.returnFulFillment
          then:
            - getString:
                identifier: us.mappings.search.pdp.returnFulFillment
                attribute: label
                storeIn: returnPolicy
            - log:
                message: Return Policy - $returnPolicy
                color: GREEN_BOLD


##################Android###############

  - name: us.functions.search.pdp.buyOnWalmart
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.verizon
          then:
            - click:
                identifier: us.mappings.search.pdp.verizon
            - sleep:
                duration: 10000
      - click:
          identifier: us.mappings.search.pdp.buyOnWalmart
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.buyOnWalmart.yes
          then:
            - click:
                identifier: us.mappings.search.pdp.buyOnWalmart.yes
            - sleep:
                duration: 15000

  - name: us.functions.search.pdp.addUnclippedRewardItemToCart
    platform: android
    flow:
      - executeFunction:
          name: us.functions.search.pdp.validatePdpPage
      - scroll:
          position: center
          direction: down
          untilIdentifier: us.mappings.search.rewardsCheckBox
      - click:
          identifier: us.mappings.search.addToCartButton
      - sleep:
          duration: 8000

  - name: us.functions.search.pdp.rewardAddToCart
    platform: android
    flow:
      - executeFunction:
          name: us.functions.search.pdp.validatePdpPage
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.rewardsCheckBox
            - name: direction
              string: down
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsCheckBox
          then:
            - click:
                identifier: us.mappings.search.rewardsCheckBox
            - click:
                identifier: us.mappings.search.addToCartButton
            - sleep:
                duration: 8000
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.rewardsTitle
                  - name: direction
                    string: up
            - click:
                identifier: us.mappings.search.addToCartButton

  - name: us.functions.search.hubAndSpokeStorePickuItems
    platform: android
    flow:
      - storeIn:
          key: itempresent
          value: false 
      - loop:
          each: ${pickupItemHubSpoke}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - click:
                  identifier: us.mappings.tabBar.search              
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.home.searchBar
              - click:
                  identifier: us.mappings.home.searchBar
                  wait: 3000
              - enterText:
                  identifier: us.mappings.home.searchBar
                  string: ${items}
                  pressEnter: true
              - executeFunction:
                  name: us.functions.search.closeHowDoYouWantYourOrderBottomTray  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.zeroResultsMessage
                  then:
                    - log: No search result for item - $items
                  else:
                    - if:
                        identifier:
                          notPresent:
                            - identifier: us.mappings.search.outOfStockBadge
                        then:
                          - log: Pickup Item is in stock 
                          - storeIn:
                              key: itempresent
                              value: true                            
                          - break: true
      - if:
          condition: ${itempresent} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - Pickup item is not  present"

  - name: us.functions.search.preOrderItems
    platform: android
    flow:  
      - loop:
          each: ${preOrderItems}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items

              - sleep: 
                  duration: 5000  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.producttile.preorderLabel
                  then:
                    - executeFunction:
                        name: us.functions.search.validatepreOrderItemDetails   
                    - storeIn:
                        key: preOrder
                        value: true                            
                    - break: true
      - if:
          condition: ${preOrder} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - No preorder items present" 


  - name: us.functions.search.pdp.closePdpPage
    platform: android
    flow:
      - click:
          identifier: us.mappings.item.closeButton

  - name: us.functions.search.pdp.validatePdpPage
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.item.ad.SponsoredAd.item.title
            - identifier: us.mappings.search.pdp.productPrice
            - identifier: us.mappings.search.pdp.productImage
            - identifier: us.mappings.item.ad.SponsoredAd.item.brandName
            #- identifier: us.mappings.item.closeButton
            - identifier: us.mappings.item.addToCartButton

  - name: us.functions.search.pdp.validateFulfillmentDetails
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.pdp.sellerInfo
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.pdp.sellerInfo
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.search.pdp.sellerInfo
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.search.pdp.sellerInfo
      - verifyIdentifier:
          text:
            - identifier: us.mappings.search.pdp.soldBySeller
              contains: ${soldby}
      - log:
          message: Seller validation is Successful - ${soldby}
          color: GREEN_BOLD
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.returnFulFillment
          then:
            - getString:
                identifier: us.mappings.search.pdp.returnFulFillment
                attribute: text
                storeIn: returnPolicy
            - log:
                message: Return Policy - $returnPolicy
                color: GREEN_BOLD

  - name: us.functions.search.verifySubscribeToSave.label
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.firstItem
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.firstItem  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.subscribeToSave.label

  - name: us.functions.search.filterfacet.nonwplus.noFreeShipping
    platform: android
    flow:
      - sleep:
          duration: 3000            
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.search.filterfacetView.freeShipping 
      - scroll:
          direction: left
          withinIdentifier: us.mappings.search.filterfacetView
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.search.filterfacetView.freeShipping   

  - name: us.functions.search.filterfacet.nonwplus.noFreeShipping
    platform: ios
    flow:
      - sleep:
          duration: 3000            
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.wplus.freeshippingpill
      - scroll:            
          direction: left
          withinIdentifier: us.mappings.search.filterfacetView
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.wplus.freeshippingpill

  - name: us.functions.search.nonConfigBundleItem
    platform: ios
    flow:
      - storeIn:
          key: itempresent
          value: false
      - executeFunction:
          name: us.functions.gic.changeFulfillment
          params:
            - name: option
              string: Shipping 
      - loop:
          each: ${nonConfigBundleItem}
          storeElement: items
          storeIndex: itemIndex
          flow:
              - click:
                  identifier: us.mappings.tabBar.search
                  doubleClick: true
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.home.searchBar
              - click:
                  identifier: us.mappings.home.searchBar
                  wait: 3000
              - enterText:
                  identifier: us.mappings.home.searchBar
                  string: ${items}
                  pressEnter: true
              - executeFunction:
                  name: us.functions.search.closeHowDoYouWantYourOrderBottomTray  
              - if:
                  identifier:
                    present:
                      - identifier: us.mappings.search.zeroResultsMessage
                  then:
                    - log: No search result for item - $items
                  else:
                    - if:
                        identifier:
                          notPresent:
                            - identifier: us.mappings.search.outOfStockBadge
                        then:
                          - log: nonConfigBundleItem is in stock
                          - executeFunction:
                              name: us.functions.search.clickOnFirstItem  
                          - storeIn:
                              key: itempresent
                              value: true                            
                          - break: true
      - if:
          condition: ${itempresent} != true
          then:
            - failTest:
                message: "FAILURE - ${env} - No bundle item present"

  - name: us.functions.search.nonConfigBundleItem
    platform: android
    flow:
      - loop:
          each: ${nonConfigBundleItem}
          storeElement: items
          storeIndex: itemIndex
          flow:             
              - executeFunction:
                  name: us.functions.search.searchItem
                  params:
                    - name: searchTerm
                      string: $items
              - sleep: 
                  duration: 2000   
              - if:
                  identifier:
                    notPresent:
                      - identifier: us.mappings.search.zeroResultsMessage
                  then:
                    - if:
                        identifier:
                          notPresent:
                            - identifier: us.mappings.cart.outofStockError 
                        then:
                          - log: nonConfigBundleItem is in stock
                          - executeFunction:
                              name: us.functions.search.clickOnFirstItem      
                          - verifyIdentifier:
                              present:
                                  - identifier: us.mappings.item.productNameTileGeneric
                          - scroll:
                              direction: down
                              untilIdentifier: us.mappings.item.productNonConfigBundleView
                              scrollLimit: 3
                          - if:
                              identifier:
                                present:
                                  - identifier: us.mappings.item.productNonConfigBundleView
                              then: 
                                - break: true
                              else:                              
                                - executeFunction:
                                    name: us.functions.item.closeItemPage

  - name: us.functions.search.verifySubscribeToSave.label
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.firstItem
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.firstItem  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.subscribeToSave.label          

  - name: us.functions.search.applyRewardsEligibleFilter
    platform: ios
    flow:
      - executeFunction:
           name: us.functions.utils.scrollIfNotVisible
           params:
             - name: identifier
               string: us.mappings.search.filterfacet.pillSortnFilter
             - name: direction
               string: up
      - click:
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.filterfacet.rewardsEligibledButton
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.filterfacet.rewardsEligibledButton
                scrollLimit: 10
            - log:
                message: Reward eligible checkbox present
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.filterfacet.rewardsEligibleCollapsedButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.search.filterfacet.rewardsEligibleCollapsedButton
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.filterfacet.rewardsEligibledButton
                  - name: direction
                    string: down
      - click:
          wait: 5000
          identifier: us.mappings.search.filterfacet.rewardsEligibledButton
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.search.filterfacet.brand.viewResultsButton
          wait: 4000

  - name: us.functions.search.applyRewardsEligibleFilter
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.filterfacet.pillSortnFilter
            - name: direction
              string: up
      - click:
          identifier: us.mappings.search.filterfacet.pillSortnFilter
      - try:
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.filterfacet.rewardsEligibleCollapsedButton
                then:
                  - click:
                      identifier: us.mappings.search.filterfacet.rewardsEligibleCollapsedButton
                else:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.search.filterfacet.rewardsEligibleCollapsedButton
                  - click:
                      identifier: us.mappings.search.filterfacet.rewardsEligibleCollapsedButton
            - click:
                wait: 5000
                identifier: us.mappings.search.filterfacet.rewardsEligibledButton
          catch:
            flow:
              - log: Rewards Eligible Collapsed Button is not present in the filter panel
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.search.filterfacet.viewResultsButton
          wait: 5000
      # Handle how do you want pop up
      - executeFunction:
          name: us.functions.search.closeHowDoYouWantYourOrderBottomTray

 #Wplus Book Slot Bottom Sheet
  - name: us.functions.search.rewards.clickJoinWplusCta
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - log: Clicking Join Walmart + CTA on Bottom Sheet
      - click: 
          identifier: us.mappings.search.rewards.joinWalmartPlusCta
          wait: 3000
      
      - executeFunction:
          name: us.functions.wplus.aquisition.legalErrorAlertCheck

      - if:
          identifier:
            present: 
              - identifier: us.mappings.search.rewards.joinWalmartPlusCta
          then:
            - click:
                identifier: us.mappings.search.rewards.joinWalmartPlusCta
                wait: 3000

  - name: us.functions.wplus.revieworder.clickStartFreetrial
    platform: ios
    flow:
      - click:
           identifier: us.mappings.wplus.revieworder.clickStartFreetrialCta
  
  - name: us.functions.wplus.revieworder.closePlansbottomSheet
    platform: ios
    flow:
        - if:
            identifier:
              present: 
                - identifier: us.mappings.wplus.reviewOrder.plansBottomsheetNoThanksBtn
            then:
              - click:
                 identifier: us.mappings.wplus.reviewOrder.plansBottomsheetNoThanksBtn

  - name: us.functions.search.rewards.choosePlanFromBottomSheet
    platform: ios
    flow:
        - sleep: 
            duration: 5000 
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.rewards.clickStart30DayFreetrial
        - click:
            identifier: us.mappings.search.rewards.clickStart30DayFreetrial

        - executeFunction:
            name: us.functions.search.closeHowDoYouWantYourOrderBottomTray

        - verifyIdentifier:
            label:
              - identifier: us.mappings.search.rewards.verifySuccessBottomSheet
                contains: Welcome - we're glad you're here!
        - click:
            identifier: us.mappings.search.rewards.bottomSheetCloseButton

  - name: us.functions.search.rewards.clickJoinWplusCta
    platform: android
    flow:
      - sleep:
            duration: 7000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewards.clickJoinWalmartPlusCta
          then:
            - log: "successfully found the primary cta"
            - click: 
                identifier: us.mappings.search.rewards.clickJoinWalmartPlusCta
                wait: 1000
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - CTA is NOT visible to click"



  - name: us.functions.search.rewards.choosePlanFromBottomSheet
    platform: android
    flow:
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.rewards.clickStart30DayFreetrial
        - click:
            identifier: us.mappings.search.rewards.clickStart30DayFreetrial
        
        - executeFunction:
            name: us.functions.search.closeHowDoYouWantYourOrderBottomTray

        - verifyIdentifier:
            text:
              - identifier: us.mappings.search.rewards.verifySuccessBottomSheet
                contains: Welcome - we're glad you're here!
        
        - click:
            identifier: us.mappings.search.rewards.clickCloseButton

  - name: us.functions.search.rewards.clipItemRewards
    platform: ios
    flow:
        - log: clicking Reward checkbox
        - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
              - name: identifier
                string: us.mappings.search.rewards.clipOnRewardCheckbox
              - name: direction
                string: up
        - click:
            identifier: us.mappings.search.rewards.clipOnRewardCheckbox
        
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.rewards.verifyRewardAddedLabel

  - name: us.functions.search.rewards.clipItemRewards
    platform: android
    flow:
        - log: clicking Reward checkbox
        - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
              - name: identifier
                string: us.mappings.search.rewards.clipOnRewardCheckbox
              - name: direction
                string: down
        - click:
            identifier: us.mappings.search.rewards.clipOnRewardCheckbox
        
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.rewards.verifyRewardAddedText

  - name: us.functions.search.verifyPickupFulfillment
    platform: ios
    flow:
        - executeFunction:
            name: us.functions.gic.expandIfCollapsed 
        - verifyIdentifier:
            label:
              - identifier: us.mappings.home.gic.module.pickupIntent
                contains: clear 
        - log: Pickup intent already selected    
        - click:
           identifier: us.mappings.home.gic.module.pickupIntent
        - sleep:
            duration: 5000
        - executeFunction:
            name: us.functions.gic.collapseIfExpanded
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.firstItem  
              - identifier: us.mappings.search.addToCartButton
        - executeFunction:
            name: us.functions.gic.changeFulfillment
            params:
              - name: option
                string: Pickup

  - name: us.functions.search.verifySpeedFilter
    platform: ios
    flow:
        - sleep:
            duration: 5000    
        - scroll:
            direction: left
            untilIdentifier: us.mappings.search.filterfacet.pillNeedItFast 
            withinIdentifier: us.mappings.search.filterfacet        
        - if:
            identifier:
              present:
                - identifier: us.mappings.search.filterfacet.pillNeedItFast
            then:
              - click:
                  identifier: us.mappings.search.filterfacet.pillNeedItFast
              - sleep:
                  duration: 5000
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.search.filterfacet.pillNeedItFast.today
                    - identifier: us.mappings.search.filterfacet.pillNeedItFast.tomorrow
                    - identifier: us.mappings.search.filterfacet.pillNeedItFast.2day
              - sleep:
                  duration: 3000
              - click:
                  identifier: us.mappings.global.closeButton

  - name: us.functions.search.pdp.closePdpPage
    platform: ios
    flow:
      - click:
          identifier: us.mappings.item.closeButton

  - name: us.functions.search.verifyPickupFulfillment
    platform: android
    flow:
        - executeFunction:
            name: us.functions.gic.expandIfCollapsed 
        - verifyIdentifier:
            contentDescription: 
              - identifier: us.mappings.wplus.globalIntentPickup
                contains: Clear
        - log: Pickup intent already selected    
        - click:
           identifier: us.mappings.wplus.globalIntentPickup
        - sleep:
            duration: 5000
        - if:
            identifier:
              present:
                - identifier: us.mappings.search.howDoYouWantYourOrderBottomTray
            then:
              - executeFunction:
                  name: us.functions.search.closeHowDoYouWantYourOrderBottomTray  
        - sleep:
            duration: 5000                                            
        - executeFunction:
            name: us.functions.gic.collapseIfExpanded
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.firstItem   
              - identifier: us.mappings.search.addToCartButton
        - executeFunction:
            name: us.functions.gic.changeFulfillment
            params:
              - name: option
                string: Pickup
        - if:
            identifier:
              present:
                - identifier: us.mappings.search.howDoYouWantYourOrderBottomTray
            then:
              - executeFunction:
                  name: us.functions.search.closeHowDoYouWantYourOrderBottomTray   

  - name: us.functions.search.verifySpeedFilter
    platform: android
    flow:
        - sleep:
            duration: 5000    
        - scroll:
            direction: left
            untilIdentifier: us.mappings.search.filterfacet.pillNeedItFast 
            withinIdentifier: us.mappings.search.filterfacetView           
        - if:
            identifier:
              present:
                - identifier: us.mappings.search.filterfacet.pillNeedItFast
            then:
              - click:
                  identifier: us.mappings.search.filterfacet.pillNeedItFast
              - sleep:
                  duration: 5000
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.search.filterfacet.pillNeedItFast.today
                    - identifier: us.mappings.search.filterfacet.pillNeedItFast.tomorrow
                    - identifier: us.mappings.search.filterfacet.pillNeedItFast.2day
              - sleep:
                  duration: 3000
              - click:
                  identifier: us.mappings.global.closeButton                  
                         
  - name: us.function.search.clikOnRewardEligibleItem
    platform: ios
    flow:
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.firstItem     
        - click:
              identifier: us.mappings.search.firstItem
              wait: 1000
        - log : Clicking Walmart+ CTA on Item page
        - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
              - name: identifier
                string: us.mappings.search.rewards.clickJoinWalmartPlusCta
              - name: direction
                string: down
        - click:
            identifier: us.mappings.search.rewards.clickJoinWalmartPlusCta
      
  - name: us.function.search.clikOnRewardEligibleItem
    platform: android
    flow:
        - verifyIdentifier:
            present:
              - identifier: us.mappings.search.firstItem     
        - click:
              identifier: us.mappings.search.firstItem
              wait: 1000
        - log : Clicking Walmart+ CTA on Item page
        - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
              - name: identifier
                string: us.mappings.search.rewards.clickJoinWalmartPlusCta
              - name: direction
                string: down
        - click:
            identifier: us.mappings.search.rewards.clickJoinWalmartPlusCta

  - name: us.function.search.verifyBcbsFlagandClickOnWellnessEligibleItem
    platform: ios
    flow:
      - scroll:
          direction: up
      - verifyIdentifier:
          present:
            - identifier: us.mappings.services.bcbsa.benefitTrackerCTA
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.skyBenefitCardLabel
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.skyBenefitCardLabel
      - click:
          identifier: us.mappings.search.clickOnWellnessBenefitEligibleItem
      - sleep: 
          duration: 10000  

  - name: us.function.search.verifyBcbsFlag
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.skyBenefitCardLabel

  - name: us.function.search.selectBenefitsProgramsFilter
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.BenefitsProgram.pill
      - click:
          identifier: us.mappings.BenefitsProgram.pill
      - sleep: 
          duration: 2000  
      - click:
          identifier: us.mappings.BenefitsProgram.WellnessBenefitRadioButton
      - click:
          identifier: us.mappings.BenefitsProgram.viewResultButton
      - sleep: 
          duration: 6000  
  
  - name: us.function.search.selectNationsBenefitsProgramsFilter
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.BenefitsProgram.pill
      - click:
          identifier: us.mappings.BenefitsProgram.pill
      - sleep: 
          duration: 2000  
      - click:
          identifier: us.mappings.BenefitsProgram.nationsBenefitRadioButton
      - click:
          identifier: us.mappings.BenefitsProgram.viewResultButton
      - sleep: 
          duration: 6000

  - name: us.function.search.selectNationsBenefitsProgramsFilter
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.BenefitsProgram.pill
      - click:
          identifier: us.mappings.BenefitsProgram.pill
      - sleep: 
          duration: 2000  
      - click:
          identifier: us.mappings.BenefitsProgram.nationsBenefitRadioButton
      - click:
          identifier: us.mappings.BenefitsProgram.viewResultButton
      - sleep: 
          duration: 6000

  - name: us.functions.search.verifyPickupBadge
    platform: ios
    flow: 
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.pickupORShippingAvailableBadge
              contains: pickup

  - name: us.functions.search.verifyShippingAvailableBadge 
    platform: ios
    flow: 
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.pickupORShippingAvailableBadge
              contains: Shipping

  - name: us.functions.search.acc.schedulingService.accVehicleModule
    platform: ios
    flow: 
      - executeFunction:
          name: us.functions.search.closeHowDoYouWantYourOrderBottomTray
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitmentWidget 
            - identifier: us.mappings.search.accVehicleName 
            - identifier: us.mappings.search.fitmentWidgetNeedMoreInfo
            - identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.accVehicleName 
              contains: ${vehicleName}
      - log: Vehicle added and displayed are same
      - click:
          identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
      - sleep:
          duration: 3000
      #adding additional vehicle details
      - click:
          identifier:  us.mappings.search.fitment.selectSubmodeldropdown
      - click:
          identifier: done
      - click:
          identifier:  us.mappings.search.fitment.selectTireSizedropdown
      - click:
          identifier: done
      - sleep:
          duration: 2000 
      - click:
          identifier: us.mappings.search.fitment.viewResultButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.fitmentStatusMessage

  - name: us.functions.search.acc.schedulingService.accVehicleModule
    platform: android
    flow: 
      - executeFunction:
          name: us.functions.search.closeHowDoYouWantYourOrderBottomTray
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.AccFitmentTab
            - identifier: us.mappings.search.accVehicleName 
            - identifier: us.mappings.search.fitmentWidgetNeedMoreInfo
            - identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
      - verifyIdentifier:
          text:
            - identifier: us.mappings.search.accVehicleName 
              contains: ${vehicleName}
      - log: Vehicle added and displayed are same
      - click:
          identifier: us.mappings.search.fitmentWidgetAddMoreInfoButton
      - sleep:
          duration: 3000
      #adding additional vehicle details
      - click:
          identifier:  us.mappings.search.fitment.selectSubmodeldropdown
      - click:
          identifier:  us.mappings.search.fitment.submodel
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.fitment.selectTireSizedropdown
          then:
            - click:
                identifier:  us.mappings.search.fitment.selectTireSizedropdown
            - sleep:
                duration: 3000 
            #CEPG-201373 : on resolution of the ticket, need to add the identifier for Tire Size           
            - click:
                identifier:  us.mappings.search.accVehicleInfo
      - sleep:
          duration: 3000 
      - click:
          identifier:  us.mappings.search.fitment.viewResultButton
            
  - name: us.functions.search.searchOilChangeInstallationService
    platform: ios
    flow:      
      - if:
          identifier:
            notPresent: 
              - identifier: us.mappings.tabBar.search
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected
          else: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tabBar.search
            - click:
                wait: 3000
                identifier: us.mappings.tabBar.search
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected 
                wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected

      # Verify, click and enter search text in search field
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected
      - click:
          identifier: us.mappings.home.searchBarSelected
          wait: 3000
      - enterText:
          identifier: us.mappings.home.searchBarSelected
          string: ${searchTerm}
          pressEnter: false
      - click:
          identifier: us.mappings.search.acc.autoserviceoilchange
      - sleep:
          duration: 10000

  - name: us.functions.search.redirectTerms
    platform: ios
    flow:  
      - loop:
          each: ${redirectTermsItems}
          storeElement: items
          flow:
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: $items
            - sleep: 
                duration: 5000  
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.firstItem
                then:
                  - log: Item is present 
                else: 
                  - failTest:
                      message: "FAILURE - ${env} - Items not found"
              
            - executeFunction:
                name: us.functions.search.clickOnFirstItem         
            - executeFunction:
                name: us.functions.item.addItemToCart

  - name: us.functions.search.redirectTerms
    platform: android
    flow: 
      - executeFunction:
          name: us.functions.gic.changeFulfillment
          params:
            - name: option
              string: Shipping 
      - loop:
          each: ${redirectTermsItems}
          storeElement: items
          flow:
            - executeFunction:
                name: us.functions.search.searchItem
                params:
                  - name: searchTerm
                    string: $items
            - sleep: 
                duration: 5000  
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.firstItem
                then:
                  - log: Item is present 
                else: 
                  - failTest:
                      message: "FAILURE - ${env} - Items not found"
            - executeFunction:
                name: us.functions.search.clickOnFirstItem
                params:
                  - name: noAds
                    string: true                
            - executeFunction:
                name: us.functions.item.addItemToCart

######### Badging2.0 Android #########

# NO Intent
  - name: us.functions.search.noIntent.verifyBadgingSLA
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.pickup
              - identifier: us.mappings.search.badging.delivery
              - identifier: us.mappings.search.badging.shipping
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla

# Pickup Intent
  - name: us.functions.search.pickupIntent.verifyBadgingSLA 
    platform: android
    flow:
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.search.badging.delivery
            - identifier: us.mappings.search.badging.shipping

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.pickup
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla

# Delivery Intent
  - name: us.functions.search.deliveryIntent.verifyBadgingSLA 
    platform: android
    flow:
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.search.badging.pickup
            - identifier: us.mappings.search.badging.shipping

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.delivery
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla

# Shipping Intent
  - name: us.functions.search.shippingIntent.verifyBadgingSLA 
    platform: android
    flow:
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.search.badging.pickup
            - identifier: us.mappings.search.badging.delivery

      - if:
          identifier:
            present:
              - identifier: us.mappings.search.badging.shipping
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.badging.sla                                        

  - name: us.functions.search.verifyAndSelect.prosellerItem
    platform: ios
    flow: 
      # Search prod item
      - executeFunction:
          name: us.functions.search.searchItem
          params:
            - name: searchTerm
              string: us.data.prod.item.mpProseller

      - executeFunction:
          name: us.functions.gic.changeFulfillment
          params:
            - name: option
              string: Shipping         

      # Apply 3P proseller retailer filter
      - executeFunction:
          name: us.functions.search.applyRetailerFilter
          params:
            - name: option
              string: Pro-Sellers 

      # Select first item
      - executeFunction:
          name: us.functions.search.clickOnFirstItem

      # Navigate to MP seller page
      - executeFunction:
          name: us.functions.item.marketplace.verifySellerType
          params:
            - name: sellerType
              string: pro-seller

  - name: us.function.search.verifyVisionPrescriptionBadge
    platform: android
    flow:
      - sleep: 
          duration: 5000 
      - verifyIdentifier:
          present: 
           - identifier: us.mappings.search.vision.prescriptionEligible
      - log: Prescription eligible text is present 

  - name: us.functions.search.increaseOrDecreaseQty
    platform: ios
    flow: 
      - sleep: 
          duration: 5000  
      - if:
          condition: ${IncreaseQty} == true
          then:
            - click:
                identifier: us.mappings.search.ATCbutton
            - executeFunction:
                name: us.functions.item.handlePAC
            - loop:
                begin: 0
                end: ${QtySearch}
                storeIndex: i
                mode: increment
                flow:
                  - click:
                      identifier: us.mappings.search.addToCartIncrement 
                  - log: $i
          else:
            - if: 
                condition: ${DecreaseQty} == true
                then:
                  - verifyIdentifier: 
                      present:
                        - identifier: us.mappings.search.decreaseQty
                  - loop:
                      begin: 0
                      end: ${QtySearch}
                      storeIndex: i
                      mode: increment
                      flow:
                        - click:
                            identifier: us.mappings.search.decreaseQty
                        - log: $i          


  - name: us.functions.verifyMOQ.Implicitdelivery
    platform: ios
    flow: 
      - if:
          condition: ${page} == 'search'
          then:
            - executeFunction: 
                name: us.functions.search.increaseOrDecreaseQty
            - sleep: 
                duration: 5000    
            # - verifyIdentifier:
            #     notPresent:
            #       - identifier: us.mappings.item.toastMessage                      
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.cart.fcDelivery.cardTitle
            - log: Shipping fulfillment is present
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
            - executeFunction:
                name: us.functions.search.addItemtoCart
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - executeFunction:
                name: us.functions.cart.decreaseToMinQty                 
            - executeFunction:
                name: us.functions.cart.removeAllCartItems
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
      - if:
          condition: ${page} == 'item page'
          then:
            - executeFunction:
                name: us.functions.search.searchItem
            - executeFunction:
                name: us.functions.search.clickOnFirstItem 
            - executeFunction:
                name: us.functions.item.addItemToCartWithErrorHandling
            - executeFunction:
                name: us.functions.item.increaseToMaxQty 
            - executeFunction:
                name: us.functions.item.verifyToastMessageMOQ
            - executeFunction:
               name: us.functions.item.SelectOtherILCintentForMOQ
            - executeFunction:
               name: us.functions.item.closeItemPage

      - if:
          condition: ${page} == 'cart'
          then:
             - executeFunction:
                 name: us.functions.global.navigation.toCartFromNavBar
             - executeFunction:
                 name: us.functions.cart.IncreaseItemAndVerifyMOQ
  

  - name: us.functions.verifyMOQ.explicitPickup
    platform: ios
    flow: 
      - if:
          condition: ${page} == 'search'
          then:          
            - executeFunction:
                name: us.functions.search.verifyPickupBadge  
            - executeFunction: 
                name: us.functions.search.increaseOrDecreaseQty
            - sleep: 
                duration: 5000    
            - executeFunction:
                name: us.functions.cart.verifyMultiOrderQtyBottomSheet    
            - executeFunction:
                name: us.functions.search.verifyShippingAvailableBadge                   
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - verifyIdentifier:
                label:
                  - identifier: us.mappings.cart.fcDelivery.cardTitle
                    contains: Shipping
            # - verifyIdentifier:
            #     present:
            #       - identifier: us.mappings.cart.fcDelivery.cardTitle
            - log: Shipping fulfillment is present                
            - executeFunction:
                name: us.functions.cart.removeAllCartItems
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
      - if:
          condition: ${page} == 'itempage'
          then:
            - executeFunction:
                name: us.functions.search.clickOnFirstItem 
                params:
                  - name: excludeSponsored
                    string: true
            - executeFunction:
                name: us.functions.item.addItemToCartWithErrorHandling
            - executeFunction:
                name: us.functions.item.handlePAC
            - executeFunction:
                name: us.functions.item.handlePAC
            - executeFunction:
                name: us.functions.item.increaseToMaxQty
            - executeFunction:
                name: us.functions.item.verifyToastMessageMOQ            
            # - click:
            #     identifier: us.mappings.item.decreaseItemQuantity
            # - scroll:
            #     direction: down
            #     untilIdentifier: us.mappings.item.switching.fulfillment.pickupText
            #     position: center                
            # - verifyIdentifier:
            #     value:
            #       - identifier: us.mappings.item.switching.fulfillment.pickupText
            #         equals: 1
            - executeFunction:
               name: us.functions.item.closeItemPage 

      - if:
          condition: ${page} == 'cart'
          then:
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - scroll:
                direction: down
                untilIdentifier: us.mappings.cart.secondItem.saveForLaterButton
                position: center
            - click:
                identifier: us.mappings.item.atc.decrementStepper
            - scroll:
                direction: up
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.cart.pickup.cardTitle
            - executeFunction: 
                name: us.functions.cart.IncreaseItemAndselectPickupfromMOQ  
            - executeFunction: 
                name: us.functions.cart.IncreaseItemAndVerifyMOQ  
            - sleep:
                duration: 3000  
            - scroll:
                direction: up
            - verifyIdentifier:
                label:
                  - identifier: us.mappings.cart.fcDelivery.cardTitle
                    contains: Shipping
            - log: Shipping fulfillment is present
            # - executeFunction:
            #     name: us.functions.cart.decrementQuantity
            # - scroll:
            #     direction: up
            # - verifyIdentifier:
            #     present: 
            #       - identifier: us.mappings.cart.pickup.cardTitle
 



  - name: us.functions.search.searchItemBasics
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBar
      - click:
          identifier: us.mappings.home.searchBar
          wait: 3000
      - enterText:
          identifier: us.mappings.home.searchBar
          string: ${searchTerm}
          pressEnter: true
      # Close pop up to select intent is displayed
      - executeFunction:
          name: us.functions.search.closeHowDoYouWantYourOrderBottomTray

  - name: us.functions.search.increaseOrDecreaseQty
    platform: android
    flow: 
      - if:
          condition: ${IncreaseQty} == true
          then:
            - click:
                identifier: us.mappings.search.addToCartButtonFromSearchResult 
            - if:
                identifier:
                  present: 
                    - identifier: us.mappings.carePlans.wppSection
                then:
                  - click: 
                      identifier: us.mappings.search.howDoYouWantYourOrderBottomTrayCloseButton
            - loop:
                begin: 0
                end: ${QtySearch}
                storeIndex: i
                mode: increment
                flow:
                  - click:
                      identifier: us.mappings.search.addToCartIncrement 
                  - if:
                      identifier:
                        present: 
                          - identifier: us.mappings.search.wantMoreItemText 
                      then:
                        - break: true
                  - log: $i
          else:
            - if: 
                condition: ${DecreaseQty} == true
                then:
                  - verifyIdentifier: 
                      present:
                        - identifier: us.mappings.search.SBA.DecrementStepper
                  - loop:
                      begin: 0
                      end: ${QtySearch}
                      storeIndex: i
                      mode: increment
                      flow:
                        - click:
                            identifier: us.mappings.search.SBA.DecrementStepper
                        - log: $i 

  - name: us.functions.search.verifyPickupBadge
    platform: android
    flow: 
      - verifyIdentifier: 
          present:
            - identifier: us.mappings.search.pickupBadge

  - name: us.functions.search.verifyShippingAvailableBadge
    platform: android
    flow: 
      - verifyIdentifier: 
          present:
            - identifier: us.mappings.search.verifyShippingAvailableBadge

  - name: us.functions.verifyMOQ.Implicitdelivery
    platform: android
    flow: 
      - if:
          condition: ${page} == 'search'
          then:
            - executeFunction: 
                name: us.functions.search.increaseOrDecreaseQty
            - sleep: 
                duration: 5000    
            # - verifyIdentifier:
            #     notPresent:
            #       - identifier: us.mappings.item.toastMessage                      
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - executeFunction:
                name: us.functions.cart.scrollToTopOfCart    
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.cart.fcDelivery.cardTitle
            - log: Shipping fulfillment is present
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
            - executeFunction:
                name: us.functions.search.addItemtoCart
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - executeFunction:
                name: us.functions.cart.decreaseToMinQty 
            - sleep: 
                duration: 8000    
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar                         
            - executeFunction:
                name: us.functions.cart.removeAllCartItems
            - executeFunction:
                name: us.functions.global.navigation.backNavigation    

      - if:
          condition: ${page} == 'item page'
          then:
            - executeFunction:
                name: us.functions.search.searchItem
            - executeFunction:
                name: us.functions.search.clickOnFirstItem 
            - executeFunction:
                name: us.functions.item.addItemToCart
            - executeFunction:
                name: us.functions.item.increaseToMaxQty 
            - executeFunction:
                name: us.functions.item.verifyToastMessageMOQ
            - executeFunction:
               name: us.functions.item.SelectOtherILCintentForMOQ
            - executeFunction:
               name: us.functions.item.closeItemPage

      - if:
          condition: ${page} == 'cart'
          then:
             - executeFunction:
                 name: us.functions.global.navigation.toCartFromNavBar
             - executeFunction:
                 name: us.functions.cart.IncreaseItemAndVerifyMOQ        

  - name: us.functions.verifyMOQ.explicitPickup
    platform: android
    flow: 
      - if:
          condition: ${page} == 'search'
          then:
            - executeFunction:
                name: us.functions.search.verifyPickupBadge   
            - executeFunction: 
                name: us.functions.search.increaseOrDecreaseQty
            - sleep: 
                duration: 5000    
            - executeFunction:
                name: us.functions.cart.verifyMultiOrderQtyBottomSheet        
            - executeFunction:
                name: us.functions.search.verifyShippingAvailableBadge                 
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - executeFunction:
                name: us.functions.cart.scrollToTopOfCart
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.cart.fcDelivery.cardTitle
                    contains: shipping
            - log: Shipping fulfillment is present
            - executeFunction:
                name: us.functions.cart.removeAllCartItems
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
            # - executeFunction:
            #     name: us.functions.search.addItemtoCart
            # - executeFunction:
            #     name: us.functions.global.navigation.toCartFromNavBar
            # - executeFunction:
            #     name: us.functions.cart.decreaseToMinQty                 

            # - executeFunction:
            #     name: us.functions.global.navigation.backNavigation
               
      - if:
          condition: ${page} == 'itempage'
          then:
            - executeFunction:
                name: us.functions.search.clickOnFirstItem 
                params:
                  - name: noAds
                    string: true
            - executeFunction:
                name: us.functions.item.addItemToCart
            - executeFunction:
                name: us.functions.item.handlePAC
            - executeFunction:
                name: us.functions.item.handlePAC
            - scroll:
                direction: down
                untilIdentifier: us.mappings.item.switching.fulfillment.shippingText
                position: center
            - executeFunction:
                name: us.functions.item.increaseToMaxQty
            - executeFunction:
                name: us.functions.item.verifyToastMessageMOQ
            - sleep:
                duration: 8000            
            - click:
                identifier: us.mappings.search.SBA.DecrementStepper
            - scroll:
                direction: down
                untilIdentifier: us.mappings.item.IlcPickupTile
                position: center                
            - verifyIdentifier:
                      contentDescription: 
                        - identifier: us.mappings.item.IlcPickupTile
                          contains: selected
            - executeFunction:
               name: us.functions.item.closeItemPage

      - if:
          condition: ${page} == 'cart'
          then:
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - executeFunction: 
                name: us.functions.cart.IncreaseItemAndselectPickupfromMOQ  
            - executeFunction: 
                name: us.functions.cart.IncreaseItemAndVerifyMOQ  
            - sleep:
                duration: 3000  
            - scroll:
                direction: up
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.cart.fcDelivery.cardTitle
                    contains: shipping
            - log: Shipping fulfillment is present
            - executeFunction:
                name: us.functions.cart.decrementQuantity
            - scroll:
                direction: up
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.cart.pickup.cardTitle
                    contains: pickup

  # Function to  select nearby store from search and select store when needed                         
  - name: us.functions.search.location.nearbyStore
    platform: ios
    flow:
      - if: 
          identifier:
            present:
              - identifier: us.mappings.search.selectpickupat.nearbystore.btn
          then:
            - click:
                identifier: us.mappings.search.selectpickupat.nearbystore.btn
            - if: 
                condition: ${selectstore} == 'select'
                then:
                  - click:
                      identifier: us.mappings.home.selectItemAvailableStore.radio.btn
            - click:
                identifier: us.mappings.home.SaveAvailablestore
            - sleep:
                duration: 3000

          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.selectpickupat.nearbystore.btn
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center 
            - click:
                identifier: us.mappings.search.selectpickupat.nearbystore.btn                    
            - if: 
                condition: ${selectstore} == 'select'
                then:
                  - click:
                      identifier: us.mappings.home.selectItemAvailableStore.radio.btn
            - click:
                identifier: us.mappings.home.SaveAvailablestore
            - sleep:
                duration: 3000

  # Function to  select nearby store from search and select store when needed                         
  - name: us.functions.search.location.nearbyStore
    platform: android
    flow:
      - if: 
          identifier:
            present:
              - identifier: us.mappings.search.selectpickupat.nearbystore.btn
          then:
            - click:
                identifier: us.mappings.search.selectpickupat.nearbystore.btn
            - if: 
                condition: ${selectstore} == 'select'
                then:
                  - click:
                      identifier: us.mappings.home.selectItemAvailableStore.radio.btn
            - click:
                identifier: us.mappings.gic.selectStore.save.button
                wait: 3000

          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.search.selectpickupat.nearbystore.btn
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.search.selectpickupat.nearbystore.btn                    
            - if: 
                condition: ${selectstore} == 'select'
                then:
                  - click:
                      identifier: us.mappings.home.selectItemAvailableStore.radio.btn
            - click:
                identifier: us.mappings.gic.selectStore.save.button
                wait: 2000

  - name: us.functions.search.ad.verifySbaRateAdsViewModel
    platform: android
    flow:
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sbaRateAdsModel
      - click:
          identifier: us.mappings.search.ad.sbaRateAdsModel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sbaRateAdsModelTitle
            - identifier: us.mappings.search.ad.sbaRateAdsModelHelpfulButton
            - identifier: us.mappings.search.ad.sbaRateAdsModelNotHelpfulButton
      - click:
          identifier: us.mappings.search.ad.sbaRateAdsModelHelpfulButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sbaRateAdsModelThankyouLabel
      - click:
          identifier: us.mappings.global.closeButton

  - name: us.functions.search.ad.verifySbaRateAdsViewModel
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sbaRateAdsModel
      - click:
          identifier: us.mappings.search.ad.sbaRateAdsModel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.ad.sbaRateAdsModelTitle
            - identifier: us.mappings.search.ad.sbaRateAdsModelHelpfulButton
            - identifier: us.mappings.search.ad.sbaRateAdsModelNotHelpfulButton
      - click:
          identifier: us.mappings.search.ad.sbaRateAdsModelHelpfulButton
      - verifyIdentifier:
          label:
            - identifier: us.mappings.search.ad.sbaRateAdsModelThankyouLabel
              contains: Thank you for helping us make our ad experiences better.
      - click:
          identifier: us.mappings.global.closeButton

  - name: us.functions.search.verifyExtraSavingsInSearchPage
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.inHome.unSelectCheckbox
      - click:
          identifier: us.mappings.inHome.unSelectCheckbox
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.primaryPrice
            - identifier: us.mappings.search.strikeThroughPrice
            - identifier: us.mappings.search.savingsAppliedText

  - name: us.functions.search.verifyExtraSavingsInSearchPage
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.search.clipDiscount
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.primaryPrice
            - identifier: us.mappings.search.strikeThroughPrice
            - identifier: us.mappings.search.savingsAppliedText

  - name: us.functions.search.clipDiscount
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.savingsCheckBox
      - click:
          identifier: us.mappings.search.savingsCheckBox

  - name: us.functions.search.verifyExtraSavingsInItemPage
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.savingsAppliedText
            - identifier: us.mappings.item.productPrimaryPrice
            - identifier: us.mappings.search.wasPriceText
      - click:
          identifier: us.mappings.cart.payOverClosebtn

  - name: us.functions.search.verifyExtraSavingsInItemPage
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.item.ilcFulfilmentLabel
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.savingsTextItemPage
            - identifier: us.mappings.search.pdp.productPrice
            - identifier: us.mappings.search.wasPriceText

  - name: us.functions.homePage.closeWplusPopup
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.myItems.reorder.bulkEnrollment.bottomSheetTitle
          then:
            - log: "Wplus bottom sheet appeared and closing the bottomsheet"
            - click:
                identifier: us.mapping.wplus.badges.closeBottomSheetMessage
          else:
            - log: "Wplus bottom sheet didn't appear proceeding further"

# Search for a product
  - name: us.functions.productSearch.searchAProduct
    platform: android
    flow:
      - log: 
          message: Searching for product.
          color: GREEN_BOLD
      - click:
          identifier: us.mappings.search.selectSearchBar
      - enterText:
          identifier: us.mappings.search.selectSearchBar
          string: ${product}
          pressEnter: true
      - sleep:
          duration: 3000
      - log:
          message: "Product ${product} searched"
          color: GREEN_BOLD
      - if:
          condition: ${shipAnotherCountry}
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.validateShipToColombia
      # - executeFunction:
      #     name: ca.test.functions.productSearch.threeWaysToOrder

            
# Local Market Place Search Type AHead experince 

  - name: us.functions.search.localMarketPlaceLandingPageValidations
    platform: android
    flow:
      - if:
          identifier:
            notPresent: 
              - identifier: us.mappings.tabBar.search
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected
          else: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tabBar.search
            - click:
                wait: 3000
                identifier: us.mappings.tabBar.search
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected 
                wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected
      - enterText:
          identifier: us.mappings.home.searchBarSelected
          string: ${searchTerm}
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBar.typeaheadStorePlacement4
            # - identifier: us.mappings.home.searchBar.typeaheadStorePlacement7 Needs to be updated once feature is stable 
      # Search Items
      - executeFunction:
          name: us.functions.search.searchItem
          params:
            - name: searchTerm
              string: Fresh roti
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.localMarketPlace.localItemCarouse.item1
            - identifier: us.mappings.search.localMarketPlace.localItemCarouse.item2
            - identifier: us.mappings.search.localMarketPlace.localItemCarouse.item3
      - if: 
          condition: ${fulfillment} == 'Delivery'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.deliverySLA.item1
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.deliverySLA.item2
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.deliverySLA.item3
      - if: 
          condition: ${fulfillment} == 'Pickup'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.pickupSLA
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.search.localMarketPlace.localItemCarousel.soldByLocally
            - identifier: us.mappings.search.localMarketPlace.localItemCarousel.sellerInfoCTA
      - click:
          identifier: us.mappings.search.localMarketPlace.localItemCarousel.sellerInfoCTA
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.localMarketPlace.localItemCarousel.sellerInfoCTA.infopage
      - click:
          identifier: us.mappings.search.localMarketPlace.localItemCarousel.sellerInfoCTA.close

# Local Market Place Search Type AHead experince 

  - name: us.functions.search.localMarketPlaceLandingPageValidations
    platform: ios
    flow:
      - if:
          identifier:
            notPresent: 
              - identifier: us.mappings.tabBar.search
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected
          else: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tabBar.search
            - click:
                wait: 3000
                identifier: us.mappings.tabBar.search
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
            - click:
                identifier: us.mappings.home.searchBarSelected 
                wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected
      - enterText:
          identifier: us.mappings.home.searchBarSelected
          string: ${searchTerm}
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBar.typeaheadStorePlacement4
            # - identifier: us.mappings.home.searchBar.typeaheadStorePlacement7 Needs to be updated once feature is stable 
      - click:
          identifier: us.mappings.home.searchBar.cancel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBar
      - click:
          identifier: us.mappings.home.searchBar
          wait: 3000
      - enterText:
          identifier: us.mappings.home.searchBar
          string: Fresh Roti
          pressEnter: true
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.localMarketPlace.localItemCarouse.item1
            - identifier: us.mappings.search.localMarketPlace.localItemCarouse.item2
      - if: 
          condition: ${fulfillment} == 'Delivery'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.deliverySLA.item1
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.deliverySLA.item2
      - if: 
          condition: ${fulfillment} == 'Pickup'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.localMarketPlace.localItemCarousel.pickupSLA
      - click:
          identifier: us.mappings.search.localMarketPlace.localItemCarousel.sellerInfoCTA
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.localMarketPlace.localItemCarousel.sellerInfoCTA.infopage
  
  - name: us.functions.productSearch.searchAProduct
    platform: ios
    flow:
      - log: 
          message: Searching for product.
          color: GREEN_BOLD
      - click:
          identifier: us.mappings.search.searchBarSelected
      - enterText:
          identifier: us.mappings.search.searchBarSelected
          string: ${product}
          pressEnter: true
      - sleep:
          duration: 3000
      - log:
          message: "Product ${product} searched"
          color: GREEN_BOLD
      - verifyIdentifier:
          present:
            - identifier: us.functions.cart.shipToColumbiaText

  - name: us.functions.search.verifyExtraSavingsInSearchDealsPage
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.search.clipDiscount
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.extraSavingsLabelsForDealsPage
            - identifier: us.mappings.search.extraSavingsStrikeThroughPriceForDealsPage
            - identifier: us.mappings.search.savingsAppliedTextForDealsPage

      
  - name: us.functions.search.verifyMultiQtyDiscountLabel
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.multiqtydiscountlabel

  - name: us.functions.search.verifyMQDDiscount
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.MQDDisocuntLabel
      - log: The item is multi quantity discount's item.

  - name: us.functions.searchResults.verifyBackorderBadgePresent
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mapings.search.backorderedLabel
          then:
            - log: "Backorder Label is present as expected"
          else:
            - failTest:
                message: "DATA_FAILURE - ${env} - Backorder badge should be present but is not"

  - name: us.functions.searchResults.verifyBackorderBadgePresent
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mapings.search.backorderedLabel
          then:
            - log: "Backorder Label is present as expected"
          else:
            - failTest:
                message: "DATA_FAILURE - ${env} - Backorder badge should be present but is not"