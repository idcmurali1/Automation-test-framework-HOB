functions:


  # Scanner

#Navigate to scanner and allow Would you like to access your camera request
  - name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.global.onboarding.allowLocationModalHeaderText
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.global.onboarding.allowLocation
            - click: 
                identifier: us.mappings.global.onboarding.allowLocation    
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.verifyWouldYouLikeToAccessCameraMessage
              - identifier: us.mappings.scanner.WouldYouLikeToAccessCameraOkButton
          then:
            - click:
                identifier: us.mappings.scanner.WouldYouLikeToAccessCameraOkButton
                wait: 1000 
                                   
#Navigate to scanner and validate are you at the store bottom overlay 
  - name: us.functions.scanner.validateAreYouAtTheStoreBottomOverlay
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.areYouAtTheStoreTitle
              - identifier: us.mappings.scanner.TellUsYourStoreMessage
              - identifier: us.mappings.scanner.yesI'mAtTheStoreButton
          then:
            - click:
                identifier: us.mappings.scanner.yesI'mAtTheStoreButton

#Navigate to scanner and validate Get accurate prices bottom overlay 
  - name: us.functions.scanner.validateGetAccuratePriceBottomOverlay
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.shareLocationButton
          then:
            - click:
                identifier: us.mappings.scanner.shareLocationButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.getAccuratePricesTitle
              - identifier: us.mappings.scanner.getAccuratePricesContinueButton
          then: 
            - click:
                identifier: us.mappings.scanner.getAccuratePricesContinueButton
      

      #Navigate to scanner allow location
  - name: us.functions.scanner.allowLocation
    platform: ios
    flow:
      # Accept share precise location pop up if displayed
      - if:
          identifier:
            present:
              - identifier: us.mappings.checkin.sharePreciseLocation.PopUp
          then:
            - click:
                identifier: us.mappings.checkin.sharePreciseLocation.PopUp
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.checkin.location.allow
          then:
            - click:
                wait: 5000
                identifier: us.mappings.checkin.location.allow
            - sleep:
                duration: 5000
            
#Navigate to scanner and validate shop smart with scanner bottom overlay 
  - name: us.functions.scanner.shopSmartWithScannerBottomOverlay
    platform: ios
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.shopSmartWithScannerTitle
              - identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
          then:
            - click:
                identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
            - sleep:
                duration: 3000
#Enter barcode and verify
  - name: us.functions.scanner.verifyAndEnterBarcodetext
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.typeYourBarcodeButton   
      - click:
          identifier: us.mappings.scanner.typeYourBarcodeButton
          wait: 1000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.typeYourBarcode.typeACodeTitle
            - identifier: us.mappings.scanner.typeYourBarcode.barCodeTab
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.scanner.typeYourBarcode.enterBarcodeTextField
      # - click:
      #     identifier: us.mappings.scanner.typeYourBarcode.enterBarcodeTextField
      - enterText:
          identifier: us.mappings.scanner.typeYourBarcode.enterBarcodeTextField
          string: ${barcode}
      - click:
          identifier: us.mappings.scanner.typeYourBarcode.searchButton

#Verify and handle item overlay after seraching with barcode
  - name: us.functions.scanner.verifyAndHandleItemFoundOverlay
    platform: ios
    flow:
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.scanner.itemFoundOverlayTitle
            # - identifier: us.mappings.scanner.itemFound.moreInfoButton
      
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.shopSimilar
          then:
            - click:
                identifier: us.mappings.scanner.shopSimilar
            - click:
                identifier: us.mappings.item.addToCartButton    
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.scanner.itemFound.moreInfoButton
            - click:
                identifier: us.mappings.scanner.itemFound.moreInfoButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.item.addToCartButton
            - click:
                identifier: us.mappings.item.addToCartButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.itemadded
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.ScannerHeader
              - identifier: us.mappings.home.ScannerCloseButton
          then:
            - click:
                identifier: us.mappings.home.ScannerCloseButton  
          else:
            - click:
                identifier: us.mappings.item.closeItemDetailsPage
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.scanner.ScannerHeader
                  - identifier: us.mappings.home.ScannerCloseButton
            - click:
                identifier: us.mappings.home.ScannerCloseButton   

  - name: us.functions.scanner.verifyScannerItemFound
    platform: ios
    flow:
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.scanner.itemFound
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.scanner.itemName
      - getString:
          identifier: us.mappings.scanner.itemName
          attribute: label
          storeIn: itemName
      - log: Name =${itemName}
      - click:
          identifier: us.mappings.scanner.itemName
          wait: 2000
      - click:
          identifier: us.mappings.item.closeScreen
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.shopSimilar   
      - click:
          identifier: us.mappings.scanner.shopSimilar
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.similarItemsLabel
            - identifier: us.mappings.scanner.hideSimilar
      - click:
          identifier: us.mappings.scanner.hideSimilar
      - if:
          identifier:
            present:
              - identifier: us.mappings.item.itemadded        
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.item.itemadded
            - click:
                identifier: us.mappings.item.itemadded
            - click:
                identifier: us.mappings.scanner.closeButton          
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.itemAddedToCart
            - click:
                identifier: us.mappings.home.itemAddedToCart
                wait: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.cart.itemAddedToCartCount
                label:
                  - identifier: us.mappings.cart.oneItemPresent.itemNameLabel
                    contains: ${itemName}
          else:
            - failTest:
                message: "DATA_FAILURE - ${env} - Searched item is OOS"

#####################################Android#####################################

#Navigate to scanner and allow Would you like to access your camera request
  - name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.verifyWouldYouLikeToAccessCameraMessage
              - identifier: us.mappings.scanner.WouldYouLikeToAccessCameraOkButton
          then:
            - click:
                identifier: us.mappings.scanner.WouldYouLikeToAccessCameraOkButton

#Navigate to scanner and validate are you at the store bottom overlay 
  - name: us.functions.scanner.validateAreYouAtTheStoreBottomOverlay
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.areYouAtTheStoreTitle
              - identifier: us.mappings.scanner.TellUsYourStoreMessage
              - identifier: us.mappings.scanner.yesI'mAtTheStoreButton
          then:
            - click:
                identifier: us.mappings.scanner.yesI'mAtTheStoreButton

#Navigate to scanner and validate Get accurate prices bottom overlay 
  - name: us.functions.scanner.validateGetAccuratePriceBottomOverlay
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.getAccuratePricesTitle
              - identifier: us.mappings.scanner.getAccuratePricesContinueButton
          then:
            - click:
                identifier: us.mappings.scanner.getAccuratePricesContinueButton

#Navigate to scanner allow location
  - name: us.functions.scanner.allowLocation
    platform: android
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.shareYourlocationInStorePrice
          then:
            - click:
                identifier: us.mappings.scanner.shareYourlocationInStorePrice
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.shareYourlocation
          then:
            - click:
                identifier: us.mappings.scanner.shareYourLocation.continueButton
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.enableYourLocation
          then:
            - click:
                identifier: us.mappings.scanner.enableYourLocation
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.checkin.location.allow # us.mappings.scanner.locationAccess
          then:
            - click:
                identifier: us.mappings.checkin.location.allow # us.mappings.scanner.locationAccess

#Navigate to scanner and validate shop smart with scanner bottom overlay 
  - name: us.functions.scanner.shopSmartWithScannerBottomOverlay
    platform: android
    flow:
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.scanner.shopSmartWithScannerTitle
              - identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
          then:
            - click:
                identifier: us.mappings.scanner.shopSmartWithScannerGotItButton

#Enter barcode and verify
  - name: us.functions.scanner.verifyAndEnterBarcodetext
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.typeYourBarcodeButton   
      - click:
          identifier: us.mappings.scanner.typeYourBarcodeButton
          wait: 1000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.typeYourBarcode.typeACodeTitle
            - identifier: us.mappings.scanner.typeYourBarcode.barCodeTab
      - enterText:
          identifier: us.mappings.scanner.typeYourBarcode.enterBarcodeTextField
          string: ${barcode}
      - click:
          identifier: us.mappings.global.onboarding.searchButton

  - name: us.functions.scanner.verifyScannerItemFound
    platform: android
    flow:
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.scanner.itemFound
            - identifier: us.mappings.scanner.itemImage
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.scanner.itemName
      - click:
          identifier: us.mappings.scanner.itemName
          wait: 3000
      - click:
          identifier: us.mappings.global.closeButton
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.shopSimilar # us.mappings.myItems.similarItemsLabel   
      - click:
          identifier: us.mappings.scanner.shopSimilar # us.mappings.myItems.similarItemsLabel
          wait: 3000
      - verifyIdentifier:
          present:
            #- identifier: us.mappings.scanner.similarItemsLabel
            - identifier: us.mappings.marketplace.compareSellerAddToCartButton
      - click:
          identifier: us.mappings.marketplace.compareSellerAddToCartButton
      - click:
          identifier: us.mappings.backButton
      # - sleep:
      #     duration: 3000
      # - openLink: walmart://home #this is commented as the app crash fixed in navigate back(bug:CEPG-124913)
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.itemAddedToCart
      - click:
          identifier: us.mappings.home.itemAddedToCart
          wait: 3000
      - sleep:
          duration: 10000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cart.navBarTitle
          then:
            - executeFunction:
                name: us.functions.cart.scrollToTopOfCart
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.itemName
            - identifier: us.mappings.cart.itemAddedToCartCount

  - name: us.functions.scanner.assert.scannerBottomSheet
    platform: ios
    flow:
      - if: 
          condition: ${option} == 'onlineandstore'
          then: 
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.scanner.itemName
            - getString:
                identifier: us.mappings.scanner.itemName
                attribute: label
                storeIn: itemName
            - log: Name =${itemName}
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.scanner.resumeStoreModeButton
                then:
                  - click:
                      identifier: us.mappings.scanner.resumeStoreModeButton
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.scanner.storePrice
                  - identifier: us.mappings.scanner.onlinePrice
                  - identifier: us.mappings.scanner.productDetailsLink
            - click:
                identifier: us.mappings.scanner.productDetailsLink 
            - verifyIdentifier:
                value:
                  -  identifier: us.mappings.item.productTitleViewpProductTitle
                     contains : ${itemName}

  - name: us.functions.scanner.assert.scannerBottomSheet
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.resumeStoreModeButton
          then:
            - click:
                identifier: us.mappings.scanner.resumeStoreModeButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.storePrice
            - identifier: us.mappings.scanner.onlinePrice            
            - identifier: us.mappings.scanner.productDetailsLink
      - click:
          identifier: us.mappings.scanner.storePrice 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.ensurePricingDisclaimerBottomSheet
            - identifier: us.mappings.global.closeButton
      - click:
          identifier: us.mappings.global.closeButton


  - name: us.functions.scanner.verifyScannerBottomSheetIsNotDispalyed
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.verifyScannerBottomSheet 
            - identifier: us.mappings.scanner.dismissButton
      - click:
          identifier: us.mappings.scanner.dismissButton
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.scanner.verifyScannerBottomSheet