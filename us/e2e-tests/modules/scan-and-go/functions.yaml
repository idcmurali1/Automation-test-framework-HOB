functions:

#Navigate to Debug panel and select store mode
  - name: us.functions.home.debugPanel.setUpScanAndGo
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://debugPanel
      - scroll:
          direction: down
          untilIdentifier: us.mappings.debugPanel.storeMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode
      - click:
          identifier: us.mappings.debugPanel.storeMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.DisableListeners
      - click:
          identifier: us.mappings.debugPanel.storeMode.DisableListeners
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.storeModeEnabled
      - click:
          identifier: us.mappings.debugPanel.storeMode.storeModeEnabled
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.isTransactable
      - click:
          identifier: us.mappings.debugPanel.storeMode.isTransactable
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.mockOrderHistoryEnabled
      - click:
          identifier: us.mappings.debugPanel.storeMode.mockOrderHistoryEnabled
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.notifyTransactionCompleted
      - click:    
          identifier: us.mappings.debugPanel.storeMode.notifyTransactionCompleted        
      - if: 
          identifier:
            present:
              - identifier: us.mappings.debugPanel.storeMode.storeId
          then:
            - enterText:
                identifier: us.mappings.debugPanel.storeMode.storeId
                string: us.data.prod.ios.scanAndGo.storeId
            - click:
                wait: 2000
                identifier: us.mappings.flex.doneButton
            - sleep:
                duration: 2000
            - click:
                wait: 2000
                identifier: us.mappings.debugPanel.storeMode.backScreen
      - if: 
          identifier:
            present:
              - identifier: us.mappings.debugPanel.storeMode.backScreen
          then:
            - click:
                identifier: us.mappings.debugPanel.storeMode.backScreen
      - if: 
          identifier:
            present:
              - identifier: us.mappings.debugPanel.WelcometoyourStoreTitle
          then:
            - click:
                identifier: us.mappings.home.storeModePopUpClose

  - name: us.functions.home.scanAndGo
    platform: ios
    flow:
      - if:
           identifier:
             present:
               - identifier: us.mappings.home.storeModePopUp
           then:
             - click:
                 identifier: us.mappings.home.storeModePopUpClose
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.ViewstoremodeButton
      - click:
          identifier: us.mappings.home.ViewstoremodeButton
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.home.scanAndGo
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo
      - click:
          identifier: us.mappings.home.scanAndGo
      - executeFunction:
          name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
      - executeFunction:
          name: us.functions.scanner.allowLocation
    #   - executeFunction:
    #       name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
      - click:
          wait: 10000
          identifier: us.mappings.home.scanAndGo.exitScanAndGo
      - executeFunction:
          name: us.functions.home.viewStoreMode
      - click:
          wait: 10000
          identifier: us.mappings.home.scanAndGo
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.welcomeTitle
            - identifier: us.mappings.home.scanAndGo.subTitle
            - identifier: us.mappings.home.scanAndGo.inStoreTitle
      - click:
          identifier: us.mappings.home.scanAndGo.exitScanAndGo
          wait: 5000
      - executeFunction:
          name: us.functions.home.viewStoreMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.findAnItem
      - click:
          identifier: us.mappings.home.scanAndGo.findAnItem
          doubleClick: true        
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.findAnItem.allDepartments
      - click:
          identifier: us.mappings.tabBar.shop
      - executeFunction:
          name: us.functions.home.viewStoreMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.walmartPay
      - click:
          identifier: us.mappings.home.scanAndGo.walmartPay
          wait: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.walmartPayTitle
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.scanAndGo.walmartPayTitle.Popup.Startscanning
          then:
              - click:
                  identifier: us.mappings.home.scanAndGo.walmartPayTitle.Popup.Startscanning
                  wait: 3000
      - click:
          identifier: us.mappings.cart.missingAnything.closeButton
      - executeFunction:
          name: us.functions.home.viewStoreMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.checkPrice
      - click:
          identifier: us.mappings.home.scanAndGo.checkPrice
    #   - click:
    #       identifier: us.mappings.home.scanAndGo.checkPrice
      - if: 
          identifier:
            present:
              - identifier: us.mappings.home.scanAndGo.checkPrice.shopSmartText
          then:
            - click:
                identifier: us.mapppings.wplus.gotItInRefferalDialog       
    #   - verifyIdentifier:
    #       present:
    #         - identifier: us.mappings.home.scanAndGo.checkPrice.shopSmartText
    #   - click:
    #       identifier: us.mapppings.wplus.gotItInRefferalDialog
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.checkPrice.scannerText
      - click:
          identifier: us.mappings.home.ScannerCloseButton
          doubleClick: true

  - name: us.functions.search.scanAndGo.StoreMapsMapView
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.storeMapsAisle
          then:
            - click:
                identifier: us.mappings.search.storeMapsAisle
                wait: 3000
          else:
            - executeFunction:
                name: us.functions.search.clickOnFirstItem
            - click:
                identifier: us.mappings.home.items.storeMode.aile
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.items.storeMode.titleText
            - identifier: us.mappings.home.items.storeMode.aile.productmap
      - click:
          identifier: us.mappings.home.items.storeMode.storeMapsCloseButton
          wait: 1000
      
######################################## ANDROID ##############################################

  - name: us.functions.home.debugPanel.setUpScanAndGo
    platform: android
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://debugPanel     
      - scroll:
          direction: down
          untilIdentifier: us.mappings.debugPanel.storeMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode
      - click:
          identifier: us.mappings.debugPanel.storeMode
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.storeId
      - click:
          identifier: us.mappings.debugPanel.storeMode.storeId  
      - if: 
          identifier:
            present:
              - identifier: us.mappings.debugPanel.storeMode.enterStoreId
          then:
            - enterText:
                identifier: us.mappings.debugPanel.storeMode.enterStoreId
                string: us.data.prod.android.scanAndGo.storeId
            - click:
                identifier: us.mappings.paymentMethod.checkout.continueButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.isTransactable # us.mappings.debugPanel.storeMode.storeIsTransactable
      - click:
          identifier: us.mappings.debugPanel.storeMode.isTransactable # us.mappings.debugPanel.storeMode.storeIsTransactable
      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.storeSupportsScanAndGo
      - click:
          identifier: us.mappings.debugPanel.storeMode.storeSupportsScanAndGo 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.debugPanel.storeMode.activateInStoreSession
      - click:
          identifier: us.mappings.debugPanel.storeMode.activateInStoreSession
      - goBack: true
      - goBack: true
      - goBack: true

  - name: us.functions.home.scanAndGo
    platform: android
    flow:
      - executeFunction:
          name: us.functions.search.scanAndGo.StoreModeView
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo
      - click:
          identifier: us.mappings.home.scanAndGo
      - if:
          identifier:
            present:
              - identifier: us.mappings.deliveryAddress.add.sharePreciseLocation
          then:
            - click: 
                identifier: us.mappings.deliveryAddress.add.sharePreciseLocation
      - executeFunction:
          name: us.functions.scanner.allowLocation
      - executeFunction:
          name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.inStoreTitle
      - click:
          identifier: us.mappings.home.scanAndGo.exitScanAndGo
      - executeFunction:
          name: us.functions.search.scanAndGo.StoreModeView
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.findAnItem
      - click:
          identifier: us.mappings.home.scanAndGo.findAnItem
      - sleep:
         duration: 5000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.home.scanAndGo.findAnItem.allDepartments
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.storeMode.close
            - click:
                identifier: us.mappings.home.storeMode.close
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.findAnItem.allDepartments
      - goBack: true
      - executeFunction:
          name: us.functions.search.scanAndGo.StoreModeView
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.walmartPay # us.mappings.services.walmartPayHeader
      - click:
          identifier: us.mappings.home.scanAndGo.walmartPay # us.mappings.services.walmartPayHeader
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.walmartPayTitle
      - if:
          identifier:
            present:
              - identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
          then:
            - click: 
                identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
          else:
            - click: 
                identifier: us.mappings.global.closeButton           
      - click:
          identifier: us.mappings.backButton
      - executeFunction:
          name: us.functions.search.scanAndGo.StoreModeView
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.scanAndGo.checkPrice
      - click:
          identifier: us.mappings.home.scanAndGo.checkPrice
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.shopSmartWithScannerTitle
      - click:
          identifier: us.mappings.scanner.shopSmartWithScannerGotItButton
      - click:
          identifier: us.mappings.backButton
    #   - executeFunction:
    #       name: us.functions.search.scanAndGo.StoreModeView
    #   - scroll:
    #       direction: down
    #       untilIdentifier: us.mappings.home.storeMapButton
    #   - verifyIdentifier:
    #       present:
    #         - identifier: us.mappings.home.storeMapTitle
    #         - identifier: us.mappings.home.storeMapButton
    #   - click:
    #       identifier: us.mappings.home.storeMapButton
    #       wait: 3000
    #   - verifyIdentifier:
    #       present:
    #         - identifier: us.mappings.home.storeMapText
    #   - click:
    #       identifier: us.mappings.backButton

  - name: us.functions.search.scanAndGo.StoreMapsMapView
    platform: android
    flow:
      - verifyIdentifier:
          contentDescription:
            - identifier: us.mappings.search.InStore.Filter
              contains: Filter by In-store, applied,
      - if: 
          identifier:
            notPresent:
              - identifier: us.mappings.search.storeMapsAisle
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.search.storeMapsAisle
            - click:
                identifier: us.mappings.search.storeMapsAisle
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.storeMapText
                  - identifier: us.mappings.search.storeMapsAisle.item
            - click:
                identifier: us.mappings.global.closeButton
      - sleep: 
          duration: 5000
      - click:
          identifier: us.mappings.search.storeMapsAisle.itemDetailScreen
      - sleep:
          duration: 3000
      # - if: 
      #     identifier:
      #       present:
      #         - identifier: us.mappings.item.search.storeMapsAisle.itemDetailScreen.pickupTile
      #     then:
      #       - verifyIdentifier:
      #           present:
      #             - identifier: us.mappings.item.search.storeMapsAisle.itemDetailScreen.pickupTile
      #       - click:
      #           identifier: us.mappings.item.search.storeMapsAisle.itemDetailScreen.pickupTile
      #     else:
      #       - scroll:
      #           direction: down
      #           untilIdentifier:  us.mappings.item.switching.fulfillment.pickupText
      #       - verifyIdentifier:
      #           present:
      #             - identifier: us.mappings.item.switching.fulfillment.pickupText
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.storeMapsAisle.itemAile
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.search.storeMapsAisle.itemAile
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.home.storeMapText
            - identifier: us.mappings.search.storeMapsAisle.item
      - if:
          identifier:
            present:
              - identifier: us.mappings.global.closeButton
          then:
            - click:
                identifier: us.mappings.global.closeButton
          else:
            - click:
                identifier: us.mappings.global.navigateBackArrow



  - name: us.functions.search.scanAndGo.StoreModeView
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.ViewstoremodeButton # us.mappings.storeMode.viewStoreMode 
          then:
            - log: "Store view mode option displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Store mode view option not displayed as expected"        
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.home.ViewstoremodeButton # us.mappings.storeMode.viewStoreMode
      - click:
          identifier: us.mappings.home.ViewstoremodeButton # us.mappings.storeMode.viewStoreMode
          coordinates: 50%,50%

  - name: us.functions.home.assert.scanAndGo
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.ViewstoremodeButton
      - click:
          identifier: us.mappings.home.ViewstoremodeButton
          wait: 5000
      - if: 
          condition: ${option} == 'checkprice'
          then:
            - click:
                identifier: us.mappings.home.scanAndGo.checkPrice #us.mappings.scanAndGo.scanner.checkPrice
                wait: 5000
       # Allow Camera Access
            - executeFunction:
                name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
      
      # Validate Are you at the store bottom overlay
            - executeFunction:
                name: us.functions.scanner.validateAreYouAtTheStoreBottomOverlay
      
      # Validate Are you get accurate prices bottom overlay
            - executeFunction:
                name: us.functions.scanner.validateGetAccuratePriceBottomOverlay    
      
      #Validate allow location
            - executeFunction:
                name: us.functions.scanner.allowLocation
      
      # Validate Are you get shop smart with scanner bottom overlay
            - executeFunction:
                name: us.functions.scanner.shopSmartWithScannerBottomOverlay

      # Enter barcode and verify
            - executeFunction:
               name: us.functions.scanner.verifyAndEnterBarcodetext
               params:
                 - name: barcode
                   string: ${barcode} #717524111128 #050946872902

  - name: us.functions.home.assert.scanAndGo
    platform: android
    flow:
      - executeFunction:
          name: us.functions.search.scanAndGo.StoreModeView
      - if: 
          condition: ${option} == 'checkprice'
          then:
            - click:
                identifier: us.mappings.home.scanAndGo.checkPrice
      # Allow Camera Access
            - executeFunction:
                name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption
      
      # Validate Are you at the store bottom overlay
            - executeFunction:
                name: us.functions.scanner.validateAreYouAtTheStoreBottomOverlay

      # Validate Are you get accurate prices bottom overlay
            - executeFunction:
                name: us.functions.scanner.validateGetAccuratePriceBottomOverlay    
      
      #Validate allow location
            - executeFunction:
                name: us.functions.scanner.allowLocation
      
      # Validate Are you get shop smart with scanner bottom overlay
            - executeFunction:
                name: us.functions.scanner.shopSmartWithScannerBottomOverlay

      # Enter barcode and verify
            - executeFunction:
               name: us.functions.scanner.verifyAndEnterBarcodetext
               params:
                 - name: barcode
                   string: ${barcode}

  - name: us.functions.home.viewStoreMode
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.ViewstoremodeButton
          then:
            - click:
                wait: 10000
                identifier: us.mappings.home.ViewstoremodeButton
          else: 
            - log: relaunching app
            - terminateApp: true
            - executeFunction:
                name: us.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: walmart://home
            - sleep:
                duration: 3000   
            - executeFunction:
                name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.home.storeModePopUp
                then:
                  - click:
                      identifier: us.mappings.home.storeModePopUpClose
            - click:
                wait: 10000
                identifier: us.mappings.home.ViewstoremodeButton