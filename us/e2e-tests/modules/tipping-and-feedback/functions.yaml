functions:

  #*********************************************** iOS **************************************************#

  - name: us.functions.tippingAndFeedback.navigateToFeedbackAndTippingScreenFromHome
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.addTipButtonPopUpHome
            - identifier: us.mappings.tipping.feedbackPoUpHeader
            - identifier: us.mappings.tipping.addTipHeaderPopUpHome
      - click:
          identifier: us.mappings.tipping.addTipButtonPopUpHome
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: "Feedback and tipping screen is dispalyed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Feedback and tipping screen is not dispalyed correctly"

  - name: us.functions.tippingAndFeedback.navigateToFeedbackAndTippingScreenFromOrderDetails
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.addTipButton
      - click:
          identifier: us.mappings.tipping.addTipButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: "Feedback and tipping screen is dispalyed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Feedback and tipping screen is not dispalyed correctly"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader

  - name: us.functions.tippingAndFeedback.navigateToFeedbackAndTippingScreenFromLOTScreen
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.tipAndRateDriverButton
      - click:
          identifier: us.mappings.tipping.tipAndRateDriverButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: "Feedback and tipping screen is dispalyed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Feedback and tipping screen is not dispalyed correctly"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader

  - name: us.functions.home.tipping.closePopUp
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.tipAndRateDriverButton
          then:
            - click:
                identifier: us.mappings.tipping.notNowButton

  - name: us.functions.tippingAndFeedback.negativeFeedback
    platform: ios
    flow:
      - click:
          identifier: us.mappings.tipping.feedbackStar2
      - click:
          identifier: us.mappings.tipping.reasonDriverLate
      - click:
          identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.fairFeedback
    platform: ios
    flow:
      - click:
          identifier: us.mappings.tipping.feedbackStar
      - click:
          identifier: us.mappings.tipping.reasonDriverLate
      - if:
          condition: ${addCustomTip} == true
          then:
            - log: "adding custom Tip"
          else:
            - click:
                identifier: us.mappings.tipping.confirmButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderdetails.trackorder.mapView.closeButton 
          then:
            - click:
                identifier: us.mappings.orderdetails.trackorder.mapView.closeButton 

  - name: us.functions.tippingAndFeedback.positiveFeedback
    platform: ios
    flow:
      - click:
          identifier: us.mappings.tipping.feedbackStar5
      - enterText:
          identifier: us.mappings.tipping.feedbackTextBox
          string: "Very polite driver"
      - click:
          identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.enterCustomTipAmount
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderdeatils.editTipButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderdeatils.editTipButton
      - click:
          identifier: us.mappings.orderdeatils.editTipButton
      - click:
          identifier: us.mappings.tipping.customTipAmount
      - click:
          identifier: us.mappings.tipping.customTipAmount
      - enterText:
          identifier: us.mappings.tipping.customTipTextField
          string: 6
          clickFirst: false
          clearField: false
      - click:
          identifier: us.mappings.default.keyboardDoneButton
      - scroll:
          direction: down
      - click:
          identifier: us.mappings.tipping.confirmButton
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.dismissFeedbackPopUpHome
    platform: ios
    flow:
      - click:
          identifier: us.mappings.tipping.notNowButton

  - name: us.functions.tippingAndFeedback.editTipFromRateDriverButton
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderDetails.addTipbutton
          then:
            - log: "Add tip button is present"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Add tip button should be present but is not"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.orderDetails.addTipbutton
      - click:
          identifier: us.mappings.orderDetails.addTipbutton

  - name: us.functions.tippingAndFeedback.deliveryDetails
    platform: ios
    flow: 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderdetails.viewDeliveryDetailsButton
      - click:
          identifier: us.mappings.orderdetails.viewDeliveryDetailsButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.RateYourDriveHeader 
      - click:
          identifier: us.mappings.tipping.RateYourDriveHeader  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.RateYourDriveHeader
            - identifier: us.mappings.tipping.feedbackPoUpHeader
            - identifier: us.mappings.tipping.confirmButton


  - name: us.functions.tippingAndFeedback.purchase.verification.for.driverTip
    platform: ios
    flow:
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.tipping.purchase.history.link
      - log: The user is navigated to Purchase history page!
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.purchase.history.page
            - identifier: us.mappings.tipping.order.view.detail.button
      - sleep:
          duration: 1000
      - click:
          identifier: us.mappings.tipping.order.view.detail.button
      - log: The user is on Order details page!
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.section
          then:
            - log: The Driver Tip Section is not Visible, Scrolling Down!
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTip.section
            - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.driverTip.amount
            - identifier: us.mappings.tipping.driverTip.amount.change.text

  - name: us.functions.tippingAndFeedback.click.continueShopping.button
    platform: ios
    flow:
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.orderConfirmation.ContinueShoppingButton
      - log: Clicked on Continue Shopping button!

  - name: us.functions.tippingAndFeedback.driverTipAmountVerification.on.orderReviewPage
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - if:
          condition: ${lessThan35Dollars}
          then:
            - log: Delivery Tip amount verification for Orders lessThan 35$, is in-Progress!!!
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTipAmount.dollar2
                then:
                  - log: The Driver Tip Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: unified.us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTipAmount.dollar2
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The Driver Tip Section is NOW Visible!
                else:
                  - log: The Driver Tip Section is Visible, Already!
                  - scroll:
                      direction: down
                      wait: 1000
                      position: center
                      scrollLimit: 1
            # Validate that $ tips of $2, $4, $6 and Custom Tip are displayed
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipAmount.dollar2
                  - identifier: us.mappings.tipping.driverTipAmount.dollar4
                  - identifier: us.mappings.tipping.driverTipAmount.dollar6 
                  - identifier: us.mappings.tipping.driverTipAmount.customTip.button                      
            # - verifyIdentifier:
            #     present:
            #       - identifier: us.mappings.reviewOrder.tippingSectionTitle # Cross check
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $4
            - sleep:
                duration: 1000
            - click:           
                identifier: us.mappings.tipping.driverTipAmount.dollar2  
                wait: 1500                             
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipPercentage.container
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $2
            - sleep:
                duration: 1000
            - click:
                identifier: us.mappings.tipping.driverTipAmount.dollar4
                wait: 1500
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $4
            - click:
                identifier: us.mappings.tipping.driverTipAmount.dollar6
                wait: 1500
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $6
            # - click:
            #     identifier: us.mappings.tipping.driverTipAmount.dollar0
            #     wait: 1500                  
            # - verifyIdentifier:
            #     value:
            #       - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
            #         contains: $0
            - if:
                condition: ${driverTipAmount} != null
                then:
                  - log: Inside the flow, where the driver tip amount is parameterized !!!
                  - click:
                      identifier: us.mappings.tipping.driverTip.selectAmountViaParameter
                      wait: 1500
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                          contains: ${driverTipAmount}
                  # - if:
                  #     identifier:
                  #       notPresent:
                  #         - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                  #     then:
                  #       - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                  #       - executeFunction:
                  #           name: us.functions.utils.scrollIfNotVisible
                  #           params:
                  #             - name: identifier
                  #               string: us.mappings.tipping.driverTipSelected.underSubTotal
                  #             - name: direction
                  #               string: down
                  #             - name: scrollPosition
                  #               string: center
                  #       - log: The Driver Tip Section under subTotal is NOW Visible!
                  #     else:
                  #       - log: The Driver Tip Section under subTotal is Visible, Already!
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.tipping.driverTipLabel

                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                          contains: ${driverTipAmount}
                else:
                  - log: Inside the default flow, where the driver tip amount is selected with the defaults available !!!
                  - click:
                      identifier: us.mappings.tipping.driverTipAmount.dollar4
                      wait: 1500
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                          contains: $4
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                      then:
                        - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTipSelected.underSubTotal
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                        - log: The Driver Tip Section under subTotal is NOW Visible!
                      else:
                        - log: The Driver Tip Section under subTotal is Visible, Already!
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                          contains: $4
            - if:
                condition: ${storeCheckoutTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTotalValue
                      then:
                        - log: The Checkout total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTotalValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTotalValue
                      attribute: value
                      storeIn: checkoutTotalValue
                  - log: The total amount on checkout is ${checkoutTotalValue}
            - if:
                condition: ${storeCheckoutTempHoldTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      then:
                        - log: The Checkout Temp hold total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTempHoldValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Temp Hold Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      attribute: value
                      storeIn: checkoutTotalTempHoldValue
                  - log: The total Temp hold amount on checkout is ${checkoutTotalTempHoldValue}                

      - if: 
          condition: ${greaterThan35Dollars}
          then:
            - if:
                condition: ${SC_DELIVERY_ITEM} == true
                then: 
                  - log: "Inside SC_DELIVERY_ITEM condition"
                  - executeNode:
                      file: us/e2e-tests/helpers/calculateItemprice.js
                      args:
                        - value: ${itemPrice}
                        - value: ${quantity}
                        - value: ${decimalPlacesNeededForTipCalc}
                      getResponse: 
                        storeIn: returnedOriginalPrice
                  - log: "Returned price for SC Delivery items: '${returnedOriginalPrice}'"
                else:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.tipping.item.subtotalLabel
                  - log: The Product SubTotal is NOW Visible !!!
                  # Fetch and storing only the item cost numeric value for percentage tipAmount calculation
                  - getString:
                      identifier: us.mappings.tipping.item.subtotalAmount
                      attribute: value
                      storeIn: originalPrice
                  - log: "The Original Price fetched is: '${originalPrice}'"
                  - executeNode:
                      file: us/e2e-tests/helpers/getNumberFromPriceString.js
                      args:
                        - value: ${originalPrice}
                        - value: ${decimalPlacesNeededForTipCalc}
                      getResponse:
                        storeIn: returnedOriginalPrice
                  - log: "The Original Numeric Price fetched is: '${returnedOriginalPrice}'"
            # Calculating tipAmount cost numeric value for all the percentages available
            - executeNode:
                file: us/e2e-tests/helpers/calculateProductTipAmountBasedOnPercentage.js
                args:
                  - value: ${returnedOriginalPrice}
                  - value: 5
                  - value: ${decimalPlacesNeededForTipCalc}
                getResponse:
                  storeIn: returned5PercentageAmount
            - log: "The 5 percentage Price calculated is: '${returned5PercentageAmount}'"
            - executeNode:
                file: us/e2e-tests/helpers/calculateProductTipAmountBasedOnPercentage.js
                args:
                  - value: ${returnedOriginalPrice}
                  - value: 10
                  - value: ${decimalPlacesNeededForTipCalc}
                getResponse:
                  storeIn: returned10PercentageAmount
            - log: "The 10 percentage Price calculated is: '${returned10PercentageAmount}'"
            - executeNode:
                file: us/e2e-tests/helpers/calculateProductTipAmountBasedOnPercentage.js
                args:
                  - value: ${returnedOriginalPrice}
                  - value: 15
                  - value: ${decimalPlacesNeededForTipCalc}
                getResponse:
                  storeIn: returned15PercentageAmount
            - log: "The 15 percentage Price calculated is: '${returned15PercentageAmount}'"
            - executeFunction:
                name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
            - log: Delivery Tip amount verification for Orders greaterThan 35$, is in-Progress!!!

            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTipPercentage.5Percent
            - log: The Driver Tip Section is NOW Visible!
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipPercentage.5Percent
                  - identifier: us.mappings.tipping.driverTipPercentage.10Percent  
                  - identifier: us.mappings.tipping.driverTipPercentage.15Percent                  
                  - identifier: us.mappings.tipping.driverTipAmount.customTip.button                                                   
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.5Percent
                wait: 1500
            - sleep:
                duration: 2000 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipPercentage.container
            - sleep:
                duration: 2000
            - storeIn:
                key: percentageAmount
                value: ${returned10PercentageAmount}          
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.10Percent
                wait: 1500
            - sleep:
                duration: 2500
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            - sleep:
                duration: 1000
            - storeIn:
                key: percentageAmount
                value: ${returned15PercentageAmount}               
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.15Percent
                wait: 1500   
            - sleep:
                duration: 2000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipPercentage.textConfirmation     
                value:
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            - sleep:
                duration: 1000
            - storeIn:
                key: percentageAmount
                value: ${returned5PercentageAmount}
            - click:         
                identifier: us.mappings.tipping.driverTipPercentage.5Percent
                wait: 1500
            - sleep:
                duration: 2000
            - verifyIdentifier:
                value:                                                                      
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            - sleep:
                duration: 1000

            # User can send the tipAmount percentage as a parameter. It is handled here dynamically
            - if:
                condition: ${driverTipPercentage} != null
                then:
                  - log: Inside the flow, where the driver tip percentage is parameterized !!!
                  - if:
                      condition: ${driverTipPercentage} == 5
                      then:
                        - storeIn:
                            key: percentageAmount
                            value: ${returned5PercentageAmount}
                      else:
                        - if:
                            condition: ${driverTipPercentage} == 10
                            then:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned10PercentageAmount}
                            else:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned15PercentageAmount}
                  - click:
                      identifier: us.mappings.tipping.driverTip.selectPercentageViaParmetergc35
                      wait: 1500
                  - sleep:
                      duration: 2000
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.item.driverTipDollarAmountDisplayed 
                          contains: ${percentageAmount}
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTipSelected.underSubTotal.g35
                      then:
                        - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTipSelected.underSubTotal
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                        - log: The Driver Tip Section under subTotal is NOW Visible!
                      else:
                        - log: The Driver Tip Section under subTotal is Visible, Already!
                  - if:
                      condition: ${driverTipPercentage} == 5
                      then:
                        - storeIn:
                            key: percentageAmount
                            value: ${returned5PercentageAmount}
                      else:
                        - if:
                            condition: ${driverTipPercentage} == 10
                            then:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned10PercentageAmount}
                            else:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned15PercentageAmount}
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.item.driverTipDollarAmountDisplayed
                          contains: ${percentageAmount}
                else:
                  # If there is no preference for the tip amount percentage, the flow continues with the default selection
                  - log: Inside the default flow, where the driver tip amount is selected with the defaults available !!!
                  - click:
                      identifier: us.mappings.tipping.driverTipPercentage.10Percent
                      wait: 1500
                  - sleep:
                      duration: 2500
                  - storeIn:
                      key: percentageAmount
                      value: ${returned10PercentageAmount}
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                          contains: ${percentageAmount}
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTipSelected.underSubTotalInReviewOrder
                then:
                  - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTipSelected.underSubTotalInReviewOrder
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The Driver Tip Section under subTotal is NOW Visible!
                else:
                  - log: The Driver Tip Section under subTotal is Visible, Already!
            - storeIn:
                key: percentageAmount
                value: ${returned10PercentageAmount}
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            # Storing the Checkout total amount for future verification
            - if:
                condition: ${storeCheckoutTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTotalValueg35
                      then:
                        - log: The Checkout total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTotalValueg35
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.checkoutTotalValueInReviewOrderg35
                      attribute: value
                      storeIn: checkoutTotalValue
                  - log: The total amount on checkout is ${checkoutTotalValue}
            # Storing the Temporary Hold total amount for future verification
            - if:
                condition: ${storeCheckoutTempHoldTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      then:
                        - log: The Checkout Temp hold total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTempHoldValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Temp Hold Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      attribute: text
                      storeIn: checkoutTotalTempHoldValue
                  - log: The total Temp hold amount on checkout is ${checkoutTotalTempHoldValue}  

      - if:
          condition: ${custTip} == true
          then:
            - executeFunction:
                name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
            - click:
                identifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
                wait: 1500
            - enterText:
                identifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
                string: ${custTipAmount}
            - click:
                identifier: us.mappings.default.keyboardDoneButton
                wait: 1500
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: ${custTipAmount}
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subTotalEffectiveAmount
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subTotalEffectiveAmount
                  - identifier: us.mappings.reviewOrder.taxLabel
            - verifyIdentifier:
                present:
                 - identifier: us.mappings.reviewOrder.estimateTotalAmount
                 - identifier: us.mappings.reviewOrder.storeDeliveryTip.amount

            - verifyIdentifier:
                value:
                  - identifier: us.mappings.reviewOrder.storeDeliveryTip.amount
                    contains: ${custTipAmount}
            - log : Diver tip $${custTipAmount} is correctly displayed
  #****************************************************** Android ***********************************************#

  - name: us.functions.tippingAndFeedback.navigateToFeedbackAndTippingScreenFromHome
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.addTipButtonPopUpHome
            - identifier: us.mappings.tipping.tipDeliveryDate
            - identifier: us.mappings.tipping.tipDriverDetails
            - identifier: us.mappings.tipping.notNowButton
      - click:
          identifier: us.mappings.tipping.addTipButtonPopUpHome
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: "Feedback and tipping screen is dispalyed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Feedback and tipping screen is not dispalyed correctly"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.editCustomTipAmount
    platform: android
    flow:
      - scroll:
          direction: down
      - click:
          identifier: us.mappings.reviewOrder.secondTipOption
      # - scroll:
      #     direction: down
      - click:
          identifier: us.mappings.tipping.confirmButton
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.dismissFeedbackPopUpHome
    platform: android
    flow:
      - click:
          identifier: us.mappings.tipping.notNowButton

  - name: us.functions.tippingAndFeedback.enterCustomTipAmount
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderDetails.editTipButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.editTipButton
      - click:
          identifier: us.mappings.orderDetails.editTipButton
      - sleep:
          duration: 10000
      - click:
          identifier: us.mappings.tipping.customTipAmountEditButton
      - sleep:
          duration: 8000
      - enterText:
          identifier: us.mappings.tipping.customTipTextField
          string: 6
          clickFirst: false
          clearField: true
      - goBack: true
      - scroll:
          direction: down
      - click:
          identifier: us.mappings.tipping.confirmButton
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.fairFeedback
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.feedbackStar
      - verifyIdentifier:
          present:
            - identifier: us.mappings.feedback.fourstarRatingSelected
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.tipping.reasonDriverLate
      - sleep:
          duration: 3000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.tipping.rateDriverHeader
            - name: direction
              string: down      
      - click:
          identifier: us.mappings.feedback.fourstarRating
      - click: 
          identifier: us.mappings.tipping.reasonDriverdeliveredToWrongAddress
      - click:
          identifier: us.mappings.orderDetails.CSATSurveyRating.submitButton 
          #identifier: us.mappings.tipping.confirmButton
      - click:
          identifier: us.mappings.global.closeButton

  - name: us.functions.tippingAndFeedback.negativeFeedback
    platform: android
    flow:
      - click:
          identifier: us.mappings.tipping.feedbackStar
      - click:
          identifier: us.mappings.tipping.reasonDriverLate
      - scroll:
          direction: down
      - click:
          identifier: us.mappings.tipping.confirmButton

  - name: us.functions.tippingAndFeedback.navigateToFeedbackAndTippingScreenFromLOTScreen
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.tipAndRateDriverButton
      - click:
          identifier: us.mappings.tipping.tipAndRateDriverButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: "Feedback and tipping screen is dispalyed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Feedback and tipping screen is not dispalyed correctly"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader

  - name: us.functions.tippingAndFeedback.navigateToFeedbackAndTippingScreenFromOrderDetails
    platform: android
    flow:
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader #us.mappings.tipping.addTipButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.feedbackStar
      - click:
          identifier: us.mappings.feedback.fourstarRating
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: "Feedback and tipping screen is dispalyed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Feedback and tipping screen is not dispalyed correctly"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.tipping.feedbackStar

  - name: us.functions.homePage.select.Pickup.or.delivery.intent
    platform: android
    flow:
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.home.gic.module.deliveryIntent
          then:
            - log: GIC module is not in Expanded view, click chevron to expand
            - click:
                identifier: us.mappings.home.gic.collapsedIcon
            - log: GIC is now Expanded
          else:
            - log: GIC is already in Expanded view
      - executeFunction:
          name: us.functions.gic.setFulfillment
          params:
            - name: option
              string: Delivery
      - sleep:
          duration: 3000
      - log: Delivery Intent is Selected on the GIC validated!

  - name: us.functions.tippingAndFeedback.driverTipAmountVerification.on.orderReviewPage
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - if:
          condition: ${lessThan35Dollars}
          then:
            - log: Delivery Tip amount verification for Orders lessThan 35$, is in-Progress!!!
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTipAmount.dollar2
                then:
                  - log: The Driver Tip Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: unified.us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTipAmount.customTip.button
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The Driver Tip Section is NOW Visible!
                else:
                  - log: The Driver Tip Section is Visible, Already!
            # Validate that $ tips of $2, $4, $6 and Custom Tip are displayed
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.tipping.driverTipAmount.customTip.button
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipAmount.dollar2
                  - identifier: us.mappings.tipping.driverTipAmount.dollar4
                  - identifier: us.mappings.tipping.driverTipAmount.dollar6
                  - identifier: us.mappings.tipping.driverTipAmount.customTip.button
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.tippingSectionTitle
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $4
            # Selecting all the available tip options and asserting for the value changes
            - sleep:
                duration: 1000
            - click:
                identifier: us.mappings.tipping.driverTipAmount.dollar2
                wait: 1500
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $2
            - sleep:
                duration: 4000
            - click:
                identifier: us.mappings.tipping.driverTipAmount.dollar6
                wait: 1500
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: $6
            - sleep:
                duration: 4000
            # User can send the tipAmount as a parameter. It is handled here dynamically
            - if:
                condition: ${driverTipAmount} != null
                then:
                  - log: Inside the flow, where the driver tip amount is parameterized !!!
                  - click:
                      identifier: us.mappings.tipping.driverTip.selectAmountViaParameter
                      wait: 1500
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                          contains: ${driverTipAmount}
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                      then:
                        - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTipSelected.underSubTotal
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                        - log: The Driver Tip Section under subTotal is NOW Visible!
                      else:
                        - log: The Driver Tip Section under subTotal is Visible, Already!
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                          contains: ${driverTipAmount}
                else:
                  # If there is no preference for the tip amount, the flow continues with the default selection
                  - log: Inside the default flow, where the driver tip amount is selected with the defaults available !!!
                  - click:
                      identifier: us.mappings.tipping.driverTipAmount.dollar4
                      wait: 1500
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                          contains: $4
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                      then:
                        - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTipSelected.underSubTotal
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                        - log: The Driver Tip Section under subTotal is NOW Visible!
                      else:
                        - log: The Driver Tip Section under subTotal is Visible, Already!
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                          contains: $4
            # Storing the checkout total amount for future verification
            - if:
                condition: ${storeCheckoutTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTotalValue
                      then:
                        - log: The Checkout total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTotalValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTotalValue
                      attribute: text
                      storeIn: checkoutTotalValue
                  - log: The total amount on checkout is ${checkoutTotalValue}
            # Storing the Temporary Hold total amount for future verification
            - if:
                condition: ${storeCheckoutTempHoldTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      then:
                        - log: The Checkout Temp hold total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTempHoldValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Temp Hold Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      attribute: text
                      storeIn: checkoutTotalTempHoldValue
                  - log: The total Temp hold amount on checkout is ${checkoutTotalTempHoldValue}
      # Validation when price is greater than 35 dollars
      - if:
          condition: ${greaterThan35Dollars}
          then:
            - if:
                condition: ${SC_DELIVERY_ITEM} == true
                then: 
                  - log: "Inside SC_DELIVERY_ITEM condition"
                  - executeNode:
                      file: us/e2e-tests/helpers/calculateItemprice.js
                      args:
                        - value: ${itemPrice}
                        - value: ${quantity}
                        - value: ${decimalPlacesNeededForTipCalc}
                      getResponse: 
                        storeIn: returnedOriginalPrice
                  - log: "Returned price for SC Delivery items: '${returnedOriginalPrice}'"
                else:  
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.item.subtotal
                      then:
                        - log: The Product SubTotal is NOT Visible, scrolling down !!!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.item.subtotal
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The Product SubTotal is NOW Visible !!!
                  # Fetch and storing only the item cost numeric value for percentage tipAmount calculation
                  - getString:
                      identifier: us.mappings.tipping.item.subtotal
                      attribute: text
                      storeIn: originalPrice
                  - log: "The Original Price fetched is: '${originalPrice}'"
                  - executeNode:
                      file: us/e2e-tests/helpers/getNumberFromPriceString.js
                      args:
                        - value: ${originalPrice}
                        - value: ${decimalPlacesNeededForTipCalc}
                      getResponse:
                        storeIn: returnedOriginalPrice
                  - log: "The Original Numeric Price fetched is: '${returnedOriginalPrice}'"
            # Calculating tipAmount cost numeric value for all the percentages available
            - executeNode:
                file: us/e2e-tests/helpers/calculateProductTipAmountBasedOnPercentage.js
                args:
                  - value: ${returnedOriginalPrice}
                  - value: 5
                  - value: ${decimalPlacesNeededForTipCalc}
                getResponse:
                  storeIn: returned5PercentageAmount
            - log: "The 5 percentage Price calculated is: '${returned5PercentageAmount}'"
            - executeNode:
                file: us/e2e-tests/helpers/calculateProductTipAmountBasedOnPercentage.js
                args:
                  - value: ${returnedOriginalPrice}
                  - value: 10
                  - value: ${decimalPlacesNeededForTipCalc}
                getResponse:
                  storeIn: returned10PercentageAmount
            - log: "The 10 percentage Price calculated is: '${returned10PercentageAmount}'"
            - executeNode:
                file: us/e2e-tests/helpers/calculateProductTipAmountBasedOnPercentage.js
                args:
                  - value: ${returnedOriginalPrice}
                  - value: 15
                  - value: ${decimalPlacesNeededForTipCalc}
                getResponse:
                  storeIn: returned15PercentageAmount
            - log: "The 15 percentage Price calculated is: '${returned15PercentageAmount}'"
            - executeFunction:
                name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
            - log: Delivery Tip amount verification for Orders greaterThan 35$, is in-Progress!!!
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTipPercentage.5Percent
                then:
                  - log: The Driver Tip Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: unified.us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTipPercentage.5Percent
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The Driver Tip Section is NOW Visible!
                else:
                  - log: The Driver Tip Section is Visible, Already!
            # Validate that % tips of 5%, 10%, 15% and Custom Tip are displayed
            # - scroll:
            #     direction: down
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.tipping.driverTipPercentage.5Percent
                  - identifier: us.mappings.tipping.driverTipPercentage.10Percent
                  - identifier: us.mappings.tipping.driverTipPercentage.15Percent
                  - identifier: us.mappings.tipping.driverTipPercentage.custom
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.5Percent
                wait: 1500
            - sleep:
                duration: 2000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.tipping.driverTipPercentage.tipAddingTrobleMessage
                then:
                  - failTest:
                      message: "ENV_FAILURE - Not able to Add Tip. The Driver Tip Add is not working"
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.tippingSectionTitle
                  - identifier: us.mappings.reviewOrder.tippingSectionSubValue
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
            - sleep:
                duration: 2000
            - storeIn:
                key: percentageAmount
                value: ${returned10PercentageAmount}
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.10Percent
                wait: 1500
            - sleep:
                duration: 2500
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.tipping.driverTipPercentage.tipAddingTrobleMessage
                then:
                  - failTest:
                      message: "ENV_FAILURE - Not able to Add Tip. The Driver Tip Add is not working"
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTippingAmountValue
                    contains: ${percentageAmount}
            - log: "Verified the tip Amount selected is 10% Option and the amount is '${percentageAmount}'"
            - sleep:
                duration: 1000
            - storeIn:
                key: percentageAmount
                value: ${returned15PercentageAmount}
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.15Percent
                wait: 1500
            - sleep:
                duration: 2000
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTippingAmountValue
                    contains: ${percentageAmount}
            - log: "Verified the tip Amount selected is 15% Option and the amount is '${percentageAmount}'"
            - sleep:
                duration: 1000
            - storeIn:
                key: percentageAmount
                value: ${returned5PercentageAmount}
            - click:
                identifier: us.mappings.tipping.driverTipPercentage.5Percent
                wait: 1500
            - sleep:
                duration: 2000
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                    contains: ${percentageAmount}
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTippingAmountValue
                    contains: ${percentageAmount}
            - log: "Verified the tip Amount selected is 5% Option and the amount is '${percentageAmount}'"
            - sleep:
                duration: 1000
            # User can send the tipAmount percentage as a parameter. It is handled here dynamically
            - if:
                condition: ${driverTipPercentage} != null
                then:
                  - log: Inside the flow, where the driver tip percentage is parameterized !!!
                  - if:
                      condition: ${driverTipPercentage} == 5
                      then:
                        - storeIn:
                            key: percentageAmount
                            value: ${returned5PercentageAmount}
                      else:
                        - if:
                            condition: ${driverTipPercentage} == 10
                            then:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned10PercentageAmount}
                            else:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned15PercentageAmount}
                  - click:
                      identifier: us.mappings.tipping.driverTip.selectPercentageViaParameter
                      wait: 1500
                  - sleep:
                      duration: 2000
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.item.driverTipDollarAmountDisplayed
                          contains: ${percentageAmount}
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.item.driverTippingAmountValue
                          contains: ${percentageAmount}
                  - log: "Verified the tip Amount selected is '${driverTipPercentage}'% Option and the amount is '${percentageAmount}'"
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                      then:
                        - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTipSelected.underSubTotal
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                        - log: The Driver Tip Section under subTotal is NOW Visible!
                      else:
                        - log: The Driver Tip Section under subTotal is Visible, Already!
                  - if:
                      condition: ${driverTipPercentage} == 5
                      then:
                        - storeIn:
                            key: percentageAmount
                            value: ${returned5PercentageAmount}
                      else:
                        - if:
                            condition: ${driverTipPercentage} == 10
                            then:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned10PercentageAmount}
                            else:
                              - storeIn:
                                  key: percentageAmount
                                  value: ${returned15PercentageAmount}
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.item.driverTipDollarAmountDisplayed
                          contains: ${percentageAmount}
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.item.driverTippingAmountValue
                          contains: ${percentageAmount}
                  - log: "Verified the tip Amount selected is '${driverTipPercentage}'% Option and the amount is '${percentageAmount}'"
                else:
                  # If there is no preference for the tip amount percentage, the flow continues with the default selection
                  - log: Inside the default flow, where the driver tip amount is selected with the defaults available !!!
                  - click:
                      identifier: us.mappings.tipping.driverTipPercentage.10Percent
                      wait: 1500
                  - sleep:
                      duration: 2500
                  - storeIn:
                      key: percentageAmount
                      value: ${returned10PercentageAmount}
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.tipping.item.driverTipSubDollarAmount
                          contains: ${percentageAmount}
                  - log: "Verified the tip Amount selected is default % Option and the amount is '${percentageAmount}'"
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTipSelected.underSubTotal
                then:
                  - log: The Driver Tip Section under subTotal is not Visible, Scrolling Down!
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTipSelected.underSubTotal
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The Driver Tip Section under subTotal is NOW Visible!
                else:
                  - log: The Driver Tip Section under subTotal is Visible, Already!
            - storeIn:
                key: percentageAmount
                value: ${returned10PercentageAmount}
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.item.driverTipDollarAmountDisplayed
                    contains: ${percentageAmount}
            - log: "Verified the tip Amount selected is '${driverTipPercentage}'% Option and the amount is '${percentageAmount}'"
            # Storing the Checkout total amount for future verification
            - if:
                condition: ${storeCheckoutTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTotalValue
                      then:
                        - log: The Checkout total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTotalValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTotalValue
                      attribute: text
                      storeIn: checkoutTotalValue
                  - log: The total amount on checkout is ${checkoutTotalValue}
            # Storing the Temporary Hold total amount for future verification
            - if:
                condition: ${storeCheckoutTempHoldTotalAmount} == true
                then:
                  - if:
                      identifier:
                        notPresent:
                          - identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      then:
                        - log: The Checkout Temp hold total Section is not Visible, Scrolling Down!
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.tipping.driverTip.checkoutTempHoldValue
                              - name: direction
                                string: down
                              - name: scrollPosition
                                string: center
                  - log: The checkout Temp Hold Total Section is NOW Visible!
                  - getString:
                      identifier: us.mappings.tipping.driverTip.checkoutTempHoldValue
                      attribute: text
                      storeIn: checkoutTotalTempHoldValue
                  - log: The total Temp hold amount on checkout is ${checkoutTotalTempHoldValue}
      - if:
          condition: ${custTip} == true
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.custom.driverTipping
                then:
                  - log: The Driver Custom Tip option is not Visible, Scrolling Up!
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.custom.driverTipping
                        - name: direction
                          string: up
                        - name: scrollPosition
                          string: center
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.custom.driverTipping
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
            - click:
                identifier: us.mappings.tipping.custom.driverTipping
                wait: 1500
            - click:
                identifier: us.mappings.tipping.custom.driverTipping
            - enterText:
                identifier: us.mappings.tipping.custom.driverTipping.amountField
                string: ${custTipAmount}
                pressEnter: true
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.tipping.custom.numpad.doneButton
                then:
                  - click:
                      identifier: us.mappings.tipping.custom.numpad.doneButton
            # - goBack: true
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTipPercentage.selectedTipAmount
                    contains: ${custTipAmount}
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subtotalPrice
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrde.estimatedtaxes
                  - identifier: us.mappings.reviewOrder.subtotalPrice
                  - identifier: us.mappings.reviewOrder.taxPriceLabel
                  - identifier: us.mappings.checkout.reviewOrder.storeDeliveryTip
                  - identifier: us.mappings.reviewOrder.storeDeliveryTip.amount
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.estimateTotalAmount
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.totalLabel
                  - identifier: us.mappings.reviewOrder.estimateTotalAmount
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.reviewOrder.storeDeliveryTip.amount
                    contains: ${custTipAmount}
            - log : Diver tip is correctly displayed

  - name: us.functions.tippingAndFeedback.purchase.verification.for.driverTip
    platform: android
    flow:
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.tipping.purchase.history.link
      - log: The user is navigated to Purchase history page!
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.purchase.history.page
            - identifier: us.mappings.tipping.order.view.detail.button
      - sleep:
          duration: 1000
      - click:
          identifier: us.mappings.tipping.order.view.detail.button
      - log: The user is on Order details page!
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.amount
          then:
            - log: The Driver Tip Section is not Visible, Scrolling Down!
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTip.amount
            - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.amount.change.text
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTip.amount.change.text
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.driverTip.amount
            - identifier: us.mappings.tipping.driverTip.amount.change.text
            - identifier: us.mappings.tipping.driverTip.section

  - name: us.functions.tippingAndFeedback.click.continueShopping.button
    platform: android
    flow:
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.orderConfirmation.ContinueShoppingButton
      - log: Clicked on Continue Shopping button!

  # Tip amount verification on ODP(After the order Status is set to Delivered
  - name: us.functions.tippingAndFeedback.verification.for.driverTip.onODP
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderHistory.title
      - log: The user is navigated to Order Detail page!
      - sleep:
          duration: 1000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.amount
          then:
            - log: The Driver Tip Section is not Visible, Scrolling Down!
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTip.amount
            - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - if:
          condition: ${tipInPercentage} != null
          then:
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
                    contains: ${percentageAmount}
          else:
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
                    contains: ${tipAmount}
      - log: The Driver tip amount selected is matching on the ODP !!!!

  # Tip amount verification on ODP, when the order status is in-progress
  - name: us.functions.tippingAndFeedback.verification.for.inProgressODP
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderHistory.title
      - log: The user is navigated to Order Detail page!
      - sleep:
          duration: 1000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
          then:
            - log: The Driver Tip Section is not Visible, Scrolling Down!
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTip.odpDriverTipValue
            - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - if:
          condition: ${tipInPercentage} != null
          then:
            - if:
                condition: ${tipPercentageAmtExpected} == 5
                then:
                  - storeIn:
                      key: percentageAmount
                      value: ${returned5PercentageAmount}
            - if:
                condition: ${tipPercentageAmtExpected} == 10
                then:
                  - storeIn:
                      key: percentageAmount
                      value: ${returned10PercentageAmount}
            - if:
                condition: ${tipPercentageAmtExpected} == 15
                then:
                  - storeIn:
                      key: percentageAmount
                      value: ${returned15PercentageAmount}
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
                    contains: ${percentageAmount}
          else:
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
                    contains: ${tipAmount}
      - log: The Driver tip amount selected is matching on the ODP !!!!
      # Verifying the Checkout total amount on ODP with values from review Order page
      - if:
          condition: ${VerifyCheckoutTotalAmount} == true
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTip.odpTotalValue
                then:
                  - log: The ODP total Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: unified.us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTip.odpTotalValue
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The ODP Total Section is NOW Visible!
            - getString:
                identifier: us.mappings.tipping.driverTip.odpTotalValue
                attribute: text
                storeIn: odpTotalValue
            - log: The total amount on ODP is ${odpTotalValue}
            - if:
                condition: ${checkoutTotalValue} ==${odpTotalValue}
                then:
                  - log: The Amount on CXO and ODP is MATCHING !!!
                else:
                  - log: The Amount on CXO and ODP is NOT MATCHING !!!
      # Verifying the Temporary Hold total amount on ODP with values from review Order page
      - if:
          condition: ${verifyCheckoutTempHoldTotalAmount} == true
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTip.odpTempHoldValue
                then:
                  - log: The ODP Temp Hold total Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: unified.us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTip.odpTempHoldValue
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The ODP Temp Hold Total Section is NOW Visible!
            - getString:
                identifier: us.mappings.tipping.driverTip.odpTempHoldValue
                attribute: text
                storeIn: odpTempHoldTotalValue
            - log: The total amount on ODP is ${odpTempHoldTotalValue}
            - if:
                condition: ${checkoutTotalTempHoldValue} ==${odpTempHoldTotalValue}
                then:
                  - log: The Temp Hold Amount on CXO and ODP is MATCHING !!!
                else:
                  - log: The Temp Hold Amount on CXO and ODP is NOT MATCHING !!!

  - name: us.functions.tippingAndFeedback.handleRateYourDriverPopupIfRequired
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - try:
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.tipping.rateYourDriverButton
                then:
                  - log: The Rate your driver pop-up is visible and will handle it NOW !!!!
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.tipping.leaveFeedbackForDriver.notNowButton
                        - identifier: us.mappings.wplus.closeButton
                  - click:
                      identifier: us.mappings.wplus.closeButton
          catch:
            flow:
              - log: The Rate your driver pop-up is NOT visible; proceeding with the flow !!!!

  # Function to check the GiftCard(GC) Balance and if it is equal to 0, then the amount will be added to the GC.
  - name: us.functions.checkGiftCardBalanceAndLoadIfZero
    flow:
      - executeFunction:
          name: us.functions.utils.checkGiftCardBalance
      - if:
          condition: ${gcBalance} == 0
          then:
            - log: "The giftCard's current balance is:  '${gcBalance}'; Proceeding with load balance to GC(as the balance is ZERO.)"
            - executeFunction:
                name: us.functions.utils.addAmountToGiftCard
          else:
            - log: "The giftCard's current balance is:  '${gcBalance}'; Skipping load balance to GC(as the balance is not ZERO.)"

  - name: us.functions.customDriverTip.amount
    platform: android
    flow:
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.tipping.custom.driverTipping
            - name: direction
              string: up
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.tipping.custom.driverTipping
      - enterText:
          identifier: us.mappings.tipping.custom.driverTipping.amountField
          string: ${tipAmount}
          pressEnter: true
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.custom.numpad.doneButton
          then:
            - click:
                identifier: us.mappings.tipping.custom.numpad.doneButton
      # - click:
      #     identifier: us.mappings.default.keyboardDoneButton
      - log: "Custom driver tip $${tipAmount} is added"          

  - name: us.functions.tippingAndFeedback.deliveredOrder.addTipAndVerifyOnOrderDetails
    platform: android
    flow:
      # - sleep:
      #     duration: 3000
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.orderDetails.editTipButton
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.orderDetails.editTipButton
      # - click:
      #     identifier: us.mappings.orderDetails.editTipButton
      - click:
          identifier: us.mappings.tipping.addTipButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderdetails.customtipButton
      - click:
          identifier: us.mappings.orderdetails.customtipButton
      # - click:
      #     identifier: us.mappings.orderdetails.customtipButton
      - enterText:
          identifier: us.mappings.orderdetails.enterCustomTipamount
          string: ${custTipAmount}
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.default.keyboardDoneButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.confirmButton
      - click:
          identifier: us.mappings.tipping.confirmButton
      - log: The Driver Tip Section is not Visible, Scrolling Down!
      - executeFunction:
                name: unified.us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
      - log: The Driver Tip Section is NOW Visible on Order details page!
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
      - verifyIdentifier:
          text:
            - identifier: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
              contains: ${custTipAmount}

  - name: us.functions.tippingAndFeedback.verification.for.inProgressODP
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - log: The user is navigated to Order Detail page!
      - sleep:
          duration: 1000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
          then:
            - log: The Driver Tip Section is not Visible, Scrolling Down!
            - executeFunction:
                name: unified.us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.tipping.driverTip.odpDriverTipValue
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - verifyIdentifier:
          value:
            - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
              contains: ${tipAmount}
      - log: The Driver tip amount selected is matching on the ODP !!!!
      - if:
          condition: ${VerifyCheckoutTotalAmount} == true
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.TotalLabel
            - log: The ODP Total Section is NOW Visible!
            - getString:
                identifier: us.mappings.tipping.driverTip.odpTotalValue
                attribute: value
                storeIn: odpTotalValue
            - log: The total amount on ODP is ${odpTotalValue}
            - if:
                condition: ${checkoutTotalValue} ==${odpTotalValue}
                then:
                  - log: The Amount on CXO and ODP is MATCHING !!!
                else:
                  - log: The Amount on CXO and ODP is NOT MATCHING !!!
      - if:
          condition: ${verifyCheckoutTempHoldTotalAmount} == true
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTip.odpTotalValue
                then:
                  - log: The ODP Temp Hold total Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTip.odpTotalValue
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The ODP Temp Hold Total Section is NOW Visible!
            # - getString:
            #     identifier: us.mappings.tipping.driverTip.odpTempHoldValue
            #     attribute: value
            #     storeIn: odpTempHoldTotalValue
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTip.odpTempHoldValue 
                    contains: ${checkoutTotalTempHoldValue} 

            - log: The Temp Hold Amount on CXO and ODP is MATCHING !!!
            # - if:
            #     condition: ${checkoutTotalTempHoldValue} ==${odpTempHoldTotalValue}
            #     then:
            #       - log: The Temp Hold Amount on CXO and ODP is MATCHING !!!
            #     else:
            #       - log: The Temp Hold Amount on CXO and ODP is NOT MATCHING !!!

  - name: us.functions.tippingAndFeedback.verification.for.driverTip.onODP
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - log: The user is navigated to Order Detail page!
      - sleep:
          duration: 1000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
          then:
            - log: The Driver Tip Section is not Visible, Scrolling Down!
            - scroll:
                direction: down
                untilIdentifier: us.mappings.tipping.driverTip.odpDriverTipValue
            - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - verifyIdentifier:
          value:
            - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
              contains: ${tipAmount}
      - log: The Driver tip amount selected is matching on the ODP !!!!

# Greater Than 35 $

  - name: us.functions.tippingAndFeedback.verification.for.inProgressODP.GreaterThan35
    platform: ios
    flow:
      - sleep:
          duration: 2000
      - log: The user is navigated to Order Detail page!
      - sleep:
          duration: 1000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.odpTotalLabelg35
          then:
            - log: The ODP total Section is not Visible, Scrolling Down!
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.tipping.driverTip.odpTotalLabelg35
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - log: The ODP Total Section is NOW Visible!
      - log: The Driver Tip Section is NOW Visible on Order details page!

      - if:
          condition: ${tipInPercentage} != null
          then:
            - if:
                condition: ${tipPercentageAmtExpected} == 5
                then:
                  - storeIn:
                      key: percentageAmount
                      value: ${returned5PercentageAmount}
            - if:
                condition: ${tipPercentageAmtExpected} == 10
                then:
                  - storeIn:
                      key: percentageAmount
                      value: ${returned10PercentageAmount}
            - if:
                condition: ${tipPercentageAmtExpected} == 15
                then:
                  - storeIn:
                      key: percentageAmount
                      value: ${returned15PercentageAmount}
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValueg35
                    contains: ${percentageAmount}
          else:
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValueg35
                    contains: ${tipAmount}
      - log: The Driver tip amount selected is matching on the ODP !!!!
      # Verifying the Checkout total amount on ODP with values from review Order page
      - if:
          condition: ${VerifyCheckoutTotalAmount} == true
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTip.odpTotalLabelg35
                then:
                  - log: The ODP total Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTip.odpTotalLabelg35
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The ODP Total Section is NOW Visible!
            - getString:
                identifier: us.mappings.tipping.driverTip.odpTotalValueg35
                attribute: value
                storeIn: odpTotalValue
            - log: The total amount on ODP is ${odpTotalValue}
            - if:
                condition: ${checkoutTotalValue} ==${odpTotalValue}
                then:
                  - log: The Amount on CXO and ODP is MATCHING !!!
                else:
                  - log: The Amount on CXO and ODP is NOT MATCHING !!!

  #when the order status is in-progress for GreaterThan35 Ends

  # Tip amount verification on ODP(After the order Status is set to Delivered Start
  - name: us.functions.tippingAndFeedback.verification.for.driverTip.onODP.GreaterThan35
    platform: ios
    flow:
      - sleep:
          duration: 2000
      - log: The user is navigated to Order Detail page!
      - sleep:
          duration: 1000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.tipping.driverTip.amount
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.tipping.driverTip.odpTempHoldValue
                then:
                  - log: The ODP Temp Hold total Section is not Visible, Scrolling Down!
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.tipping.driverTip.amount
                        - name: direction
                          string: down
                        - name: scrollPosition
                          string: center
                  - log: The Driver Tip Section is NOW Visible on Order details page!
          else:
            - log: The Driver Tip Section is Visible on Order details page, Already!
      - if:
          condition: ${tipInPercentage} != null
          then:
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValueg35
                    contains: ${percentageAmount}
          else:
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.driverTip.odpDriverTipValue
                    contains: ${tipAmount}
      - log: The Driver tip amount selected is matching on the ODP !!!!

  - name: us.functions.utils.checkGiftDSCardBalanceAndBalanceifLessThanFive
    flow:
      - executeFunction:
          name: us.functions.utils.checkDSCardBalance
      - if:
          condition: ${gcBalance} <= 1
          then:
            - log: "The giftCard's current balance is: '${gcBalance}'; Proceeding with load balance to GC(as the balance is less than $1.)"
            - executeFunction:
                name: us.functions.utils.addAmountToDsCard
          else:
            - log: "The giftCard's current balance is: '${gcBalance}'; Skipping load balance to GC(as the balance is greater than $1.)"

# Function to add driver tip amount in order details page
  - name: us.functions.tippingAndFeedback.deliveredOrder.verifyAddTipOnOrderDetails
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.addTipButton.deliveredOrder
      - click:
          identifier: us.mappings.tipping.addTipButton.deliveredOrder
      - if:
          identifier:
            present:
              - identifier: us.mappings.tipping.addTipSubHeader #us.mappings.tipping.feedbackAndTippingScreenHeader
          then:
            - log: 'Feedback and tipping screen is displayed correctly'
          else:
            - failTest:
                message: 'ENV_FAILURE - ${env} - Feedback and tipping screen is not displayed correctly'
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderdetails.customtipButton
      - click:
          identifier: us.mappings.orderdetails.customtipButton

      - enterText:
          identifier: us.mappings.orderdetails.enterCustomTipamount
          string: ${custTipAmount}
      - sleep:
          duration: 10000
      # - click:
      #     identifier: us.mappings.default.keyboardDoneButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.confirmButton
      - click:
          identifier: us.mappings.tipping.confirmButton
      - scroll:
          direction: down
          untilIdentifier: us.mappings.purchaseOrder.VerifyCustomDriverTip
      - verifyIdentifier:
          present:
            - identifier: us.mappings.purchaseOrder.VerifyCustomDriverTip
      - verifyIdentifier:
          value:
            - identifier: us.mappings.purchaseOrder.VerifyCustomDriverTip
              contains: ${custTipAmount}
      - log: "Driver Tip is displayed with correct tip amount $${custTipAmount}"  

  - name: us.functions.customDriverTip.amount
    platform: ios
    flow:
      - if:
          condition: ${AddDriverTip} == null
          then:
          - scroll:
              direction: down
              untilIdentifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
          else:
          - click:
              identifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
          - enterText:
              identifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
              string: ${tipAmount}
          - click:
              identifier: us.mappings.default.keyboardDoneButton
          - log: "Custom driver tip $${tipAmount} is added"


  - name: unified.us.functions.tippingAndFeedback.handleRateYourDriverPopupIfRequired
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - try:
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.tipping.rateYourDriverButton
                then:
                  - log: The Rate your driver pop-up is visible and will handle it NOW !!!!
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.tipping.leaveFeedbackForDriver.notNowButton
                        - identifier: us.mappings.wplus.closeButton
                  - click:
                      identifier: us.mappings.wplus.closeButton
          catch:
            flow:
              - log: The Rate your driver pop-up is NOT visible; proceeding with the flow !!!!


  - name: unified.us.functions.tippingAndFeedback.deliveredOrder.addTipAndVerifyOnOrderDetails
    flow:
      - click:
          identifier: us.mappings.tipping.addTipButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderdetails.editCustomTipamount
      - click:
          identifier: us.mappings.orderdetails.editCustomTipamount
      - enterText:
          identifier: us.mappings.orderdetails.enterCustomTipamount
          string: ${custTipAmount}
      - hideKeyboard: true
      - sleep:
          duration: 3000
      - scroll:
          direction: up
          untilIdentifier: us.mappings.tipping.confirmButton
          position: center
          scrollLimit: 4
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.confirmButton
      - click:
          identifier: us.mappings.tipping.confirmButton
      - log: The Driver Tip Section is not Visible, Scrolling Down!
      - executeFunction:
                name: unified.us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
      - log: The Driver Tip Section is NOW Visible on Order details page!
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
      - if:
          condition: ${platform} == 'Android'
          then:
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
                    contains: ${custTipAmount}
          else:
            - verifyIdentifier:
                value:
                  - identifier: us.mappings.tipping.orderDetailsPage.verifyDriverTipAmount
                    contains: ${custTipAmount}
