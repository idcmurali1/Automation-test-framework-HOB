functions:
#************************************************** iOS **********************************************
  - name: us.functions.carePlans.validateAddOns
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.carePlans.expertHelpSection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSection
            - identifier: us.mappings.carePlans.expertHelpSection

  - name: us.functions.carePlans.verifyAppleCare
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.wppSection  #(the previous mapping is not required in item page we only verify the protection plan label so for that i change the mapping)
            - name: direction
              string: down
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.carePlans.wppSection
      - if:
          identifier:
            present: 
              - identifier: us.mappings.carePlans.wppSection
          then:
            - log: "WPP option present"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Apple care should be present but not available"

  - name: us.functions.carePlans.selectAddOns
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.wppSection
          then:
            - click:
                identifier: us.mappings.carePlans.wppSection
      - if:
          identifier:
            present:
              - identifier: us.mappings.item.addOnServiceDetailsViewController
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.global.navigateBackArrow
                then:
                  - click:
                      identifier: us.mappings.global.navigateBackArrow
                else:
                  - click:
                      identifier: us.mappings.buyNow.closeButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSectionHeader            
      - click:
          identifier: us.mappings.carePlans.wppOption
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.expertHelpSection
          then:
            - click:
                identifier: us.mappings.carePlans.expertHelpSection
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.addOnServiceDetailsView
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.global.navigateBackArrow
                then:
                  - click:
                      identifier: us.mappings.global.navigateBackArrow
                else:
                  - click:
                      identifier: us.mappings.buyNow.closeButton
      - scroll:
          direction: down
          scrollLimit: 2
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.expertHelpSectionHeader
      - click:
          identifier: us.mappings.carePlans.expertHelpOption
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.SecondProductItem
          then:
            - click:
                identifier: us.mappings.carePlans.wppOptionSecondItem
            - click:
                identifier: us.mappings.carePlans.expertHelpOptionSecondItem

  - name: us.function.carePlans.viewDetailsPlan
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.smartNudgeView
          then:
            - click:
                identifier: us.mappings.cart.smartNudgeViewClose
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.viewDetailPlan     
            - name: direction
              string: down
      - click:
          identifier: us.mappings.carePlans.viewDetailPlan
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.verifyDetailsPlanTitleLabel
      - click:
          identifier: us.mappings.global.closeButton

  - name: us.function.carePlans.viewDetailsExpertHelp
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.viewDetailsExpertHelp     
            - name: direction
              string: down
      - click:
          identifier: us.mappings.carePlans.viewDetailsExpertHelp
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.verifyDetailsExpertHelpTitleLabel
      - click:
          identifier: us.mappings.global.closeButton

  - name: us.functions.carePlans.selectAppleCareAddOn
    platform: iOS
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subtotalPricelabel
      - click:
          identifier: us.mappings.carePlans.appleCareSection
      - click:
          identifier: us.mappings.carePlans.wppOption
      - click:
          identifier: us.mappings.cart.checkoutAllItemsButton

  - name: us.functions.carePlans.verifyWhetherCarePlansSelected
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.gotItButton
          then:
            - click:
                identifier: us.mappings.carePlans.gotItButton
      - scroll:
          direction: down
          untilIdentifier: us.mappings.multibox.viewItemDetaisReviewOrder
      - click:
          identifier: us.mappings.multibox.viewItemDetaisReviewOrder
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedAddOns
      - click:
          identifier: us.mappings.digitalDelivery.ItemDetailsCloseButton

  - name: us.functions.cart.carePlans.verifyWhetherCarePlansSelected
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.fulfillmentSection.expandView
          then:
            - click:
                identifier: us.mappings.cart.fulfillmentSection.expandView
      - if:
          condition: ${typeofitem} == 'AddOns'
          then:
            - executeFunction:
                name: us.functions.carePlans.verifyAddOnsTextViewQty
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSectionHeader
            - identifier: us.mappings.carePlans.expertHelpOption
      - click:
          identifier: us.mappings.cart.viewDetailsAddWalmartProtectionPlan 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppOption
      - click:
          identifier: us.mappings.global.closeButton
      - scroll:
          direction: down
          scrollLimit: 2
      - click:
          identifier: us.mappings.cart.viewDetailsAddExpertHelp 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.addOnServiceDetailsViewController
      - click:
          identifier: us.mappings.global.closeButton

  - name: us.functions.carePlans.verifyOrderConfirmationScreenAddOnSection
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.addOnInstructionText     
            - name: direction
              string: down
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.addOnInstructionText
          then:
            - log: "Add-ons text present"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Add-ons text not present"

  - name: us.functions.carePlans.validateReturnsScreen
    platform: iOS
    flow:
      - click:
          identifier: us.mappings.orderDetails.startReturnButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.addOnSectionReturn
            - identifier: us.mappings.carePlans.addOnName
            - identifier: us.mappings.carePlans.cancelPlanCTA
      - click:
          identifier: us.mappings.capOne.cartIcon
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.capOne.cartIcon

  - name: us.functions.carePlans.addAOSFromPAC
    platform: iOS
    flow:
      - executeFunction:
          name: us.functions.item.preAddToCartSteps
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.wppSection       
            - name: direction
              string: down
      - click:
          identifier: us.mappings.carePlans.option1
      - executeFunction:
          name: us.functions.item.validateAndClickAddToCartButton
      - executeFunction:
          name: us.functions.item.postAddToCartSteps
      

  - name: us.functions.carePlans.validateMultipleCarousels
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.item.addItemToCart
          params:
            - name: skipPostAddToCartSteps
              string: true
      - if:
          identifier: 
            present:
              - identifier: us.mappings.item.PACScreen
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.carePlans.carouselsPAC1
            - scroll:
                direction: down
                untilIdentifier: us.mappings.carePlans.carouselsPAC3
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.carePlans.carouselsPAC3
            - click:
                identifier: us.mappings.cart.postAddToCartButton

  - name: us.functions.carePlans.conditionallyProceedToReviewOrder
    platform: iOS
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reserveSlot.title
          then:
            - executeFunction:
                name: us.functions.reserveSlot.scheduledDelivery.bookSlot

#*********************************************** Android ********************************************
  - name: us.functions.carePlans.validateAddOns
    platform: android
    flow:
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.expertHelpSection
            - name: direction
              string: down
            - name: scrollPosition
              string: center               
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSection
            - identifier: us.mappings.carePlans.expertHelpSection
#apple free offers 
  - name: us.functions.applefreeoffers.iOSvalidateOffers
    platform: iOS
    flow: 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.AppleFreeOffers.Validateoffers
      - click:
          identifier: us.mappings.AppleFreeOffers.Validateoffers      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.AppleFreeOffers.ValidateArcadePlan
      - verifyIdentifier:
          present:
            - identifier: us.mappings.AppleFreeOffers.CloseOffers
      - click:
          identifier: us.mappings.AppleFreeOffers.CloseOffers 
#apple free offers 
  - name: us.functions.applefreeoffers.validateOffers
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.AppleFreeOffers.Validateoffers
      - click:
          identifier: us.mappings.AppleFreeOffers.Validateoffers      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.AppleFreeOffers.ValidateArcadePlan
      - verifyIdentifier:
          present:
            - identifier: us.mappings.AppleFreeOffers.CloseOffers
      - click:
          identifier: us.mappings.AppleFreeOffers.CloseOffers 
      
                          
  - name: us.functions.carePlansItemPage.selectAddOns
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.expertHelpSection
            - name: direction
              string: down
            - name: scrollPosition
              string: center 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSection
      - click:
          identifier: us.mappings.carePlans.wppSection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSectionHeader      
      - click:
          identifier: us.mappings.carePlans.wppOption 
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.expertHelpSection
      - click:
          identifier: us.mappings.carePlans.expertHelpSection 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.expertHelpSectionHeader
      - click:
          identifier: us.mappings.carePlans.expertHelpOption           
      - sleep:
          duration: 5000 
      - scroll:
          direction: up                            
          scrollLimit: 1
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.itempage.freeshippinglabel           
          then: 
            - click:
                identifier: us.mappings.wplus.itempage.freeshippinglabel

          
  - name: us.functions.carePlans.selectAddOns
    platform: android
    flow:
      - executeFunction:
          name: us.functions.cart.scrollToTopOfCart
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.wppSection
          then:
            - click:
                identifier: us.mappings.carePlans.wppSection
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.wppSectionHeader
            - name: direction
              string: down 
            - name: scrollPosition
              string: center               
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSectionHeader
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.wppOption
            - name: direction
              string: down                      
      - click:
          identifier: us.mappings.carePlans.wppOption
          wait: 1000
      - click: 
          identifier: us.mappings.carePlans.wppDetailLink
      - sleep:
          duration: 1000    
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppDetailTitle                
      - click: 
          identifier: us.mappings.search.pdp.close          
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.expertHelpSectionHeader
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.expertHelpSectionHeader
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.carePlans.expertHelpOption
          then:
            - click: 
                identifier: us.mappings.carePlans.expertHelpSectionHeader
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.expertHelpOption
            - name: direction
              string: down 
      - click:
          identifier: us.mappings.carePlans.expertHelpOption        
      - click: 
          identifier: us.mappings.carePlans.expertHelpDetailLink             
      - sleep:
          duration: 1000    
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.expertHelpDetailTitle 
      - click: 
          identifier: us.mappings.search.pdp.close
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.SecondProductItem
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.carePlans.SecondProductItem
                  - name: direction
                    string: down                      
            - click:
                identifier: us.mappings.carePlans.wppOption
                wait: 1000
            - click:
                identifier: us.mappings.carePlans.expertHelpOption
                wait: 1000

  - name: us.functions.carePlans.verifyWhetherCarePlansSelected
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.seeDetailsLink
          then:                            
              - click:
                  identifier: us.mappings.cart.seeDetailsLink 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.selectedProtectionPlan
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedProtectionPlan
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.selectedExpertHelpPlan
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedExpertHelpPlan
      - if:
          condition: ${typeofitem} == 'AddOns'
          then:
            - executeFunction:
                name: us.functions.carePlans.verifyAddOnsTextViewQty
      - executeFunction:
          name: us.functions.cart.scrollToTopOfCart
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.carePlans.wppOption
      #     then:
      #       - click:
      #            identifier: us.mappings.carePlans.wppOption
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.carePlans.expertHelpOption 
      #     then:
      #       - click:
      #            identifier: us.mappings.carePlans.expertHelpOption    

  - name: us.functions.carePlans.verifyReviewOrderPage
    platform: android
    flow:
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed  
      - click:
          identifier: us.mappings.digitalDelivery.viewDetailsButton
      - if:
          condition: ${typeofitem} == 'AddOns'
          then:
            - executeFunction:
                name: us.functions.carePlans.verifyAddOnsTextViewQty
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.mainItemImage
            - identifier: us.mappings.carePlans.reviewOrder.selectedProtectionPlan
            - identifier: us.mappings.carePlans.expertHelpIcon
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsDoneButton

  - name: us.functions.carePlans.verifyAppleCare
    platform: android
    flow:
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.item.preAddToCartSteps         
      - scroll:
          direction: down
          untilIdentifier: us.mappings.carePlans.wppSection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppSection

  - name: us.functions.carePlans.selectAppleCareAddOn
    platform: android
    flow:
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.carePlans.taxesLineItem
      #     then:
      #       - scroll:
      #           direction: up
      #           untilIdentifier: us.mappings.cart.switching.section
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.cart.switching.section
      #     then:
      #       - click:
      #           identifier: us.mappings.cart.switching.section
      # - sleep:
      #     duration: 5000
      # - if:
      #     identifier:
      #       present:
      #         - identifier: us.mappings.carePlans.switchFulfilmentTypePopUp
      #     then:
      #       - click:
      #           identifier: us.mappings.reserveSlot.oos.itemUpdates.gotItButton
      - sleep:
          duration: 5000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.carePlans.addOnsExpandButton
      - click:
          identifier: us.mappings.carePlans.addOnsExpandButton
      - scroll:
          direction: down
          untilIdentifier: us.mappings.carePlans.appleCarePlanOption
      - click:
          identifier: us.mappings.carePlans.appleCarePlanOption

  - name: us.functions.carePlans.conditionallyProceedToReviewOrder
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reserveSlot.title
          then:
            - executeFunction:
                name: us.functions.reserveSlot.scheduledDelivery.bookSlot
            - executeFunction:
                name: us.functions.carePlans.verifyWhetherCarePlansSelectedTeflon
          else:
            - executeFunction:
                name: us.functions.carePlans.verifyWhetherCarePlansSelectedTeflon

  

  - name: us.functions.carePlans.verifyWhetherCarePlansSelectedTeflon
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reserveSlot.oos.itemUpdates.gotItButton
          then:
            - click:
                identifier: us.mappings.reserveSlot.oos.itemUpdates.gotItButton
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.viewDetailsLink
            - name: direction
              string: down                
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedAddOns
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsDoneButton
      - sleep:
          duration: 5000

  - name: us.functions.carePlans.verifyOrderConfirmationScreenAddOnSection
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.addOnInstructionText
            - name: direction
              string: down
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.addOnInstructionText
          then:
            - log: "Add-ons instruction text present in order confirmation screen"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Add-ons instruction not visible"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.confrimationScreenAddOnInstruction
      - scroll:
          direction: up
          untilIdentifier: us.mappings.orderConfirmation.greenCheckMarkIcon

  - name: us.functions.carePlans.validateReturnsScreen
    platform: android
    flow:
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.orderDetails.startReturnButton
      - click:
          identifier: us.mappings.orderDetails.startReturnButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.addOnHeading
            - identifier: us.mappings.carePlans.addOnName
            - identifier: us.mappings.carePlans.addOnHeading
            - identifier: us.mappings.carePlans.cancelPlanCTA
      - click:
          identifier: us.mappings.global.navigation.backNavigation
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.global.navigation.backNavigation

  - name: us.functions.carePlans.editCarePlanOrder
    platform: android
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.ppu.item.pureWeighted
      - executeFunction:
          name: us.functions.digital-delivery.addToCart
      - executeFunction:
          name: us.functions.digital-delivery.closeTheBottomSheet
      - executeFunction:
          name: us.functions.global.navigation.toCartFromNavBar
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.amend.addToExistingOrderFlow
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.itemAddedConfimationMessage
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.amend.itemAddedConfimationMessage
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.itemAddedConfimationMessage
            - identifier: us.mappings.amend.viewDetailsLink
      - click:
          wait: 10000
          identifier: us.mappings.amend.viewDetailsLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.navBarTitle

  - name: us.functions.carePlans.addAOSFromPAC
    platform: android
    flow:
      - executeFunction:
          name: us.functions.item.addItemToCart
          params:
            - name: skipPostAddToCartSteps
              string: true
      - if:
          identifier:
            present:
              - identifier: us.mappings.item.PACScreen
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.carePlans.detailsButtonPAC
            - click:
                identifier: us.mappings.carePlans.detailsButtonPAC
            - sleep:
                duration: 3000
            - verifyIdentifier:
                timeout: 80000            
                present:
                  - identifier: us.mappings.carePlans.detailsScreenContent
            - sleep:
                duration: 2000
      - if:
          identifier:
            present:
              - identifier: us.mappings.storeMaps.backButton
          then:                
            - click:
                identifier: us.mappings.storeMaps.backButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.carePlans.addAOSButtonPAC
          then:                
            - click:
                identifier: us.mappings.carePlans.addAOSButtonPAC
            - sleep:
                duration: 7000
      - executeFunction:
          name: us.functions.item.postAddToCartSteps
                
  - name: us.functions.carePlans.validateAdonsInPacScreen
    platform: android
    flow:
      - executeFunction:
          name: us.functions.item.addItemToCart
          params:
            - name: skipPostAddToCartSteps
              string: true        
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.PACScreen
            - identifier: us.mappings.carePlans.wppSection
            - identifier: us.mappings.carePlans.customerSupportLabel 
            - identifier: us.mappings.carePlans.subHeading
            - identifier: us.mappings.carePlans.addAOSButtonPAC 

  - name: us.functions.carePlans.validateMultipleCarousels
    platform: android
    flow:
      - executeFunction:
          name: us.functions.item.addItemToCart
          params:
            - name: skipPostAddToCartSteps
              string: true
      - if:
          identifier: 
            present:
              - identifier: us.mappings.item.PACScreen
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.carePlans.carouselsPAC1
            - scroll:
                direction: down
                untilIdentifier: us.mappings.carePlans.carouselsPAC2
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.carePlans.carouselsPAC2
            - click:
                identifier: us.mappings.cart.postAddToCartButton
            - executeFunction:
                name: us.functions.utils.handleTechnicalErrorPageInCart

  - name: us.functions.carePlans.validateAdonsInPacScreen
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.item.addItemToCart
          params:
            - name: skipPostAddToCartSteps
              string: true
         
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.PACScreen
            - identifier: us.mappings.carePlans.wppSection
            - identifier: us.mappings.carePlans.customerSupportLabel 
            - identifier: us.mappings.carePlans.repairLabel
            - identifier: us.mappings.carePlans.protectioPlanButton             

  - name: us.functions.orderDetails.verifyCarePlan
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderDetails.itemAddOnServices
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.orderDetails.verifyItemsCarePlan  
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderDetails.verifyItemsCarePlan
                  - identifier: us.mappings.carePlans.oDPPageAccidentProtectionPlan
            - if:
                condition: ${typeofitem} == 'AddOns'
                then:
                  - executeFunction:
                      name: us.functions.carePlans.verifyAddOnsTextViewQty
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.orderDetails.itemsButtonODP 
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center         
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderDetails.itemsButtonODP
            - click:
                identifier: us.mappings.orderDetails.itemsButtonODP 
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.orderDetails.verifyItemsCarePlan 
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.carePlans.oDPPageAccidentProtectionPlan
                  - identifier: us.mappings.orderDetails.verifyItemsCarePlan
            

  - name: us.functions.orderDetails.verifyCarePlan
    platform: android
    flow:           
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.odp.expertHelp
            - name: direction
              string: down         
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.AddonServicesPopupTitle
            - identifier: us.mappings.carePlans.odp.itemDescription
            - identifier: us.mappings.carePlans.odp.expertHelp
      - if:
          condition: ${typeofitem} == 'AddOns'
          then:
            - executeFunction:
                name: us.functions.carePlans.verifyAddOnsTextViewQty
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.odp.wpp
            - name: direction
              string: down                 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.odp.wpp

  - name: us.functions.carePlans.verifyCarePlansSelectedInCart
    platform: android
    flow:
      - executeFunction:
          name: us.functions.cart.scrollToTopOfCart
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.carePlans.expertHelpOption
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedProtectionPlanInCart
            - identifier: us.mappings.carePlans.selectedExpertHelpPlanInCart
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.wppOption
            - identifier: us.mappings.carePlans.expertHelpOption          

  - name: us.functions.carePlans.addProtectionPlanFromPACScreen
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.pacHeader
      - click:
          identifier: us.mappings.carePlans.addAOSButtonPAC
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.carePlan.viewCartButton

  - name: us.functions.carePlans.addProtectionPlanFromPACScreen
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.pacHeader
      - click:
          identifier: us.mappings.carePlans.addAOSButtonPAC
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.carePlans.viewCartButton

  - name: us.functions.cart.changefulfilmentToDelivery
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.startNewOrderButton
          then:
            - log: "Start New Order Button displaying so no need to select fulfillment delivery options"
          else:
            - if:
                identifier:
                  timeout: 5000
                  present:
                    - identifier: us.mappings.cart.fulfillmentSection.delivery
                then:
                  - log: "Selecting the Delivery Fulfillment Section"
                  - click:
                      identifier: us.mappings.cart.fulfillmentSection.delivery
                      wait: 3000
                else:
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.cart.fulfillmentSection.expand
                        - name: direction
                          string: up
                  - click: 
                      identifier: us.mappings.cart.fulfillmentSection.expand
                  - click:
                      identifier: us.mappings.cart.fulfillmentSection.delivery
                      wait: 3000 

  - name: us.functions.cart.changefulfilmentToDelivery
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.startNewOrderButton
          then:
            - log: "Start New Order Button displaying so no need to select fulfillment delivery options"
          else:
            - if:
                identifier:
                  timeout: 5000
                  present:
                    - identifier: us.mappings.cart.fulfillmentSection.delivery
                then:
                  - log: "Selecting the Delivery Fulfillment Section"
                  - click:
                      identifier: us.mappings.cart.fulfillmentSection.delivery
                      wait: 3000
                else:
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.cart.fulfillmentSection.expand
                        - name: direction
                          string: up
                  - click: 
                      identifier: us.mappings.cart.fulfillmentSection.expand
                  - click:
                      identifier: us.mappings.cart.fulfillmentSection.delivery
                      wait: 3000 

  - name: us.function.carePlans.verifyAddOnsQtyStepper
    platform: android
    flow:
      - sleep:
          duration: 5000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.carePlans.selectedExpertHelpPlan      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.addOnsQtyStepper
      - click : 
          identifier: (//android.widget.ImageButton[@resource-id="com.walmart.android.debug:id/button_plus"])[2]

      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.addOnsQtyStepperMax
      - sleep:
          duration: 5000

      - executeFunction:
          name: us.functions.cart.decreaseToMinQty
          params:
            - name: minQty
              string: 1
      - verifyIdentifier:
          present:
            - identifier:  us.mappings.carePlans.addOnsQtyStepper
      
  - name: us.functions.carePlans.verifyAddOnsTextViewQty
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedProtectionPlanQty
            - identifier: us.mappings.carePlans.selectedExpertHelpPlanQty
          

  - name: us.function.carePlans.verifyAddOnsQtyStepper
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.carePlans.selectedExpertHelpPlan      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.addOnsQtyStepper
      - click : 
          identifier: (//android.widget.ImageButton[@resource-id="com.walmart.android.debug:id/button_plus"])[2]

      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.addOnsQtyStepperMax
      - sleep:
          duration: 5000

      - executeFunction:
          name: us.functions.cart.decreaseToMinQty
          params:
            - name: minQty
              string: 1
      - verifyIdentifier:
          present:
            - identifier:  us.mappings.carePlans.addOnsQtyStepper
      
  - name: us.functions.carePlans.verifyAddOnsTextViewQty
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.selectedProtectionPlanQty
            - identifier: us.mappings.carePlans.selectedExpertHelpPlanQty
  
  - name: us.functions.carePlans.verifyReviewOrderPage
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed  
      - click:
          identifier: us.mappings.digitalDelivery.viewDetailsButton
      - if:
          condition: ${typeofitem} == 'AddOns'
          then:
            - executeFunction:
                name: us.functions.carePlans.verifyAddOnsTextViewQty
      - verifyIdentifier:
          present:
            - identifier: us.mappings.carePlans.mainItemImage
            - identifier: us.mappings.carePlans.reviewOrder.selectedProtectionPlan
            - identifier: us.mappings.carePlans.expertHelpIcon
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsDoneButton
