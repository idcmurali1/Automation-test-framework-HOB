functions:

  - name: us.functions.buyNow.existingUser.overlay
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.buyNow.buyNowButton
          then:   
          #   - click:
          #         identifier: us.mappings.search.searchShelf.productTile
          #         wait: 10000
            - verifyIdentifier:
                timeout: 5000
                present:
                  - identifier: us.mappings.buyNow.buyNowButton
            - click:
                identifier: us.mappings.buyNow.buyNowButton
                wait: 10000

            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.AddonServicesPopupTitle
                then:       
                  - click:
                      identifier: us.mappings.buyNow.AddonServices.Closebutton
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.shippingTab
                then:       
                  - click:
                      identifier: us.mappings.buyNow.shippingTab  
            - verifyIdentifier:
                present:
                    - identifier: us.mappings.buyNow.titleNavigationBar
                    - identifier: us.mappings.buyNow.productTitle
                    # - identifier: us.mappings.buyNow.deliverToAddress
                    - identifier: us.mappings.buyNow.arrivingText
                    #- identifier:  us.mappings.buyNow.payWithText
                    - identifier: us.mappings.buyNow.placeOrderButton
            - executeFunction:
                  name: us.functions.buyNow.addAddress.selectorverify       
          else:
            - failTest:
                message: "FAILURE - ${env} - Buy now button is not present "   
                  
  - name: us.functions.buyNow.addAddress.selectorverify
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.addAddress 
          then:
            - click:
                identifier:  us.mappings.buyNow.addAddress
                wait: 10000
            - executeFunction:
                name: us.functions.reserveSlot.fcormpselectaddressandcontinue
            - sleep:
                duration: 10000
            - verifyIdentifier:
                present :  
                  - identifier: us.mappings.buyNow.deliverToAddress
          else:
            - sleep:
                duration: 10000
            - verifyIdentifier:
                present :  
                  - identifier: us.mappings.buyNow.deliverToAddress
      #verifying buy now overlay elements

  - name: us.functions.buynow.existingUser.placeOrder
    platform: ios
    flow:
      - click:
           identifier: us.mappings.buyNow.placeOrderButton
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.enterYourCvv
          then:
            - click:
                identifier:  us.mappings.buyNow.enterYourCvv  
            - click:
                identifier:  us.mappings.buyNow.addCard.securityCodeField
            - enterText:
                identifier: us.mappings.buyNow.addCard.securityCodeField
                string: ${cvv}
            - click:
                identifier: us.mappings.default.keyboardDoneButton    
            - click:
                identifier: us.mappings.reviewOrder.paymentMethod.continueButton
            - sleep:
                duration: 2000
            - click:
                identifier: us.mappings.buyNow.placeOrderButton
      - sleep:
          duration: 5000
      - if:
          identifier: 
            present:
              - identifier: us.mappings.wplus.walmartCashChallenge
          then:
            - click:
                identifier: us.mappings.buyNow.closeButton
            # closing app rating pop-up                        
      - executeFunction:
          name: us.functions.orderConfirmation.ratings                      
      #Click on place order button on buy now overlay
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.thankYouTitle
            - identifier: us.mappings.buyNow.orderNumberLabel
            - identifier: us.mappings.buyNow.continueButton

  #Function to extract  order number from buy now order confirmation page
  - name: us.functions.buyNow.orderConfirmation.getOrderNumber
    platform: ios
    flow:
    - storeIn:
          key: executionStage
          value: Post-transactions
    - getString:
        identifier: us.mappings.buyNow.orderNumberLabel
        extractNumbers: true
        storeIn: orderNo

  # Function to close buy now order confirmation screen
  - name: us.functions.closebuyNowOrderConfirmation
    platform: ios
    flow:
    - click:
         identifier: us.mappings.buyNow.continueButton
    - click:
         identifier: us.mappings.item.closeItemDetailsPage

  # Function to return to home page
  - name: us.functions.closeBuyNowOrderConfirmation.goToHomeScreen
    platform: ios
    flow:
    - click:
         identifier: us.mappings.buyNow.continueButton
    # Close buy now order confirmation page
    - click:
         identifier: us.mappings.item.closeItemDetailsPage
    # Close item detail page
    - click:
         identifier: us.mappings.global.navigation.backNavigationToShop
    # Click on shop tab to return to home page

  - name: us.functions.buyNow.newUser.overlay.verify
    platform: ios
    flow:
      - sleep:
          duration: 20000
      - verifyIdentifier:
          timeout: 250000
          present:
            - identifier: us.mappings.buyNow.buyNowButton
      - click:
          identifier: us.mappings.buyNow.buyNowButton
          wait: 30000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.titleNavigationBar
            - identifier: us.mappings.buyNow.productTitle
            - identifier: us.mappings.buyNow.addAddress
            - identifier: us.mappings.buyNow.arrivingText
            - identifier: us.mappings.buyNow.placeOrderButton                       
      - sleep:
          duration: 20000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.walmartPlusBannerContainer
          then:
            - verifyIdentifier:
                present :
                  - identifier: us.mappings.buyNow.VerifyWalmartPlusBanner
                  - identifier: us.mappings.buyNow.verifyCheckoutboxTry+forfreefor30days
          #  - identifier: us.mappings.paymentMethod.addPayment.overlay.title
    #   - click:
    #       identifier: us.mappings.buyNow.buyNowButton
      #click on buy now button
        #   wait: 30000
    #   - verifyIdentifier:
    #       present:
    #         - identifier: us.mappings.buyNow.titleNavigationBar
    #         - identifier: us.mappings.buyNow.productTitle

  - name: us.functions.buyNow.addCVV
    platform: ios
    flow:      
        - if:
            identifier:
              present:
                - identifier: us.mappings.buyNow.payWithField
            then:    
              - click:
                  identifier: us.mappings.buyNow.payWithField
        - if:
            identifier:
              present:
                - identifier: us.mappings.buyNow.cVVTextField
            then:    
              - enterText:
                  identifier: us.mappings.buyNow.cVVTextField
                  string: ${CVV}
              - click:
                  identifier: Done
        - click:
            identifier: mapings.capOne.paymentsOptionsContinueButton
            wait: 5000

      
  # Function to add credit card details
  - name: us.functions.buyNow.paymentMethod.addCardDetails
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - click:
          identifier: us.mappings.buyNow.payWithField
          wait: 3000              
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.paymentMethod.addPayment.overlay.title
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.paymentMethod.addPayment.overlay.title
          then:       
            - if:  
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.AddCreditorDebitcard
                then:     
                  - click:
                      identifier: us.mappings.buyNow.AddCreditorDebitcard
                      wait: 3000 
            - click:
                identifier: us.mappings.buyNow.addCard.cardNumberField 
                wait: 3000   
            - enterText:
                identifier: us.mappings.buyNow.addCard.cardNumberField
                string: ${number}
            - click:
                identifier: Done
            - if:  
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.addAddress.firsNameField
                then:     
                  - click:
                      identifier: us.mappings.buyNow.addAddress.firsNameField
                  - enterText:
                      identifier: us.mappings.buyNow.addAddress.firsNameField
                      string: ${firstName}
                  - click:
                      identifier: Done
                  - click:
                      identifier: us.mappings.buyNow.addAddress.lastNameField
                  - enterText:
                      identifier: us.mappings.buyNow.addAddress.lastNameField
                      string: ${lastName}
                  - click:
                      identifier: Done
            - click:
                identifier: us.mappings.buyNow.addCard.expirationDatefield
            - sleep:
                duration: 3000
            - enterText:
                identifier: us.mappings.paymentMethod.addPayment.overlay.expiry.pickerWheelMonth
                string: ${expirationMonth}
                clearField: false
                clickFirst: false
            - enterText:
                identifier: us.mappings.paymentMethod.addPayment.overlay.expiry.pickerWheelYear
                string: ${expirationYear}
                clearField: false
                clickFirst: false
            - click:
                identifier: Done
            - enterText:
                identifier: us.mappings.buyNow.addCard.securityCodeField
                string: ${cvv}
            - click:
                identifier: Done
            - click:
                identifier: us.mappings.buyNow.addCard.phoneNumberTextField
            - enterText:
                identifier: us.mappings.buyNow.addCard.phoneNumberTextField
                string: ${phoneNumber}
            - click:
                identifier: Done
                wait: 3000
            - if:  
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.addCard.billingAddress.headerLabel
                then:     
                  - click:
                      identifier: us.mappings.buyNow.addCard.streetAddressField
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.streetAddressField
                      string: ${streetAddress}
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.cityField
                      string: ${city}
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.stateField
                      string: ${state}
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.zipCodeField
                      string: ${zipcode}
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.phoneNumberField
                      string: ${phoneNumber}
                  - click:
                      identifier: Done
            - click:
                identifier: us.mappings.buyNow.addCard.save.button
                wait: 4000
            - sleep:
                duration: 3000
            - if:  
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.addCard.securityCodeField
                then:     
                  - click:
                      identifier: us.mappings.buyNow.addCard.securityCodeField
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.securityCodeField
                      string: ${cvv}
                  - click:
                      identifier: Done
            - click:
                identifier: us.mappings.reviewOrder.paymentMethod.continueButton
                wait: 5000
            - if:  
                identifier:
                  present: 
                    - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                then:     
                  - click:
                      identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                  - enterText:
                      identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                      string: ${cvv}
                  - click:
                      identifier: Done
                  - click:
                      identifier: us.mappings.reviewOrder.paymentMethod.continueButton
                      wait: 5000                                     
          # else:
          #   - click:
          #       identifier: us.mappings.reviewOrder.paymentMethod.continueButton
          #       wait: 3000
                
  # Function to add delivery address details
  - name: us.functions.buyNow.deliveryAddress.addAddress              
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:  
          identifier:
            present:
              - identifier: us.mappings.buyNow.buyNowButton
          then:     
            - click:
                identifier: us.mappings.buyNow.buyNowButton
                wait: 1000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.switchOptionContainer
          then:
            - click:
                identifier: us.mappings.buyNow.switchOptionShipping
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.buyNow.addAddress
      - click:
          identifier: us.mappings.buyNow.addAddress
          wait: 2000
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.buyNow.addAddress.title.text
      # - executeFunction:
      #      name: us.functions.deliveryAddress.addAddress
      - sleep:
          duration: 4000
      - if:
          identifier:
            present:
              - identifier: us.mappings.deliveryAddress.add.title
          then:
            - executeFunction:
                name: us.functions.deliveryAddress.addAddress
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.buyNow.addAddress
          then: 
              - click: 
                  identifier: us.mappings.buyNow.addAddress
                  wait: 2000                                            
      - executeFunction:
            name: us.functions.reserveSlot.fcormpselectaddressandcontinue  

  # Function to input delivery address details
  - name: us.functions.buyNow.noAddress.addDeliveryAddress
    platform: iOS
    flow:
      - executeFunction:
          name: us.functions.buyNow.deliveryAddress.addAddress
          params:
            - name: firstName
              string: ${firstName}
            - name: lastName
              string: ${lastName}
            - name: streetAddress
              string: ${streetAddress}
            - name: city
              string: ${city}
            - name: state
              string: ${state}
            - name: zipcode
              string: ${zipcode}
            - name: phoneNumber
              string: ${phoneNumber}

  - name: us.functions.buynow.guestUser.placeOrder      
    platform: iOS
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - verifyIdentifier:
            timeout: 90000
            present:
                - identifier: us.mappings.buyNow.placeOrderButton
      - click:
            wait: 2000
            identifier: us.mappings.buyNow.placeOrderButton
      #Click on place order button on buy now overlay
      - sleep:
          duration: 10000          
      - executeFunction:
          name: us.functions.orderConfirmation.ratings   
      - sleep:
          duration: 5000 
      - verifyIdentifier:
            timeout: 90000
            present:
                - identifier: us.mappings.buyNow.thankYouTitle
                - identifier: us.mappings.buyNow.orderNumberLabel
                - identifier: us.mappings.buyNow.continueButton

  # Function to apply the associate discount when prompted after tapping BuyNow  #Joel 2/17/22
  - name: us.functions.buyNow.associateDiscountPrompt.applyDiscount
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buyNow.buyNowButton
          wait: 6000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNowUnavailableAlert
          then:
            - log: Buy Now button is unavailable
            - click:
                identifier: us.mappings.popup.okButton
            - sleep:
                duration: 2000
            - log: Clicking on Buy Now button again
            - click:
                identifier: us.mappings.buyNow.buyNowButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNowUnavailableAlert
                then:
                  - log: Buy Now button is unavailable on second try
                  - failTest:
                      message: "FAILURE - ${env} - Buy now unavailable "  
      - if:
          identifier:
            present:
              - identifier: us.mappings.associateDiscount.pageTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.associateDiscount.pageTitle
                  - identifier: us.mappings.associateDiscount.applyAssociateDiscount
                  - identifier: us.mappings.associateDiscount.doNotAppyAssociateDiscount
                  - identifier: us.mappings.associateDiscount.VerifyDiscountpolicyArrow
            - click:
                identifier: us.mappings.associateDiscount.continueButton
            - sleep:
                duration: 10000
            - executeFunction:
                name: us.functions.utils.handleTechnicalErrorPopup
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.associateDiscount.continueButton
                then:
                  - click:
                      identifier: us.mappings.associateDiscount.continueButton
                  - sleep:
                      duration: 7000                               
      - scroll:
          direction: down
          untilIdentifier: us.mappings.buyNow.placeOrderButton
          position: center
      - verifyIdentifier:
          timeout: 100000
          present:
            - identifier: us.mappings.buyNow.arrivingText
            - identifier: us.mappings.buyNow.payWithText
            - identifier: us.mappings.buyNow.placeOrderButton
            - identifier: us.mappings.buynow.estTotalButton          
            - identifier: us.mappings.buynow.estTotal.includesBelowMinFee.string 

  # Function to view the Estimate total sheet, associate discount and Below minimum fee for BuyNow Eligibility  #Joel 2/15/22
  - name: us.functions.buyNow.estTotal.associateDiscount.buyNowEligibility.text
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buynow.estTotalButton # us.mappings.buyNow.estimatedTotalText
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buynow.estTotal.pos.belowOrderMinimumLabel
            - identifier: us.mappings.buynow.estTotal.pos.belowOrderMinimumLabel.string
            - identifier: us.mappings.buynow.estTotal.pos.associateDiscountLabel
            - identifier: us.mappings.buynow.estTotal.pos.associateDiscountLabel.string
      - verifyIdentifier:
          present:            
            - identifier: us.mappings.buynow.estTotal.pos.totalHeader
            - identifier: us.mappings.buynow.estTotal.pos.subTotalLabel
            - identifier: us.mappings.buynow.estTotal.pos.estimatedTaxesLabel.string
            - identifier: us.mappings.buynow.estTotal.pos.estimatedTotalLabel.string
      - click:
          identifier: us.mappings.global.navigation.backNav.resourceId

  #Function to Verify Est total Text String when under $35 and then Above $35 threshold.  #Joel 2/15/22
  - name: us.functions.buyNow.estTotal.buyNowEligibility.belowAndAbove.includesText
    platform: ios
    flow:         
      - verifyIdentifier:
          present:            
            - identifier: us.mappings.buynow.estTotal.includesBelowMinFee.string
      - log: Price is under $35 Threshold expected text is present.            
      - click:
          identifier: us.mappings.global.navigateBackArrow
          wait: 3000                
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.item.closeItemDetailsPage
          then:          
              - log: Item Page is present, closing Item Page
              - click:
                  identifier: us.mappings.item.closeItemDetailsPage
                  wait: 3000            
          else:
              - log: Item Page is Not present, deep link to new item
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
      - executeFunction: 
          name: us.functions.search.clickOnFirstItem.buyNow 
      - sleep:
          duration: 10000
      #Tapping BuyNow and Apply Associate Discount for new item and verifying the above threshold string (includes taxes)
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: us.mappings.buyNow.buyNowButton
      - click:  
          identifier: us.mappings.buyNow.buyNowButton
          wait: 6000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNowUnavailableAlert
          then:
            - log: Buy Now button is unavailable
            - click:
                identifier: us.mappings.popup.okButton
            - sleep:
                duration: 2000
            - log: Clicking on Buy Now button again
            - click:
                identifier: us.mappings.buyNow.buyNowButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNowUnavailableAlert
                then:
                  - log: Buy Now button is unavailable on second try
                  - failTest:
                      message: "ENV_FAILURE - ${env} - Buy now unavailable "  
      - if:
          identifier:
            present:
              - identifier: us.mappings.associateDiscount.pageTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.associateDiscount.pageTitle
                  - identifier: us.mappings.associateDiscount.applyAssociateDiscount
                  - identifier: us.mappings.associateDiscount.doNotAppyAssociateDiscount
                  - identifier: us.mappings.associateDiscount.VerifyDiscountpolicyArrow
            - click: 
                identifier: us.mappings.associateDiscount.continueButton
                wait: 6000
      - sleep:
          duration: 10000          
      - executeFunction:
          name: us.functions.utils.handleTechnicalErrorPopup 
      - sleep:
          duration: 5000
  #trying to click the continue button after dismising technical error.
      - loop:
         begin: 0
         end: 4
         storeIndex: j
         flow:      
          - if:
              identifier:
                present:
                  - identifier: us.mappings.associateDiscount.continueButton
              then:
                - click:
                    identifier: us.mappings.associateDiscount.continueButton
                - executeFunction:
                    name: us.functions.utils.handleTechnicalErrorPopup
                - sleep:
                    duration: 3000
                - if:
                    identifier:
                      notPresent:
                        - identifier: us.mappings.associateDiscount.continueButton
                    then:
                      - break: true
              else:
                - break: true
      - scroll:
          direction: down
          untilIdentifier: us.mappings.buyNow.placeOrderButton
          position: center          
      # - verifyIdentifier:
      #     present:            
      #       - identifier: us.mappings.buynow.estTotal.pos.aboveOrderMinimumLabel.string
      - log: Price is now over $35 Threshold Includes taxes text is present. 


  #Function for Placing order through buy now flow with CVV and Associate Discount
  - name: us.functions.buyNow.placeOrder.buyNow.associateDiscount.eligibility  #Joel 2/15/22
    platform: ios
    flow:
      - if:
          identifier:
            present: 
              - identifier: us.mappings.buyNow.addCard.securityCodeField
          then:          
              - log: CVV field is Prompting user for Buy Now          
              - verifyIdentifier:
                  present:            
                    - identifier: us.mappings.buyNow.addCard.securityCodeField
              - enterText:
                  identifier: us.mappings.buyNow.addCard.securityCodeField
                  string: ${cvv}
          else:
              - log: CVV field is Not Prompting user for Buy Now
      - executeFunction:
          name: us.functions.buyNow.addCVV
      - sleep:
          duration: 2000              
      - scroll:
          direction: down
          untilIdentifier: us.mappings.buyNow.placeOrderButton
          position: center                        
      - executeFunction:
          name: us.functions.buynow.guestUser.placeOrder
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.buyNow.thankYouTitle
            - identifier: us.mappings.buyNow.itemArrivesText
            - identifier: us.mappings.buyNow.continueButton
      - executeFunction:  #Test Here
          name: us.functions.buyNow.orderConfirmation.getOrderNumber
      - log: ${orderNo}            
      - click:
          identifier: us.mappings.buyNow.continueButton
          wait: 3000
      - if:
          identifier:
            present: 
              - identifier: us.mappings.item.closeItemDetailsPage
          then:          
              - log: Item Page is present, closing Item Page
              - click:
                  identifier: us.mappings.item.closeItemDetailsPage
                  wait: 3000            
          else:
              - log: Item Page is Not present, procceeding with next step          

  # Function to edit delivery address details
  - name: us.functions.buyNow.deliveryAddress.editAddress     
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buyNow.deliverToAddress
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.selectAddress.titleNavigationBar
          then:
              - verifyIdentifier:
                  present:            
                    - identifier: us.mappings.buyNow.selectAddress.titleNavigationBar      
      - click:
          identifier: us.mappings.buyNow.selectAddress.editButton
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.editAddress.editAddressText
      - enterText:
          identifier: us.mappings.buyNow.addAddress.firsNameField
          string: ${firstName}
      - click:
          identifier: us.mappings.buyNow.addAddress.lastNameField
      - enterText:
          identifier: us.mappings.buyNow.addAddress.lastNameField
          string: ${lastName}
      - click:
          identifier: Done
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.deliveryAddress.add.addressSuggestionList
          then:
            - click:
                identifier: us.mappings.deliveryAddress.add.addressSuggestionLink
            - sleep:
                duration: 2000
            - click:
                identifier: Done
      - click:
          wait: 3000
          identifier: us.mappings.deliveryAddress.add.saveButton 
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.selectAddress.continueButton
          then:
            - click:
                identifier:  us.mappings.selectAddress.continueButton
                wait: 10000    
          else:
            - click:
                identifier:  us.mappings.selectAddress.backbutton           
      - if:
          identifier:
            present:
              - identifier: us.mappings.editAddress.addressAlreadySavedError
          then:
            - click:
                identifier:  us.mappings.buyNow.closeButton      

 # Function to edit credit card details
  - name: us.functions.buyNow.payMentMethod.editCardDetails                # modified on 17th March 2021
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buyNow.payWithField
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.updatePayment.listPaymentOverlay.Title
      - click:
          identifier: us.mappings.buyNow.paymentMethods.editCard.editButton
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.paymentMethods.editCard.editCardText
      - enterText:
          identifier: us.mappings.buyNow.addAddress.firsNameField
          string: ${firstName}
      - click:
          identifier: us.mappings.buyNow.addAddress.lastNameField
      - enterText:
          identifier: us.mappings.buyNow.addAddress.lastNameField
          string: ${lastName}
      - click:
          identifier: Done
          wait: 3000
      - enterText:
          identifier: us.mappings.buyNow.addCard.securityCodeField
          string: ${cvv}  
      - click:
          identifier: Done
          wait: 3000    
      - click:
          identifier: us.mappings.buyNow.paymentMethods.editCard.saveButton
          wait: 3000
      - click:
          identifier: us.mappings.buyNow.paymentMethods.editCard.closeButton
          wait: 3000

  - name: us.functions.buyNow.deliveryAddress.addAddressFromSelectAddressOverlay
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buyNow.deliverToAddress
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.selectAddress.titleNavigationBar
      - click:
          identifier: us.mappings.deliveryAddress.selectAddress.addNewAddressLink
          wait: 3000 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.addAddress.title.text
      - enterText:
          identifier: us.mappings.buyNow.addAddress.firsNameField
          string: ${firstName}
      - click:
          identifier: us.mappings.buyNow.addAddress.lastNameField
      - enterText:
          identifier: us.mappings.buyNow.addAddress.lastNameField
          string: ${lastName}
      - click:
            identifier: us.mappings.buyNow.addAddress.firsNameField
      - enterText:
          identifier: us.mappings.buyNow.addAddress.streetAddressField
          string: ${streetAddress}
      - click:
          identifier: Done
      - enterText:
          identifier: us.mappings.buyNow.addAddress.cityField
          string: ${city}
      - enterText:
          identifier: us.mappings.buyNow.addAddress.stateField
          string: ${state}
      - enterText:
          identifier: us.mappings.buyNow.addAddress.zipCodeField
          string: ${zipcode}
      - click:
          identifier: Done
      - enterText:
          identifier: us.mappings.buyNow.addAddress.phoneNumberField
          string: ${phoneNumber}
      - click:
          identifier: Done
          wait: 3000
      - click:
          identifier: us.mappings.buyNow.addAddress.save.button           
      - verifyIdentifier:        
          timeout: 30000
          present:
              - identifier: us.mappings.buyNow.selectAddress.continueButton
                  
  - name: us.functions.buyNow.existingUser.upgradeShippingAndVerifyFields
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.arrivingText
      - click:
          identifier: us.mappings.buyNow.arrivingText
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buynow.pleaseAddYourAddressButton
          then:
            - click:
                identifier:  us.mappings.buynow.pleaseAddYourAddressButton
            - executeFunction:
                name: us.functions.reserveSlot.fcormpselectaddressandcontinue 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.buyNow.upgradeShipping      
            - name: direction
              string: down                 
      - click:
          identifier: us.mappings.buyNow.upgradeShipping
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.upgradeShippingConfirmButton
      - click:    
          identifier: us.mappings.buyNow.upgradeShippingConfirmButton      
          wait: 3000
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.buyNow.arrivingText
      - getString:
          identifier: us.mappings.buyNow.arrivingText
          attribute: label
          storeIn: UpgradedDate
      - log:  UpgradedDate ${UpgradedDate}
      - verifyIdentifier:
          label:
            - identifier: us.mappings.buyNow.deliverToAddAnAddressText
              notEquals: Add delivery address
      - verifyIdentifier:
          label:
            - identifier: us.mappings.buyNow.payWithText
              notEquals: Add a credit or debit card
            - identifier: us.mappings.buyNow.estimatedTotalText
            - identifier: us.mappings.buyNow.placeOrderButton
       
  - name: us.functions.buynow.existingUser.verifyUpgradedDateinOrderConfirmation
    platform: ios
    flow:
    #splitting the text to extract date part of upgraded date
      - executeNode:
          file: us/e2e-tests/helpers/splitDateString_ios.js
          args:
            - value: ${UpgradedDate}
          getResponse:
            storeIn: returnedUpgradedDate
      - log: returnedUpgradedDate ${returnedUpgradedDate}
      - getString:
          identifier: us.mappings.buyNow.itemArrivesText
          attribute: label
          storeIn: itemArrivesText
      - log: itemArrivesText ${itemArrivesText}
  #splitting the text to extract date displayed in order confirmation screen
      - executeNode:
          file: us/e2e-tests/helpers/splitDateString_ios.js
          args:
            - value: ${itemArrivesText}
          getResponse:
            storeIn: returneditemArrivesText
      - log: returneditemArrivesText  ${returneditemArrivesText}
#verifying the upgraded date is equal to date displayed in order confirmation screen
      - verifyIdentifier:
          label:
            - identifier: ${returneditemArrivesText}
              equals: ${returnedUpgradedDate}        

  - name: us.functions.buyNow.newUser.overlay.createNewAccount
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Pre-transactions
      - sleep:
          duration: 20000
      - verifyIdentifier:
          timeout: 280000
          present:
            - identifier: us.mappings.buyNow.buyNowButton
      - click:
          identifier: us.mappings.buyNow.buyNowButton
          wait: 30000
      - executeFunction:
          name: us.functions.global.authentication.createAccountFromSignInScreen
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNowUnavailableAlert
          then:
            - log: Buy Now button is unavailable
            - click:
                identifier: us.mappings.popup.okButton
            - sleep:
                duration: 2000
            - log: Clicking on Buy Now button again
            - click:
                identifier: us.mappings.buyNow.buyNowButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNowUnavailableAlert
                then:
                  - log: Buy Now button is unavailable on second try
                  - failTest:
                      message: "ENV_FAILURE - ${env} - Buy now unavailable "  

######################################################## Android #########################################################################

  - name: us.functions.buyNow.addCVV
    platform: android
    flow:      
        - if:
            identifier:
              present:
                - identifier: us.mappings.buyNow.enterYourCvvText
            then:    
              - click:
                  identifier: us.mappings.buyNow.payWithViewButton
        - if:
            identifier:
              present:
                - identifier: us.mappings.buyNow.cVVTextField
            then:    
              - enterText:
                  identifier: us.mappings.buyNow.cVVTextField
                  string: ${CVV}
        - click:
            identifier: us.mappings.capOne.paymentsOptionsContinueButton

  - name: us.functions.buyNow.existingUser.overlay
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.myItems.itemTile.productTitle
          then:
            - click:
                identifier: us.mappings.myItems.itemTile.productTitle
                wait: 3000
      - if: 
          identifier:
            present: 
              - identifier: us.mappings.buyNow.buyNowButton
          then:                 
            - click:
                identifier: us.mappings.buyNow.buyNowButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNow.AddonServicesPopupTitle
                then:
                  - click:
                      identifier: us.mappings.myItems.AddonServiceContinueButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.myItems.Buynow.AddHomeAddress
                then:
                  - click:
                      identifier: us.mappings.myItems.Buynow.AddHomeAddress
                      wait: 3000
            - if: 
                identifier:
                  present: 
                    - identifier: us.mappings.buyNow.addHomeAddress.SelectAddress
                then:         
                    - executeFunction:
                          name: us.functions.reserveSlot.fcormpselectaddressandcontinue
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNowUnavailableAlert
                then:
                  - log: Buy Now button is unavailable
                  - click:
                      identifier: us.mappings.buyNowUnavailableAlert.okay
                  - sleep:
                      duration: 2000
                  - log: Clicking on Buy Now button again
                  - click:
                      identifier: us.mappings.buyNow.buyNowButton
            - sleep:
                duration: 5000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.buyNow.arrivingText
                  - identifier: us.mappings.buyNow.deliverToAddAnAddressText
                  #- identifier: us.mappings.buyNow.payWithText
                  - identifier: us.mappings.buyNow.estimatedTotalText

            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.buyNow.placeOrderButton
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.buyNow.placeOrderButton
          else:
            - failTest:
                message: "FAILURE - ${env} - Buy now button is not present "  

  - name: us.functions.buyNow.existingUser.upgradeShippingAndVerifyFields 
    platform: android
    flow:

      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.arrivingText
      - click:
          identifier: us.mappings.buyNow.arrivingDateArrowButton
          wait: 3000
      - click:
          identifier: us.mappings.buyNow.upgradeShipping
          wait: 3000
      - getString:
          identifier: us.mappings.buyNow.selectDateText
          attribute: Text
          storeIn: newSpeedingOption
      - log:  ${newSpeedingOption}

      - click:
          identifier: us.mappings.buyNow.upgradeShippingConfirmButton

      - sleep:
          duration: 5000

      - getString:
          identifier: us.mappings.buyNow.arrivingtextValue
          attribute: Text
          storeIn: UpgradedDate
      - log:  ${UpgradedDate}     
      - verifyIdentifier:
          text:
            - identifier: ${newSpeedingOption}
              equals: ${UpgradedDate}

      - verifyIdentifier:
          text:
            - identifier: us.mappings.buyNow.deliverToAddAnAddressText
              notEquals: Add delivery address
      - verifyIdentifier:
          text:
            - identifier: us.mappings.buyNow.payWithText
              notEquals: Add a credit or debit card

            - identifier: us.mappings.buyNow.estimatedTotalText
            - identifier: us.mappings.buyNow.placeOrderButton

      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.enterYourCvv
          then:
            - click:
                identifier: us.mappings.buyNow.enterYourCvv
            - verifyIdentifier:
                present:            
                  - identifier: us.mappings.buyNow.addCard.securityCodeField
            - enterText:
                identifier: us.mappings.buyNow.addCard.securityCodeField
                string: 222
            - click:
                identifier: us.mappings.reviewOrder.paymentMethod.continueButton
      - sleep:
          duration: 5000



  - name: us.functions.buynow.existingUser.placeOrder
    platform: android
    flow:
      - click:
          identifier: us.mappings.buyNow.deliverToAddAnAddressText
          wait: 3000
      # Click on add an address module in buy now overlay
      - click:
          identifier: us.mappings.buyNow.selectAddress.saveButton
          wait: 3000
      # Click on continue button on Add an address page
      - click:
          identifier: us.mappings.buyNow.placeOrderButton
          wait: 3000
      # # Click on place order button on buy now overlay
      - sleep:
          duration: 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.welcomeSplash.title
          then:
            - click:
                identifier: us.mappings.global.closeButton

      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.thankYouTitle
            - identifier: us.mappings.buyNow.orderNumberLabel
            - identifier: us.mappings.buyNow.continueButton
            # - identifier: us.mappings.orderConfirmation.fulfillmentTopSection.fulfillmentTypeText

  - name: us.functions.buynow.existingUser.verifyUpgradedDateinOrderConfirmation
    platform: android
    flow:
    #splitting the text to extract date part of upgraded date
      - executeNode:
          file: us/e2e-tests/helpers/splitDateString.js
          args:
            - value: ${UpgradedDate}
          getResponse:
            storeIn: returnedUpgradedDate
      - log: ${returnedUpgradedDate}

      - executeNode:
          file: us/e2e-tests/helpers/splitString.js
          args:
            - value: ${UpgradedDate}
            - value: ${delimeter}
          getResponse:
            storeIn: returnedUpgradedDate
      - log: ${returnedUpgradedDate}

      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentTime
          then:
            - getString:
                identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentTime
                attribute: Text
                storeIn: itemArrivesText
            - log:  ${itemArrivesText}
            - executeNode:
                file: us/e2e-tests/helpers/splitString.js
                args:
                  - value: ${itemArrivesText}
                  - value: ${delimeter}
                getResponse:
                  storeIn: returneditemArrivesText
            - log: ${returneditemArrivesText}

          else:
            - getString:
                identifier: us.mappings.buyNow.itemArrivesText
                attribute: Text
                storeIn: itemArrivesText
            - log:  ${itemArrivesText}      
            - executeNode:
                file: us/e2e-tests/helpers/splitDateString.js
                args:
                  - value: ${itemArrivesText}
                getResponse:
                  storeIn: ArrivesDate
            - log: ${ArrivesDate}      
            - executeNode:
                file: us/e2e-tests/helpers/splitString.js
                args:
                  - value: ${ArrivesDate}
                  - value: ${delimeter}
                getResponse:
                  storeIn: returneditemArrivesText
            - log: ${returneditemArrivesText}
#verifying the upgraded date is equal to date displayed in order confirmation screen
      - verifyIdentifier:
          text:
            - identifier: ${returneditemArrivesText}
              equals: ${returnedUpgradedDate}


  #Function to extract  order number from buy now order confirmation page
  - name: us.functions.buyNow.orderConfirmation.getOrderNumber
    platform: android
    flow:
    - storeIn:
          key: executionStage
          value: Post-transactions
    - sleep:
        duration: 3000
    - getString:
        identifier: us.mappings.buyNow.orderNumberLabel
        extractNumbers: true
        storeIn: orderNo

  # Function to close buy now order confirmation screen
  - name: us.functions.closebuyNowOrderConfirmation
    platform: android
    flow:
    - click:
         identifier: us.mappings.buyNow.continueButton
    - click:
         identifier: us.mappings.buyNow.closeButton

  # Function to return to home page
  - name: us.functions.closeBuyNowOrderConfirmation.goToHomeScreen
    platform: android
    flow:
    - click:
         identifier: us.mappings.buyNow.continueButton
    # Close buy now order confirmation page
    - click:
         identifier: us.mappings.item.closeItemDetailsPage
    # Close item detail page
    - click:
         identifier: us.mappings.global.navigation.backNavigationToShop
    # Click on shop tab to return to home page

  # Function to add credit card details
  - name: us.functions.buyNow.paymentMethod.addCardDetails
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - click:
          identifier: us.mappings.buyNow.payWithField
          wait: 5000
      - if:
          identifier:
            present:
              - identifier:  us.mappings.accounts.wallet.addCreditDebitCardLink
          then:
            - click:
                identifier: us.mappings.accounts.wallet.addCreditDebitCardLink
      # - click:
      #     identifier: us.mappings.accounts.wallet.addCreditDebitCardLink
      #     wait: 5000
      - sleep:
          duration: 3000
      - executeFunction:
          name: us.functions.account.paymentMethod.addCardDetailsBuyNow
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.continueButton
          wait: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.addCard.preferredAddress.checkBox
          then:
            - getString:
                identifier: us.mappings.buyNow.addCard.preferredAddress.checkBox
                attribute: checked
                storeIn: addrChkBox
            - if:
                condition: ${addrChkBox} == false
                then:
                  - click:
                      identifier: us.mappings.buyNow.addCard.preferredAddress.checkBox
                      wait: 3000
            - click:
                identifier: us.mappings.buyNow.addPayment.saveButton
                wait: 3000
          else:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buynow.savedaddress.btn
                then:
                    - click:
                        identifier: us.mappings.buyNow.deliverToAddAnAddressText
                        wait: 3000
                    - enterText:
                        identifier: us.mappings.paymentMethod.addPayment.overlay.streetAddressField
                        string: ${streetAddress}
                        pressEnter: true
                    - goBack: true
                    - enterText:
                        identifier: us.mappings.paymentMethod.addPayment.overlay.cityField
                        string: ${city}
                        pressEnter: true
                    - goBack: true
                    - enterText:
                        identifier: us.mappings.paymentMethod.addPayment.overlay.stateDropdown
                        string: ${state}
                        pressEnter: true
                    - goBack: true
                    - enterText:
                        identifier: us.mappings.paymentMethod.addPayment.overlay.zipCodeField
                        string: ${zipcode}
                        pressEnter: true
                    - goBack: true
                    
                    - scroll:
                        direction: down
                        untilIdentifier: us.mappings.buyNow.addPayment.saveButton
      - sleep:
          duration: 10000
      - verifyIdentifier:
         present: 
           - identifier: us.mappings.buyNow.deliverToAddAnAddressText
    #   - click:
    #       identifier: us.mappings.buyNow.deliverToAddAnAddressText
    #       wait: 3000
    #   #Click on add an address module in buy now overlay
    #   - click:
    #       identifier: us.mappings.buyNow.selectAddress.saveButton
    #       wait: 3000
      #Click on continue button on Add an address page
      - click:
           identifier: us.mappings.buyNow.placeOrderButton
           wait: 3000
      #Click on place order button on buy now overlay
      # - if:
      #     identifier:
      #       notPresent:
      #         - identifier: continueButton
      #     then:
      #       - click:
      #           identifier: us.mappings.buyNow.placeOrderButton
           

  # Function to add delivery address details
  - name: us.functions.buyNow.deliveryAddress.addAddress
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration : 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.buyNowButton
          then:
            - click:
                identifier: us.mappings.buyNow.buyNowButton
                wait: 3000
      - click:
          identifier: us.mappings.buyNow.deliverToAddAnAddressText
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.addAddress.title.text
      - enterText:
          identifier: us.mappings.buyNow.addAddress.firsNameField
          string: ${firstName}
      - click:
          identifier: us.mappings.buyNow.addAddress.lastNameField
      - enterText:
          identifier: us.mappings.buyNow.addAddress.lastNameField
          string: ${lastName}
    #   - click:
    #         identifier: us.mappings.buyNow.addAddress.firsNameField
      - goBack: true
      - click:
          identifier: us.mappings.buyNow.addAddress.streetAddressField
      - sleep:
          duration: 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.deliveryAddress.add.sharePreciseLocation
          then:
            - click:
                identifier: us.mappings.deliveryAddress.add.sharePreciseLocation
      - executeFunction:
          name: us.functions.denyLocationPermissions
      - sleep:
          duration : 10000
      - enterText:
          identifier: us.mappings.buyNow.addAddress.streetAddressField
          string: ${streetAddress}
      - goBack: true
    #   - enterText:
    #       identifier: us.mappings.buyNow.addAddress.cityField
    #       string: ${city}
    #   - goBack: true
    #   - enterText:
    #       identifier: us.mappings.buyNow.addAddress.stateField
    #       string: ${state}
    #   - goBack: true
    #   - enterText:
    #       identifier: us.mappings.buyNow.addAddress.zipCodeField
    #       string: ${zipcode}
      - if:
          identifier:
            present:
              - identifier: us.mappings.addAddress.selectaddress.sugesstions
          then:
            - click:
                identifier: us.mappings.addAddress.selectaddress.sugesstions
          else:
            - enterText:
                identifier: us.mappings.buyNow.addAddress.cityField
                string: ${city}
            - goBack: true
            - enterText:
                identifier: us.mappings.buyNow.addAddress.stateField
                string: ${state}
            - goBack: true
            - enterText:
                identifier: us.mappings.buyNow.addAddress.zipCodeField
                string: ${zipcode}
            - goBack: true
            - sleep:
                duration: 2000
      - click:
          identifier: us.mappings.buyNow.addAddress.phoneNumberField
      - enterText:
          identifier: us.mappings.buyNow.addAddress.phoneNumberField
          string: ${phoneNumber}
          clickFirst: true
      - goBack: true
      - scroll:
          direction: down
          untilIdentifier: us.mappings.buyNow.addAddress.save.button
      - click:
          identifier: us.mappings.buyNow.addAddress.SetAsMyPreferredAddress.checkbox
      - click:
          identifier: us.mappings.buyNow.addAddress.save.button
          wait: 3000
         
  - name: us.functions.denyLocationPermissions
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.addAddress.permission.denyButton
          then:
            - click: 
                identifier: us.mappings.addAddress.permission.denyButton
                wait: 1000
  # Function to input delivery address details
  - name: us.functions.buyNow.noAddress.addDeliveryAddress
    platform: android
    flow:
      - executeFunction:
          name: us.functions.buyNow.deliveryAddress.addAddress
          params:
            - name: firstName
              string: ${firstName}
            - name: lastName
              string: ${lastName}
            - name: streetAddress
              string: ${streetAddress}
            - name: city
              string: ${city}
            - name: state
              string: ${state}
            - name: zipcode
              string: ${zipcode}
            - name: phoneNumber
              string: ${phoneNumber}

  # Function to click on product buy now button           
  - name: us.functions.buyNow.newUser.overlay.verify
    platform: android
    flow:
      - sleep:
          duration: 20000
      - verifyIdentifier:
          timeout: 250000
          present:
            - identifier: us.mappings.buyNow.buyNowButton
      #click on buy now button
      - click:
          identifier: us.mappings.buyNow.buyNowButton
          wait: 30000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.arrivingText
            - identifier: us.mappings.buyNow.deliverToAddAnAddressText
            # - identifier: us.mappings.buyNow.payWithText
            - identifier: us.mappings.buyNow.estimatedTotalText
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.buyNow.placeOrderButton
          then:
            - scroll:
                direction: down
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.buyNow.placeOrderButton
      - sleep:
          duration: 20000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.walmartPlusBannerContainer
          then:
            - verifyIdentifier:
                present :
                  - identifier: us.mappings.buyNow.VerifyWalmartPlusBanner
                  - identifier: us.mappings.buyNow.verifyCheckoutboxTry+forfreefor30days
                  - identifier: us.mappings.buyNow.verifyWantToSkip$6.99OrderMinfee?
      - sleep:
          duration: 20000
            
  # Function to place order after adding address and payments        

  - name: us.functions.buynow.guestUser.placeOrder
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.buyNow.placeOrderButton
      - click:
           identifier: us.mappings.buyNow.placeOrderButton
           wait: 5000
      - verifyIdentifier:
           timeout: 90000
           present:
              - identifier: us.mappings.buyNow.thankYouTitle
              - identifier: us.mappings.buyNow.orderNumberLabel
              - identifier: us.mappings.buyNow.continueButton
      
      #Click on place order button on buy now overlay

  # Function to apply the associate discount when prompted after tapping BuyNow  #Joel 2/15/22
  - name: us.functions.buyNow.associateDiscountPrompt.applyDiscount
    platform: android
    flow:
      - click:
          identifier: us.mappings.buyNow.buyNowButton
          wait: 6000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNowUnavailableAlert
          then:
            - log: Buy Now button is unavailable
            - click:
                identifier: us.mappings.buyNowUnavailableAlert.okay
            - sleep:
                duration: 2000
            - log: Clicking on Buy Now button again
            - click:
                identifier: us.mappings.buyNow.buyNowButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNowUnavailableAlert.okay
                then:
                  - log: Buy Now button is unavailable on second try
                  - failTest:
                      message: "FAILURE - ${env} - Buy now unavailable "  
      - if:
          identifier:
            present:
              - identifier: us.mappings.associateDiscount.pageTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.associateDiscount.pageTitle
                  - identifier: us.mappings.associateDiscount.applyAssociateDiscount
                  - identifier: us.mappings.associateDiscount.doNotAppyAssociateDiscount
                  - identifier: us.mappings.associateDiscount.VerifyDiscountpolicyArrow
            - click:
                identifier: us.mappings.associateDiscount.continueButton
                wait: 6000
            - sleep:
                duration: 4000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.associateDiscount.continueButton
                then:
                    - click:
                        identifier: us.mappings.associateDiscount.continueButton
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.buyNow.placeOrderButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.buynow.pleaseAddYourAddressButton
          then:
            - click:
                identifier:  us.mappings.buynow.pleaseAddYourAddressButton
            - executeFunction:
                name: us.functions.reserveSlot.fcormpselectaddressandcontinue  
      - verifyIdentifier:
          timeout: 100000
          present:
            - identifier: us.mappings.buyNow.arrivingText
            - identifier: us.mappings.buyNow.deliverToAddAnAddressText
            - identifier: us.mappings.buyNow.payWithText
            - identifier: us.mappings.buyNow.estimatedTotalText
            - identifier: us.mappings.buyNow.placeOrderButton
           # - identifier: us.mappings.buynow.includesFeeBelow35

  # Function to view the Estimate total sheet, associate discount and Below minimum fee for BuyNow Eligibility  #Joel 2/15/22
  - name: us.functions.buyNow.estTotal.associateDiscount.buyNowEligibility.text
    platform: android
    flow:          
      - click:
          identifier: us.mappings.buyNow.estimatedTotalText
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.associateDiscount.checkout.posAssociateDiscountLabel
            - identifier: us.mappings.associateDiscount.checkout.posAssociateDiscountValueLabel
           # - identifier: us.mappings.reviewOrder.POS.threshold
           # - identifier: us.mappings.buynow.estTotal.belowMin.titleText
      - verifyIdentifier:
          present:            
            - identifier: us.mappings.reviewOrder.subtotalPricelabel
            - identifier: us.mappings.buynow.estTotal.total.titleText
            - identifier: us.mappings.buynow.estTotal.subTotal.titleText
            #- identifier: us.mappings.buynow.estTotal.belowMin.titleText
            - identifier: us.mappings.buynow.estTotal.estTaxes.titleText
            - identifier: us.mappings.buynow.estTotal.estTotalPOS.titleText
            - identifier: us.mappings.reviewOrder.orderTotalAmount
      - executeFunction:
            name: us.functions.global.navigation.backNavigation

  #Function to Verify Est total Text String when under $35 and then Above $35 threshold.  #Joel 2/15/22
  - name: us.functions.buyNow.estTotal.buyNowEligibility.belowAndAbove.includesText
    platform: android
    flow:         
      - verifyIdentifier:
          present:            
            - identifier: us.mappings.buynow.includesFeeBelow35
            - identifier: us.mappings.buynow.includesFeeBelow35.textString
      - click:
          identifier: us.mappings.cart.increaseQty
          wait: 3000
      - loop:
         begin: 0
         end: 5
         storeIndex: i
         flow:
           - log: $i
           - click:
               identifier: us.mappings.cart.increaseQty
               wait: 3000
           - if:
              identifier:
                notPresent:
                  - identifier: us.mappings.buynow.includesFeeBelow35
              then:
                - break: true      
      - if:
          identifier:
            notPresent: 
              - identifier: us.mappings.buynow.includesFeeBelow35
          then:          
              - verifyIdentifier:
                  timeout: 20000                    
                  present:            
                    - identifier: us.mappings.buynow.includesFeeAbove35.textString
                    - identifier: us.mappings.buynow.estTotal.aboveMin.includes.titleText
              - log: Price is now over $35 Threshold on first attempt                                                         
          else:
              - log: Price is still under $35 Threshold, Attempt to increase qty again.
              - click:
                  identifier: us.mappings.cart.increaseQty
                  wait: 3000
              - verifyIdentifier:
                  timeout: 20000
                  present:            
                    - identifier: us.mappings.buynow.includesFeeAbove35.textString
                    - identifier: us.mappings.buynow.estTotal.aboveMin.includes.titleText
              - log: Price is now over $35 Threshold on second attempt                                         

        
  #Function for Placing order through buy now flow with CVV and Associate Discount
  - name: us.functions.buyNow.placeOrder.buyNow.associateDiscount.eligibility  #Joel 2/15/22
    platform: android
    flow:
      - if:
          identifier:
            present: 
              - identifier: us.mappings.buyNow.addCard.securityCodeField
          then:          
              - log: CVV field is Prompting user for Buy Now          
              - verifyIdentifier:
                  present:            
                    - identifier: us.mappings.buyNow.addCard.securityCodeField
              - enterText:
                  identifier: us.mappings.buyNow.addCard.securityCodeField
                  string: ${cvv}
          else:
            - log: CVV field is Not Prompting user for Buy Now
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.buyNow.enterYourCvv
                then:
                  - click:
                      identifier: us.mappings.buyNow.enterYourCvv
                  - verifyIdentifier:
                      present:            
                        - identifier: us.mappings.buyNow.addCard.securityCodeField
                  - enterText:
                      identifier: us.mappings.buyNow.addCard.securityCodeField
                      string: ${cvv}
                  - click:
                      identifier: us.mappings.reviewOrder.paymentMethod.continueButton
      - sleep:
          duration: 5000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.buyNow.placeOrderButton
          position: center                        
      - executeFunction:
          name: us.functions.buynow.guestUser.placeOrder
      - sleep:
          duration: 50000
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.buyNow.thankYouTitle
            # - identifier: us.mappings.buyNow.thankYouAlert
            - identifier: us.mappings.buyNow.itemArrivesText
            - identifier: us.mappings.buyNow.continueButton
      - executeFunction:  #Test Here
          name: us.functions.buyNow.orderConfirmation.getOrderNumber
      - log: ${orderNo}            
      - click:
          identifier: us.mappings.buyNow.continueButton
          wait: 3000                

  - name: us.functions.buyNow.newUser.overlay.createNewAccount
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Pre-transactions
      - storeIn:
          key: astroEmail        # remove afrer mobile verification issue get resolved 
          value: "identity-testuser${timestamp}@walmart.com"
#Random phone number some times not working 
      - storeIn:
          key: astroPhoneNumber 
          value: 5678923459
          #5678923456
          #1${__randomUSPhone}
      - sleep:
          duration: 10000
      - verifyIdentifier:
          timeout: 2000
          present:
            - identifier: us.mappings.buyNow.buyNowButton
      - click:
          identifier: us.mappings.buyNow.buyNowButton
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.buyNowUnAvailableMessage
          then:
            - failTest:
                message: "ENV_FAILURE - Buy Now is Not Available Now Message displayed"
      - if:
          identifier:
            present:
              - identifier: us.mappings.account.createAccount.signinAnotherOptions.banner
          then:             
              - click:     
                  identifier: us.mappings.account.createAccount.dismiss.banner           
      - if:
          identifier:
            present:
              - identifier: us.mappings.account.createAccount.userEmailTextField
          then:             
              - enterText:
                  identifier: us.mappings.account.createAccount.userEmailTextField
                  string: ${astroEmail}
                  pressEnter: true
              - goBack: true 
              - click:     
                  identifier: us.mappings.global.authentication.signIn.continueButton   
          else:                                  
            - click:
                identifier: us.mappings.global.authentication.createAccountButton
      - verifyPresent:
          identifier: us.mappings.account.createAccount.firstNameTextField
      - enterText:
          identifier: us.mappings.account.createAccount.firstNameTextField
          string: TestFirst
          pressEnter: true
      - goBack: true
      - enterText:
          identifier: us.mappings.account.createAccount.lastNameTextField
          string: TestLast
          pressEnter: true
      - goBack: true
      - if: 
          identifier:
            present:
              - identifier: us.mappings.account.createAccount.buyNowphoneNumberTextField
          then:             
              - enterText:
                  identifier: us.mappings.account.createAccount.buyNowphoneNumberTextField
                  string: ${astroPhoneNumber}
                  pressEnter: true
              - goBack: true
      - if: 
          identifier:
            present:
              - identifier: us.mappings.account.createAccount.passwordTextField
          then:             
              - enterText:
                  identifier: us.mappings.account.createAccount.passwordTextField
                  string: E2epassword$
                  pressEnter: true
      - click:
          identifier: us.mappings.global.authentication.createAccountButton
      - sleep:
          duration: 5000
   
      - if:
          identifier:
            present:
              - identifier: us.mappings.global.authentication.accountVerificationEmail.text
          then:
            - executeFunction:
                name : us.functions.utils.astro.fetchPasscode.emailOTP      
                params:
                  - name: email
                    string: ${astroEmail}
            - log: "The OTP generated is: "
            - log: ${otpFromEmail}
            - log: "The Request Verification Code button is clicked"
            - verifyIdentifier:
                    present:
                    - identifier: us.mappings.global.authentication.signIn.textBoxForOTP
            - enterText:
                    identifier: us.mappings.global.authentication.signIn.textBoxForOTP
                    string: ${otpFromEmail}
            - log: "Entered the OTP form Customer's email"
            - click:
                    identifier: us.mappings.global.authentication.signInButton
            - sleep:
                    duration: 5000 
      - if:
          identifier:
            present:
              - identifier: us.mappings.global.authentication.enterVerificationCode.text
          then:
            - storeIn:
                key: astroPhoneNumber 
                value: 15678923459
            - executeFunction:
                name : us.functions.authentication.verifyPhoneOTP
                params:
                  - name: email
                    string: ${astroEmail}
                  - name: phone
                    string: ${astroPhoneNumber}                          
            - executeFunction:
                name: us.functions.utils.handleTechnicalErrorPopup
            - verifyNotPresent:
                identifier: us.mappings.global.authentication.createAccountButton
      - executeFunction:
          name: us.functions.utils.handleCartMergePopup

  - name: us.functions.buyNow.editCard.verifyBuyNowEligibility               # modified on 17th March 2021
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buyNow.payWithField
          wait: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.wallet.title
      - verifyIdentifier:
          label:
            - identifier: us.mappings.buyNow.verifyEBTEligibility
              contains: EBT is not available for buy now.
      - verifyIdentifier:
         visible:
           - identifier: EBTCardView.selectionButton
             value: false
  
  - name: us.functions.buyNow.editCard.verifyBuyNowEligibility               # modified on 17th March 2021
    platform: android
    flow:
      - click:
          identifier: us.mappings.buyNow.payWithField
          wait: 3000
      - verifyIdentifier:
          text:
            - identifier: us.mappings.buyNow.buyNowTitle
              equals: us.data.buynow.textWallet
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.verifyEBTEligibility
      - verifyIdentifier:
          enabled:
            - identifier: us.mappings.buyNow.verifyEBTSelectionButton
              value: false
              
  - name: us.functions.buyNow.editCard.navigateback               
    platform: android
    flow:
      - click:
          identifier: us.mappings.buyNow.navigateback
          wait: 3000  

  - name: us.functions.buyNow.editCard.navigateback               
    platform: ios
    flow:
      - click:
          identifier: us.mappings.buyNow.navigateback
          wait: 3000

  - name: us.functions.buyNow.itemScreen.selectWplusCheckBox               
    platform: ios
    flow:
     - if:
          identifier:
            present:
              - identifier:  us.mappings.buyNow.itemScreen.wplusCheckBox
          then:
            - click:
                identifier:   us.mappings.buyNow.itemScreen.wplusCheckBox
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string:  us.mappings.buyNow.itemScreen.wplusCheckBox     
                  - name: direction
                    string: down       
            - click:
                identifier: us.mappings.buyNow.itemScreen.wplusCheckBox


  - name: us.functions.buyNow.itemScreen.selectWplusCheckBox               
    platform: android
    flow:
     - if:
          identifier:
            present:
              - identifier:  us.mappings.buyNow.itemScreen.wplusCheckBox
          then:
            - click:
                identifier:   us.mappings.buyNow.itemScreen.wplusCheckBox
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string:  us.mappings.buyNow.itemScreen.wplusCheckBox     
                  - name: direction
                    string: down       
            - click:
                identifier: us.mappings.buyNow.itemScreen.wplusCheckBox
          