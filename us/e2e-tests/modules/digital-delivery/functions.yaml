functions:

################################################### iOS ###################################################

  - name: us.functions.digital-delivery.verifyReturnsScreenDigital
    platform: iOS
    flow:
      - click:
          identifier: us.mappings.orderDetails.startReturnButton
      - sleep:
          duration: 3000   
      - if:
          identifier:
            present:
              - identifier: us.mappings.digitalDelivery.verifyNotReturnEligibilityText  
          then:
            - log: "Return eligibility text displayed"    
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Expected the return eligibility text but not displayed"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.digitalDelivery.verifyNotReturnEligibilityText
      - sleep:
          duration: 3000

  - name: us.functions.digital-delivery.navigateToSignInScreen
    platform: iOS
    flow:
      - click:
          identifier: us.mappings.home.signInButton

  - name: us.functions.digital-delivery.verifyCheckoutScreen
    platform: iOS
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.checkoutScreenHeader
      - click:
          identifier: us.mappings.cartMigration.cartHeaderMessageView
      - click:
          identifier: us.mappings.digitalDelivery.ItemDetailsCloseButton
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
      - enterText:
          identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
          string: 6312556017
      - click:
          identifier: us.mappings.default.keyboardDoneButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.digitalDelivery.CVVText
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.enterCvv
            - click:
                identifier: us.mappings.reviewOrder.enterCvv
            - enterText:
                string: 111
                identifier: us.mappings.reviewOrder.enterCvv
            - click:
                identifier: us.mappings.default.keyboardDoneButton
            - sleep:
                duration: 3000
            # - click:
            #     identifier: us.mappings.reviewOrder.placeOrderButton
          # else:
          #   - click:
          #       identifier: us.mappings.reviewOrder.placeOrderButton

  - name: us.functions.digital-delivery.verifyOrderConfirmationScreen
    platform: iOS
    flow:
      - sleep:
          duration: 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfrimation.ratings.notNowButton
          then:
            - click:
                identifier: us.mappings.orderConfrimation.ratings.notNowButton
            - executeFunction:
                name: us.functions.digital-delivery.verifyOrderConfirmationScreenSections
          else:
            - executeFunction:
                name: us.functions.digital-delivery.verifyOrderConfirmationScreenSections

  - name: us.functions.digital-delivery.verifyOrderConfirmationScreenSections
    platform: iOS
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.digitalDelivery.fulfilmentTypeDigital
          then:
            - log: "Order confirmation screen for digital order displayed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Order confirmation screen for digital orders not displayed correctly"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.thankYouPageHeader
            - identifier: us.mappings.digitalDelivery.fulfilmentTypeDigital
            - identifier: us.mappings.digitalDelivery.fulfilmentSpeedDigital

  - name: us.functions.digital-delivery.getOrderNumber
    platform: iOS
    flow:
      - sleep:
          duration: 300000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.orderNumber
      - getString:
          identifier: us.mappings.orderConfirmation.orderNumber
          extractNumbers: true
          storeIn: orderNo
      - log: ${orderNo}

  - name: us.functions.digital-delivery.getOrderNumberForCancellation
    platform: iOS
    flow:
      # - click:
      #     identifier: us.mappings.orderConfrimation.ratings.notNowButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.orderNumber
      - getString:
          identifier: us.mappings.orderConfirmation.orderNumber
          extractNumbers: true
          storeIn: orderNo
      - log: ${orderNo}
      - scroll:
          direction: down
          untilIdentifier: us.mappings.pgc.feedbackLabel
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.continueButton
          then:
           - click:
               identifier: us.mappings.buyNow.continueButton
          else:
            - click:
                identifier: us.mappings.orderConfirmation.closeButton    

##################################################### Android ########################################################

  - name: us.functions.digital-delivery.navigateToSignInScreen
    platform: android
    flow:
      - click:
          identifier: us.mappings.home.signInButton

  - name: us.functions.digital-delivery.searchFor3PeGiftCardAndSelect
    platform: android
    flow:
      - click:
          identifier: us.mappings.home.searchBar
      - enterText:
          identifier: us.mappings.home.searchBar
          string: "eGift Cards"
          pressEnter: true
      - click:
          identifier: us.mappings.digitalDelivery.3PeDiftCardItem
      - click:
          identifier: us.mappings.item.atcButton
  
  - name: us.functions.digital-delivery.closeTheBottomSheet
    platform: android
    flow:
      - click:
          identifier: us.mappings.global.authentication.signIn.closeButton

  - name: us.functions.digital-delivery.addToCart
    platform: android
    flow:
      - click: 
          identifier: us.mappings.item.atcButton

  - name: us.functions.digital-delivery.verifyCheckoutScreen
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.checkoutScreenHeader
      - click:
          identifier: us.mappings.digitalDelivery.viewDetailsButton
      - executeFunction:
          name: us.functions.digital-delivery.closeTheBottomSheet
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.mobileContact.phoneNumberField   
      - enterText:
          identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
          string: 6312556017
          pressEnter: true
      - goBack: true

  - name: us.functions.digital-delivery.verifyOrderConfirmationScreen
    platform: android
    flow:
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.digitalDelivery.thankYouPageHeader
            - identifier: us.mappings.digitalDelivery.fulfilmentTypeDigital
            - identifier: us.mappings.digitalDelivery.fulfilmentSpeedDigital

  - name: us.functions.digital-delivery.getOrderNumber
    platform: android
    flow:
      - sleep:
          duration: 300000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.orderNumber
      - getString:
          identifier: us.mappings.orderConfirmation.orderNumber
          extractNumbers: true
          storeIn: orderNo
      - log: ${orderNo}

  - name: us.functions.digital-delivery.getOrderNumberForCancellation
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.orderNumber
      - getString:
          identifier: us.mappings.orderConfirmation.orderNumber
          extractNumbers: true
          storeIn: orderNo
      - log: ${orderNo}

  - name: us.functions.digital-delivery.verifyOrderDetailsPageDigital
    platform: android
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.orderDetails.orderNumber
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.fulfilmentTypeDigital
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.arrivingSoonText
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.digitalDelivery.progressBar
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.emailAddressHeader
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.deliveryInstructionsNonDTU
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.digitalDelivery.editButtonDigital
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.digitalDelivery.editButtonDigital
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.editButtonDigital
      - scroll:
          direction: down
          untilIdentifier: us.mappings.digitalDelivery.subTotalDigital

  - name: us.functions.digital-delivery.navigateToOrderDetails
    platform: android
    flow:
      - click:
          identifier: us.mappings.tabBar.account
      - click:
          identifier: us.mappings.account.purchaseHistoryButton
      - click:
          identifier: us.mappings.digitalDelivery.firstOrder

  - name: us.functions.digital-delivery.verifyReturnsScreenDigital
    platform: android
    flow:
      - click:
          identifier: us.mappings.orderDetails.startReturnButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.digitalDelivery.verifyNotReturnEligibilityText  
          then:
            - log: "Return eligibility text displayed"    
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Expected the return eligibility text but not displayed"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.digitalDelivery.returnEligibilityText

  - name: us.functions.digital-delivery.verifyEditOrderFlow
    platform: android
    flow:
      - sleep:
          duration: 15000
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/${orderNo}
      - scroll:
          direction: down
          untilIdentifier: us.mappings.digitalDelivery.editButtonDigital
      - click:
          identifier: us.mappings.digitalDelivery.editButtonDigital
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.digitalDelivery.DTUText
      - click:
          identifier: us.mappings.global.navigation.backNavigation

  - name: us.functions.digital-delivery.addItemsToCart
    platform: android
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: us.data.flow035.itemId.softwares

      - executeFunction:
          name: us.functions.item.addItemToCart
