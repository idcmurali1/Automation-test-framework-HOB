
functions:

  - name: us.functions.orderConfirmation.scheduledDelivery.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - sleep:
          duration: 10000
      - executeFunction:
          name: us.functions.orderConfirmation.ratings
      - if:
          identifier: 
            present:
              - identifier: us.mappings.orderConfirmation.thankYouCopy
          then:
            - log: "Order confirmation page displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Order Confirmation Screen not displayed correctly"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.scheduledDelivery.cardTitle

  - name: us.functions.orderConfirmation.expressDelivery.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
      - verifyIdentifier:
          label:
            - identifier: us.mappings.orderConfirmation.scheduledDelivery.cardTitle
              contains: Delivery from store
            - identifier: us.mappings.orderConfirmation.expressDelivery.slotTime
              contains: Estimated arrival
            - identifier: us.mappings.orderConfirmation.amendsBanner
              contains: seconds left to add items to your order

#Verify unScheduledPickup confirmation
  - name: us.functions.orderConfirmation.pickup.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - sleep:
          duration: 10000
      - executeFunction:
          name: us.functions.orderConfirmation.ratings
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.pickup.cardTitle
          then:
            - log: "Pick up order confirmation screen is displayed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Pick up order confirmation screen not displayed as expected"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber

  - name: us.functions.orderConfirmation.ratings
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfrimation.ratings.notNowButton
          then:
              - click:
                  identifier: us.mappings.orderConfrimation.ratings.notNowButton

  - name: us.functions.orderConfirmation.lowInStockPopUp
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfrimation.lowInStockLabel
          then:
              - click:
                  identifier: us.mappings.orderConfrimation.lowInStockMaybeLaterButton


  - name: us.functions.orderConfirmation.mixedOrder.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            - identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
      - executeFunction:
          name: us.functions.orderConfirmation.fcDeliveryAddressInformation

  # Verify FC delivery order confirmation
  - name: us.functions.orderConfirmation.fcDelivery.verifyOrderConfirmationScreen
    flow:
      - sleep:
          duration: 10000
      - executeFunction:
          name: us.functions.orderConfirmation.ratings
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            # - identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryEstimate
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryAddress
            - identifier: us.mappings.orderConfirmation.itemsCount
            # - identifier: us.mappings.orderConfirmation.items

  - name: us.functions.orderConfirmation.mixedOrder.fcDeliveryAndScheduledDelivery.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            - identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryAddress
            - identifier: us.mappings.orderConfirmation.scheduledDelivery.cardTitle

  - name: us.functions.orderConfirmation.mixedOrder.fcDeliveryAndPickup.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - sleep:
          duration: 10000
      - executeFunction:
          name: us.functions.orderConfirmation.ratings
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            # - identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            # - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.pickup.cardTitle
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryAddress

  # [mandatory] ${fulfillmentText} - Shipping/Curbside pickup/Delivery from store/Digital delivery ... [Required to scroll to the appropriate cart fulfillment section]
  - name: us.functions.orderConfirmation.scrollToSection
    platform: ios
    flow:
      # Validate if Order number is displayed
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.orderNumber
      - log: Scroll to top of OrderConfirmation page and skip if page top is already displayed
      # Scroll up until top section fulfillment type
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderConfirmation.orderNumber
            - name: direction
              string: up
      - log: Scroll to specific fulfillment type section and skip if it is already visible on screen
      - log: Scrolling to Fulfillment section ${fulfillmentText}
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentTypeText
            - name: direction
              string: down
            - name: scrollPosition
              string: center

  # Utility to validate order confirmation details for any fulfillment type
  # [mandatory] ${fulfillmentText} - Shipping/Delivery from store/Curbside pickup/Digital delivery/Auto Care... [Required for identifying fulfillment section to be validated]
  # [optional]  ${unscheduled}     - true/false [default false] [Set to true if unscheduled item fulfillment time needs to be validated]
  # [optional]  ${expressSlot}     - true/false [default false] [Set to true if express slot fulfillment time needs to be validated]
  - name: us.functions.orderConfirmation.verifyCardDetails
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - executeFunction:
          name: us.functions.utils.getFulfillmentTextsToCompare

      - log: -----------${fulfillmentText} section validation start-----------
      # Main validation
      - if:
          condition: ${OCMainValidated} == null
          then:
            - sleep:
                duration: 5000
            # Validate if Order number is displayed
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.orderNumber
            - storeIn:
                key: OCMainValidated
                value: complete
          else:
            - log: Order confirmation headers already validated. Validating fulfillment section now

      # This section is used to set viewType required for specific fulfillment section detail identifications
      - if:
          condition: ${fulfillmentText} == 'Curbside pickup'
          then:
            - storeIn:
                key: viewType
                value: Pickup
          else:
            - if:
                condition: ${fulfillmentText} == 'pickup' || ${fulfillmentText} == 'Pickup' || ${fulfillmentText} == 'Retiro'
                then:
                  - storeIn:
                      key: viewType
                      value: Pickup
                else:
                  - if:
                      condition: ${fulfillmentText} == 'Auto Care'
                      then:
                        - storeIn:
                            key: viewType
                            value: AutoCareCenter
                      else:
                        - if:
                            condition: ${fulfillmentText} == 'Digital delivery'
                            then:
                              - storeIn:
                                  key: viewType
                                  value: DigitalDelivery
                            else:
                              - storeIn:
                                  key: viewType
                                  value: Delivery

      - log: Validating fulfillment section ${fulfillmentText}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentTypeText
      - log: Validated basic fulfillment details 
      - if:
          condition: ${fulfillmentText} != 'Digital delivery'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentTime
                  # - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentName
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAddress
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentItemCount
            - log: Validated fulfillment time, name, adrress and item count details

      - if:
          condition: ${fulfillmentText} == 'Curbside pickup'
          then:
            - if:
                condition: ${unscheduled}
                then:
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentTime
                          contains: Anytime after
                  - log: Validated unscheduled fulfillmentTime text
                else:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendIcon
                        - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendMessage
                  - log: Validated fulfillment amend details

      - if:
          condition: ${fulfillmentText} == 'Delivery from store'
          then:
            - if:
                condition: ${expressSlot}
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentTime
                  - log: Validated express slot fulfillmentTime text
                else:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendIcon
                        - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendMessage
                  - log: Validated fulfillment amend details

      - if:
          condition: ${fulfillmentText} == 'Auto Care'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentComment
                label:
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentComment
                    contains: We'll hold your order for 10 days
            - log: Validated fulfillment hold comment

      - if:
          condition: ${fulfillmentText} == 'Digital delivery'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.digitalFulfillmentComment
                label:
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.digitalFulfillmentComment
                    contains: Arrives soon after purchase
            - log: Validated fulfillment time comment

      - storeIn:
          key: altFulfillmentText
          value: 'null'
      - log: -----------${fulfillmentText} section validation end-------------

  # Get order number for order placed
  - name: us.functions.orderConfirmation.getOrderNumber
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfrimation.ratings.notNowButton
          then:
            - click:
                identifier: us.mappings.orderConfrimation.ratings.notNowButton
      - getString:
          identifier: us.mappings.orderConfirmation.orderNumber
          extractNumbers: true
          storeIn: orderNo
      - sleep:
          duration: 10000

  - name: us.functions.orderConfirmation.orderCreationValidation
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.orderNumber
          then:
            - log: Order created successfully
          else:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.orderConfrimation.ratings.notNowButton
                then:
                  - log: Order created successfully
                else:
                  - failTest:
                      message: "ENV_FAILURE - ${env} - Order creation error"

  - name: us.functions.orderConfirmation.goToHomeScreen
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.closeButton

  - name: us.functions.orderConfirmation.closeOrderConfirmation
    flow:
      - if:
          identifier:
            timeout: 6000
            present:
              - identifier: us.mappings.orderConfirmation.closeButton
          then:
              - click:
                  identifier: us.mappings.orderConfirmation.closeButton
          else:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderConfirmation.ContinueShoppingButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.ContinueShoppingButton
            - click:
                identifier: us.mappings.orderConfirmation.ContinueShoppingButton
            # - executeFunction:
            #     name: us.functions.wplus.switchToOriginalAppTileClose
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.tabBar.shop
                  - name: direction
                    string: up
            - click:
                identifier: us.mappings.tabBar.shop

  - name: us.functions.orderConfirmation.fcDelivery.validation
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle

  - name: us.functions.orderConfirmation.verifyAssociateDiscountLabel
    platform: ios
    flow:
      - if:
          condition: ${associateDiscountApplied}
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.associateDiscountLabel

  # Verify digital delivery order confirmation details
  - name: us.functions.orderConfirmation.digitalDelivery.verifyOrderConfirmationScreen
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfrimation.digitalDelivery.cardTitle
          then:
            - log: "Digital delivery order confirmation screen displayed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Digital delivery order confirmation screen is not displayed as expected"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfrimation.digitalDelivery.deliveryTime

  - name: us.functions.orderConfirmation.verifyEBTDetailsDisplay
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.EBTBalanceTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.EBTBalanceTitle
            - identifier: us.mappings.orderConfirmation.EBTBalanceText
          label:
            - identifier: us.mappings.orderConfirmation.EBTBalanceTitle
              contains: "EBT Balance"
            - identifier: us.mappings.orderConfirmation.EBTBalanceText
              contains: "Food balance"
            - identifier: us.mappings.orderConfirmation.EBTBalanceText
              contains: "Cash balance"

  - name: us.functions.orderConfirmation.verifyMarketplaceSection
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.marketplacePickupText
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText
          position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText
          then:
            - log: "Marketplace section displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Expected Market place section but it is not displayed"
      # - verifyIdentifier:
      #     present:   
      #       - identifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText
            # - identifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText2 # commented due to non availablility of instruction text.

  - name: us.functions.orderConfirmation.verifypromodiscount
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.promoSavedLabel
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.promoSavedLabel
          else:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.orderConfirmation.promoDiscounttext
                then:
                    - scroll:
                        direction: up
                        untilIdentifier: us.mappings.orderConfirmation.promoDiscounttext
                    - verifyIdentifier:
                        value:
                          - identifier: us.mappings.orderConfirmation.promoDiscounttext
                            contains: ${promocode} promo code
                else: 
                  - verifyIdentifier:
                      value:
                        - identifier: us.mappings.orderConfirmation.promoDiscounttext
                          contains: ${promocode} promo code
                    
  - name: us.functions.checkout.orderConfirmation.verifyTotalAmountForDonation
    platform: ios
    flow:
      - sleep:
          duration: 10000
      - executeFunction:
          name: us.functions.orderConfirmation.ratings
      - verifyIdentifier:
          label:
            - identifier: us.mappings.orderConfirmation.orderTotalAmount
              contains: ".00"

  - name: us.functions.orderConfirmation.gift.verifyGiftDetails
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderconfirmation.gifting.giftDetailsMessage
      - sleep:
          duration: 2000          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderconfirmation.gifting.giftDetailsTitle
            - identifier: us.mappings.orderconfirmation.gifting.giftDetailsTo
            - identifier: us.mappings.orderconfirmation.gifting.giftDetailsSender
            - identifier: us.mappings.orderconfirmation.gifting.giftDetailsMessage

  - name: us.functions.orderConfirmation.wPlusCloseOrderConfirmation
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.wplus.orderConfirmation.walmartPlusHeaderLabel
            - identifier: us.mappings.wplus.orderConfirmation.walmartPlusCardBannerButton
      - if:
          identifier:
            timeout: 6000
            present:
              - identifier: us.mappings.orderConfirmation.closeButton
          then:
              - click:
                  identifier: us.mappings.orderConfirmation.closeButton
          else:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderConfirmation.ContinueShoppingButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.ContinueShoppingButton
            - click:
                identifier: us.mappings.orderConfirmation.ContinueShoppingButton
            - click:
                identifier: us.mappings.tabBar.shop

########################################## Android ######################################################################

  - name: us.functions.orderConfirmation.verifyMarketplaceSection
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.marketplacePickupText
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText
          position: center
      - verifyIdentifier:
          present:   
            - identifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText
            - identifier: us.mappings.orderConfirmation.marketplacePickup.pickupInstructionsText2
      

  # [mandatory] ${fulfillmentText} - Shipping/Curbside pickup/Digital delivery ... [Required to scroll to the appropriate orderConfirmation fulfillment section]
  - name: us.functions.orderConfirmation.scrollToSection
    platform: android
    flow:
      - log: -------Scroll to ${fulfillmentText} section start-------
      # Wait until the order confirmation screen is loaded
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon
      # Get top section fulfillment type text from order confirmation page and save to 'firstOCSection' variable
      - log: Scroll to top of order confirmation page
      - if:
          condition: ${firstOCSection} == null
          then:    
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.orderConfirmation.fulfillmentTopSection.fulfillmentTypeText
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center     
            # Store the fulfillment details text for top section
            - getString:
                identifier: us.mappings.orderConfirmation.fulfillmentTopSection.fulfillmentTypeText
                attribute: text
                storeIn: firstOCSection
            - log: ${firstOCSection}
      # Scrolls to top of orderConfirmation screen before scrolling to specific section
      - log: Scroll to top of order confirmation page
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.orderNumber
              #us.mappings.orderConfirmation.fulfillmentFirstSection.fulfillmentTypeText
          then:
            - log: Already on top of order confirmation page
          else:
            - log: Scrolling to top of order confirmation page
            - scroll:
                direction: up
                untilIdentifier: us.mappings.orderConfirmation.orderNumber
                #us.mappings.orderConfirmation.fulfillmentFirstSection.fulfillmentTypeText
      # Scrolls to required fulfillment section
      - try:
          flow:
            # Skips scrolling if required section is already displayed
            - log: Skip scrolling if required section is already displayed
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.orderConfirmation.fulfillmentFirstSection.fulfillmentTypeText
                    contains: ${fulfillmentText}
            - log: Required orderConfirmation ${fulfillmentText} fulfillment section already displayed.
          catch:
            flow:
              # Scrolls to appropriate section
              - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: direction
                      string: down
                    - name: identifier
                      string: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentTypeText
                    - name: scrollPosition
                      string: center
              - log: Required orderConfirmation ${fulfillmentText} fulfillment section is scrolled.
      - log: -------Scroll to ${fulfillmentText} section end-------

  # Utility to validate order confirmation details for any fulfillment type
  # [mandatory] ${fulfillmentText} - Shipping/Delivery from store/Curbside pickup/Digital delivery/Auto Care... [Required for identifying fulfillment section to be validated]
  # [optional]  ${unscheduled}     - true/false [default false] [Set to true if unscheduled item fulfillment time needs to be validated]
  # [optional]  ${expressSlot}     - true/false [default false] [Set to true if express slot fulfillment time needs to be validated]
  - name: us.functions.orderConfirmation.verifyCardDetails
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - executeFunction:
          name: us.functions.utils.getFulfillmentTextsToCompare

      - log: -----------${fulfillmentText} section validation start-----------
      # Order no. and title validations
      - if:
          condition: ${OCMainValidated} == null
          then:
            - sleep:
                duration: 5000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.orderConfirmation.navBarTitle
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.navBarTitle
                else:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.home.searchBarSelected
                        - identifier: us.mappings.navBar.cartIcon
            - verifyIdentifier:
                present:
                  # - identifier: us.mappings.orderConfirmation.thankYouCopy
                  - identifier: us.mappings.orderConfirmation.orderNumber
            - storeIn:
                key: OCMainValidated
                value: complete
          else:
            - log: Order confirmation headers already validated. Validating fulfillment section now
      - if:
          condition: ${fulfillmentText} == null
          then:
            - log: Skipping fulfillment section validation as none mentioned
          else:
            - storeIn:
                key: type
                value: ${fulfillmentText}
            - log: Validating fulfillment section ${type}
            - executeFunction:
                name: us.functions.orderConfirmation.scrollToSection
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentItemCount
                  - name: direction
                    string: down                
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentTime
                  - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentItemCount
            - log: Validated basic fulfillment details
            - if:
                condition: ${type} != 'Digital delivery'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentName
                        - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentAddress
                  - log: Validated fulfillment Name and Adrress
 
            - if:
                condition: ${type} == 'Curbside pickup'
                then:
                  - if:
                      condition: ${unscheduled}
                      then:
                        - verifyIdentifier:
                            text:
                              - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentTime
                                contains: us.data.text.anytimeAfter
                        - log: Validated unscheduled fulfillmentTime text
                      else:
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendTimerIcon
                              - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendTimerText
                              - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendAddItemsLink
                        - log: Validated fulfillment Amend option details

            - if:
                condition: ${type} == 'Delivery from store'
                then:
                  - if:
                      condition: ${expressSlot}
                      then:
                        - verifyIdentifier:
                            text:
                              - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentTime
                                contains: or less
                        - log: Validated express slot fulfillmentTime text
                      else:
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendTimerIcon
                              - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendTimerText
                              - identifier: us.mappings.orderConfirmation.fulfillmentSection.fulfillmentAmendAddItemsLink
                        - log: Validated fulfillment Amend option details

            - if:
                condition: ${type} == 'Digital delivery'
                then:
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentTime
                          contains: Arrives soon after purchase
                  - log: Validated fulfillment time text for ${type}

            - if:
                condition: ${type} == 'Auto Care'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfimration.fulfillmentSection.fulfillmentHoldTillDate
                  - log: Validated fulfillment hold till date for ${type}

            - log: -----------${fulfillmentText} section validation end-------------
      - storeIn:
          key: fulfillmentText
          value: 'null'
      - storeIn:
          key: altFulfillmentText
          value: 'null'

#Verify unScheduledPickup confirmation
  - name: us.functions.orderConfirmation.pickup.verifyOrderConfirmationScreen
    platform: android
    flow:
      - sleep:
          duration: 5000

      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon

      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            #- identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.pickup.cardTitle
            # - identifier: us.mappings.orderConfirmation.unScheduledPickup.slotDetails # Cannot be checked with multiple cards
            # - identifier: us.mappings.orderConfirmation.amendUntilCopy
            # - identifier: us.mappings.orderConfirmation.pickUpInstructions

#Verify ScheduledPickup confirmation
  - name: us.functions.orderConfirmation.pickup.verifyOrderConfirmationScreen.benefitsCopy
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon

      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            # - identifier: us.mappings.orderConfirmation.benefits.thanksOrderCopy
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.pickup.cardTitle

#Verify unScheduled Delivery confirmation
  - name: us.functions.orderConfirmation.delivery.verifyOrderConfirmationScreen.benefitsCopy
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon
      - verifyIdentifier:
          present:
            #- identifier: us.mappings.orderConfirmation.navBarTitle
            # - identifier: us.mappings.orderConfirmation.benefits.thanksOrderCopy
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.scDelivery.deliveryAddress
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.scDelivery.deliveryAddress
          else:            
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderConfirmation.scDelivery.deliveryAddress
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.orderConfirmation.scDelivery.deliveryAddress           

    # Get order number for order placed
  - name: us.functions.orderConfirmation.getOrderNumber
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - getString:
          identifier: us.mappings.orderConfirmation.orderNumber
          extractNumbers: true
          storeIn: orderNo
      - sleep:
          duration: 30000

  - name: us.functions.orderConfirmation.orderCreationValidation
    platform: android
    flow:
      - sleep:
          duration: 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.orderNumber
          then:
            - log: Order created successfully
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Order creation error"

  # Verify Scheduled delivery order confirmation
  - name: us.functions.orderConfirmation.scheduledDelivery.verifyOrderConfirmationScreen
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon

      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            #- identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.scheduledDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.scDelivery.deliveryAddress
            - identifier: us.mappings.orderConfirmation.itemsCount
            - identifier: us.mappings.ordeerConfirmation.amendBanner
            # - identifier: us.mappings.orderConfirmation.items

  # Verify Scheduled delivery order confirmation
  - name: us.functions.orderConfirmation.scheduledDelivery.express
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            #- identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
            - identifier: us.mappings.orderConfirmation.scheduledDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.scDelivery.deliveryAddress
            - identifier: us.mappings.orderConfirmation.itemsCount

  # Verify FC delivery order confirmation
  - name: us.functions.orderConfirmation.fcDelivery.verifyOrderConfirmationScreen
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.orderConfirmation.navBarTitle
            #- identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
      - executeFunction:
          name: us.functions.orderConfirmation.scrollToSection
          params:
            - name: fulfillmentText
              string: Shipping  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryEstimate
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryAddress
            - identifier: us.mappings.orderConfirmation.itemsCount
            # - identifier: us.mappings.orderConfirmation.items

  - name: us.functions.orderConfirmation.mixedOrder.fcDeliveryAndPickup.verifyOrderConfirmationScreen
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon

      - verifyIdentifier:
          present:
            #- identifier: us.mappings.orderConfirmation.navBarTitle
            #- identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber

      - executeFunction:
          name: us.functions.orderConfirmation.scrollToSection
          params:
            - name: fulfillmentText
              string: Shipping
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryAddress

      - executeFunction:
          name: us.functions.orderConfirmation.scrollToSection
          params:
            - name: fulfillmentText
              string: Curbside pickup
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.pickup.cardTitle

  - name: us.functions.orderConfirmation.mixedOrder.fcDeliveryAndScheduledDelivery.verifyOrderConfirmationScreen
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.navBarTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.navBarTitle
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.home.searchBarSelected
                  - identifier: us.mappings.navBar.cartIcon
      - verifyIdentifier:
          present:
            #- identifier: us.mappings.orderConfirmation.navBarTitle
            #- identifier: us.mappings.orderConfirmation.greenCheckMarkIcon
            - identifier: us.mappings.orderConfirmation.thankYouCopy
            - identifier: us.mappings.orderConfirmation.orderNumber
      - executeFunction:
          name: us.functions.orderConfirmation.scrollToSection
          params:
            - name: fulfillmentText
              string: Delivery from store
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.scheduledDelivery.cardTitle
      - executeFunction:
          name: us.functions.orderConfirmation.scrollToSection
          params:
            - name: fulfillmentText
              string: Shipping
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.fcDelivery.cardTitle
            - identifier: us.mappings.orderConfirmation.fcDelivery.deliveryAddress

  - name: us.functions.orderConfirmation.verifyAssociateDiscountLabel
    platform: android
    flow:
      - if:
          condition: ${associateDiscountApplied}
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.associateDiscountLabel

  # Verify digital delivery order confirmation details
  - name: us.functions.orderConfirmation.digitalDelivery.verifyOrderConfirmationScreen
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfrimation.digitalDelivery.cardTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfrimation.digitalDelivery.cardTitle
            - identifier: us.mappings.orderConfrimation.digitalDelivery.deliveryTime

  - name: us.functions.orderConfirmation.verifyEBTDetailsDisplay
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.EBTBalanceText
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.EBTFoodBalanceText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.EBTBalanceText
            - identifier: us.mappings.orderConfirmation.EBTFoodBalanceText
            - identifier: us.mappings.orderConfirmation.EBTCashBalanceText
          text:
            - identifier: us.mappings.orderConfirmation.EBTBalanceText
              contains: "EBT Balance"
            - identifier: us.mappings.orderConfirmation.EBTFoodBalanceText
              contains: "Food balance"
            - identifier: us.mappings.orderConfirmation.EBTCashBalanceText
              contains: "Cash balance"

  - name: us.functions.orderConfirmation.verifypromodiscount
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderConfirmation.promoSavedLabel
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.promoSavedLabel
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderConfirmation.promoDiscountLabel
                  - identifier: us.mappings.orderConfirmation.promoDiscounttext
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.orderConfirmation.promoDiscounttext
                    contains: us.data.revieworder.appliedPromoCodeText

  - name: us.functions.checkout.orderConfirmation.verifyTotalAmountForDonation
    platform: android
    flow:
      - sleep:
          duration: 10000
    #  - executeFunction:
        #  name: us.functions.orderConfirmation.ratings
      - verifyIdentifier:
          text:
            - identifier: us.mappings.orderConfirmation.orderTotalAmount
              contains: ".00"

  - name: us.functions.orderConfirmation.gift.verifyGiftDetails
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.gifting.orderconfirmation.giftDetailsMessage
      - verifyIdentifier:
          present:
            - identifier: us.mappings.gifting.orderconfirmation.giftDetailsTitle
            - identifier: us.mappings.gifting.orderconfirmation.giftDetailsTo
            - identifier: us.mappings.gifting.orderconfirmation.giftDetailsSender
            - identifier: us.mappings.gifting.orderconfirmation.giftDetailsMessage

  - name: us.functions.checkout.orderConfirmation.verifyCharityLinkNotPresent
    platform: android
    flow: 
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.orderconfirmation.charityLink
          then:
            - log: "Charity link not displayed as per expectation"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Charity link should not be displayed"
       # - verifyIdentifier:
       #     notPresent:
       #       - identifier: us.mappings.orderconfirmation.charityLink
       # - sleep:
       #    duration: 5000  
       # - log: charity link not present      

  - name: us.functions.checkout.navigateToCartFromReviewOrder
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.navBarTitle
          then:
              - log: Review Order page loaded
              - goBack: true
              - executeFunction:
                  name: us.functions.checkout.handleCheckoutAlert

  - name: us.functions.checkout.orderConfirmation.verifyAddItems
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderconfirmation.addItems

  - name: us.functions.checkout.orderConfirmation.verifyAddItems
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderconfirmation.addItems
  
  - name: us.functions.checkout.orderConfirmation.verifyMultiplePickupMessage
    platform: ios
    flow:
      - verifyIdentifier:
          label:
            - identifier: us.functions.orderconfirmation.curbsidePickup.verifyMultiplePickupMessage
              contains: This order requires pickup in 2 different areas of the parking lot.

  - name: us.functions.checkout.orderConfirmation.verifyMultiplePickupMessage
    platform: android
    flow:
      - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
              - name: identifier
                string: us.functions.orderconfirmation.curbsidePickup.verifyMultiplePickupMessage
              - name: direction
                string: down
      - verifyIdentifier:
          text:
            - identifier: us.functions.orderconfirmation.curbsidePickup.verifyMultiplePickupMessage
              contains: This order requires pickup in 2 different areas of the parking lot.


  # [mandatory] ${pickupText} - GardenCenterPickup/GroceryPickup/LiquorPickup... [Required for identifying fulfillment section to be validated]
  - name: us.functions.orderConfirmation.verifyPickupInstructions
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.getPickupTextsToCompare

      - log: -----------${pickupText} section validation start-----------
      - if:
          condition: ${pickupText} == null
          then:
            - log: Skipping fulfillment section validation as none mentioned
          else:
            - storeIn:
                key: type
                value: ${pickupText}
            - log: Validating fulfillment section ${type}
            - if:
                condition: ${type} == 'GardenCenterPickup'
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.orderConfirmation.gardenCenterPickup.pickupInstructionsText
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.gardenCenterPickup.pickupInstructionsText
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.orderConfirmation.gardenCenterPickup.pickupInstructionsText
                          contains: Garden Center pickup instructions
                  - log: Validated ${type} instructions

            - if:
                condition: ${type} == 'GroceryPickup'
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.orderConfirmation.groceryPickup.pickupInstructionsText
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.groceryPickup.pickupInstructionsText
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.orderConfirmation.groceryPickup.pickupInstructionsText
                          contains: Pickup instructions
                  - log: Validated ${type} instructions

            - if:
                condition: ${type} == 'LiquorPickup'
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.orderConfirmation.liquorPickup.pickupInstructionsText
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.liquorPickup.pickupInstructionsText
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.orderConfirmation.liquorPickup.pickupInstructionsText
                          contains: Liquor pickup
                  - log: Validated ${type} instructions
      - storeIn:
          key: pickupText
          value: 'null'
      - storeIn:
          key: altPickupText
          value: 'null'

  # [mandatory] ${pickupText} - GardenCenterPickup/GroceryPickup/LiquorPickup... [Required for identifying fulfillment section to be validated]
  - name: us.functions.orderConfirmation.verifyPickupInstructions
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.getPickupTextsToCompare

      - log: -----------${pickupText} section validation start-----------
      - if:
          condition: ${pickupText} == null
          then:
            - log: Skipping fulfillment section validation as none mentioned
          else:
            - storeIn:
                key: type
                value: ${pickupText}
            - log: Validating fulfillment section ${type}
            - if:
                condition: ${type} == 'GardenCenterPickup'
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.orderConfirmation.gardenCenterPickup.pickupInstructionsText
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.gardenCenterPickup.pickupInstructionsText
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.orderConfirmation.gardenCenterPickup.pickupInstructionsText
                          contains: Garden Center pickup instructions
                  - log: Validated ${type} instructions

            - if:
                condition: ${type} == 'GroceryPickup'
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.orderConfirmation.groceryPickup.pickupInstructionsText
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.groceryPickup.pickupInstructionsText
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.orderConfirmation.groceryPickup.pickupInstructionsText
                          contains: Pickup instructions
                  - log: Validated ${type} instructions

            - if:
                condition: ${type} == 'LiquorPickup'
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.orderConfirmation.liquorPickup.pickupInstructionsText
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.orderConfirmation.liquorPickup.pickupInstructionsText
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.orderConfirmation.liquorPickup.pickupInstructionsText
                          contains: Liquor pickup instructions
                  - log: Validated ${type} instructions
      - storeIn:
          key: pickupText
          value: 'null'
      - storeIn:
          key: altPickupText
          value: 'null'

  - name: us.functions.RewardsCenter.rewardshistory.pendingWalmartCash
    platform: ios
    flow:
      - try:
          flow:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.RewardsCenter.rewardshistory.pendingWalmartCashText
                  - identifier: us.mappings.RewardsCenter.rewardshistory.estimatedRewards
          catch:
            flow:
              - failTest:
                  message: "ENV_FAILURE - ${env} - identifier is missing on pending Walmart Cash"
      - click:
          identifier: us.mappings.RewardsCenter.rewardshistory.estimatedRewards
          wait: 5000          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.wplus.WalmartRewardCenterTitle

  - name: us.functions.RewardsCenter.rewardshistory.notpendingWalmartCash
    platform: ios
    flow: 
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.RewardsCenter.rewardshistory.pendingWalmartCashText
              - identifier: us.mappings.RewardsCenter.rewardshistory.estimatedRewards              
          then:
            - log: "pending Walmart Cash not present"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - pending Walmart Cash should not be displayed"
  
  - name: us.functions.orderConfirmation.verifyPackageAndInstruction
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.autoCareCenterInstallation
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderConfirmation.autoServiceValuePackage
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.autoServiceValuePackage
            - identifier: us.mappings.orderConfirmation.serviceInstructions

  - name: us.functions.orderConfirmation.verifyPackageAndInstruction
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.autoCareCenterInstallation
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderConfirmation.autoServiceValuePackage
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.serviceInstructions
            - identifier: us.mappings.orderConfirmation.autoServiceValuePackage


  # [mandatory] ${searchresultsconditions} - Restored: Premium /Restored: Good/Restored: Like New/Restored: Fair.... [Required for identifying multiple conditions for the same original identifiers to be validated]
  - name: us.functions.marketplace.search.restored.validations
    platform: ios
    flow:
      # - executeFunction:
      #     name: us.functions.utils.getitemTextsToCompare

      - log: -----------${searchresultsconditions} section validation start-----------
      - if:
          condition: ${searchresultsconditions} == null
          then:
            - log: Skipping searchresultsconditions validation as none mentioned
          else:
            - storeIn:
                key: type
                value: ${searchresultsconditions}
            - log: Validating fulfillment section ${type}
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.conditions.restored.item
            - log: Validated ${type} label
      - storeIn:
          key: searchresultsconditions
          value: 'null'

  - name: us.functions.marketplace.itempage.restored.validations
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 90000
          present:
            - identifier: us.mappings.buyNow.buyNowButton
            - identifier : us.mappings.item.addToCartButton
      - if: 
          identifier: 
            present: 
              - identifier: cta.continue.location
          then: 
            - click :
                identifier: cta.continue.location
      - if: 
          identifier: 
            present: 
              - identifier: us.mappings.global.onboarding.askAppNotToTrackButton
          then: 
            - click :
                identifier: us.mappings.global.onboarding.askAppNotToTrackButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.conditions.restored.item

  - name: us.functions.marketplace.cart.restored.validations
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.conditions.restored.item
    # Move all items to SFL   
      - executeFunction:
          name: us.functions.cart.verifySaveAllForLater
      - executeFunction:
          name: us.functions.cart.moveItemToCart

  - name: us.functions.marketplace.odp.restored.validations
    platform: ios
    flow:
      - scroll:
          direction: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.conditions.restored.item

  # [mandatory] ${searchresultsconditions} - Restored: Premium /Restored: Good/Restored: Like New/Restored: Fair... [Required for identifying multiple conditions for the same original identifiers to be validated]
  - name: us.functions.marketplace.search.restored.validations
    platform: android
    flow:
      # - executeFunction:
      #     name: us.functions.utils.getitemTextsToCompare

      - log: -----------${searchresultsconditions} section validation start-----------
      - if:
          condition: ${searchresultsconditions} == null
          then:
            - log: Skipping searchresultsconditions validation as none mentioned
          else:
            - storeIn:
                key: type
                value: ${searchresultsconditions}
            - log: Validating fulfillment section ${type}
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.conditions.restored.item
            - log: Validated ${type} label
      - storeIn:
          key: searchresultsconditions
          value: 'null'

  - name: us.functions.marketplace.itempage.restored.validations
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.buyNowButton
            - identifier : us.mappings.item.addToCartButton
      - if: 
          identifier: 
            present: 
              - identifier: cta.continue.location
          then: 
            - click :
                identifier: cta.continue.location
      - if: 
          identifier: 
            present: 
              - identifier: us.mappings.global.onboarding.askAppNotToTrackButton
          then: 
            - click :
                identifier: us.mappings.global.onboarding.askAppNotToTrackButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.conditions.restored.item

  - name: us.functions.marketplace.cart.restored.validations
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.conditions.restored.item
    # Move all items to SFL   
      - executeFunction:
          name: us.functions.cart.verifySaveAllForLater
      - executeFunction:
          name: us.functions.cart.moveItemToCart

  - name: us.functions.marketplace.odp.restored.validations
    platform: android
    flow:
      - scroll:
          direction: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.conditions.restored.item

  - name: us.functions.cart.verifyOTPexpinpurchasehistory
    platform: android
    flow:
    - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.functions.cart.verifyShowpasscodeexpinpurchasehistory
            - name: direction
              string: down
            - name: scrollPosition
              string: center    
    - verifyIdentifier:
          text:
            - identifier: us.functions.cart.verifySODExpinPurchasehistory
              contains : You'll need to be present at delivery
           
    - verifyIdentifier:
          text:
            - identifier: us.functions.cart.verifyShowpasscodeexpinpurchasehistory
              contains : Show this one-time passcode to your driver.
    - verifyIdentifier:
          present:
            - identifier: us.functions.cart.verifyShowOTPexpinpurcahsehistory #OTP will showup.

  - name: us.functions.cart.verifyOTPexpinpurchasehistory
    platform: ios
    flow:
    - verifyIdentifier:
          label:
            - identifier: us.functions.cart.verifySODExpinODPios
              contains : You'll need to be present at delivery
           
    - verifyIdentifier:
          label:
            - identifier: us.functions.cart.verifySODExpinODPios
              contains : Show this one-time passcode to your driver.
    - verifyIdentifier:
          present:
            - identifier: us.functions.cart.verifyShowOTPexpinODPios #OTP will showup.     

  - name: us.functions.cart.verifyOTPexpinODP
    platform: android
    flow:
    - verifyIdentifier:
          text:
            - identifier: us.functions.cart.verifySODExpinODP
              contains : You'll need to be present at delivery
           
    - verifyIdentifier:
          text:
            - identifier: us.functions.cart.verifyShowpasscodeexpinODP
              contains : Show this one-time passcode to your driver.
    - verifyIdentifier:
          present:
            - identifier: us.functions.cart.verifyShowOTPexpinODP #OTP will showup.   

  - name: us.functions.cart.verifyOTPexpinODP
    platform: ios
    flow:
    - verifyIdentifier:
          label:
            - identifier: us.functions.cart.verifySODExpinODPios
              contains : You'll need to be present at delivery
           
    - verifyIdentifier:
          label:
            - identifier: us.functions.cart.verifySODExpinODPios
              contains : Show this one-time passcode to your driver.
    - verifyIdentifier:
          present:
            - identifier: us.functions.cart.verifyShowOTPexpinODPios #OTP will showup.                            


# Local Market Place

  - name: us.functions.orderConfirmation.localMarketPlace.OrderConfirmationPageValidations
    platform: android
    flow:
      - if: 
          condition: ${fulfillment} == 'Delivery'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSeller
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSellerSLA
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSeller.customerAddress
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSeller.numberOfItems
      - if: 
          condition: ${fulfillment} == 'Pickup'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSeller
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSellerSLA

# Local Market Place

  - name: us.functions.orderConfirmation.localMarketPlace.OrderConfirmationPageValidations
    platform: ios
    flow:
      - if: 
          condition: ${fulfillment} == 'Delivery'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSeller
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSellerSLA
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSeller.customerAddress
                      - identifier: us.mappings.orderConfirmation.localMarketPlace.deliveryFromLocalSeller.numberOfItems
      - if: 
          condition: ${fulfillment} == 'Pickup'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSeller
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSellerSLA

  - name: us.functions.orderConfirmation.SODBanner
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.rxpd.sodBanner
            - identifier: us.mappings.cart.rxpd.sodBanner.text
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.rxpd.SODText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.rxpd.SODText

  - name: us.functions.orderConfirmation.SODBanner
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.rxpd.SODText

  - name: us.functions.orderConfirmation.navigateToSubscriptionPage
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.mangeSubscriptionNowCTA
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.mangeSubscriptionNowCTA
      - click:
          identifier: us.mappings.orderConfirmation.mangeSubscriptionNowCTA
      - log: Navigated to Subscription Mnanagement page from Order Confirmation page
      - sleep:
          duration: 3000

  - name: us.functions.orderConfirmation.navigateToSubscriptionPage
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.mangeSubscriptionNowCTA
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.mangeSubscriptionNowCTA
      - click:
          identifier: us.mappings.orderConfirmation.mangeSubscriptionNowCTA
      - log: Navigated to Subscription Mnanagement page from Order Confirmation page
      - sleep:
          duration: 3000