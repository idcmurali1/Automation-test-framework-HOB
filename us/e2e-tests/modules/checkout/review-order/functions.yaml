functions:

  - name: us.functions.checkout.reviewOrder.scheduledPickup.verifyCard
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 50000
          present:
            - identifier: us.mappings.reviewOrder.navBarTitle
            - identifier: us.mappings.reviewOrder.curbsidepickup.cardTitle
            - identifier: us.mappings.reviewOrder.scheduledDelivery.slotDetails
            - identifier: us.mappings.reviewOrder.pickupPersonText
            - identifier: us.mappings.reviewOrder.pickupPersonName
            - identifier: us.mappings.reviewOrder.editPickupPersonLink
            - identifier: us.mappings.reviewOrder.mobileContactText
            - identifier: us.mappings.reviewOrder.getTextInfo
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.totalLabel
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subTotalLabel
            - identifier: us.mappings.reviewOrder.totalLabel
      - scroll:
          direction: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.taxLabel
      
  - name: us.functions.checkout.reviewOrder.scDelivery.verifyCard
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.scheduledDelivery.cardTitle
            - identifier: us.mappings.reviewOrder.scheduledDelivery.slotDetails
            - identifier: us.mappings.reviewOrder.deliveryAddress
            - identifier: us.mappings.reviewOrder.deliveryInstructions.title
            - identifier: us.mappings.reviewOrder.deliveryInstructionsText
            - identifier: us.mappings.reviewOrder.deliveryInstructionsAddLink
            - identifier: us.mappings.reviewOrder.deliveryInstructions.leaveAtMyDoorButton
            - identifier: us.mappings.reviewOrder.deliveryInstructions.willSignButton
            # - identifier: us.mappings.reviewOrder.mobileContactText  #removed as FC card validation is failing when we add scroll to mobile number
            # - identifier: us.mappings.reviewOrder.mobileContactPhoneNumber
            # - identifier: us.mappings.reviewOrder.getTextInfo
      # - verifyChecked:
      #     identifier: us.mappings.reviewOrder.getTextCheckBox
      #     value: true

  - name: us.functions.checkout.reviewOrder.fcDelivery.verifyCard
    platform: ios
    flow:
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.reviewOrder.loadingSpark 
      - scroll:
          direction: up
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.fcDelivery.cardTitle
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.fcDelivery.cardTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.navBarTitle
            - identifier: us.mappings.reviewOrder.fcDelivery.cardTitle
            - identifier: us.mappings.reviewOrder.placeOrderButton

  # Scrolls to top of review order page
  - name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
    platform: ios
    flow:
      - log: Scrolling to top of review order page
      # Validate if Review Order title is displayed
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.navBarTitle
      # Scroll up until top section fulfillment type
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.fulfillmentTopSection.fulfillmentTypeText
            - name: direction
              string: up

  - name: us.function.checkout.reviewOrder.verifyItemDetails
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.checkoutButton
          then:
            - log: Still in Cart page 
            - executeFunction:
                name: us.functions.global.navigation.backNavigation
            - executeFunction:
                name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
            - executeFunction:
                name: us.functions.global.navigation.toCartFromNavBar
            - log: In Cart page, navigating to Review order page                 
            - executeFunction:
                name: us.functions.cart.continueToCheckout
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.multibox.viewItemDetaisReviewOrder
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemNameDetails
      - log: Item details verified successfully
      - verifyIdentifier:
          present:
            - identifier: us.mappings.digitalDelivery.ItemDetailsCloseButton
      - click:
          identifier: us.mappings.digitalDelivery.ItemDetailsCloseButton
      - sleep:
          duration: 2000

  - name: us.functions.cart.getItemName
    platform: ios
    flow:
    - sleep:
       duration: 2000
    - verifyIdentifier:
       present:
         - identifier: us.mappings.cart.getItemName
    - getString:
       identifier: us.mappings.cart.getItemName
       attribute: label
       storeIn: itemName1
    - log: $itemName1
    - executeNode:
          file: us/e2e-tests/helpers/splitpaymentDateString_iOS.js
          args:
            - value: ${itemName1}
            - value: Qty 
            - value: before
          getResponse:
            storeIn: itemName1
    - log: $itemName1

  # [mandatory] ${fulfillmentText} - Shipping/Curbside pickup/Digital delivery ... [Required to scroll to the appropriate cart fulfillment section]
  - name: us.functions.checkout.reviewOrder.scrollToSection
    platform: ios
    flow:
      - log: -------Scroll to ${fulfillmentText} section start-------
      # Validate if Review Order title is displayed
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.navBarTitle
      - log: Scroll to top of ReviewOrder page and skip if page top is already displayed
      # Scroll up until top section fulfillment type
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.fulfillmentTopSection.fulfillmentTypeText
            - name: direction
              string: up
      - log: Scroll to specific fulfillment type section and skip if it is already visible on screen
      - log: Scrolling to Fulfillment section ${fulfillmentText}
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.fulfillmentSection.fulfillmentTypeText
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - log: -------Scroll to ${fulfillmentText} section end-------

  # Utility to validate review order details for any fulfillment type
  # [mandatory] ${fulfillmentText} - Shipping/Delivery from store/Curbside pickup/Digital delivery/Auto Care... [Required to scroll to the appropriate cart fulfillment section]
  # [optional]  ${unscheduled}     - true/false [default false] [Set to true if unscheduled item fulfillment time needs to be validated]
  # [optional]  ${expressSlot}     - true/false [default false] [Set to true if express slot fulfillment time needs to be validated]
  - name: us.functions.checkout.reviewOrder.verifyCardDetails
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.viewSubstitutionPopUpCloseButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPopUpCloseButton
      - executeFunction:
          name: us.functions.utils.getFulfillmentTextsToCompare
      - log: -----------${fulfillmentText} section validation start-----------
      # Main validation
      - if:
          condition: ${initialCheckoutDataSetup} == null
          then:
            - sleep:
                duration: 5000
            # Validate if Review Order page is loaded
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.navBarTitle
                then:
                  - log: Review order page loaded successfully
                else:
                  - failTest:
                      message: "ENV_FAILURE - ${env} review order page load ERROR"
            - storeIn:
                key: initialCheckoutDataSetup
                value: complete
          else:
            - log: Review order page already loaded and inital setup is done.

      # This section is used to set viewType required for specific fulfillment section detail identifications
      - if:
          condition: ${fulfillmentText} == 'Curbside pickup' || ${fulfillmentText} == 'Cary Advance Auto Parts pickup'
          then:
            - storeIn:
                key: viewType
                value: Pickup
          else:
            - if:
                condition: ${fulfillmentText} == 'pickup' || ${fulfillmentText} == 'Pickup' || ${fulfillmentText} == 'Retiro'
                then:
                  - storeIn:
                      key: viewType
                      value: Pickup
                else:
                  - if:
                      condition: ${fulfillmentText} == 'Auto Care'
                      then:
                        - storeIn:
                            key: viewType
                            value: AutoCareCenter
                      else:
                        - if:
                            condition: ${fulfillmentText} == 'Digital delivery'
                            then:
                              - storeIn:
                                  key: viewType
                                  value: DigitalDelivery
                            else:
                              - storeIn:
                                  key: viewType
                                  value: Delivery

      # Verify required section is displayed
      - log: Validating fulfillment section ${fulfillmentText}
      - try:
          flow:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentTypeText
          catch:
            flow:
              - failTest:
                  message: "FAILURE - ${env} - ${fulfillmentText} fulfillment section not displayed in review order page"
      - log: Validated basic fulfillment details

      # Verify address/name details for all fulfillment type except digital delivery
      - if:
          condition: ${fulfillmentText} != 'Digital delivery'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentTime
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentName
                  # - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentAddress
                  # - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentViewLink      #Commenting as multiple runs failed due to this identifier. To be added back once verified
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentItemCount
            - log: Validated fulfillment time, name, address, item count and view link details

            # Verify unscheduled/express time details
            - if:
                condition: ${unscheduled}
                then:
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentTime
                          contains: us.data.text.anytimeAfter
                  - log: Validated unscheduled fulfillmentTime details
                else:
                  - if:
                      condition: ${expressSlot}
                      then:
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.reviewOrder.expressDelivery.slotTime
                        - log: Validated express fulfillmentTime details

      - if:
          condition: ${fulfillmentText} == 'Curbside pickup'
          then:
            #Space to validate pickup specific detals [Delivery/substitutions preferences]
            - log: Validated fulfillment amend details

      - if:
          condition: ${fulfillmentText} == 'Delivery from store'
          then:
            #Space to validate delivery from store specific detals [Delivery/substitutions preferences]
            - log: Validated fulfillment amend details

      # Verify Auto care specific details
      - if:
          condition: ${fulfillmentText} == 'Auto Care'
          then:
            #Add pickup person details validations
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentComment
            - try:
                flow:
                  - verifyIdentifier:
                      label:
                        - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentComment
                          contains: We'll hold your order for 10 days
                catch:
                  flow:
                   - verifyIdentifier:
                       label:
                         - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentComment
                           contains: Tires will be ready for you at the store
            - log: Validated fulfillment hold comment

      # Verify Digital delivery specific details
      - if:
          condition: ${fulfillmentText} == 'Digital delivery'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.digitalFulfillmentItemCount
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.digitalFulfillmentViewLink
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.digitalFulfillmentComment
                label:
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.digitalFulfillmentComment
                    contains: Arrives soon after purchase
            - log: Validated fulfillment time comment

      - storeIn:
          key: altFulfillmentText
          value: 'null'
      - log: -----------${fulfillmentText} section validation end-------------

  - name: us.functions.checkout.reviewOrder.reviewOrderPageLoadValidation
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.navBarTitle
          then:
            - log: Review order page loaded successfully
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} review order page load ERROR"

  - name: us.functions.checkout.reviewOrder.verifyPaymentCardsDisplay
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - scroll:
          direction: up
          scrollLimit: 3
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.paymentMethod.checkout.wallet.title           
      - if:
          condition: ${verifyEBT} == 'exists'
          then:        
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.EBT.cardSummaries
          else:
            - if:
                condition: ${verifyEBT} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.EBT.cardSummaries
      - if:
          condition: ${verifyGC} == 'exists'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.GC.cardSummaries
          else:
            - if:
                condition: ${verifyGC} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.GC.cardSummaries
      - if:
          condition: ${verifyCC} == 'exists'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.CC.cardSummaries
          else:
            - if:
                condition: ${verifyCC} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.CC.cardSummaries
      - try:
          flow:
            - if:
                condition: ${verifyDS} == 'exists'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.DS.cardSummaries
                else:
                  - if:
                      condition: ${verifyDS} == 'notExists'
                      then:
                        - verifyIdentifier:
                            notPresent:
                              - identifier: us.mappings.reviewOrder.DS.cardSummaries
          catch:
            flow:
              - failTest:
                  message: "FAILURE - ${env} - DS card is not the auto-selected payment method, verification failed in Review Order page"

      - try:
          flow:
            - if:
                condition: ${verifyRefundCard} == 'exists'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.refundCard.cardSummaries
                else:
                  - if:
                      condition: ${verifyRefundCard} == 'notExists'
                      then:
                        - verifyIdentifier:
                            notPresent:
                              - identifier: us.mappings.reviewOrder.refundCard.cardSummaries
          catch:
            flow:
              - failTest:
                  message: "FAILURE - ${env} - Refund card is not the auto-selected payment method, verification failed in Review Order page"            


  # Function to select affirm payment and fill all required details
  - name: us.functions.checkout.applyAffirmPayment
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.affirmApplyNowButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.reviewOrder.affirmApplyNowButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirmConfirmButton
      - click:
          identifier: us.mappings.reviewOrder.affirmConfirmButton
      - verifyIdentifier:
          timeout: 50000
          present:
            - identifier: us.mappings.reviewOrder.affirm.mobileNumber
      - enterText:
          identifier: us.mappings.reviewOrder.affirm.mobileNumber
          string: 8142801436
      - click:
          identifier: us.mappings.reviewOrder.affirm.title 
      - click:
          identifier: us.mappings.reviewOrder.affirm.continueButton
          wait: 2000 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirm.pin
      - enterText:
          identifier: us.mappings.reviewOrder.affirm.pin
          string: 123456
      - click:
          identifier: us.mappings.reviewOrder.affirm.pinConfirmationTitle
      - click:
          identifier: us.mappings.reviewOrder.affirm.submitButton
      - loop:
          begin: 0
          end: 5
          storeIndex: i
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.affirm.selectPlan
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.affirm.selectPlan
                  - executeFunction:
                      name: us.functions.utils.scrollIfNotVisible
                      params:
                        - name: identifier
                          string: us.mappings.reviewOrder.affirm.continueSelectedPlan
                        - name: direction
                          string: down
                  - click:
                      identifier: us.mappings.reviewOrder.affirm.continueSelectedPlan                                             
                  - break: true
                else:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.affirm.reviewPageText
                      then:
                        - log: Plan selected by default, skipping to plan review page validations
                        - break: true
            - sleep:
                duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirm.reviewPageText
      - sleep:
          duration: 2000
      - if:
          identifier:
            present: 
              - identifier: us.mappings.reviewOrder.affirm.autoPayOnButton               
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.affirm.autoPayOnButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.affirm.autoPayOnButton
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirm.confirmPageText
      - click:
          identifier: us.mappings.reviewOrder.affirm.confirmCheckbox
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.maappings.reviewOrder.affirm.confirmPageContinueButton
            - name: direction
              string: down
      - click:
          identifier: us.maappings.reviewOrder.affirm.confirmPageContinueButton
      - verifyIdentifier:
          timeout: 15000
          present:
            - identifier: us.mappings.reviewOrder.affirm.thankyouText
      - click:
          identifier: us.mappings.reviewOrder.affirm.returnToWalmartButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirmAppliedDetails
          label:
            - identifier: us.mappings.reviewOrder.affirmAppliedDetails
              contains: Affirm
      - sleep:
          duration: 3000

  - name: us.functions.checkout.applyAffirmPayment
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.affirmApplyNowButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.reviewOrder.affirmApplyNowButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirmConfirmButton
      - click:
          identifier: us.mappings.reviewOrder.affirmConfirmButton
      - verifyIdentifier:
          timeout: 60000
          present:
            - identifier: us.mappings.reviewOrder.affirm.mobileNumber
      - enterText:
          identifier: us.mappings.reviewOrder.affirm.mobileNumber
          string: 8142801436
          pressEnter: true 
      - hideKeyboard: true
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.affirmConfirmButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.affirmConfirmButton
                wait: 2000
            - click:
                identifier: us.mappings.reviewOrder.affirmApplyNowButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.affirmConfirmButton
            - click:
                identifier: us.mappings.reviewOrder.affirmConfirmButton
            - verifyIdentifier:
                timeout: 60000
                present:
                  - identifier: us.mappings.reviewOrder.affirm.mobileNumber
            - enterText:
                identifier: us.mappings.reviewOrder.affirm.mobileNumber
                string: 8142801436 #4085551234
                pressEnter: true 
            - hideKeyboard: true
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.affirm.continueButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.affirm.continueButton
                wait: 2000 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirm.pin
      - enterText:
          identifier: us.mappings.reviewOrder.affirm.pin
          string: 123456
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.affirm.pinConfirmationTitle
          then:
            - click:
                identifier: us.mappings.reviewOrder.affirm.pinConfirmationTitle
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.affirm.submitButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.affirm.submitButton   
      - loop:
          begin: 0
          end: 5
          storeIndex: i
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.affirm.selectPlan
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.affirm.affrimPlanSelectionView
                      # coordinates: 14%,50%
                  - scroll:
                      direction: down
                  - click:
                      identifier: us.mappings.reviewOrder.affirm.continueSelectedPlan
                  - break: true
                else:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.affirm.reviewPageText
                      then:
                        - log: Plan selected by default, skipping to plan review page validations
                        - break: true
            - sleep:
                duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirm.reviewPageText
      - sleep:
          duration: 2000
      - scroll:
          direction: down    
      - if:
          identifier:
            present: 
              - identifier: us.mappings.reviewOrder.affirm.autoPayOnToggle             
          then:
            - click:
                identifier: us.mappings.reviewOrder.affirm.autoPayOnToggle
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirm.confirmPageText
      - click:
          identifier: us.mappings.reviewOrder.affirm.confirmCheckbox
          # coordinates: 10%,20%
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.maappings.reviewOrder.affirm.confirmPageContinueButton
            - name: direction
              string: down
      - click:
          identifier: us.maappings.reviewOrder.affirm.confirmPageContinueButton
      - verifyIdentifier:
          timeout: 15000
          present:
            - identifier: us.mappings.reviewOrder.affirm.thankyouText
      - click:
          identifier: us.mappings.reviewOrder.affirm.returnToWalmartButton
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.affirmAppliedDetails
            - name: direction
              string: up
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.affirmAppliedDetails

  - name: us.functions.checkout.placeOrder
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - executeFunction:
          name: us.functions.checkout.confirmCvvBeforePlaceOrder
      - loop:
          begin: 1
          end: 4
          storeIndex: tryCount
          mode: increment
          flow:
            - log: Place order try count - ${tryCount}
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.placeOrderButton
            - click:
                identifier: us.mappings.reviewOrder.placeOrderButton
                wait: 4000
          # Conditionally execute if EBT card is added for payment
            - if:
                condition: ${ebtExists}
                then:
                  - sleep:
                      duration: 6000
                  - if: 
                      identifier:
                        present: 
                          - identifier: us.mappings.paymentMethod.checkout.continueButton # us.mappings.paymentMethod.checkout.EBT.continueButton
                      then:
                        - executeFunction: 
                            name: us.functions.account.paymentMethod.enterEBTPin
            - if:
                condition: ${Wic}
                then:
                  - sleep:
                      duration: 6000
                  - if: 
                      identifier:
                        present: 
                          - identifier: us.mappings.paymentMethod.checkout.Wic.continueButton
                      then:
                        - executeFunction: 
                            name: us.functions.account.paymentMethod.enterWICPin
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.checkout.verifySubscriptionTermsBottomSheet
                then:
                  - executeFunction:
                      name: us.functions.checkout.placeOrderAndAcceptSubscriptionTerms           
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.rxpd.delivery.map.close.btn
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.rxpd.delivery.map.close.btn
                      wait: 2000      
            - sleep:
                duration: 10000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.popup.technicalError
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.popup.okButton
                  - click:
                      identifier: us.mappings.popup.okButton
                else:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.reservationExpiredSelectNewTime
                      then:
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.reviewOrder.reservationExpiredPopUp
                        - click:
                            identifier: us.mappings.reviewOrder.reservationExpiredSelectNewTime
                        - sleep:
                            duration: 5000   
                        - executeFunction:
                            name: us.functions.selectTimeSlot
                            params:
                              - name: slotIndex
                                string: 2
                        - executeFunction:
                            name: us.mappings.confirmSlotSelection
                        - executeFunction:
                            name: us.functions.cart.continueToCheckoutOrNewOrder
                        - executeFunction:
                            name: us.functions.cart.continueMissingAnythingScreen                            
                        - executeFunction:
                            name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
                      else:
                        - break: true
      # Handling "Please confirm your location" popup after placing order
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.placeOrder.confirmYourLocationPopupTitle
          then:
            - click : 
                identifier: us.mappings.reviewOrder.placeOrder.confirmYourLocationPopupConfirmButton
        # Commenting this because order is placed successfully through UI and verified
      #- executeFunction:
          #name: us.functions.orderConfirmation.orderCreationValidation

  - name: us.functions.checkout.alcoholDisclosureHandle
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
          then:
            - click:
                identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox

                
  - name: us.functions.checkout.enterEBTPinAndPlaceOrder
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
          then:
              - executeFunction: 
                  name: us.functions.reviewOrder.verifyBagsDetailsOurSustainabilityPledge 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.continueButton # us.mappings.paymentMethod.checkout.EBT.continueButton
      - click:
          identifier: us.mappings.paymentMethod.checkout.continueButton # us.mappings.paymentMethod.checkout.EBT.continueButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.paymentMethod.checkout.EBT.pinField 
          then:
            - click:
                identifier: //XCUIElementTypeButton[@name="0"]
            - click:
                identifier: //XCUIElementTypeButton[@name="0"]
            - click:
                identifier: //XCUIElementTypeButton[@name="0"]
            - click:
                identifier: //XCUIElementTypeButton[@name="5"]
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.paymentMethod.checkout.EBT.newPinField
            - enterText:
                identifier: us.mappings.paymentMethod.checkout.EBT.newPinField
                string: 0005
      - click:
          identifier: us.mappings.reviewOrder.submitEBTPin
      - sleep:
          duration: 15000
      - executeFunction:
          name: us.functions.orderConfirmation.orderCreationValidation

  - name: us.functions.checkout.placeOrderAgainIfError
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.popup.technicalError
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.popup.okButton
            - click:
                identifier: us.mappings.popup.okButton
            - executeFunction:
                name: us.functions.checkout.placeOrder

#PetRx added by _Murali Krish_
  - name: us.functions.checkout.AddPetVet
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.addPetVet
          position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.addPetVet
          then:
            - click:
                identifier: us.mappings.reviewOrder.addPetVet
      - sleep: 
          duration: 10000


#PetRx added by _Murali Krish_
  - name: us.functions.checkout.SelectPetVet
    platform: ios
    flow:
    #Pet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAPetid
      - click:
          identifier:  us.mappings.reviewOrder.SelectAPetid
      - sleep: 
          duration: 2000
      - getString:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          attribute: value
          storeIn: petName
      - log: ${petName} selected
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1

        #Vet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVetid
      - click:
          identifier: us.mappings.reviewOrder.SelectAVetid
      - sleep: 
          duration: 2000
      - getString:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          attribute: value
          storeIn: vetName
      - log: ${vetName} selected
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
          then:
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
      - if:
          condition: ${multipleItems} == true
          then:
            #Pet Selection
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAPetid
            - click:
                identifier:  us.mappings.reviewOrder.SelectAPetid
            - sleep: 
                duration: 2000
            - getString:
                identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
                attribute: value
                storeIn: petName
            - log: ${petName} selected
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
                then:
                  - log: inside done
                  - click:
                        identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
            - scroll:
                direction: down
            #Vet Selection
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAVetid
            - click:
                identifier:  us.mappings.reviewOrder.SelectAVetid
            - sleep: 
                duration: 2000
            - getString:
                identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
                attribute: value
                storeIn: vetName
            - log: ${vetName} selected
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
                then:
                  - click:
                        identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SaveButton
      - click:
          identifier:  us.mappings.reviewOrder.SaveButton

#PetRx added by _Murali Krish_
  - name: us.functions.checkout.MultiSelectPetVet
    platform: ios
    flow:

     #Qty Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.PetSelectAQtyTextfieldid
      - click:
          identifier: us.mappings.reviewOrder.PetSelectAQtyTextfieldid
      - sleep:
          duration: 5000    
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: 1
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

     #Pet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MutliSelectPet1Textfield_id
      - click:
          identifier: us.mappings.reviewOrder.MutliSelectPet1Textfield_id
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: Chris
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

        #Vet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MutliSelectVet1Textfield_id
      - click:
          identifier:  us.mappings.reviewOrder.MutliSelectVet1Textfield_id
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: WEINER, RONALD S (STORY ROAD ANIMAL HOSPITAL)
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
          then:
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

#2nd Pet and Vet selection
#Pet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MutliSelectPet2Textfield
      - click:
          identifier:  us.mappings.reviewOrder.MutliSelectPet2Textfield
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: Gia
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.PetPickerWheelDone1
          then:
            - log: inside done
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

        #Vet Selection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVet2
      - click:
          identifier:  us.mappings.reviewOrder.SelectAVet2
      # - click:
      #     identifier:  us.mappings.reviewOrder.SelectAVet2
    
      - enterText:
          identifier: us.mappings.reviewOrder.SelectPetPickerWheel1xpath
          string: Boemer, William Roy Dvm (Walnut Plaza Veterinary Hospital)
          clearField: false
          clickFirst: false
          pressEnter: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.SelectPetPickerWheelXCUIother1
          then:
            - click:
                  identifier:  us.mappings.reviewOrder.PetPickerWheelDone1
      - sleep:
          duration: 3000

 #Save Button
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SaveButton
      - click:
          identifier:  us.mappings.reviewOrder.SaveButton

  - name: us.functions.checkout.enterCvv
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.enterCvv
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.enterCvv
          then:
            - enterText:
                identifier: us.mappings.reviewOrder.enterCvv
                string: ${cvv}
                pressEnter: true
            - click:
                identifier: us.mappings.default.keyboardDoneButton

  - name: us.functions.checkout.enterMobileContact
    platform: ios
    flow:
      - loop:
          begin: 0
          end: 2
          storeIndex: i
          flow:
            - log: $i
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string:  us.mappings.reviewOrder.mobileContact.phoneNumberField
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center    
            - click:
                identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
            - sleep:
                duration: 3000
            - enterText:
                identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
                string: ${phoneNumber}
            - if: 
                condition: ${streetCode} != null           
                then:
                  - enterText:
                      identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
                      string: ${streetCode}  
            - if: 
                condition: ${lineCode} != null           
                then:
                  - enterText:
                      identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
                      string: ${lineCode}  
            - click:
                identifier: us.mappings.default.keyboardDoneButton
            - sleep:
                duration: 2000
            - if: 
                identifier:
                  notPresent: 
                    - identifier: us.mappings.reviewOrder.mobileContact.error
                then:
                  - break: true
                else:
                  - click:
                      identifier: us.mappings.reviewOrder.mobileContact.clearText

  - name: us.functions.checkout.confirmCvvBeforePlaceOrder
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
          then:
            # - scroll:
            #     direction: down
            #     untilIdentifier: us.mappings.reviewOrder.confirmCvv.cvvField
            - if:
                condition: ${cvv} == null
                then:
                  - log: "Taking default cvv value 111"
                  - storeIn:
                      key: cvv
                      value: 111
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField            
            - enterText:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                string: ${cvv}
            - click:
                identifier: us.mappings.default.keyboardDoneButton

  - name: us.functions.checkout.confirmCvvAndPlaceOrder
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.confirmCvv.PageTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
            - enterText:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                string: ${cvv}
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.confirmButton
            - executeFunction:
                name: us.functions.checkout.placeOrder
          else:
            # Conditionally execute if EBT card is added for payment
            - if:
                condition: ${ebtExists}
                then:
                  - executeFunction:
                      name: us.functions.account.paymentMethod.enterEBTPin
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.placeOrderButton

  - name: us.functions.checkout.reviewOrder.verifyThresholdFeesOnReviewOrder
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.thresholdText
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.thresholdText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.thresholdText

  - name: us.functions.checkout.reviewOrder.verifyScDeliveryFee
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.scDelivery.fee
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.scDelivery.fee

  - name: us.functions.checkout.reviewOrder.verifyNoThresholdFeesOnReviewOrder
    platform: ios
    flow:
      - sleep:
          duration: 10000
      - if: #Conditional logic Added for DCT small screen devices
          identifier:
            present:
               - identifier: us.mappings.reviewOrder.subTotal
          then: 
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.thresholdText
            - log: no minium threshold fee is present      
          else:
            - log: Need to scroll up/down to check minium threshold fee is not present
            - scroll: 
                direction: up
                untilIdentifier: us.mappings.reviewOrder.pickup.cardTitle             
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.subTotal
                position: center
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.thresholdText    

  - name: us.functions.checkout.reviewOrder.verifyThresholdFee
    platform: ios
    flow: 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.subTotalEffectiveAmount
            - name: direction
              string: down
            - name: scrollPosition
              string: center 
      - executeFunction:
          name: us.functions.utils.fetchAmountDisplayed
          params:
            - name: identifier
              string: us.mappings.reviewOrder.subTotalEffectiveAmount
            - name: attribute
              string: label
            - name: delimeter
              string: '$'

      - if:
          condition: ${amountValue} > 35.00
          then:
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.thresholdText  
          else:     
            - if:
                condition: ${amountValue} < 35.00     
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.wplus.thresholdLabel
                        - identifier: us.mappings.wplus.cart.pos.deliveryFromStoreCharges.rightLabel
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.thresholdText  
                        - identifier: us.mappings.reviewOrder.thresholdValue
                  - executeFunction:
                      name: us.functions.utils.fetchAmountDisplayed
                      params:
                        - name: identifier
                          string: us.mappings.reviewOrder.thresholdValue
                        - name: attribute
                          string: value                      
                        - name: delimeter
                          string: '$'               
                  - if:
                       condition: ${amountValue} > 0
                       then:  
                          - log :  Verified below order minimum fee is ${amountValue}   
                       else:
                         - if:
                              condition: ${amountValue} == 0
                              then:
                                - failTest:
                                    message: "FAILURE - ${env} - Below order minimum fee should never be 0" 

  - name: us.functions.checkout.reviewOrder.paymentsCloseTray
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.closeTrayButton
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.closeTrayButton
            - click:
               identifier: us.mappings.reviewOrder.closeTrayButton

  - name: us.functions.checkout.reviewOrder.uncheckDeliveryTipIfExists
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.tippingSectionTitle
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.tippingSectionTitle
                position: center
            - click:
                identifier: us.mappings.reviewOrder.secondTipOption
            - sleep:
                duration: 3000
            - scroll:
                direction: up

  - name: us.functions.checkout.reviewOrder.closePaymentMethodBottomTray
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.paymentMethodBottomTrayTitle
          then:
            - click:
                identifier: us.mappings.reviewOrder.closeTrayButton

  - name: us.functions.reviewOrder.verifyItemEligibleForSubs
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
          then:
            - log: Item is eligible for substitution
          else:
            - failTest:
                message: "DATA_FAILURE - ${env} - Substitution not eligible item - ${itemFetched} "

  - name: us.functions.reviewOrder.chooseSubsPreferences
    platform: ios
    flow: 
      - sleep:
          duration: 4000

      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToSection
          params:
            - name: fulfillmentText
              string: pickup

      - if:
          condition: ${fulfillmentType} == 'Shipping'
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.notEligibleSubsText
                  - name: direction
                    string: down 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subsPreference.notEligibleSubsText
            - log: Item is not eligible for substitution
                                         
          else:
            - click:
                identifier: us.mappings.reviewOrder.scheduledDelivery.cardTitle         
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton

            # - executeFunction:
            #     name: us.functions.utils.scrollIfNotVisible
            #     params:
            #       - name: identifier
            #         string: us.mappings.reviewOrder.subsPreference.editButtonOfItem
            #       - name: direction
            #         string: down
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.subsPreference.editButtonOfItem
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.subsPreference.editButtonOfItem
                else:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.subsPreference.notEligibleSubsTextWithItemIndex
                      then:
                        - failTest:
                            message: "DATA_FAILURE - ${env} - Substitution not eligible item"
            - if:
                condition: ${option} == 'bestMatch'
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.subsPreference.bestMatchRadioButton
                else:
                  - if:
                      condition: ${option} == 'dontReplace'
                      then:
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.reviewOrder.noSubstitutionButton
                              - name: direction
                                string: down
                        - click:
                            identifier: us.mappings.reviewOrder.noSubstitutionButton 
                      else:
                        - if:
                            condition: ${option} == 'replaceWith'
                            then:
                              - executeFunction:
                                  name: us.functions.utils.scrollIfNotVisible
                                  params:
                                    - name: identifier
                                      string: us.mappings.reviewOrder.subsPreference.replaceWithRadioButton
                                    - name: direction
                                      string: up
                                    - name: scrollPosition
                                      string: center
                              - if:
                                  identifier:
                                    present:
                                      - identifier: us.mappings.reviewOrder.subsPreference.alreadyExistingItem
                                  then:
                                    - click:
                                        identifier: us.mappings.reviewOrder.subsPreference.alreadyExistingItem 
                                    - getString:
                                        identifier: us.mappings.reviewOrder.subsPreference.alreadyExistingItem
                                        attribute: label
                                        storeIn: itemtitle  
                                    - log:  ${itemtitle} 
                                  else: 
                                    - scroll:
                                        direction: left
                                        untilIdentifier: us.mappings.subsPreference.searchItemButton                                                  
                                    - click:
                                        identifier: us.mappings.subsPreference.searchItemButton
                                    - click:
                                        identifier: us.mappings.subsPreference.searchBarSelected
                                    - enterText:
                                        identifier: us.mappings.subsPreference.searchBarSelected
                                        string: ${searchTerm}
                                        pressEnter: true
                                    - sleep:
                                        duration: 5000
                                    - if:
                                        identifier:
                                          present:
                                            - identifier: us.mappings.subsPreference.keyboard.Searchbutton
                                        then:
                                          - click:
                                              identifier: us.mappings.subsPreference.keyboard.Searchbutton
                                    - click:
                                        identifier: us.mappings.subsPreference.firstItem  
                                    - getString:
                                        identifier: us.mappings.subsPreference.firstItem
                                        attribute: label
                                        storeIn: itemtitle
                                    - log:  ${itemtitle}  
                                    - click:
                                        identifier:  us.mappings.reviewOrder.subsPreference.search.selectButton
                                    - sleep:
                                        duration: 2000    
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.doneButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.doneButton

            - sleep:
                duration: 5000  

  - name: us.functions.checkout.reviewOrder.fcDelivery.verifyAddress
    platform: ios
    flow:
      - scroll:
          direction: up
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.slotDetails.nameLabel
              equals: ${firstName} ${lastName}
          label:
            - identifier: us.mappings.reviewOrder.deliveryAddress
              contains: ${streetAddress}


  - name: us.functions.checkout.reviewOrder.verifySubstitutionPopUp
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subPopUpTitle
            - identifier: us.mappings.reviewOrder.subPopUpCartLabel
            # - identifier: us.mappings.reviewOrder.subPopUpCartLink
            - identifier: us.mappings.reviewOrder.subOptInCheckbox
            - identifier: us.mappings.reviewOrder.subPopUpInfoLink
            - identifier: us.mappings.reviewOrder.subPopUpItemTile
            - identifier: us.mappings.default.keyboardDoneButton

  - name: us.functions.checkout.reviewOrder.verifyExpressDeliveryDetails
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            #- identifier: us.mappings.cart.expressDeliveryBar.confirmText
            #- identifier: us.mappings.cart.expressTitle
            - identifier: us.mappings.reviewOrder.scheduledDelivery.slotDetails
            - identifier: us.mappings.reviewOrder.expressDeliveryFeeLabel
            - identifier: us.mappings.reviewOrder.expressDeliveryPrice
      - verifyIdentifier:
          value:
            - identifier: us.mappings.reviewOrder.scheduledDelivery.slotDetails
              contains: in 2 hours or less
      #- verifyIdentifier:
          #value:
            #- identifier: us.mappings.cart.expressTitle
              #contains: You've selected Express!
      - verifyIdentifier:
          value:
            - identifier: us.mappings.reviewOrder.expressDeliveryFeeLabel
              contains: Express delivery, $17.95

  - name: us.functions.checkout.reviewOrder.verifyNoSubstitutionPopUp
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subPopUpTitle
            - identifier: us.mappings.reviewOrder.subPopUpCartLabel
            # - identifier: us.mappings.reviewOrder.subPopUpCartLink
            - identifier: us.mappings.reviewOrder.noSubPopUpInfoLink
            - identifier: us.mappings.reviewOrder.noSubPopUpItemTile
            - identifier: us.mappings.default.keyboardDoneButton

#Verify Alcoholdisclosure details in the review order page  
  - name: us.functions.checkout.reviewOrder.SCDelivery.verifyAlcoholDsiclosure
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.alcoholDisclosureCheckbox
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
            - identifier: us.mappings.reviewOrder.alcoholDisclosureLabel
            - identifier: us.mappings.reviewOrder.alcoholDisclosureDescription
            - identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
      - verifyIdentifier:
          value:
            - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
              equals: 1   
      - log: 'checkbox already selected'        
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyHeader   
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyDescription
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyCloseCta
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyCloseCta         

  - name: us.functions.checkout.reviewOrder.applyPromoCodeiOS
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.promocodeSection
          position: center
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.promocodeSection
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.reviewOrder.promocodeSection
                position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.promocodeSection
      - click:
          identifier: us.mappings.reviewOrder.promocodeSection
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.promocode.applyButton
            - identifier: us.mappings.reviewOrder.promocodeTextfield

      - enterText:
          identifier: us.mappings.reviewOrder.promocodeTextfield
          string: ${promoCode}
          # pressEnter: true
      - click :
          identifier: us.mappings.default.keyboardDoneButton
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.promocode.applyButton
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.reviewOrder.promocodeSection
                position: center
      
      - click:
          identifier: us.mappings.reviewOrder.promocode.applyButton

      # - scroll:
      #     direction: up
      #     untilIdentifier: us.mappings.reviewOrder.promocode.removeButton
      #     position: center

      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.promocode.viewDetailsButton
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.promocode.viewDetailsButton
                position: center

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.promocode.appliedText
            - identifier: us.mappings.reviewOrder.promocode.viewDetailsButton
            - identifier: us.mappings.reviewOrder.promocode.removeButton
            - identifier: us.mappings.reviewOrder.promocode.appliedText
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.reviewOrder.promocode.viewDetailsButton
      #     position: center
      # - click:
      #     identifier: us.mappings.reviewOrder.promocode.viewDetailsButton
      # - verifyIdentifier:
      #     present:
      #       #- identifier: us.mappings.reviewOrder.promocode.viewdetailsmessage
      #       - identifier: us.mappings.reviewOrder.promocode.viewDetailscloseButton

      # - click:
      #     identifier: us.mappings.reviewOrder.promocode.viewDetailscloseButton

  - name: us.functions.checkout.reviewOrder.verifypromocodeonPOS
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.pos.promoCodeLabel
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.pos.promoCodeLabel
      - if:
          condition: ${InhomeDevicePromoCodeText} == true
          then:
            - verifyIdentifier:
                label:
                  - identifier: us.mappings.reviewOrder.pos.promoCodeLabel
                    contains: INHOMEDEVICE
            - log: Inhome promo code verified


#flow 66
  - name: us.functions.checkout.reviewOrder.verifyAndSelectInstorePickup
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.pickupLocation.instoreButton
          then:              
            - verifyIdentifier:
                timeout: 30000
                present:
                  - identifier: us.mappings.reviewOrder.pickupTitleLabel
                  - identifier: us.mappings.reviewOrder.pickupLocation.instoreButton
            - click:
                identifier: us.mappings.reviewOrder.pickupLocation.instoreButton
            - log: Switched to in-store pickup

  - name: us.functions.checkout.reviewOrder.clickDonationCheckbox
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.donationCheckbox
      - click:
          identifier: us.mappings.reviewOrder.donationCheckbox
          wait: 5000

  - name: us.functions.checkout.reviewOrder.verifyTotalAmountForDonation
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.orderTotalAmount
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.orderTotalAmount
              contains: ".00"

  - name: us.functions.checkout.handleCheckoutAlert
    platform: ios
    flow: 
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.alert.YouAreAlmostThereHeader
              - identifier: us.mappings.reviewOrder.alert.YouAreAlmostThereText
              - identifier: us.mappings.reviewOrder.alert.leaveAnyWayButton
              - identifier: us.mappings.reviewOrder.alert.keepCheckingOutButton
          then:
            - click: 
                identifier: us.mappings.reviewOrder.alert.leaveAnyWayButton

# Marketplace pickup

  - name: us.functions.checkout.verifyMarketplacePickupSection
    platform: ios
    flow: 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.marketplacePickupLabel
            - identifier: us.mappings.reviewOrder.marketplacePickupHoldTime
            - identifier: us.mappings.reviewOrder.pickupPersonText

  - name: us.functions.revieworder.addGiftDetails
    platform: ios
    flow:
      # - verifyIdentifier:
      #     present: 
      #       - identifier: us.mappings.gifting.recipientAddressButton
      - if: 
          identifier:
            present:
              - identifier: us.mappings.selectAddress.addressRadioButton
          then: 
            - click:
                identifier: us.mappings.selectAddress.addressRadioButton
            - click:    
                identifier: us.mappings.selectAddress.saveButton
      - if: 
          identifier:
            present:
              - identifier: us.mappings.selectAddress.saveButton
          then: 
            - click:
                identifier:  us.mappings.selectAddress.saveButton
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.gifting.reviewOrder.addGiftDetailsButton   
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton
  
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsTitle
            -  identifier: us.mappings.gifting.giftDetails.from   
      - enterText:
          identifier: us.mappings.gifting.giftDetails.recipientEmail
          string: ${recipientEmail}     
      # - enterText:
      #     identifier: us.mappings.gifting.giftDetails.fromField
      #     string: ${from}
      - click:
          identifier: us.mappings.capOne.keyboardDoneButton
      - click:
          identifier: us.mappings.reviewOrder.registryGiftdetailsGiftMessageField
      - enterText:
          identifier: us.mappings.reviewOrder.registryGiftdetailsGiftMessage
          string: ${message} 
          clearField: true
      - click:
          identifier: us.mappings.capOne.keyboardDoneButton
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.gifting.giftDetails.continueButton 

  - name: us.functions.checkout.reviewOrder.verifyingTip
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.tippingSectionTitle
          then:
            # - scroll:
            #     direction: down
            #     untilIdentifier: us.mappings.reviewOrder.tippingSectionTitle
            #     position: center
            - verifyIdentifier:
                present:
                - identifier: us.mappings.revieworder.defaultSelectedTipAmount
            # - sleep:
            #     duration: 3000
            # - scroll:
            #     direction: up 

  - name: us.functions.revieworder.verifyGiftDetails
    platform: ios
    flow:
      - if: 
          identifier:
            present:
              - identifier: us.mappings.gifting.checkout.addressSelection
          then: 
            - click:
                identifier: us.mappings.gifting.checkout.addressSelection.saveButton

      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed

      - sleep:
          duration: 7000
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.gifting.reviewOrder.giftDetailModuleTitle
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsTo
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsFrom
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsMessage

  - name: us.functions.checkout.reviewOrder.editStoreDeliveryTipTo0
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.storeDeliveryTip.Custom
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.reviewOrder.storeDeliveryTip.Custom
          wait: 3000
      - sleep:
          duration: 3000
      - enterText:
          identifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
          string: 0
          # clickFirst: true
      - click:
          identifier: us.mappings.default.keyboardDoneButton
          wait: 2000
      - sleep:
          duration: 3000

  - name: us.functions.reviewOrder.verifyBagFieldAndBanMessage
    platform: ios
    flow:
      # - scroll:
      #     direction: down
      #     untilIdentifier: us.mappings.reviewOrder.verifyBagsBannedMessage
      #     position: center
      #     scrollLimit: 15 
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.verifyBagsBannedMessage
              contains: Please bring your own reusable bag

  - name: us.functions.reviewOrder.substitutionPreferencesLDCallout
    platform: ios
    flow:
       - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.substitutionPreferencesLDCallout
          then:
            - click:
                identifier: us.mappings.reviewOrder.substitutionPreferencesLDCallout
                wait: 2000
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceCloseButton
                wait: 2000

  - name: us.functions.reviewOrder.verifyBagFieldAndBagFeeForDelivery
    platform: ios
    flow:
       - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.substitutionPreferencesLDCallout
          then:
            - click:
                identifier: us.mappings.reviewOrder.substitutionPreferencesLDCallout
            - sleep:
                duration: 3000
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceCloseButton
            - sleep:
                duration: 3000
            - executeFunction:
                name: us.functions.reviewOrder.verifyBagSection
          else:
            - executeFunction:
                name: us.functions.reviewOrder.verifyBagSection

  # Verify bag section details
  - name: us.functions.reviewOrder.verifyBagSection
    platform: ios
    flow:    
      - log: "Validating the bag section details and text"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
            - identifier: us.mappings.reviewOrder.verifyLearnMore
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
              contains: I want my items in bags
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
              contains: I’ll bring my own reusable bags
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagDetailsText
              contains: We’ll pack items for you at pickup
      - log: "Validating the bag fee popup on selecting KnoeMore link"
      - click:
          identifier: us.mappings.reviewOrder.verifyLearnMore
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyLearnMore.bagfee
      - click:
          identifier: us.mappings.reviewOrder.disclaimerViewControllerCloseButton
      - sleep:
          duration: 3000    
      - log: "Validating the bag delivery pending status"      
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryText
          position: center
          scrollLimit: 15
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryValue
      - click:
          identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryText
      - sleep:
          duration: 3000
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryFee
              contains: Your order will be delivered in bags that include a fee of $0.10 per bag.
      - click:
          identifier: us.mappings.reviewOrder.disclaimerViewControllerCloseButton
      - log: "Bag section validation completed"


  - name: us.functions.checkout.reviewOrder.validateStoreDeliveryTip0
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.storeDeliveryTip.amount
      - verifyIdentifier:
          value:
            - identifier: us.mappings.reviewOrder.storeDeliveryTip.amount
              contains: "$0.00"

  - name: us.functions.reviewOrder.verifySubsToggleButton
    platform: ios
    flow: 
      - sleep:
          duration: 7000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
      - click:
          identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subsPreference.bestMatchText
            - identifier: us.mappings.reviewOrder.subsPreferenceOfSecondItem

      - verifyIdentifier:
          enabled:
            - identifier: us.mappings.reviewOrder.subsToggleButton
              value: true
      - click:
          identifier: us.mappings.reviewOrder.subsToggleButton

      # - verifyIdentifier:
      #     notPresent:
      #       - identifier: us.mappings.reviewOrder.subsPreference.bestMatchText
      #       - identifier: us.mappings.reviewOrder.subsPreferenceOfSecondItem 

      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.noSubsMessage   
              contains: No substitutions will be provided for this order.
      - click: # Reenable the Toggle button again to see its working and useful for other test cases
          identifier: us.mappings.reviewOrder.subsToggleButton
      - click:
          identifier: us.mappings.reviewOrder.subsPreference.doneButton

  - name: us.functions.revieworder.editGiftDetails
    platform: ios
    flow:                            
       - scroll:
           direction: down
           untilIdentifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton
           position: center      
       - verifyIdentifier:
           present: 
             - identifier: us.mappings.gifting.reviewOrder.giftDetailsTitle 
       - sleep:
          duration: 5000  
       - click:
           identifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton
       - click:    
           identifier: us.mappings.global.closeButton        
       - verifyIdentifier:
           notPresent: 
             - identifier: us.mappings.gifting.reviewOrder.toFieldGiftDetails 

  - name: us.functions.checkout.reviewOrder.verifyEditPickPersonLink 
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editPickupPersonLink
      - click:
          identifier: us.mappings.reviewOrder.editPickupPersonLink
          coordinates: 50% , 50%
      - sleep:
         duration: 3000
      - enterText:
          identifier: us.mappings.reviewOrder.editPickupPerson.FirstNameField
          string: ${pickupPersonFirstName}
          clearField: true
      - if:
          identifier:
            present:
              - identifier: us.mappings.default.keyboardDoneButton
          then:
            - click:
                identifier: us.mappings.default.keyboardDoneButton
      - enterText:
          identifier: us.mappings.reviewOrder.editPickupPerson.LastNameField
          string: ${pickupPersonLastName}
          clearField: true
      - if:
          identifier:
            present:
              - identifier: us.mappings.default.keyboardDoneButton
          then:
            - click:
                identifier: us.mappings.default.keyboardDoneButton
      - click:
          identifier: us.mappings.reviewOrder.editPickupPerson.saveButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.backendErrorMessage
          then:
            - failTest:
                message: "ENV_FAILURE - ${env} Unable to edit pickup person details"  # CEPG-245470

  - name: us.functions.checkout.reviewOrder.verifyViewItemDetailsLink 
    platform: ios
    flow:

      - click:
          identifier: us.mappings.reviewOrder.viewDetailsLink

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemDetails.title
            - identifier: us.mappings.reviewOrder.itemDetails.dateLabel
            - identifier: us.mappings.reviewOrder.itemDetails.itemDescription

      - click:
          identifier: us.mappings.reviewOrder.itemDetails.closeButton


  - name: us.functions.reviewOrder.verifyBagsDetailsOurSustainabilityPledge
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
      - if: 
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.bagOptInViewTitle
          then:
            - log: "new Bag optin screen"
            - click:
                identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
          else:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
                position: center
                scrollLimit: 15
            - click:
                identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
            - click:
                identifier: us.mappings.reviewOrder.sustainabilityPledge
            - sleep:
                duration: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.ourSustainabilityPledgePopUp
            - click:
                identifier: us.mappings.reviewOrder.disclaimerViewControllerCloseButton
            - sleep:
                duration: 3000              
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineLeft  
            - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineRight 
                 
  - name: us.functions.reviewOrder.verifyBagsDetailsIWantMyItemsInBags
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.bagOptInViewTitle
          then:
           - click:
              identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.sustainabilityPledge
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center 
            - click:
                identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton
            - click:
                identifier: us.mappings.reviewOrder.verifyLearnMore
            - sleep:
                duration: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyLearnMore.bagfee
            - click:
                identifier: us.mappings.reviewOrder.disclaimerViewControllerCloseButton
            - sleep:
                duration: 3000  
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineLeft  
            - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineRight 

  # This is a reusable function to validate the Violation Policy prompt. Can be used for different Prompt validations.
  - name: us.functions.reviewOrder.mip.confirmItemPolicy.editItems  #Joel Function
    platform: ios
    flow:  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton        
      - verifyIdentifier:
          timeout: 50000
          present:
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.id
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.editButton.id
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.closeButton.id         
      - verifyIdentifier:
          timeout: 50000
          present:            
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.headerText
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.violationText
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.itemDescription
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.instructions
      - log: The "Edit items" CTA Button is present, Click and then Assert User is redirected to cart
      - click:
          identifier: us.mappings.reviewOrder.mip.bottomSheet.editButton.id
          wait: 5000
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: us.mappings.cart.navBarTitle
      - log: The "Edit items" CTA Button has been clicked and user is now redirected to Cart.
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.itemSaveForLaterLink
      - click:
          identifier: us.mappings.cart.itemSaveForLaterLink
          wait: 5000
          
  - name: us.functions.reviewOrder.verifyCheckoutAcceptorSkipBagFeeField
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.sustainabilityPledge
          position: center                       
      - if:
          condition: ${option} == 'AcceptBagFee'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
            - click:
                identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
            - sleep:
               duration: 3000   
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyLearnMore
            - sleep:
               duration: 3000            
            - click:
                identifier: us.mappings.reviewOrder.verifyLearnMore
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyLearnMore.bagfee
            - click:
                identifier: us.mappings.reviewOrder.okayButton
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineLeft
                  - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineRight
          else:
            - if:
                condition: ${option} == 'SkipBagFee'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText               
                  - click:
                      identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
                  - sleep:
                     duration: 3000 
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.sustainabilityPledge
                      then:
                        - click:
                            identifier: us.mappings.reviewOrder.sustainabilityPledge
                        - sleep:
                            duration: 3000         
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.reviewOrder.verifyOurSustainabilityPledge
                        - sleep:
                            duration: 3000                    
                        - click:
                            identifier: us.mappings.reviewOrder.okayButton
                        - sleep:
                            duration: 3000
                        - verifyIdentifier:
                            notPresent: 
                              - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineLeft  
                              - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLineRight


###################### ANDROID ##################

  - name: us.functions.checkout.reviewOrder.scheduledPickup.verifyCard
    platform: android
    flow:
      - log: Validate fulfillment details
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToSection
          params:
            - name: fulfillmentText
              string: Curbside pickup
    
    
      - verifyIdentifier:
          present:
        #enable after https://jira.walmart.com/browse/OAMC-847 is resolved
            #- identifier: us.mappings.reviewOrder.navBarTitle
            - identifier: us.mappings.reviewOrder.pickup.cardTitle
            - identifier: us.mappings.reviewOrder.slotDetails
            - identifier: us.mappings.reviewOrder.pickupPersonText
            - identifier: us.mappings.reviewOrder.pickupPersonName # depending upon how this will be coded this could just be a parameter and not require a predefined identifier
            - identifier: us.mappings.reviewOrder.editPickupPersonLink
      - log: Finished veryifying ReviewOrder Elements   
      # - verifyChecked:
      #     identifier: us.mappings.reviewOrder.getTextCheckBox
      #     value: true

  - name: us.functions.reviewOrder.chooseSubsPreferences
    platform: android
    flow: 
      - sleep:
          duration: 7000
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - if:
          condition: ${fulfillmentType} == 'Shipping'
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.notEligibleSubsText
                  - name: direction
                    string: down 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subsPreference.notEligibleSubsText
            - log: Item is not eligible for substitution
                                         
          else:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton

            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.editButtonOfItem
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.editButtonOfItem

            - if:
                condition: ${option} == 'bestMatch'
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.subsPreference.bestMatchRadioButton
                else:
                  - if:
                      condition: ${option} == 'dontReplace'
                      then:
                        - executeFunction:
                            name: us.functions.utils.scrollIfNotVisible
                            params:
                              - name: identifier
                                string: us.mappings.reviewOrder.noSubstitutionButton
                              - name: direction
                                string: down
                        - click:
                            identifier: us.mappings.reviewOrder.noSubstitutionButton 
                      else:
                        - if:
                            condition: ${option} == 'replaceWith'
                            then:
                              - executeFunction:
                                  name: us.functions.utils.scrollIfNotVisible
                                  params:
                                    - name: identifier
                                      string: us.mappings.reviewOrder.subsPreference.search.selectButton
                                    - name: direction
                                      string: down
                                    - name: scrollPosition
                                      string: center
                              - if:
                                  identifier:
                                    present:
                                      - identifier: us.mappings.reviewOrder.subsPreference.alreadyExistingItem
                                  then:
                                    - click:
                                        identifier: us.mappings.reviewOrder.subsPreference.alreadyExistingItem 
                                    - getString:
                                        identifier: us.mappings.reviewOrder.subsPreference.alreadyExistingItem
                                        attribute: text
                                        storeIn: itemtitle  
                                    - log:  ${itemtitle} 
                                  else:                                                   
                                    - click:
                                        identifier: us.mappings.subsPreference.searchItemButton
                                    - click:
                                        identifier: us.mappings.subsPreference.searchBarSelected
                                    - enterText:
                                        identifier: us.mappings.subsPreference.searchBarSelected
                                        string: ${searchTerm}
                                        pressEnter: true
                                    - sleep:
                                        duration: 10000
                                    - click:
                                        identifier: us.mappings.subsPreference.firstItem  
                                    - getString:
                                        identifier: us.mappings.subsPreference.firstItem
                                        attribute: text
                                        storeIn: itemtitle
                                    - log:  ${itemtitle}  

            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.search.selectButton
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.search.selectButton

      - click:
          identifier: us.mappings.reviewOrder.subsPreference.doneButton

  - name: us.functions.reviewOrder.verifySubsToggleButton
    platform: android
    flow: 
      - sleep:
          duration: 7000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
      - click:
          identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsExpandedGroup
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subsPreference.replaceWithRadioButton      
                  - identifier: us.mappings.reviewOrder.subsPreferenceOfFirstItem
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subsPreference.replaceWithTitle       
                  - identifier: us.mappings.reviewOrder.subsPreferenceOfFirstItem
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreferenceOfSecondItem
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.subsPreferenceOfSecondItem

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subsToggleButton
      - click:
          identifier: us.mappings.reviewOrder.subsToggleButton

      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.reviewOrder.subsPreference.bestMatchText          
            - identifier: us.mappings.reviewOrder.subsPreferenceOfFirstItem

      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.noSubsMessage   
              equals: No substitutions will be provided for this order.

      - click: # Reenable Toggle again to validate substittue use cases for other test cases
          identifier: us.mappings.reviewOrder.subsToggleButton

      - click:
          identifier: us.mappings.reviewOrder.subsPreference.doneButton
      - sleep:
          duration: 7000

  - name: function.checkout.reviewOrder.mobileNumberValidater
    platform: android
    flow:
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.mobileContactText
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox
          #  - identifier: us.mappings.reviewOrder.sendTextUpdates.toDifferentPhone.link

  # Srolls to top of review order page
  - name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
    platform: android
    flow:
      - log: Scrolling to top of review order page
      - sleep:
          duration: 2000
      # Validate if Review Order title is displayed
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.navBarTitle
      - loop:
          begin: 0
          end: 7
          storeIndex: scrollIndex
          mode: increment
          flow:
            - log: Check ${scrollIndex}
            # If any fulfillment section is displayed
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.fulfillmentTopSection.fulfillmentTypeText
                then:
                  - if:
                      condition: ${validateText} == null
                      then:
                        # Store currently displayed fulfillment section text to be used in next loop
                        - getString:
                            identifier: us.mappings.reviewOrder.fulfillmentTopSection.fulfillmentTypeText
                            attribute: text
                            storeIn: validateText
                      else:
                        # Store currently displayed fulfillment section text and compate with previous section text
                        - getString:
                            identifier: us.mappings.reviewOrder.fulfillmentTopSection.fulfillmentTypeText
                            attribute: text
                            storeIn: compareText
                        - log: Store currently displayed fulfillment type and compare with previously displayed fulfillment type text
                        # If previous and current fulfillment section texts are same, top of review order page is reached. Hence exit loop
                        # Else, assign current displayed fulfillment section text to ${validateText} for next run
                        - if:
                            condition: ${validateText} == ${compareText}
                            then:
                              - log: Breaking the loop as review order page top is reached
                              - break: true
                            else:
                              - storeIn:
                                  key: validateText
                                  value: ${compareText}
                              - log: Store current fulfillment type text for next run before scrolling up
            # Scroll up until loop is not breaked
            - log: Scrolling up till cart page top is reached
            - scroll:
                direction: up
      # Reset to default
      - storeIn:
          key: validateText
          value: 'null'

  # [mandatory] ${fulfillmentText} - Shipping/Curbside pickup/Digital delivery ... [Required to scroll to the appropriate reviewOrder fulfillment section]
  # [optional]  ${resetScrollDetails} - true/false [default false] [Set to true if function is called during multiple navigations to review order page]
  - name: us.functions.checkout.reviewOrder.scrollToSection
    platform: android
    flow:
      - log: -------Scroll to ${fulfillmentText} section start-------
      - log: Function to scroll and display appropriate fulfillment section
      - if:
          condition: $resetScrollDetails
          then:
            - storeIn:
                key: firstReviewSection
                value: 'null'
      # Get top section fulfillment type text from review page and save to 'firstReviewSection' variable
      - log: Scroll to top of review page
      - if:
          condition: ${firstReviewSection} == null
          then:
            # Scroll to cart page top
            - executeFunction:
                name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
            # Store the fulfillment details text for top section
            - getString:
                identifier: us.mappings.reviewOrder.fulfillmentTopSection.fulfillmentTypeText
                attribute: text
                storeIn: firstReviewSection
            - log: ${firstReviewSection}
      # Scroll up until top section fulfillment type is not displayed based on 'firstReviewSection' variable data saved from above step
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.fulfillmentFirstSection.fulfillmentTypeText
          then:
            - log: Already at the top of review page
          else:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.reviewOrder.fulfillmentFirstSection.fulfillmentTypeText
            - log: Scrolled to top of the page
      - try:
          flow:
            # Skips scrolling if required section is already displayed
            - log: Skip scrolling if required section is already displayed
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.reviewOrder.fulfillmentFirstSection.fulfillmentTypeText
                    contains: ${fulfillmentText} 
            - log: Required reviewOrder ${fulfillmentText} fulfillment section already displayed.
          catch:
            flow:
              # Scrolls to appropriate section
              - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: direction
                      string: down
                    - name: identifier
                      string: us.mappings.reviewOrder.fulfillmentSection.fulfillmentTypeText
                    - name: scrollPosition
                      string: center
              - log: Required review order ${fulfillmentText} fufillment section is scrolled.
              
      # Reset to default
      - storeIn:
          key: resetScrollDetails
          value: false
      - log: -------Scroll to ${fulfillmentText} section end-------

  # Utility to validate review order details for any fulfillment type
  # [mandatory] ${fulfillmentText} - Shipping/Delivery from store/Curbside Pickup/Digital delivery/Auto Care... [Required to scroll to the appropriate cart fulfillment section]
  # [optional]  ${unscheduled}     - true/false [default false] [Set to true if unscheduled item fulfillment time needs to be validated]
  # [optional]  ${expressSlot}     - true/false [default false] [Set to true if express slot fulfillment time needs to be validated]
  - name: us.functions.checkout.reviewOrder.verifyCardDetails
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - executeFunction:
          name: us.functions.utils.getFulfillmentTextsToCompare
      - log: -------Validate ${fulfillmentText} review order details function start-------
      # Review order page load check
      - if:
          condition: ${initialCheckoutDataSetup} == null
          then:
            - sleep:
                duration: 5000
            # Validate if Review Order page is loaded
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.navBarTitle
                then:
                  - log: Review order page loaded successfully
                else:
                  - failTest:
                      message: "ENV_FAILURE - ${env} review order page load ERROR"
            - storeIn:
                key: initialCheckoutDataSetup
                value: complete
          else:
            - log: Review order page already loaded and inital setup is done.

      # Scroll to appropriate section
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToSection

      - try:
          flow:
            # Verify required section is displayed
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentTypeText
          catch:
            flow:
              - failTest:
                  message: "FAILURE - ${env} - ${fulfillmentText} fulfillment section not displayed in review order page"

      # Scroll down if section details are not displayed and verify
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.fulfillmentSection.fulfillmentDate
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentDate

      # Verify address/name details for all fulfillment type except digital delivery
      - if:
          condition: ${fulfillmentText} != 'Digital delivery'
          then:
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.fulfillmentSection.fulfillmentAddress
                  - name: direction
                    string: down
            - verifyIdentifier:
                present:      
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentDescription
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentAddress
            - log: Name and address validations completed

            # Verify unscheduled time details
            - if:
                condition: ${unscheduled}
                then:
                  - verifyIdentifier:
                      text:
                        - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentDate
                          contains: us.data.text.anytimeAfter
                  - log: Validated unscheduled fulfillmentTime details
                else:
                  - if:
                      condition: ${expressSlot}
                      then:
                        - verifyIdentifier:
                            present:
                              - identifier: us.mappings.reviewOrder.expressDelivery.slotTime
                        - log: Validated express fulfillmentTime details

      # Verify Auto care specific details
      - if:
          condition: ${fulfillmentText} == 'Auto Care'
          then:
            - verifyIdentifier:
                present:      
                  - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentHoldTime
            - log: Hold time validation completed

      # Scroll down if section item details are not displayed and verify
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentItemCount
          then:
            - scroll:
                direction: down
                position: center
                untilIdentifier: us.mappings.reviewOrder.fulfillmentSection.itemCount
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.fulfillmentSection.itemCount
            # - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentItemCount
            # - identifier: us.mappings.reviewOrder.fulfillmentSection.fulfillmentItemDetails
      - log: Item details validations completed
      - storeIn:
          key: altFulfillmentText
          value: 'null'
      - log: -------Validate ${fulfillmentText} review order details function end-------

  # New Utility to validate review order/Cart page details for any multiple fulfillment type present in review order page.
  # [mandatory] ${listOfExpectedFulfilment} - Shipping/Delivery from store/Pickup/Digital delivery/Auto Care... [In a String for example Pickup, Shipping, Digital delivery, Auto Care Center]
  # [mandatory] ${cart} - true / false (set flag true for cart page validation)
  # TBD[optional]  ${unscheduled}     - true/false [default false] [Set to true if unscheduled item fulfillment time needs to be validated]
  # TBD[optional]  ${expressSlot}     - true/false [default false] [Set to true if express slot fulfillment time needs to be validated]

  - name: us.functions.verifyCardDetailsNew
    platform: android
    flow:
    # Condition for handling the same function for both cart and review order page
      - if:
          condition: ${cart}
          then:
            - executeFunction:
                name: us.functions.cart.scrollToTopOfCart
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.cart.navBarTitle
                then:
                  - log: Cart page displayed
                  - storeIn:
                      key: cart
                      value: false
                else:
                  - failTest:
                      message: "FAILURE - ${env} - cart page is not displayed"
          else:
            - if:
                condition: ${reviewOrder}
                then:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.navBarTitle
                      then:
                        - log: Review order page loaded successfully
                        # Scroll to top of Review order page
                        - executeFunction:
                            name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
                        - storeIn:
                            key: reviewOrder
                            value: false
                      else:
                        - failTest:
                            message: "ENV_FAILURE - ${env} review order page load ERROR"
      - storeIn:
          key: listOfFulfilmentDetails
          value: ''
      - loop:
          begin: 0
          end: 7
          storeIndex: scrollIndex
          mode: increment
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.global.fulfilmentCardTitleForVerifying
                then:
                  - getString:
                      identifier: us.mappings.global.fulfilmentCardTitleForVerifying
                      attribute: text
                      storeIn: fulfillmentAvailable
                  - log: ${fulfillmentAvailable}
                  - storeIn:
                      key: listOfFulfilmentDetails
                      value: ${listOfFulfilmentDetails}${fulfillmentAvailable}####
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.global.fulfilmentCardPreviousTitle
                then:
                  - scroll:
                      direction: down
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.global.fulfilmentCardTitle
                then:
                  - break: true
      - executeNode:
          file: us/e2e-tests/helpers/cardValidation.js
          args:
            - value: ${listOfFulfilmentDetails}
            - value: ${listOfExpectedFulfilment}
          getResponse:
            storeIn: validationStatus
      - log: ${validationStatus}
      - if:
          condition: ${validationStatus} == 'Validation Completed all expected fulfilments are available'
          then:
            - log: verify Card Details successful
            - storeIn:
                key: fulfillmentAvailable
                value: 'null'
          else:
            - failTest:
                message: ${validationStatus}

  # New Utility to validate review order/Cart page details for any multiple fulfillment type present in review order page.
  # [mandatory] ${listOfExpectedFulfilment} - Shipping/Delivery from store/Pickup/Digital delivery/Auto Care... [In a String for example Pickup, Shipping, Digital delivery, Auto Care Center]
  # [mandatory] ${cart} - true / false (set flag true for cart page validation)
  # TBD[optional]  ${unscheduled}     - true/false [default false] [Set to true if unscheduled item fulfillment time needs to be validated]
  # TBD[optional]  ${expressSlot}     - true/false [default false] [Set to true if express slot fulfillment time needs to be validated]

  - name: us.functions.verifyCardDetailsNew
    platform: ios
    flow:
    # Condition for handling the same function for both cart and review order page
      - if:
          condition: ${cart}
          then:
            - executeFunction:
                name: us.functions.cart.scrollToTopOfCart
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.cart.navBarTitle
                then:
                  - log: Cart page displayed
                  - storeIn:
                      key: cart
                      value: false
                else:
                  - failTest:
                      message: "FAILURE - ${env} - cart page is not displayed"
      # else part handle review order page
          else:
            - if:
                condition: ${reviewOrder}
                then:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.reviewOrder.navBarTitle
                      then:
                        - log: Review order page loaded successfully
                        # Scroll to top of Review order page
                        - executeFunction:
                            name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
                        - storeIn:
                            key: reviewOrder
                            value: false
                      else:
                        - failTest:
                            message: "ENV_FAILURE - ${env} review order page load ERROR"
      - numberOfChildElements:
          identifier: us.mappings.global.fulfilmentCardPage
          filterBy: us.mappings.global.fulfilmentCardTitle
          storeIn: noOfCard
      - arithmetic:
          expression: ${noOfCard} + 1
          storeIn: noOfCard
      - storeIn:
          key: listOfFulfilmentDetails
          value: ''
      - loop:
          begin: 1
          end: ${noOfCard}
          storeIndex: scrollIndex
          mode: increment
          flow:
            - getString:
                identifier: us.mappings.global.fulfilmentCardTitleWithIndex
                attribute: label
                storeIn: fulfillmentAvailable
            - log: ${fulfillmentAvailable}
            - storeIn:
                key: listOfFulfilmentDetails
                value: ${listOfFulfilmentDetails}${fulfillmentAvailable}####
      - executeNode:
          file: us/e2e-tests/helpers/cardValidation.js
          args:
            - value: ${listOfFulfilmentDetails}
            - value: ${listOfExpectedFulfilment}
          getResponse:
            storeIn: validationStatus
      - log: ${validationStatus}
      - if:
          condition: ${validationStatus} == 'Validation Completed all expected fulfilments are available'
          then:
            - log: verify Card Details successful
          else:
            - failTest:
                message: ${validationStatus} 
           

  - name: us.functions.checkout.reviewOrder.reviewOrderPageLoadValidation
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.navBarTitle
          then:
            - log: Review order page loaded successfully
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} review order page load ERROR"

  - name: us.functions.checkout.reviewOrder.scDelivery.verifyCard
    platform: android
    flow:
      # - scroll:
      #     direction: up
      #     untilIdentifier: us.mappings.reviewOrder.scheduledDelivery.cardTitle
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToSection
          params:
            - name: fulfillmentText
              string: Delivery from store
            - name: resetScrollDetails
              string: true
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.scheduledDelivery.cardTitle
            - identifier: us.mappings.reviewOrder.slotDetails
            - identifier: us.mappings.reviewOrder.deliveryAddress
            - identifier: us.mappings.reviewOrder.deliveryInstructions.title
            - identifier: us.mappings.reviewOrder.deliveryInstructionsText
            - identifier: us.mappings.reviewOrder.deliveryInstructionsAddLink
            - identifier: us.mappings.reviewOrder.deliveryInstructions.leaveAtMyDoorButton
            - identifier: us.mappings.reviewOrder.deliveryInstructions.willSignButton

      # - verifyChecked:
      #     identifier: us.mappings.reviewOrder.getTextCheckBox
      #     value: true

  - name: us.functions.checkout.reviewOrder.fcDelivery.verifyCard
    platform: android
    flow:
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.reviewOrder.loadingSpark
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToSection
          params:
            - name: fulfillmentText
              string: Shipping
            - name: resetScrollDetails
              string: true
      - verifyIdentifier:
          present:
        #enable after https://jira.walmart.com/browse/OAMC-847 is resolved
            #- identifier: us.mappings.reviewOrder.navBarTitle
            - identifier: us.mappings.reviewOrder.cardTitle
            # - identifier: us.mappings.cart.scheduledDelivery.deliveryEstimate
            # - identifier: us.mappings.reviewOrder.pickupPersonName
            # - identifier: us.mappings.reviewOrder.deliveryAddress
            # - identifier: us.mappings.reviewOrder.fcDelivery.smsCopy
            - identifier: us.mappings.reviewOrder.placeOrderButton
    

  - name: us.functions.reviewOrder.verifyBagFieldAndBagFeeForDelivery
    platform: android
    flow:
       - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.substitutionPreferencesLDCallout
          then:
            - click:
                identifier: us.mappings.reviewOrder.substitutionPreferencesLDCallout
            - sleep:
                duration: 3000
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceCloseButton
            - sleep:
                duration: 3000
            - executeFunction:
                name: us.functions.reviewOrder.verifyBagSection
          else:
            - executeFunction:
                name: us.functions.reviewOrder.verifyBagSection


  # Verify bag section details
  - name: us.functions.reviewOrder.verifyBagSection
    platform: android
    flow:    
      - log: "Validating the bag section details and text"
      - try:
          flow:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
                  - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
                  - identifier: us.mappings.reviewOrder.verifyLearnMore
          catch:
            flow:
              - failTest:
                  message: "FAILURE - ${env} - Accept/Skip Bag fee Section Module missing - CEPG-256196"
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
              contains: I want my items in bags
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
              contains: I’ll bring my own reusable bags
            - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagDetailsText
              contains: I’ll pay a 10¢ fee per bag.
            - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagDetailsText
              contains: We’ll pack items for you at pickup.
      - log: "Validating the bag fee popup on selecting KnoeMore link"
      - click:
          identifier: us.mappings.reviewOrder.verifyLearnMore
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyLearnMore.bagfee
      - click:
          identifier: us.mappings.reviewOrder.mip.bottomSheet.closeButton.id
      - sleep:
          duration: 3000    
      - log: "Validating the bag delivery pending status"      
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryText
          position: center
          scrollLimit: 15
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryValue
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryText
              contains: Bag fee
            - identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryValue
              contains: Pending
      - click:
          identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryIcon
      - sleep:
          duration: 3000
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.verifyBagFeePendingDeliveryFee
              contains: Laws in your region require us to charge you a fee of 10¢ per bag
      - click:
          identifier: us.mappings.reviewOrder.mip.bottomSheet.closeButton.id
      - log: "Bag section validation completed"              

  - name: us.functions.checkout.reviewOrder.verifyPaymentCardsDisplay
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 3000
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.reviewOrder.placeOrderButton
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.totalLabel
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.cardSummaries
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.reviewOrder.cardSummaries
                position: center
      - if:
          condition: ${verifyEBT} == 'exists'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.cardSummaries.ebt
          else:
            - if:
                condition: ${verifyEBT} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.cardSummaries.ebt
      - if:
          condition: ${verifyGC} == 'exists'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.cardSummaries.gc
          else:
            - if:
                condition: ${verifyGC} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.cardSummaries.gc
      - if:
          condition: ${verifyCC} == 'exists'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.cardSummaries.cc
          else:
            - if:
                condition: ${verifyCC} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.cardSummaries.cc
      - if:
          condition: ${verifyRC} == 'exists'
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.cardSummaries.refundCard
          else:
            - if:
                condition: ${verifyEBT} == 'notExists'
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.reviewOrder.cardSummaries.refundCard
      - try:
          flow:
            - if:
                condition: ${verifyDS} == 'exists'
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.cardSummaries.ds
                else:
                  - if:
                      condition: ${verifyDS} == 'notExists'
                      then:
                        - verifyIdentifier:
                            notPresent:
                              - identifier: us.mappings.reviewOrder.cardSummaries.ds
          catch:
            flow:
              - failTest:
                  message: "FAILURE - ${env} - DS card is not the auto-selected payment method, verification failed in Review Order page"
      - scroll:
          direction: up

  - name: us.functions.checkout.reviewOrder.verifyEditPickPersonLink 
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editPickupPersonLink
      - click:
          identifier: us.mappings.reviewOrder.editPickupPersonLink
      - click:
          identifier: us.mappings.reviewOrder.editPickupPerson.FirstNameField
      - enterText:
          identifier: us.mappings.reviewOrder.editPickupPerson.FirstNameField
          string: ${pickupPersonFirstName}
      #- goBack: true
      - click:
          identifier: us.mappings.reviewOrder.editPickupPerson.LastNameField
      - enterText:
          identifier: us.mappings.reviewOrder.editPickupPerson.LastNameField
          string: ${pickupPersonLastName}
      #- goBack: true

      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.editPickupPerson.phoneNumberField
          then:
            - enterText:
                identifier: us.mappings.reviewOrder.editPickupPerson.phoneNumberField
                string: ${pickupPersonPhoneNumber}
            #- goBack: true

      - click:
          identifier: us.mappings.reviewOrder.editPickupPerson.saveButton
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.editPickupPerson.saveButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.editPickupPerson.saveButton
      - sleep:
          duration: 5000

  - name: us.functions.checkout.reviewOrder.verifyViewItemDetailsLink 
    platform: android
    flow:

      - click:
          identifier: us.mappings.reviewOrder.editItemButton

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemDetails.title
            - identifier: us.mappings.reviewOrder.itemDetails.dateLabel
            - identifier: us.mappings.reviewOrder.itemDetails.itemDescription

      - click:
          identifier: us.mappings.reviewOrder.itemDetails.closeButton

  - name: us.function.checkout.reviewOrder.verifyItemDetails
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.checkoutButton
          then:
            - click:
                wait: 5000
                identifier: us.mappings.cart.checkoutButton
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - click:
          identifier: us.mappings.reviewOrder.viewLink
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemNameDetails
      - verifyIdentifier:
          present:
            - identifier: us.mappings.checkout.reviewOrder.viewItemDetailDone
      - click:
          identifier: us.mappings.checkout.reviewOrder.viewItemDetailDone
      - sleep:
          duration: 2000

  - name: us.functions.cart.getItemName
    platform: android
    flow:
    - sleep:
       duration: 2000
    - verifyIdentifier:
       present:
         - identifier: us.mappings.cart.getItemName
    - getString:
       identifier: us.mappings.cart.getItemName
       attribute: text
       storeIn: itemName1
    - log:
       message: $itemName1

  - name: us.functions.checkout.enterMobileContact
    platform: android
    flow:
      - executeFunction:
          name: function.checkout.reviewOrder.mobileNumberValidater
      # - click:
      #     identifier: us.mappings.reviewOrder.sendTextUpdates.toDifferentPhone.link
      - enterText:
          identifier: us.mappings.reviewOrder.mobileContact.phoneNumberField
          string: ${phoneNumber}
          clearField: true
      - goBack: true
      # - click:
      #     identifier: us.mappings.reviewOrder.phoneNumber.saveButton
      #     wait: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox
      # Workaround for warning during placing order with checkbox selected sometimes
      - if:
          identifier:
            checked:
               - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox
                 value: true
          then:
            - click:
                identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox

  - name: us.function.checkout.reviewOrder.subscriptionTerms.checkBox
    platform: android
    flow:
    - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subscriptionTerms.checkBox
    - click:
            identifier: us.mappings.reviewOrder.subscriptionTerms.checkBox


  - name: us.functions.checkout.placeOrder
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - executeFunction:
          name: us.functions.utils.cvv.errorHandling
      - executeFunction:
          name: us.functions.reviewOrder.alcoholCheckbox.errorHandling
      - loop:
          begin: 1
          end: 4
          storeIndex: tryCount
          mode: increment
          flow:
            - log: Place order try count - ${tryCount}
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.placeOrderButton
            - click:
                identifier: us.mappings.reviewOrder.placeOrderButton
                wait: 10000
            # Conditionally execute if EBT card is added for payment
            - if:
                condition: ${ebtExists}
                then:
                  - sleep:
                      duration: 15000
                  - if: 
                      identifier:
                        present: 
                          - identifier: us.mappings.paymentMethod.checkout.continueButton
                      then:
                        - executeFunction: 
                            name: us.functions.account.paymentMethod.enterEBTPin
            - if:
                condition: ${ebtNewExists}
                then:
                  - sleep:
                      duration: 15000
                  - if: 
                      identifier:
                        present: 
                          - identifier: us.mappings.paymentMethod.checkout.continueButton
                      then:
                        - executeFunction: 
                            name:  us.functions.account.paymentMethod.enterEBTPinNew 

            - if:
                condition: ${Wic}
                then:
                  - sleep:
                      duration: 15000
                  - if: 
                      identifier:
                        present: 
                          - identifier: us.mappings.paymentMethod.checkout.continueButton
                      then:
                        - executeFunction: 
                            name: us.functions.account.paymentMethod.enterWicPin

            - if:
                identifier:
                  present:
                    - identifier: us.mappings.checkout.verifySubscriptionTermsBottomSheet #us.mappings.subscribe.manageSubscription.termsAndConditionsPopUP
                then:
                  - executeFunction:
                      name: us.functions.subs.validateNewUISubscriptioTermsPageAndAccept

            - sleep:
                duration: 5000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.popup.technicalError
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.popup.okButton
                  - click:
                      identifier: us.mappings.popup.okButton
                else:
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.paymentMethod.checkout.walletTitle
                      then:
                        - click:
                            identifier: us.mappings.reviewOrder.paymentMethod.continueButton
                        - sleep:
                            duration: 5000
                      else:
                        - break: true
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - if:
          identifier:
            present:
              - identifier: us.mappings.typage.yourorderisconfirmed
          then:
            - executeFunction:
               name: us.functions.deliveryInstructions.thankyoupage
      - executeFunction:
          name: us.functions.orderConfirmation.orderCreationValidation

  - name: us.functions.checkout.enterEBTPinAndPlaceOrder
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
          then:
              - executeFunction: 
                  name: us.functions.reviewOrder.verifyBagsDetailsOurSustainabilityPledge
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.continueButton
      - click:
          identifier: us.mappings.paymentMethod.checkout.continueButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.submitEBTPin   
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebtPin.payframe
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.EBTPinField
            - enterText:
                identifier: us.mappings.reviewOrder.EBTPinField
                string: 0005
            - click:
                identifier: us.mappings.reviewOrder.submitEBTPin
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - executeFunction:
          name: us.functions.orderConfirmation.orderCreationValidation

  - name: us.functions.checkout.placeOrderAgainIfError
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.popup.technicalError
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.popup.okButton
            - click:
                identifier: us.mappings.popup.okButton
            - executeFunction:
                name: us.functions.checkout.placeOrder

  - name: us.functions.checkout.reviewOrder.verifyThresholdFeesOnReviewOrder
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.thresholdText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.thresholdText

  - name: us.functions.checkout.reviewOrder.verifyNoThresholdFeesOnReviewOrder
    platform: android
    flow:
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.reviewOrder.thresholdText

  - name: us.functions.checkout.reviewOrder.verifyThresholdFee
    platform: android
    flow:          
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.totalLabel
            - name: direction
              string: down
            - name: scrollPosition
              string: center 
      - executeFunction:
          name: us.functions.utils.fetchAmountDisplayed
          params:
            - name: identifier
              string: us.mappings.reviewOrder.subTotalEffectiveAmount
            - name: attribute
              string: content-desc
            - name: delimeter
              string: '$'

      - if:
          condition: ${amountValue} > 35.00
          then:
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.reviewOrder.thresholdText  
          else:     
            - if:
                condition: ${amountValue} < 35.00     
                then:
                  - verifyIdentifier:
                      notPresent:
                        - identifier: us.mappings.wplus.reviewOrder.pos.oldThresholdValue
                        - identifier: us.mappings.wplus.reviewOrder.pos.thresholdValue
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.thresholdText 
                        - identifier: us.mappings.reviewOrder.POS.thresholdAmount
                        - identifier: us.mappings.reviewOrder.POS.threshold
                  - executeFunction:
                      name: us.functions.utils.fetchAmountDisplayed
                      params:
                        - name: identifier
                          string: us.mappings.reviewOrder.POS.thresholdAmount
                        - name: attribute
                          string: text
                        - name: delimeter
                          string: '$'                
                  - if:
                      condition: ${amountValue} > 0
                      then:  
                        - log :  Verified below order minimum fee is ${amountValue}   
                      else:
                        - if:
                            condition: ${amountValue} == 0
                            then:
                              - failTest:
                                  message: "FAILURE - ${env} - Below order minimum fee should never be 0" 


  - name: us.functions.checkout.reviewOrder.verifyScDeliveryFee
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.scDelivery.fee
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.scDelivery.fee

  - name: us.functions.checkout.confirmCvvBeforePlaceOrder
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.walletSection
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.walletSection
                position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
          then:
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvPutField
            - enterText:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvPutField
                string: ${cvv}
            - goBack: true

  - name: us.functions.checkout.confirmCvvAndPlaceOrder
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton
          wait: 3000       
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.confirmCvv.cvvField
          then:
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvPutField
            - enterText:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvPutField
                string: ${cvv}
                pressEnter: true
            - executeFunction:
                name: us.functions.checkout.placeOrder
          else:
            # Conditionally execute if EBT card is added for payment
            - if:
                condition: ${ebtExists}
                then:
                  - executeFunction:
                      name: us.functions.account.paymentMethod.enterEBTPin
            - verifyIdentifier:
                timeout: 80000
                notPresent:
                  - identifier: us.mappings.reviewOrder.placeOrderButton


  #Verify Substitution Page
  - name: us.functions.checkout.reviewOrder.verifySubstitutionPopUp
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.substitution.pageTitle
            - identifier: us.mappings.reviewOrder.substitution.pagesubTitle
            - identifier: us.mappings.reviewOrder.allowsubstitutionTitle
            - identifier: us.mappings.reviewOrder.allowsubstitutionCheckbox
            - identifier: us.mappings.reviewOrder.itemtileCheckbox
            - identifier: us.mappings.reviewOrder.substitution.doneButton

  - name: us.functions.checkout.reviewOrder.verifyNoSubstitutionPopUp
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.substitution.pageTitle
            - identifier: us.mappings.reviewOrder.substitution.pagesubTitle
            - identifier: us.mappings.reviewOrder.nosubstitutionTitle
            - identifier: us.mappings.reviewOrder.substitution.doneButton

  - name: us.functions.checkout.reviewOrder.naviagatetoaddpaymentmethod
    platform: android
    flow:

      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.addPaymentmethodButton
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.addPaymentmethodButton
            - identifier: us.mappings.reviewOrder.paymentmethodBanner
      - click:
          identifier: us.mappings.reviewOrder.addPaymentmethodButton
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.reviewOrder.wallet.addPaymentmethodTitle

  - name: us.functions.checkout.reviewOrder.addcreditdebitpaymentMethod
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.reviewOrder.wallet.addPaymentmethodTitle
            - identifier: us.mappings.reviewOrder.wallet.addcreditdebitcardButton

      - click:
          identifier: us.mappings.reviewOrder.wallet.addcreditdebitcardButton

      - executeFunction:
          name: us.functions.account.paymentMethod.addCardDetails
          params:
            - name: number
              string: us.data.flow005.payment.creditCard
            - name: expiration
              string: us.data.flow005.payment.expiration
            - name: cvv
              string: us.data.flow005.payment.cvv
            
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.reviewOrder.wallet.title
            - identifier: us.mappings.reviewOrder.wallet.cardSavedNotification
            - identifier: us.mappings.reviewOrder.wallet.continueButton

      - click:
          identifier: us.mappings.reviewOrder.wallet.continueButton     

  - name: us.functions.checkout.reviewOrder.uncheckDeliveryTipIfExists
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subTotalLabel
          position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.tippingSectionTitle
          then:
            - click:
                identifier: us.mappings.reviewOrder.secondTipOption
            - click:
                wait: 3000
                identifier: us.mappings.reviewOrder.subTotalLabel
            - verifyIdentifier:
                selected:
                  - identifier: us.mappings.reviewOrder.secondTipOption
                    value: false
      - scroll:
          direction: up
          scrollLimit: 2

  - name: us.functions.reviewOrder.verifyAlcoholDisclaimer
    platform: android
    flow: 
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.alcoholDisclosureLabel
            - identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton
            - identifier: us.mappings.reviewOrder.alcoholDisclosureDescription
            - identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox 
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.alcoholDisclosureLabel
              equals: Alcohol disclosure (required)
            - identifier: us.mappings.reviewOrder.alcoholDisclosureDescription
              equals: Checking this box confirms you’re at least 21 years old and won’t resell any alcohol you purchase.
      - scroll:
          direction: down
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclosureCheckbox
      - sleep:
          duration: 3000          
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclosurePolicyButton        
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyHeader   
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyDescription
            - identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyCloseCta
      - click:
          identifier: us.mappings.reviewOrder.alcoholDisclaimerPolicyCloseCta      
      - sleep:
          duration: 3000

  - name: us.functions.checkout.reviewOrder.applyPromoCode
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string:  us.mappings.reviewOrder.promocodeSection
            - name: direction
              string: down
            - name: scrollPosition
              string: center 
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.promocodeCollapsedButton
          then:          
            - click:
                identifier: us.mappings.reviewOrder.promocodeCollapsedButton
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.promocode.applyButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.promocode.applyButton
            - identifier: us.mappings.reviewOrder.promocodeTextfield
      - enterText:
          identifier: us.mappings.reviewOrder.promocodeTextfield
          string: ${promoCode}
      # - goBack: true
      - click:
          identifier: us.mappings.reviewOrder.promocode.applyButton
      - sleep:
          duration: 6000
      - hideKeyboard: true
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.promocode.appliedText
            - identifier: us.mappings.reviewOrder.promocode.viewDetailsButton
            - identifier: us.mappings.reviewOrder.promocode.removeButton
          text:
            - identifier: us.mappings.reviewOrder.promocode.appliedText
              contains: us.data.revieworder.appliedPromoCodeText
      - click:
          identifier: us.mappings.reviewOrder.promocode.viewDetailsButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.promocode.appliedText
            - identifier: us.mappings.reviewOrder.promocode.viewDetailsButton
      - sleep:
          duration: 4000
      - click:
          identifier: us.mappings.reviewOrder.promocode.viewDetailscloseButton

  - name: us.functions.checkout.reviewOrder.verifypromocodeonPOS
    platform: android
    flow:
      - sleep:
          duration: 6000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.pos.promoCodeLabel
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.pos.promoCodeLabel
            - identifier: us.mappings.reviewOrder.pos.promoCodeValue
          text:
            - identifier: us.mappings.reviewOrder.pos.promoCodeLabel
              contains: ${promoCodeText}


  - name: us.functions.reviewOrder.verifyBagsDetailsOurSustainabilityPledge
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.checkoutBagFeeOptOut
          then:                
            - verifyIdentifier:
                  present:
                  - identifier: us.mappings.reviewOrder.checkoutBagFeeOptOut 
            - click: 
                identifier: us.mappings.reviewOrder.checkoutBagFeeOptOutRadioButton
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.reviewOrder.checkoutBagFeeOptOutTitle
                    contains: I’ll bring my own reusable bags
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.reviewOrder.checkoutBagFeeOptOutText
                    contains: We’ll pack items for you at pickup.              
          else: 
          - executeFunction:
              name: us.functions.utils.scrollIfNotVisible
              params:
                - name: identifier
                  string:  us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
                - name: direction
                  string: down
                - name: scrollPosition
                  string: center 
          - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
                  - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
          - click:
              identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
          - sleep:
              duration: 5000
          - scroll:
              direction: down
              scrollLimit: 2
          - click:
              identifier: us.mappings.reviewOrder.sustainabilityPledge
          - sleep:
              duration: 3000
          - verifyIdentifier:
              present:
              - identifier: us.mappings.reviewOrder.ourSustainabilityPledgePopUp
          - click: 
              identifier: us.mappings.global.closeButton
          - sleep:
              duration: 3000              
          - verifyIdentifier:
              notPresent: 
                - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLine


  - name: us.functions.reviewOrder.verifyBagsDetailsIWantMyItemsInBags
    platform: android
    flow:
       - executeFunction:
           name: us.functions.utils.scrollIfNotVisible
           params:
             - name: identifier
               string: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
             - name: direction
               string: down
             - name: scrollPosition
               string: center 
       - verifyIdentifier:
           present:
             - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
             - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton
       - click:
           identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton
       - sleep:
           duration: 3000
      #  - click:         (CEPG-121029 - Bug  has been created ,Once the bug is fixed will uncomment out code)
      #      identifier: us.mappings.reviewOrder.verifyLearnMore 
      #  - sleep:
      #       duration: 3000
      #  - verifyIdentifier:
      #      present:
      #        - identifier: us.mappings.reviewOrder.verifyLearnMoreBagFee
      #  - click:
      #      identifier: us.mappings.global.closeButton
       - sleep:
           duration: 3000  
       - verifyIdentifier:
           notPresent: 
             - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLine
  

  - name: us.functions.checkout.reviewOrder.verifyingTip
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.checkout.reviewOrder.storeDeliveryTip
      - verifyIdentifier:
          present:
            - identifier: us.mappings.checkout.reviewOrder.customTipAmountVerification

  - name: us.functions.checkout.reviewOrder.clickDonationCheckbox
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.donationCheckbox
      - click:
          identifier: us.mappings.reviewOrder.donationCheckbox
          wait: 5000

  - name: us.functions.checkout.reviewOrder.verifyTotalAmountForDonation
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.orderTotalAmount
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.orderTotalAmount
              contains: ".00"
  
  - name: us.functions.checkout.reviewOrder.verifyAndSelectInstorePickup
    platform: android
    flow:
      # - scroll:
      #     direction: down
      #     scrollLimit: 1
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.substitution.chooseSubsTooltipCloseButton
          then:
            - log:  substitution tooltip displayed
            - click:
                identifier: us.mappings.reviewOrder.substitution.chooseSubsTooltipCloseButton
          else:
            - log: no substitution tooltip displayed
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.pickupLocation.instoreButton
          then:              
            - verifyIdentifier:
                timeout: 30000
                present:
                  - identifier: us.mappings.reviewOrder.pickupTitleLabel
                  - identifier: us.mappings.reviewOrder.pickupLocation.instoreButton
            - click:
                identifier: us.mappings.reviewOrder.pickupLocation.instoreButton
      - verifyIdentifier:
          timeout: 30000
          present:
            - identifier: us.mappings.reviewOrder.inStoreTitleSwitchLabel
      - log: Switched to in-store pickup

  - name: us.functions.checkout.handleCheckoutAlert
    platform: android
    flow: 
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.alert.YouAreAlmostThereHeader
              - identifier: us.mappings.reviewOrder.alert.YouAreAlmostThereText
              - identifier: us.mappings.reviewOrder.alert.leaveAnyWayButton
              - identifier: us.mappings.reviewOrder.alert.keepCheckingOutButton
          then:
            - click: 
                wait: 6000
                identifier: us.mappings.reviewOrder.alert.leaveAnyWayButton

 ######################### Gifting ###################################

  - name: us.functions.revieworder.addGiftDetails
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.selectaddress.continue
          then:
            - click: 
                identifier: us.mappings.selectaddress.continue
      - scroll:
          direction: down
          untilIdentifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton  
          position: center      
      - sleep:
         duration: 10000 
      - click:
          identifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsTitle
      - enterText:
          identifier: us.mappings.gifting.giftDetails.recipientEmail
          string: ${recipientEmail}
      - goBack: true
      - enterText:
          identifier: us.mappings.gifting.giftDetails.fromField
          string: ${from}
          pressEnter: true         
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.gifting.giftDetails.giftMessage
            - name: direction
              string: down
            - name: scrollPosition
              string: center      
      - click:
          identifier: us.mappings.gifting.giftDetails.giftMessage
      - enterText:
          identifier: us.mappings.gifting.giftDetails.giftMessage
          string: ${message}
          pressEnter: true
      - click:
          identifier: us.mappings.gifting.giftDetails.continueButton 

  - name: us.functions.revieworder.verifyGiftDetails
    platform: android
    flow:
      - sleep:
          duration: 7000
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.gifting.reviewOrder.giftDetailModuleTitle
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsTo

  - name: us.functions.revieworder.editGiftDetails
    platform: android
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.navBarTitle                             
      - scroll:
          direction: down
          untilIdentifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton
          position: center      
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.gifting.reviewOrder.giftDetailsTitle 
      - sleep:
         duration: 5000  
      - click:
          identifier: us.mappings.gifting.reviewOrder.addGiftDetailsButton
      - click:    
          identifier: us.mappings.global.closeButton        
      - verifyIdentifier:
          notPresent: 
            - identifier: us.mappings.gifting.giftDetails.to                     

  - name: us.functions.checkout.reviewOrder.editStoreDeliveryTipTo0
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.storeDeliveryTip.Custom
      - click:
          identifier: us.mappings.reviewOrder.storeDeliveryTip.Custom
          wait: 3000
      - enterText:
          identifier: us.mappings.reviewOrder.storeDeliveryTip.yourTipText
          string: 0.00
      - click:
          coordinates: 95%,95%

  - name: us.functions.reviewOrder.verifyBagFieldAndBanMessage
    platform: android
    flow:
       - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.verifyBagsBannedMessage
            - name: direction
              string: down
            - name: scrollPosition
              string: center
       - try:
           flow:
              - verifyIdentifier:
                  notPresent:
                    - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
                    - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText
              - verifyIdentifier:
                  text:
                    - identifier: us.mappings.reviewOrder.verifyBagsBannedMessage
                      contains: Please bring your own reusable bags
           catch:
             flow:
               - failTest:
                   message: "FAILURE - ${env} - Bag fee banned message missing for banned store" 
              
  - name: us.functions.checkout.reviewOrder.validateStoreDeliveryTip0
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.storeDeliveryTip.amount
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.storeDeliveryTip.amount
              contains: "0.00"
              
  - name: us.functions.checkout.reviewOrder.verifyAddress
    platform: android
    flow:
      - scroll:
          direction: up
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.deliveryDescription
              equals: ${firstName} ${lastName}
          text:
            - identifier: us.mappings.reviewOrder.deliveryAddress
              contains: ${streetAddress}
       

  - name: us.functions.checkout.reviewOrder.verifyCheckoutAcceptOrSkipBagFeeField
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText
            - name: direction
              string: down
      - if: 
          condition: ${option} == 'AcceptBagFee'
          then:
             - verifyIdentifier:
                 present: 
                   - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeText 
                   - identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton
             - click:
                identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton 
             - verifyIdentifier:
                present: 
                  - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLine          
          else:
              - if:
                  condition: ${option} == 'SkipBagFee'
                  then:
                  - verifyIdentifier:
                      present: 
                        - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeText 
                        - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
                  - click:
                      identifier: us.mappings.reviewOrder.verifyCheckoutAcceptBagFeeRadioButton 
                  - verifyIdentifier:
                      notPresent: 
                        - identifier: us.mappings.reviewOrder.verifyCheckoutPosAcceptBagFeeTextLine

  - name: us.functions.checkout.reviewOrder.registy.gift.validation
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.registryGiftdetailseditCTA
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.registryGiftdetailseditCTA
      - click:
          identifier: us.mappings.reviewOrder.registryGiftdetailseditCTA 

    #unselecting 'This order is a gift' checkbox and clicking save    
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.registryEditGiftOrderCheckbox
      - click:
          identifier: us.mappings.reviewOrder.registryEditGiftOrderCheckbox
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.continueButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.registryNotAGiftOrderText
      - log:
          message: "'verified as not a gift" 

    #editing gift details
      - click:
          identifier: us.mappings.reviewOrder.registryGiftdetailseditCTA
          wait: 1000
      - click:
          identifier: us.mappings.reviewOrder.registryEditGiftOrderCheckbox
          wait: 1000
      - click:
          identifier: us.mappings.reviewOrder.registryGiftdetailsFrom
      - enterText:
          identifier: us.mappings.reviewOrder.registryGiftdetailsFrom
          string: ${from}
          clearField: true
      - click:
          identifier: us.mappings.default.keyboardDoneButton
      - click:
          identifier: us.mappings.reviewOrder.registryGiftdetailsGiftMessageField
      - enterText:
          identifier: us.mappings.reviewOrder.registryGiftdetailsGiftMessage
          string: ${giftMessage}
          clearField: true
      - click:
          identifier: us.mappings.default.keyboardDoneButton    
      - verifyIdentifier:
          notPresent:           
            - identifier: us.mappings.reviewOrder.toGiftDetails      
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.continueButton

  - name: us.functions.checkout.reviewOrder.registyEdit.gift.checkout.validation
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.registryGiftdetailseditCTA
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.registryGiftdetailseditCTA
      - click:
          identifier: us.mappings.reviewOrder.registryGiftdetailseditCTA 
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.registryEditGiftOrderCheckbox
      - click:
          identifier: us.mappings.reviewOrder.registryEditGiftOrderCheckbox  
      - click:
          identifier: us.mappings.reviewOrder.gift.continueButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.registryNotAGiftOrderText   
      - log: 
          message: "'verified as not a gift"      
      - click:
          identifier: us.mappings.reviewOrder.giftdetails.editTextCTA           
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.gift.edit.title
      - click:
          identifier: us.mappings.reviewOrder.registryEditGiftOrderCheckbox     
      - enterText:
          identifier: us.mappings.reviewOrder.registryGiftdetailsFrom
          string: ${from}
          clearField: true    
      - enterText:
          identifier: us.mappings.reviewOrder.registryGiftdetailsGiftMessage
          string: ${giftMessage}
          clearField: true    
      - click:
          identifier: us.mappings.reviewOrder.gift.continueButton
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.reviewOrder.toGiftDetails    
      - log: 
          message: "'To' field is not present under the gift details section"

  - name: us.functions.verifyVetApprovalRequired
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.validation.vetApprovalRequired
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.validation.vetApprovalRequired
                scrollLimit: 1
                position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.validation.vetApprovalRequired
          then:
            - log: "Vet Approval Validated"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Vet Approval is not present"
                
 
  - name: us.functions.verifyPetVetApprovalRequired
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.verify.vetApproval
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.verify.vetApproval
                scrollLimit: 1
                position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.verify.vetApproval
          then:
            - log: "Vet Approval Validated"
          else:
            - scroll:
                direction: down
                scrollLimit: 1
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.verify.vetApproval
                then:
                  - log: "Vet Approval Validated"
                else:
                  - failTest:
                      message: "ENV_FAILURE - ${env} - Vet Approval is not present"


  - name: us.functions.verifyIfsetupSubscriptionisPresent
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.item.setupSubscription
          then:
            - executeFunction:
                name: us.functions.item.selectOnetimePurchase

#PetRx added by _Murali Krish_
  - name: us.functions.checkout.AddPetVet
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.addPetVetButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.addPetVetButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.addPetVetButton

###### Signature required
  - name: us.functions.checkout.PrescriptionTerms.Agree&Sign
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.prescriptionTerms.AgreeSign.Button
      - click:
          identifier: us.mappings.reviewOrder.prescriptionTerms.AgreeSign.Button

      # Click preview signature, if it appear
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.PreviewSign.Button
          then:
            - click:
                identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.PreviewSign.Button

      # Click Sign as
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.SignAs.Button
          then:
            - click:
                identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.SignAs.Button

      #  Click Agree&Sign
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.Agree.Button
          then:
            - click:
                identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.Agree.Button


  - name: us.functions.checkout.PrescriptionTerms.Agree&Sign
    platform: ios
    flow:
      - scroll:
          direction: down
          scrollLimit: 5
          untilIdentifier: us.mappings.reviewOrder.prescriptionTerms.AgreeSign.Button
      - click:
          identifier: us.mappings.reviewOrder.prescriptionTerms.AgreeSign.Button

      # Click preview signature, if it appear
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.PreviewSign.Button
          then:
            - click:
                identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.PreviewSign.Button

      # Click Sign as
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.SignAs.Button
      - click:
          identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.SignAs.Button

      #  Click Agree&Sign
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.Agree.Button
      - click:
          identifier: us.mappings.reviewOrder.prescriptionTerms.SignatureScreen.Agree.Button

#PetRx Added by Murali Krish
  - name: us.functions.checkout.SelectPetVet
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAPetid
      - click:
          identifier:  us.mappings.reviewOrder.SelectAPetid
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAPetOption1
      - click:
          identifier:  us.mappings.reviewOrder.SelectAPetOption1
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVetid
      - click:
          identifier:  us.mappings.reviewOrder.SelectAVetid
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVetOption1
      - click:
          identifier:  us.mappings.reviewOrder.SelectAVetOption1

      - if:
          condition: ${multipleItems} == true
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAPetid
            - click:
                identifier:  us.mappings.reviewOrder.SelectAPetid
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAPetOption1
            - click:
                identifier:  us.mappings.reviewOrder.SelectAPetOption1
            - sleep:
                duration: 5000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAVetid
            - click:
                identifier:  us.mappings.reviewOrder.SelectAVetid
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.SelectAVetOption1
            - click:
                identifier:  us.mappings.reviewOrder.SelectAVetOption1

      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SaveButton
      - click:
          identifier:  us.mappings.reviewOrder.SaveButton


#PetRx added by _Murali Krish_
  - name: us.functions.checkout.MultiSelectionPetVet
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.PetSelectAQtyTextfieldid
      - click:
          identifier:  us.mappings.reviewOrder.PetSelectAQtyTextfieldid
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MultiPetQtyChoice1
      - click:
          identifier:  us.mappings.reviewOrder.MultiPetQtyChoice1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.PetChoice1textField
      - click:
          identifier:  us.mappings.reviewOrder.PetChoice1textField
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAPetGia
      - click:
          identifier:  us.mappings.reviewOrder.SelectAPetGia
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.FirstVetDropdown
      - click:
          identifier: us.mappings.reviewOrder.FirstVetDropdown
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SelectAVetOption1 #us.mappings.reviewOrder.Vetchoice1dropdown
      - click:
          identifier:  us.mappings.reviewOrder.SelectAVetOption1 #us.mappings.reviewOrder.Vetchoice1dropdown
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.PetChoice1textField #us.mappings.reviewOrder.Pet2ndtextField
      - click:
          identifier:  us.mappings.reviewOrder.PetChoice1textField #us.mappings.reviewOrder.Pet2ndtextField
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.Pet2ndnamechris
      - click:
          identifier:  us.mappings.reviewOrder.Pet2ndnamechris
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SecondVetDropdown
      - click:
          identifier:  us.mappings.reviewOrder.SecondVetDropdown
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.Vet2ndOption
      - click:
          identifier:  us.mappings.reviewOrder.Vet2ndOption
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.SaveButton
      - click:
          identifier:  us.mappings.reviewOrder.SaveButton

  - name: us.functions.checkout.reviewOrder.verifyRoundupandDonate
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.roundupAndDonateText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
      - sleep:
          duration: 4000
          
  - name: us.functions.checkout.donationCheckoutSelection
    platform: android
    flow:
      - getString:
            identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
            attribute: checked
            storeIn: checkboxSelected
      - if:
          condition: ${donation} == 'select' && ${checkboxSelected} == false
          then:
            - click:
                identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
          else:
            - if:
                condition: ${donation} == 'unselect' && ${checkboxSelected} == true
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
      - sleep:
          duration: 10000

  - name: us.functions.checkout.validateDonationRoundOffCheck
    platform: android
    flow:
      - verifyValue:
          identifier: ${amountValue}
          contains: .00

  - name: us.functions.checkout.validateEstimatedTotalPreviousValue
    platform: android
    flow:
      - if:
          condition: ${estimatedTotalBefore} == ${amountValue}
          then:
            - log: verified
          else:
            - failTest:
                message: "FAILURE - ${env} - Estimated total not revereted to old value"

  - name: us.functions.checkout.reviewOrder.verifyRoundupandDonate
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
          then: 
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
            - click:
                identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceCloseButton
                wait: 5000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.roundupAndDonateText
            - name: direction
              string: down
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.reviewOrder.roundupAndDonateText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
      - sleep:
          duration: 4000      

  - name: us.functions.checkout.donationCheckoutSelection
    platform: ios
    flow:
      - getString:
          identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
          attribute: label
          storeIn: checkboxSelected
      - log:  ${checkboxSelected}
      - if:
          condition: ${donation} == 'select'
          then:
            # - try:
            #     flow:
            #       - verifyValue:
            #           identifier: ${checkboxSelected}
            #           contains: is unchecked
            #       - click:
            #           identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
                # temp solution for checkbox not clicking bug
                  - try:
                      flow:
                        - verifyIdentifier:
                            value:
                              - identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
                                equals: 1
                        - log: Checkbox already selected
                      catch:
                        flow:
                          - click:
                              identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
                # catch:
                #   flow:
                #     - log: Checkbox already selected
          else:
            - getString:
                identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
                attribute: value
                storeIn: checkboxSelected
            - try:
                flow:
                  - verifyValue:
                      identifier: ${checkboxSelected}
                     # contains: is checked
                      contains: "1"
                  - click:
                      identifier: us.mappings.reviewOrder.roundupAndDonateTextCheckbox
                catch:
                  flow:
                    - log: Checkbox already unselected

  - name: us.functions.checkout.validateDonationRoundOffCheck
    platform: ios
    flow:
      - verifyValue:
          identifier: ${amountValue}
          contains: .00

  - name: us.functions.checkout.validateEstimatedTotalPreviousValue
    platform: ios
    flow:
      - if:
          condition: ${estimatedTotalBefore} == ${amountValue}
          then:
            - log: verified
          else:
            - failTest:
                message: "FAILURE - ${env} - Estimated total not revereted to old value"                  

  - name: us.functions.checkout.reviewVPOrderDetails
    platform: android
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewLink
      - log: 'Clicked on the View link to review the cart items'
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.findSinglePackCartItem
            - identifier: us.mappings.cart.findMultiPackCartItem
      - log: 'Verified the cart, it has virtual pack items'

  - name: us.functions.checkout.reviewVPOrderDetails
    platform: ios
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewLink
      - log: 'Clicked on the View link to review the cart items'
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.findSinglePackCartItem
            - identifier: us.mappings.cart.findMultiPackCartItem
      - log: 'Verified the cart, it has virtual pack items'

  - name: us.functions.checkout.reviewOrder.verifySubTotal
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier:  us.mappings.reviewOrder.subTotal

  - name: us.functions.checkout.reviewListItem
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemPresent
            - identifier: us.mappings.reviewOrder.viewItemDetail
      - click:
          identifier: us.mappings.reviewOrder.viewItemDetail
      - click:
          identifier: us.mappings.reviewOrder.viewItemDetailDone
      - sleep:
          duration: 3000
      - goBack: true
      - sleep:
          duration: 3000
      - executeFunction:
          name: us.functions.checkout.handleCheckoutAlert
      - goBack: true
      - sleep:
          duration: 2000
      - goBack: true

  - name: us.functions.checkout.reviewListItem
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemPresent
            - identifier: us.mappings.reviewOrder.viewItemDetail
      - click:
          identifier: us.mappings.reviewOrder.viewItemDetail
      - click:
          identifier: us.mappings.reviewOrder.subsPreference.doneButton
      - executeFunction:
          name: us.functions.global.navigation.backNavigation
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.checkout.handleCheckoutAlert

  - name: us.functions.reviewOrder.verifySkyBenefitCard
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.editPaymentMethod
      - click:
          identifier: us.mappings.reviewOrder.editPaymentMethod
      - sleep:
          duration: 5000          
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.paymentMethod.verifyBenefitCard
            - identifier: us.mappings.reviewOrder.editPaymentMethod.BenefitCardAppliedLabel
      - click:
          identifier: us.mappings.returns.continue
      - sleep:
          duration: 5000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.pos.benefitCardFeesCredit
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.pos.benefitCardFeesCredit

  - name: us.functions.reviewOrder.verifySkyBenefitCard
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.paymentMethod.changeLink         
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.skyBenefitCard
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.changeLink 
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.wallet.BenefitCardAppliedLabel
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.continueButton
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.pos.benefitCardFeesCredit
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.pos.benefitCardFeesCredit

  - name: us.functions.reviewOrder.verifyNationsBenefitCard
    platform: ios
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.nationsbenefitcard
      - log: "Nations card is present under payment summary"
  
  - name: us.functions.reviewOrder.verifyNationsBenefitCard
    platform: android
    flow:
      - verifyIdentifier:
          present: 
            - identifier: us.mappings.reviewOrder.nationsbenefitcard
      - log: "Nations card is present under payment summary"


  - name: us.functions.reviewOrder.curbsidePickup.verifyMultiplePickupMessage
    platform: ios
    flow:
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.curbsidePickup.multipleLocationPickupMessage
              contains: This order requires pickup in 3 different areas of the parking lot.

  - name: us.functions.reviewOrder.curbsidePickup.verifyMultiplePickupMessage
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.curbsidePickup.multipleLocationPickupMessage
              contains: This order requires pickup in 2 different areas of the parking lot.


#Edit delivery instructions on review order screen, InHome added by MuraliKrish
  - name: us.functions.reviewOrder.editDeliveryInstructionsInHome
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editDeliveryInstructionsButtonInhome
      - click:
          identifier: us.mappings.reviewOrder.editDeliveryInstructionsButtonInhome
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.editDeliveryInstructions.label
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reiewOrder.deliveryInstructions.clear
                then:
                  - click:
                      identifier: us.mappings.reiewOrder.deliveryInstructions.clear
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyTypeText
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyTypeText
                  - click:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyType.house
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
                  - enterText:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
                      string: ${accessCode}
                      pressEnter: true
                  - goBack: true
            - if:
                condition: ${deliver} == 'Garage' 
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliverKitchen
                  - click:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliverGarage
                      wait: 2000
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.keyPadLocatedText  
            - scroll:
                direction: down
                scrollLimit: 1
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.editDeliveryInstructions.keypadsCode
                then:
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.editDeliveryInstructions.keypadsCode                
                  - enterText:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.keypadsCode
                      string: ${keypadsCode}
                      pressEnter: true
                  - goBack: true
            - scroll:
                direction: down
                scrollLimit: 1
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
                string: ${deliveryNotes}
                pressEnter: true
            - goBack: true                                                     
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.save
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.save



  #Edit delivery instructions on review order screen
  - name: us.functions.reviewOrder.editDeliveryInstructions
    platform: android
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.editDeliveryInstructionsButton
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editDeliveryInstructionsButton
      - click:
          identifier: us.mappings.reviewOrder.editDeliveryInstructionsButton
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.editDeliveryInstructions.label
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reiewOrder.deliveryInstructions.clear
                then:
                  - click:
                      identifier: us.mappings.reiewOrder.deliveryInstructions.clear
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyTypeText
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyType.house
            - sleep:
                duration: 2000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocation
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocationType
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
                string: ${accessCode}
                pressEnter: true
            - sleep:
                duration: 2000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
                string: ${deliveryNotes}
                pressEnter: true
            - goBack: true  
            - sleep:
                duration: 2000
            # - verifyIdentifier:
            #     present:
            #       - identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocation
            # - click:
            #     identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocationType
            - if: # Moved under if condition as this is still under A/B Test . Only if Adjust pin feature available below code will execute
                condition: ${verifyAdjustPin}
                then:
                  - sleep:
                      duration: 2000
                  - scroll:  
                      direction: down
                      untilIdentifier: us.mappings.reviewOrder.verifyAdjustPin
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.verifyAdjustPin               
                        - identifier: us.mappings.reviewOrder.verifyMapUI
                        - identifier: us.mappings.reviewOrder.verifyIsThisRightPlaceTitle
                  - click:
                      identifier: us.mappings.reviewOrder.verifyAdjustPin
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.verifyheaderText             
                        - identifier: us.mappings.reviewOrder.topExplanationText
                        - identifier: us.mappings.reviewOrder.verifyAddressText
                        - identifier: us.mappings.reviewOrder.verifyAccessibilitySetting     
                  - click:
                      identifier: us.mappings.reviewOrder.verifyAccessibilitySetting
                      wait: 6000                
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.verifyCurrentLocation
                        - identifier: us.mappings.reviewOrder.moveMapUpButton         
                        - identifier: us.mappings.reviewOrder.moveMapDownButton
                        - identifier: us.mappings.reviewOrder.moveMapRightButton
                        - identifier: us.mappings.reviewOrder.moveMapLeftButton                  
                        - identifier: us.mappings.reviewOrder.zoomMapInButton         
                        - identifier: us.mappings.reviewOrder.zommMapOutButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.verifySavebutton
          then: 
            - click:
                identifier: us.mappings.reviewOrder.verifySavebutton
                wait: 5000


#Edit delivery instructions on review order screen ios  InHome added by Murali Krish
  - name: us.functions.reviewOrder.editDeliveryInstructionsInHome
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reiewOrder.deliveryInstructionsinHome.AddButton
      - click:
          identifier: us.mappings.reiewOrder.deliveryInstructionsinHome.AddButton
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.editinHomeDeliveryInstructions.label
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reiewOrder.deliveryInstructions.clear
                then:
                  - click:
                      identifier: us.mappings.reiewOrder.deliveryInstructions.clear
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyTypeText
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyType.house
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
                string: ${accessCode}
                pressEnter: true
                clearField: true
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.default.keyboardDoneButton
                then:
                  - click:
                      identifier: us.mappings.default.keyboardDoneButton
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
                  - name: direction
                    string: down
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
                string: ${deliveryNotes}
                pressEnter: true
                clearField: true
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.default.keyboardDoneButton
                then:
                  - click:
                      identifier: us.mappings.default.keyboardDoneButton
            - if:
                identifier:
                  present:
                    - identifier:  us.mappings.reviewOrder.editDeliveryInstructions.deliveryLabel
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryLocation

            - if:
                identifier:
                  present:
                    - identifier:  us.mappings.reviewOrder.editDeliveryInstructions.deliveryHomeAccess
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryHomeAccess

            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocation
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocationType
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocationKeypadTextField
                string: ${keypad}
                pressEnter: true
                clearField: true
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.save
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.save

  #Edit delivery instructions on review order screen ios
  - name: us.functions.reviewOrder.editDeliveryInstructions
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editDeliveryInstructionsButton
      - click:
          identifier: us.mappings.reviewOrder.editDeliveryInstructionsButton
          wait: 3000
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.editDeliveryInstructions.label
          then:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reiewOrder.deliveryInstructions.clear
                then:
                  - click:
                      identifier: us.mappings.reiewOrder.deliveryInstructions.clear
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyTypeText
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.propertyType.house
            - sleep:
                duration: 1000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.accessCode
                string: ${accessCode}
                pressEnter: true
                clickFirst: true
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.default.keyboardDoneButton
                then:
                  - click:
                      identifier: us.mappings.default.keyboardDoneButton
            - sleep:
                duration: 1000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
            - enterText:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.deliveryNotes
                string: ${deliveryNotes}
                pressEnter: true
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.default.keyboardDoneButton
                then:
                  - click:
                      identifier: us.mappings.default.keyboardDoneButton
            - sleep:
                duration: 2000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocation
            - click:
                identifier: us.mappings.reviewOrder.editDeliveryInstructions.dropoffLocationType
            - if: # Moved under if condition as this is still under A/B Test . Only if Adjust pin feature available below code will execute
                condition: ${verifyAdjustPin}
                then:
                  - scroll:  
                      direction: down
                      untilIdentifier: us.mappings.reviewOrder.verifyAdjustPin
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.verifyAdjustPin               
                        - identifier: us.mappings.reviewOrder.verifyMapUI
                        - identifier: us.mappings.reviewOrder.verifyIsThisRightPlaceTitle
                  - click:
                      identifier: us.mappings.reviewOrder.verifyAdjustPin
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.verifyheaderText             
                        - identifier: us.mappings.reviewOrder.verifyAddressText
                        - identifier: us.mappings.reviewOrder.verifyAccessibilitySetting     
                        - identifier: us.mappings.reviewOrder.verifyCurrentLocation
                  - click:
                      identifier: us.mappings.reviewOrder.verifyAccessibilitySetting
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.reviewOrder.moveMapUpButton         
                        - identifier: us.mappings.reviewOrder.moveMapDownButton
                        - identifier: us.mappings.reviewOrder.moveMapRightButton
                        - identifier: us.mappings.reviewOrder.moveMapLeftButton                  
                        - identifier: us.mappings.reviewOrder.zoomMapInButton         
                        - identifier: us.mappings.reviewOrder.zommMapOutButton
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.reviewOrder.editDeliveryInstructions.save
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.editDeliveryInstructions.save

  # This is a reusable function to validate the Moving Item Policy. Can be used for different Prompt validations.
  - name: us.functions.reviewOrder.mip.confirmItemPolicy.editItems #Joel Function
    platform: android
    flow:          
      - verifyIdentifier:
          timeout: 50000
          present:
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.id
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.editButton.id
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.closeButton.id
      - verifyIdentifier:
          timeout: 50000
          present:            
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.headerText
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.itemDescription
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.instructions
            - identifier: us.mappings.reviewOrder.mip.bottomSheet.violationText            
      - log: The "Edit items" CTA Button is present, Click and then Assert User is redirected to cart
      - click:
          identifier: us.mappings.reviewOrder.mip.bottomSheet.editButton.id
          wait: 5000
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: us.mappings.cart.navBarTitle
      - log: The "Edit items" CTA Button has been clicked and user is now redirected to Cart.
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.saveforLaterButton
      - click:
          wait: 5000
          identifier: us.mappings.cart.saveforLaterButton

  #PetRx Add new PET and VET
  - name: us.functions.checkout.addNewPetVet
    platform: android
    flow:
      - click:
          identifier: us.mappings.addPet.petType
      - click:
          identifier: us.mappings.addPet.petFirstName
      - enterText:
          identifier: us.mappings.addPet.petFirstName
          string: Bruno
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petLastName
      - enterText:
          identifier: us.mappings.addPet.petLastName
          string: Mars
      - hideKeyboard: true
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.addPet.petDOB
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.addPet.petDOB
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.addPet.petDOB
      - enterText:
          identifier: us.mappings.addPet.petDOB
          string: 05/09/2022
      - hideKeyboard: true
      - scroll:
          direction: down
          scrollLimit: 1
      - click:
          identifier: us.mappings.addPet.petGender.dropDown
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petGenderSelection
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petWeight
      - enterText:
          identifier: us.mappings.addPet.petWeight
          string: 15
      - hideKeyboard: true
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.addPet.petMedicalConditions.radioButton
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.addPet.petMedicalConditions.radioButton
      - click:
          identifier: us.mappings.addPet.petOtherMed.radioButton
      - click:
          identifier: us.mappings.addPet.petKnownAllergies.radioButton
      - click:
          identifier: us.mappings.addPet.petMedicalConditions.radioButton
      - click:
          identifier: us.mappings.addPet.petDetailsSave.continueButton
      - sleep:
          duration: 10000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.addPet.petAdded.SuccessText
      - click:
          identifier: us.mappings.addVet.zipSearchBox
      - enterText:
          identifier: us.mappings.addVet.zipSearchBox
          string: 95122
          pressEnter: true
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addVet.vetClinic.radioButton
      - click:
          identifier: us.mappings.addVet.vetSaveButton
      - log: "PET and VET added successfully!!!"

  - name: us.functions.checkout.petrx.orderVerification
    platform: android
    flow:
      - click:
          identifier: us.mappings.orderConfirmation.continueShopping
      - executeFunction:
          name: us.functions.global.navigation.homeToOrderHistory
      - verifyIdentifier:
          present:
            - identifier: us.mappings.tipping.order.view.detail.button
            - identifier: us.mappings.ost.seeMore.odp.orderStatusMessage
      - click:
          identifier: us.mappings.tipping.order.view.detail.button
      - sleep:
          duration: 5000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petrx.info.label.onOrderHistory
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petrx.info.label.onOrderHistory
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petrx.info.label.onOrderHistory
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.orderDetails.paymentMethod
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderDetails.paymentMethod
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.paymentMethod
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.orderDetails.totalText
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderDetails.totalText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.totalText

  - name: us.functions.petRxManualRefillFlow
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.managePrescriptions.pageTitle
            - identifier: us.mappings.petRx.timeToRefill.tag
            - identifier: us.mappings.cart.itemPresent.itemNameLabel
            - identifier: us.mappings.petRx.refillNow.button
      - click:
          identifier: us.mappings.petRx.refillNow.button
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.ad.SponsoredAd.ATCbutton.decrement
            - identifier: us.mappings.item.ad.SponsoredAd.ATCbutton.increment
      - click:
          identifier: us.mappings.homePage.cartNotEmpty
      - sleep:
          duration: 10000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cart.itemPresent.itemNameLabel
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.cart.itemPresent.itemNameLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.itemPresent.itemNameLabel
            - identifier: us.mappings.evergreen.continue.to.checkout
      - click:
          identifier: us.mappings.evergreen.continue.to.checkout
      - sleep:
          duration: 5000
#      - verifyIdentifier:
#          present:
#            - identifier: us.mappings.buyNow.placeOrderButton
#      - click:
#          identifier: us.mappings.reviewOrder.clickPlaceOrder
#      - sleep:
#          duration: 5000
#      - click:
#          identifier: us.mappings.petRx.manualRefill.orderPlaced.doneButton
#      - sleep:
#          duration: 2000

  - name: us.functions.petRxManualRefillFlow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.managePrescriptions.pageTitle
            # - identifier: us.mappings.petRx.timeToRefill.tag
            - identifier: us.mappings.petRx.refillNow.button
      - click:
          identifier: us.mappings.petRx.refillNow.button
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.ad.SponsoredAd.ATCbutton.increment
            - identifier: us.mappings.item.ad.SponsoredAd.ATCbutton.decrement
      - executeFunction:
          name: us.functions.global.navigation.toCartFromNavBar
      - sleep:
          duration: 10000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cart.itemPresent.itemNameLabel
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.cart.itemPresent.itemNameLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.itemPresent.itemNameLabel
            - identifier: us.mappings.cart.checkoutButton
      - click:
          identifier: us.mappings.cart.checkoutButton
      - sleep:
          duration: 5000
#      - verifyIdentifier:
#          present:
#            - identifier: us.mappings.buyNow.placeOrderButton
#      - click:
#          identifier: us.mappings.buyNow.placeOrderButton
#      - sleep:
#          duration: 5000
#      - click:
#          identifier: us.mappings.petRx.manualRefill.orderPlaced.doneButton
#      - sleep:
#          duration: 2000

  # C2682761 - Android consolidated shipping verfication 
  - name: us.functions.reviewOrder.verifyConsolidatedShipping
    platform: android
    flow:
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder    
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.consolidatedShipping.title
          then:
            - log: "ConsolidatedShipping is present"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - ConsolidatedShipping is not present"

      - verifyIdentifier:
          text:
            - identifier: us.mappings.reviewOrder.consolidatedShipping.keepSeparateDeliveries
              contains: separate deliveries
      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.consolidatedShipping.combineDeliveries     
      - click:
          identifier: us.mappings.reviewOrder.consolidatedShipping.combineDeliveries
     
      - sleep:
          duration: 5000          
      
      # Verify combine deliveries radio button selected
      - verifyIdentifier:
          selected:
            - identifier: us.mappings.reviewOrder.consolidatedShipping.combineDeliveries
              value: true

  - name: us.functions.petrx.postAmendment.acceptReject
    platform: android
    flow:
      #  Depricated steps:
      # - click:
      #     identifier: us.mappings.navigation.backNavigationFrompurchasehistory
      # - scroll:
      #     direction: up
      #     scrollLimit: 3
      # - sleep:
      #     duration: 4000
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.tipping.order.view.detail.button
      # - click:
      #     identifier: us.mappings.tipping.order.view.detail.button
      # - sleep:
      #     duration: 3000
      - sleep:
          duration: 20000
      - click:
          identifier: us.mappings.orderConfirmation.ContinueShoppingButton
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo   
     
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.replacedWithText
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.replacedWithText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.replacedWithText
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.orderedText
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.petRx.orderedText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.orderedText
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.petRx.amend.reviewPrescriptionUpdates
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates
            - identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates.reviewButton
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates.reviewButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.orderedText
            - identifier: us.mappings.petRx.replacedWithText
            - identifier: us.mappings.petRx.updatesDecline.button
            - identifier: us.mappings.petRx.updatesAccept.button
            - identifier: us.mappings.petRx.updatesConfirm.button

      - if:
          condition: ${acceptRejectPetrx} == true
          then:
            - click:
                identifier: us.mappings.petRx.updatesAccept.button
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.petRx.updatesDeclineSecondItem.button
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - click:
                identifier: us.mappings.petRx.updatesDecline.button

      - if:
          condition: ${rejectPetrx} == true
          then:
            - click:
                identifier: us.mappings.petRx.updatesDecline.button      
            
      - click:
          identifier: us.mappings.petRx.updatesConfirm.button
      - sleep:
          duration: 10000
      - if:
          identifier:
            present:
              - identifier: us.mappings.odp.closeInstallationDetail
          then:
            - click:
                identifier: us.mappings.odp.closeInstallationDetail
      - if:
          identifier:
            present:
              - identifier: us.mappings.petRx.amend.reviewUpdates.button
          then:
            - click:
                identifier: us.mappings.navigation.backNavigationFrompurchasehistory
            - sleep:
                duration: 10000
            - click:
                identifier: us.mappings.tipping.order.view.detail.button
      - sleep:
          duration: 1000
      
      - if:
          condition: ${acceptRejectPetrx} == true
          then:
            - verifyIdentifier:
                present: 
                  - identifier: us.mappings.myitems.CreateRegistry.TrackerView
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.orderDetails.petrxAcceptAmendQty
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderDetails.petrxAcceptAmendQty 
            - log: Accept amend Petrx item successful
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.petRx.amendOrder.canceledUpdates.text
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.amendOrder.canceledUpdates.text
      - log: Reject amend Petrx item successful

  - name: us.functions.petrx.postAmendment.declineOrderUpdates
    platform: ios
    flow:
      - sleep:
          duration: 20000
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.replacedWithText
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.replacedWithText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.replacedWithText
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.orderedText
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.petRx.orderedText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.orderedText
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.petRx.amend.reviewPrescriptionUpdates
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates
            - identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates.reviewButton
      - sleep:
          duration: 2000
      - scroll:
          direction: up
          scrollLimit: 1         
      - click:
          identifier: us.mappings.petRx.amend.reviewPrescriptionUpdates.reviewButton
      - verifyIdentifier:
          timeout: 40000
          present:
            - identifier: us.mappings.petRx.orderedText
            - identifier: us.mappings.petRx.replacedWithText
            - identifier: us.mappings.petRx.updatesDecline.button
            - identifier: us.mappings.petRx.updatesAccept.button
            - identifier: us.mappings.petRx.updatesConfirm.button
      - click:
          identifier: us.mappings.petRx.updatesDecline.button
      - click:
          identifier: us.mappings.petRx.updatesConfirm.button
      - sleep:
          duration: 1000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.amendOrder.canceledUpdates.text

  - name: us.functions.checkout.petrx.orderVerification
    platform: ios
    flow:
      - click:
          identifier: us.mappings.orderConfirmation.ContinueShoppingButton
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.orderDetails.paymentMethodTitle
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderDetails.paymentMethodTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.paymentMethodTitle
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.orderDetails.totalText
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.orderDetails.totalText
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.totalText

  #PetRx Add new PET and VET
  - name: us.functions.checkout.addNewPetVet
    platform: ios
    flow:
      - click:
          identifier: us.mappings.addPet.petType
      - click:
          identifier: us.mappings.addPet.petFirstName
      - enterText:
          identifier: us.mappings.addPet.petFirstName
          string: Bruno
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petLastName
      - enterText:
          identifier: us.mappings.addPet.petLastName
          string: Mars
      - hideKeyboard: true
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.addPet.petDOB
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.addPet.petDOB
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.addPet.petDOB
      - enterText:
          identifier: us.mappings.addPet.petDOB
          string: 05/09/2022
      - hideKeyboard: true
      - scroll:
          direction: down
          scrollLimit: 1
      - click:
          identifier: us.mappings.addPet.petGender.dropDown
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petGenderSelection
      - sleep:
          duration: 20000
      - click:
          identifier: us.mappings.addPet.petGenderSelection.done
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petWeight
      - enterText:
          identifier: us.mappings.addPet.petWeight
          string: 15
      - hideKeyboard: true
      - scroll:
          direction: down
          scrollLimit: 5
      - if:
          identifier:
            present:
              - identifier: us.mappings.addPet.petGenderSelection.done
          then:
            - click:
                identifier: us.mappings.addPet.petGenderSelection.done
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petOtherMed.radioButton
      - click:
          identifier: us.mappings.addPet.petKnownAllergies.radioButton
      - click:
          identifier: us.mappings.addPet.petMedicalConditions.radioButton
      - hideKeyboard: true
      - click:
          identifier: us.mappings.addPet.petDetailsSave.continueButton
      - sleep:
          duration: 20000
      - hideKeyboard: true
      - verifyIdentifier:
          present:
            - identifier: us.mappings.addPet.petAdded.SuccessText
      - click:
          identifier: us.mappings.addVet.zipSearchBox
      - enterText:
          identifier: us.mappings.addVet.zipSearchBox
          string: 95122
          pressEnter: true
      - hideKeyboard: true
      - sleep:
          duration: 8000
      - click:
          identifier: us.mappings.addVet.vetClinic.radioButton
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.addVet.vetSaveButton
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.popularServices.pharmacy.prescriptions.refill.continue
      - sleep:
          duration: 8000
      - log: "PET and VET added successfully!!!"

  - name: us.functions.checkout.selectExistingPetAndVet
    platform: ios
    flow:
      #Pet Selection
      - click:
          identifier: us.mappings.addPet.selectFirstAvailablePet
      - click:
          identifier: us.mappings.addPet.petGenderSelection.done
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.addVet.selectFirstAvailableVet
      - click:
          identifier: us.mappings.addPet.petGenderSelection.done
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.subs.subs.saveButton

  - name: us.functions.reviewOrder.verifyConsolidatedShipping
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.consolidatedShipping.title
          then:
            - log: "ConsolidatedShipping is present"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - ConsolidatedShipping is not present"
      
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.consolidatedShipping.keepSeparateDeliveries
              contains: separate deliveries       
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.consolidatedShipping.combineDeliveries
      - click:
          identifier: us.mappings.reviewOrder.consolidatedShipping.combineDeliveries
      - sleep:
          duration: 5000          
      - verifyIdentifier:
          label:
            - identifier: us.mappings.reviewOrder.consolidatedShipping.combineDeliveries
              contains: selected

  - name: us.functions.petRxAutoRefill
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.managePrescriptions.pageTitle
      - sleep:
          duration: 10000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.autoRefill.button
          then:
            - log: "Refill now button is not visible and scrolling down!!!"
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.autoRefill.button
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.timeToRefill.tag
            - identifier: us.mappings.cart.itemPresent.itemNameLabel
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.petRx.refillNow.button
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.refillNow.button
      - click:
          identifier: us.mappings.petRx.autoRefill.button
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.subscribeNow.address
            - identifier: us.mappings.petRx.autoRefill.subscribeNow.payment.button
            - identifier: us.mappings.petRx.autoRefill.subscribeNow.quantityFrequency
            - identifier: us.mappings.petRx.autoRefill.subscribeNow.itemName
            - identifier: us.mappings.petRx.autoRefill.subscriptionsCheckbox
            - identifier: us.mappings.subscribe.subscribeNowButton
      - getString:
          identifier: us.mappings.petRx.autoRefill.subscribeNow.itemName
          attribute: text
          storeIn: SubscribedItemName
      - log: "The fetched subscription item Name ${SubscribedItemName}"
      - click:
          identifier: us.mappings.petRx.autoRefill.subscribeNow.address
      - log: "Clicked on the Subscription Address button!!"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.buyNow.addHomeAddress.SelectAddress
#            - identifier: us.mappings.petRx.autoRefill.subscription.addNewAddressLink
      - click:
          identifier: us.mappings.item.backButton
      - log: "Verified that the Subscription Address button is editable and click on Back Chevron!!"
      - click:
          identifier: us.mappings.petRx.autoRefill.subscribeNow.payment.button
      - log: "Clicked on the Subscription Payment button!!"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.paymentMethods.pageTitle
            - identifier: us.mappings.petRx.autoRefill.subscription.addNewPaymentCard.link
            - identifier: us.mappings.item.SubsPayment.Selectcard
      - click:
          identifier: us.mappings.item.backButton
      - log: "Verified that the Subscription Payment button is editable and click on Back Chevron!!"
      - if:
          identifier:
            present:
              - identifier: us.mappings.petRx.autoRefill.subscription.selectEligibleAddress
          then:
            - click:
                identifier: us.mappings.petRx.autoRefill.subscription.selectEligibleAddress
                wait: 2000
            - click:
                identifier: us.mappings.petRx.autoRefill.subscription.eligibleAddressForPetRx
                wait: 3000
            - click:
                identifier: us.mappings.cart.saveAddress
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.petRx.autoRefill.subscription.selectEligibleAddress
            - log: "Selected a Eligible address for the PetRX"
      - click:
          identifier: us.mappings.petRx.autoRefill.subscriptionsCheckbox
      - click:
          identifier: us.mappings.subscribe.subscribeNowButton
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.subscriptionConfirmationTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.subscribe.verifyConfirmationMessage
                  - identifier: us.mappings.subscribe.gotItButton
                  - identifier: us.mappings.item.SubsManageSubscriptions
      - click:
          identifier: us.mappings.subscribe.gotItButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.SubscribeAutoRefill.button.change.postSubscription
      - sleep:
          duration: 2000

  - name: us.functions.petRxAutoRefill
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.autoRefill.button
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.autoRefill.button
      - click:
          identifier: us.mappings.petRx.autoRefill.button
      - sleep:
          duration: 30000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.subscribeNow.address
            - identifier: us.mappings.item.SubsPayment
            - identifier: us.mappings.petRx.autoRefill.subscribeNow.quantityFrequency
            - identifier: us.mappings.petRx.autoRefill.subscriptionsCheckbox
            - identifier: us.mappings.subscribe.subscribeNowButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.petRx.autoRefill.subscription.selectEligibleAddress
          then:
            - click:
                identifier: us.mappings.petRx.autoRefill.subscription.selectEligibleAddress
                wait: 3000
            - click:
                identifier: us.mappings.petRx.autoRefill.subscription.eligibleAddressForPetRx
            - click:
                identifier: us.mappings.inHome.addressSelection.saveButton
            - log: "Selected an Eligible address"
      - click:
          identifier: us.mappings.petRx.autoRefill.subscribeNow.address
      - log: "Clicked on the Subscription Address button!!"
      - verifyIdentifier:
          timeout: 100000
          present:
            - identifier: us.mappings.item.SelectAddressScreenTitle
            - identifier: us.mappings.reserveSlot.addressselectionButton
      - click:
          identifier: us.mappings.item.SubscribeButton
      - log: "Verified that the Subscription Address button is editable and click on Back Chevron!!"
      - click:
          identifier: us.mappings.item.SubsPayment
      - log: "Clicked on the Subscription Payment button!!"
      - verifyIdentifier:
          timeout: 100000
          present:
            - identifier: us.mappings.popularServices.pharmacy.reviewOrder.paymentMethodTitle
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.confirmCvv.confirmButton
          then:
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField            
            - enterText:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                string: 111
            - click:
                identifier: us.mappings.default.keyboardDoneButton
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.confirmButton
            - sleep:
                duration: 4000
            - click:
                identifier: us.mappings.item.SubsPayment
            - verifyIdentifier:
                timeout: 100000
                present:
                  - identifier: us.mappings.paymentMethod.addPayment.overlay.title
          else:
            - verifyIdentifier:
                timeout: 100000
                present:
                  - identifier: us.mappings.paymentMethod.addPayment.overlay.title
      - click:
          identifier: us.mappings.item.SubscribeButton
      - log: "Verified that the Subscription Payment button is editable and click on Back Chevron!!"
      - click:
          identifier: us.mappings.petRx.autoRefill.subscriptionsCheckbox
      - click:
          identifier: us.mappings.subscribe.subscribeNowButton
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.subscriptionConfirmationTitle
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.petRx.amendOrder.orderedApproved.gotItButton
                  - identifier: us.mappings.ibottaRewards.manageSubscriptions
      - click:
          identifier: us.mappings.petRx.amendOrder.orderedApproved.gotItButton
      - sleep:
          duration: 2000

  - name: us.functions.petRxAutoRefill.cancelSubscription
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.autoRefill.prescriptionNameCard
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.autoRefill.prescriptionNameCard
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.prescriptionNameCard
      - click:
          identifier: us.mappings.petRx.autoRefill.subscribedQuantityLink
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.autoRefill.subscription.editButton
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.autoRefill.subscription.editButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.subscription.editButton
      - click:
          identifier: us.mappings.petRx.autoRefill.subscription.editButton
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.petRx.autoRefill.cancelSubscriptionButton
          wait: 1000
      - click:
          identifier: us.mappings.petRx.autoRefill.cancelSubscriptionReason.radioButton
          wait: 1000
      - click:
          identifier: us.mappings.subscribe.cancelMySubscriptionButton

  - name: us.functions.petVetDiet.orderDeliveryVerification
    platform: android
    flow:
      - click:
          identifier: us.mappings.orderConfirmation.continueShopping
      - executeFunction:
          name: us.functions.global.navigation.homeToOrderHistory
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.tipping.order.view.detail.button
            - identifier: us.mappings.ost.seeMore.odp.orderStatusMessage

  - name: us.functions.petVetDiet.orderDeliveryVerification
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.deliveryText.onODP

  - name: us.functions.petRxAutoRefill.cancelSubscription
    platform: ios
    flow:
      - click:
          identifier: us.mappings.petRx.autoRefill.subscribedQuantityLink
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.petRx.autoRefill.subscription.editButton
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.petRx.autoRefill.subscription.editButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.petRx.autoRefill.subscription.editButton
      - click:
          identifier: us.mappings.petRx.autoRefill.subscription.editButton
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.petRx.autoRefill.cancelSubscriptionButton
          wait: 1000
      - click:
          identifier: us.mappings.petRx.autoRefill.cancelSubscriptionReason.radioButton
          wait: 1000
      - click:
          identifier: us.mappings.subscribe.cancelMySubscriptionButton
      - sleep:
          duration: 3000

  - name: us.functions.reviewOrder.verifyGuidedDeliveryInstructions
    platform: ios
    flow:
      - verifyIdentifier:
          label:
          - identifier: us.mappings.reviewOrder.guidedDeliveryInstruction
            contains: House

  - name: us.functions.reviewOrder.verifyGuidedDeliveryInstructions
    platform: Android
    flow:
      - verifyIdentifier:
          text:
          - identifier: us.mappings.reviewOrder.deliveryInstructionsText
            contains: House

  # Delivery instruction on Thankyou page
  - name: us.functions.deliveryInstructions.thankyoupage
    platform: android
    flow:
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.ensurePricingDisclaimerBottomSheet
            - identifier: us.mappings.typage.yourorderisconfirmed
      - log: Guided delivery instructions bottomsheet is displayed
      - enterText:
          identifier: us.mappings.gdi.typ.gateorcallboxcode
          clearField: true
          string: ${accessCode}
      - enterText:
          identifier: us.mappings.gdi.typ.deliverynotes
          clearField: true
          string:  ${deliveryNotes}
      - goBack: true
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.gdi.typ.savebutton

  # Delivery instruction on Thankyou page
  - name: us.functions.deliveryInstructions.thankyoupage
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scanner.ensurePricingDisclaimerBottomSheet # us.mappings.reviewOrder.guidedDeliveryInstruction.on.thankyoupage
            - identifier: us.mappings.typage.yourorderisconfirmed
      - log: Guided delivery instructions bottomsheet is displayed
      - enterText:
          identifier: us.mappings.gdi.typ.gateorcallboxcode
          clearField: true
          string: ${accessCode}
      - enterText:
          identifier: us.mappings.gdi.typ.deliverynotes
          clearField: true
          string:  ${deliveryNotes}
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.gdi.typ.savebutton
  

  - name: us.functions.checkout.enterFISEBTPinAndPlaceOrder
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.continueButton
      - click:
          identifier: us.mappings.paymentMethod.checkout.continueButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.submitEBTPin   
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebtPin.frame
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.EBTPin
            - enterText:
                identifier: us.mappings.reviewOrder.ebtpinEnter
                string: 0005
            - sleep:
                duration: 2000
                 
            - click:
                identifier: us.mappings.reviewOrder.submitEBTOrder
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - executeFunction:
          name: us.functions.orderConfirmation.orderCreationValidation

  - name: us.functions.checkout.placeOrder.OnePay #Joel Added
    platform: ios
    flow:
      - scroll:
          direction: up
          untilIdentifier: us.mappings.reviewOrder.paymentMethod.label     
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.verifyOnePay.icon
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - if: 
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.verifyOnePay.icon
              - identifier: us.mappings.reviewOrder.verifyOnePay.label
          then:
            - log: Pay over time header is present       
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.placeOrderButton
            - click:
                identifier: us.mappings.reviewOrder.placeOrderButton 
                wait: 3000
          else:
            - log: Pay over time header is not present, proceed with Checkout
            - click:
                identifier: us.mappings.reviewOrder.placeOrderButton 
                wait: 3000                    

  - name: us.functions.checkout.verifyOnePay
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.address.selectAddressCheckBox # us.mappings.selectAddress.continueButton
          then:
            - log: Address prompt is present           
            - click:
                identifier: us.mappings.address.selectAddressCheckBox #us.mappings.selectAddress.addressRadioButton
            - click:
                identifier: us.mappings.selectAddress.continueButton
                wait: 3000
          else:
            - log: Address prompt is not present                    
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.verifyOnePayPayment
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyOnePayPayment
            - identifier: us.mappings.reviewOrder.verifyApplyNowButton
      - click:        
          identifier: us.mappings.reviewOrder.verifyApplyNowButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.selectAddress.continueButton
          then: 
            - click:
                identifier: us.mappings.selectAddress.continueButton
                wait: 3000          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyOneOnlyPaymentMethodText
            - identifier: us.mappings.reviewOrder.manualEnterYourInformation
            - identifier: us.mappings.reviewOrder.privacyPolicy.tos.text
      - click:        
          identifier: us.mappings.reviewOrder.verifyAgreeAndContinue
      - sleep:
          duration: 15000
      - click:        
          identifier: us.mappings.reviewOrder.verifyMobileNumberAndOTP
      - enterText:
          identifier: us.mappings.reviewOrder.verifyMobileNumberAndOTP
          string: ${mobile}
          pressEnter: true
      - click:        
          identifier: us.mappings.reviewOrder.continuebutton
      - click:        
          identifier: us.mappings.reviewOrder.verifyMobileNumberAndOTP
      - executeFunction:
          name: us.functions.utils.astro.fetchOtpOnePay
      - enterText:
          identifier: us.mappings.reviewOrder.verifyMobileNumberAndOTP
          string: ${otp}          
          pressEnter: true
      - sleep:
          duration: 15000
      - if:
          identifier:
            present:
              - identifier: us.mappings.selectAddress.continueButton
          then:
            - log: User already has an account
            - click:
                identifier: us.mappings.selectAddress.continueButton
                wait: 3000          
      - click:
          identifier: us.mappings.reviewOrder.enterPasscode
          wait: 3000 
      - enterText:
          identifier: us.mappings.reviewOrder.enterPasscode
          string: ${code}
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyEsignAgreementAndSSALink     
      - click:        
          identifier: us.mappings.orderConfrimation.ratings.submitButton
      - sleep:
          duration: 15000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifySixMonthsOption     
            - identifier: us.mappings.reviewOrder.verifyTwelveMonthsOption 
            - identifier: us.mappings.reviewOrder.verifyEighteenMonthsOption
      - click:        
          identifier: us.mappings.reviewOrder.verifySixMonthsOption
      - click:        
          identifier: us.mappings.reviewOrder.continuebutton
      - sleep:
          duration: 2000
      - click:        
          identifier: us.mappings.reviewOrder.verifyAmericanBank
      - click:   
          identifier: us.mappings.reviewOrder.onepay.backButton                
      - sleep:
          duration: 5000        
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyPleaseLookOverEverthingScreen
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.verifyAcceptAndContinue                    
      - click:        
          identifier: us.mappings.reviewOrder.verifyAcceptAndContinue
      - sleep:
          duration: 10000
      - click:        
          identifier: us.mappings.reviewOrder.verifyReturnToCheckout
      - sleep:
          duration: 5000    

  - name: us.functions.reviewOrder.verifyOnePay
    platform: Android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.applyNowButton
      - verifyIdentifier:
          present:            
            - identifier: us.mappings.reviewOrder.verifyOnePayment    
            - identifier: us.mappings.reviewOrder.applyNowButton
      - click:
          identifier: us.mappings.reviewOrder.applyNowButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.onePayLaterAlertText
            - identifier: us.mappings.reviewOrder.onePayPrivacyPolicyText
      - click:
          identifier: us.mappings.reviewOrder.agreeAndContinue
      - sleep:
          duration: 15000
      - click:
          identifier: us.mappings.reviewOrder.verifyMobileNumber
      - enterText:
          identifier: us.mappings.revieworder.verifyMobileNumber
          string: ${mobile}
      - click:
          identifier: us.mappings.reviewOrder.onepayContinue
      - click:
          identifier: us.mappings.reviewOrder.enterOTP
      - executeFunction:
          name: us.functions.utils.astro.fetchOtpOnePay
      - enterText:
          identifier: us.mappings.reviewOrder.enterOTP
          string: ${otp}
      - click:
          identifier: us.mappings.reviewOrder.onepayContinue
      - sleep:
          duration: 15000
      - click:
          identifier: us.mappings.reviewOrder.enterPasscode
      - enterText:
          identifier: us.mappings.reviewOrder.enterPasscode
          string: ${code}
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.justYouKnow
            - identifier: us.mappings.reviewOrder.eSignInConsumerReportSSA
      - click:
          identifier: us.mappings.reviewOrder.onePaySubmit
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.greatNewsMsg
            - identifier: us.mappings.reviewOrder.verifyNineMonthsOption 
            - identifier: us.mappings.reviewOrder.verifyTwelveMonthsOption
            - identifier: us.mappings.reviewOrder.verifyEighteenMonthsOption 
      - click:
          identifier: us.mappings.reviewOrder.onePayContinue
      - click:
          identifier: us.mappings.reviewOrder.selectBankOfAmerica
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.pleaseLookEverythingText
      - click:
          identifier: us.mappings.reviewOrder.acceptAndContinue
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.allSetReadyToCheckout
      - click:
          identifier: us.mappings.reviewOrder.returnToCheckout
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.onePayCardIcon
      - sleep:
          duration: 9000
           
  - name: us.functions.reviewOrder.verifyVisionItemTile
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.prescriptionItems
            - name: direction
              string: down
            - name: scrollPosition
              string: center             
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.reviewOrder.verifyPrescriptionAdded
            - identifier: us.mappings.reviewOrder.weMayContactYouMsg
            - identifier: us.mappings.reviewOrder.prescriptionItems

      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.viewLink
            - name: direction
              string: up
            - name: scrollPosition
              string: center              
      - click:
          identifier: us.mappings.reviewOrder.viewLink
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.verifyPrescriptionAdded
            - name: direction
              string: down  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.verifyPrescriptionAdded   
      - log: Verified Vision item title and if prescription is added on review screen    
      - click:
          identifier: us.mappings.item.walmart+BottomTrayCloseButton        

  - name: us.functions.reviewOrder.verifyVisionItemTile
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.weMayContactYouMsg
          position: center      
      - verifyIdentifier:
          present:
            # - identifier: us.mappings.reviewOrder.verifyPrescriptionAdded
            - identifier: us.mappings.reviewOrder.weMayContactYouMsg
            - identifier: us.mappings.reviewOrder.prescriptionItems
      - log: Verified Vision item title and if prescription is added              

# To check the subscription terms in review order page 
  - name: us.functions.revieworder.subscriptionterms.checkbox
    platform: ios
    flow:
      - log : Ticking the subscription terms checkbox
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subscriptionTerms.checkbox
          position: center 
      - click:
          identifier: us.mappings.reviewOrder.subscriptionTerms.checkbox              

 # Verify Subscription and OTP items are shown separately with Arrive By date on Review Order page with Subscription terms
  - name: us.functions.reviewOrder.verifyOrderDetails            
    platform: ios
    flow:
      - log: Verifying Subscription and OTP items are shown separately
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.autoDeliveryItems
          position: center      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.autoDeliveryItems
            - identifier: us.mappings.reviewOrder.OTPItems
      - log: Verifying Subscription items include 'Every X weeks' label
      - click:
          identifier: us.mappings.reviewOrder.viewItemDetailsButton
      - sleep:
         duration: 4000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.viewDetails.subscriptionWeeks  
      - log: Verifying Subscription terms section    
      - click:
          identifier: us.mappings.reviewOrder.viewDetails.closeBtn
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subscriptionTermsCheckBox
          position: center      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subscriptionTerms
            - identifier: us.mappings.reviewOrder.subscriptionTermsCheckBox  
      - click:
          identifier: us.mappings.reviewOrder.subscriptionTermsCheckBox  

 # Verify Subscription and OTP items are shown separately with Arrive By date on Review Order page with Subscription terms
  - name: us.functions.reviewOrder.verifyOrderDetails            
    platform: android
    flow:
      - log: Verifying Subscription and OTP items are shown separately
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.autoDeliveryItems
          position: center      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.autoDeliveryItems
            - identifier: us.mappings.reviewOrder.OTPItems
      - log: Verifying Subscription items include 'Every X weeks' label
      - click:
          identifier: us.mappings.reviewOrder.viewItemDetail
      - sleep:
         duration: 4000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.viewDetails.subscriptionWeeks  
      - log: Verifying Subscription terms section    
      - click:
          identifier: us.mappings.reviewOrder.mip.bottomSheet.closeButton.id
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.subscriptionTermsCheckBox
          position: center      
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subscriptionTerms
            - identifier: us.mappings.reviewOrder.subscriptionTermsCheckBox  
      - click:
          identifier: us.mappings.reviewOrder.subscriptionTermsCheckBox                         

  - name: us.functions.item.autoShip.itemSubscription.ATC
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.item.petrx.autoship.subscriptionRadioButton
          then:
            - log: "The item subscription overlay is not Visible, Scrolling Down!!!"
            - scroll:
                direction: down
                position: left
                scrollLimit: 2
                # Adding temporary fix for ios, because righnt now ios scrolling too fast and cant find the element below
                # untilIdentifier: us.mappings.item.petrx.autoship.subscriptionRadioButton
 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.item.petrx.autoship.subscriptionRadioButton
      - click:
          identifier: us.mappings.item.petrx.autoship.subscriptionRadioButton
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.petrx.autoship.subscriptionRadioButton
            - identifier: us.mappings.item.petrx.autoship.subscriptionInfoText
            - identifier: us.mappings.item.petrx.autoship.subscription.howItWorks.link
      - verifyIdentifier:
          present:
            - identifier: us.mappings.subscribe.subscribeButton
      - click:
          identifier: us.mappings.subscribe.subscribeButton
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.petrx.autoship.setupSubscriptionTitle
            - identifier: us.mappings.item.petrx.autoship.subscription.itemName
            - identifier: us.mappings.item.petrx.autoship.subscription.count
            - identifier: us.mappings.item.petrx.autoship.subscription.freqIcon
            - identifier: us.mappings.item.petrx.autoship.subscription.freqHeader
            - identifier: us.mappings.item.petrx.autoship.subscription.freqSubHeader
      - click:
          identifier: us.mappings.item.addSubscriptionToCart
      - sleep:
          duration: 4000
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.pdp.close
          then:
            - log: "The PDP close button exists and clicking on it !!!"
            - click:
                identifier: us.mappings.search.pdp.close
          else:
            - log: "The PDP close button does not exists !!!"

  - name: us.functions.item.autoShip.subscription.placeOrder
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.checkout.AddPetVet
      - sleep:
          duration: 2000
      # - executeFunction:
      #     name: us.functions.checkout.selectExistingPetAndVet
      - executeFunction:
          name: us.functions.checkout.SelectPetVet
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.petrx.autoship.addPetVet.successMessage
      - if:
          condition: ${signatureRequired} == true
          then:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.reviewOrder.petrx.autoship.subscription.agreeAndSignCta
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.reviewOrder.petrx.autoship.subscription.agreeAndSignCta
            - click:
                identifier: us.mappings.reviewOrder.petrx.autoship.subscription.agreeAndSignCta
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.petrx.autoship.subscription.signatureRequiredTitle
                  - identifier: us.mappings.reviewOrder.petrx.autoship.subscription.signatureImage
                  - identifier: us.mappings.reviewOrder.petrx.autoship.subscription.signaturecheckbox
            - click:
                identifier: us.mappings.reviewOrder.petrx.autoship.subscription.signaturecheckbox
            - click:
                identifier: us.mappings.reviewOrder.petrx.autoship.subscription.signatureRequired.agreeAndSignCta
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.petrx.autoship.subscription.signatureImage
          else:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.item.petrx.autoship.subscription.termsCheckBox
                then:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.item.petrx.autoship.subscription.termsCheckBox
            - click:
                identifier: us.mappings.item.petrx.autoship.subscription.termsCheckBox
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.item.petrx.autoship.subscription.termsCheckBox
            # - identifier: us.mappings.item.petrx.autoship.subscription.termsTitle


  - name: us.functions.reviewOrder.editEbtFood
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.editPayment
      - click:
          identifier: us.mappings.reviewOrder.editPayment
      - click:
          identifier: us.mappings.reviewOrder.ebtFoodField
      - enterText:
          identifier: us.mappings.reviewOrder.ebtFoodField
          clearField: true
          string: ${ebtFoodAmount}
      - click:
          identifier: us.mappings.capOne.paymentsOptionsContinueButton
      - sleep:
          duration: 5000

  - name: us.functions.reviewOrder.editEbtFood
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.capOne.changePaymentsButton
      - click:
          identifier: us.mappings.capOne.changePaymentsButton
      - click:
          identifier: us.mappings.reviewOrder.ebtFoodField
      - enterText:
          identifier: us.mappings.reviewOrder.ebtFoodField
          clearField: true
          string: ${ebtFoodAmount}
      - click: 
          identifier: us.mappings.default.keyboardDoneButton
      - click:
          identifier: us.mappings.item.continue
      - sleep:
          duration: 5000


  # Validate CO delivery fee charges in review order page
  - name: us.functions.reviewOrder.verifyCORetailDeliveryFeeChargedonreviewOrder
    platform: iOS
    flow :
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeLabel
            - identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeButton
      - click:
          identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.Title
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.subTitle
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.COdeliveryFeeLabel
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.COdeliveryFeeClarityLabel
            - identifier: us.mappings.global.closeButton
      - click:
          identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.gotItButton

  # Validate CO delivery fee charges in review order page 
  - name: us.functions.reviewOrder.verifyCORetailDeliveryFeeChargedonreviewOrder
    platform: android
    flow :
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeLabel
            - identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeButton
            - identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeValue
      - click:
          identifier: us.mappings.reviewOrder.CORetailDelivery.pos.feeButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.Title
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.subTitle
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.COdeliveryFeeLabel
            - identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.COdeliveryFeeClarityLabel
            - identifier: us.mappings.global.closeButton
      - click:
          identifier: us.mappings.reviewOrder.CORetailDelivery.bottomsheet.gotItButton

  #FUNCTION for Drone Delivery Review Order screen
  - name: us.functions.reviewOrder.verifyDroneFulfillmentDetails
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: Up
          untilIdentifier: us.mappings.reviewOrder.droneDelivery.cardTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.droneDelivery.arrivesText
            - identifier: us.mappings.reviewOrder.deliveryAddress
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.totalLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.droneDelivery.fee.pos.text
            - identifier: us.mappings.reviewOrder.droneDelivery.fee.pos.price

  - name: us.functions.reviewOrder.verifyDroneFulfillmentDetails
    platform: android
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: Up
          untilIdentifier: us.mappings.reviewOrder.droneDelivery.cardTitle
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.droneDelivery.arrivesText
            - identifier: us.mappings.reviewOrder.deliveryAddress
            # - identifier: us.mappings.reviewOrder.droneDelivery.checkoutTimer | # To be enabled when locator is added
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.totalLabel
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.droneDelivery.fee.pos.text
            - identifier: us.mappings.reviewOrder.droneDelivery.fee.pos.price

  - name: us.functions.checkout.reviewOrderDetails.verifyVPItemDetails
    platform: android
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewLink
      - log: 'Clicked on the View link to review the cart items'
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.largeVPItem
            - identifier: us.mappings.reviewOrder.countVPItem
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.cart.findMultiPackCartItem            
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.findSinglePackCartItem
            - identifier: us.mappings.cart.findMultiPackCartItem 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.MPVPItem
            - name: direction
              string: down
            - name: scrollPosition
              string: center             
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MPVPItem         
      - log: 'Verified the cart, it has virtual pack items'    

  - name: us.functions.checkout.reviewOrderDetails.verifyVPItemDetails
    platform: ios
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewLink
      - log: 'Clicked on the View link to review the cart items'
      - verifyIdentifier:
          timeout: 6000
          present:
            - identifier: us.mappings.reviewOrder.largeVPItem
            - identifier: us.mappings.reviewOrder.countVPItem         
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.cart.findMultiPackCartItem 
            - name: direction
              string: down
            - name: scrollPosition
              string: center           
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.findSinglePackCartItem
            - identifier: us.mappings.cart.findMultiPackCartItem            
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.MPVPItem        
      - log: 'Verified the cart, it has virtual pack items'

  - name: us.functions.checkout.reviewOrderDetails.verifyDeliveryInstructions
    platform: android
    flow:
      - log: 'Verify Delivery Instructions are available on review order page'
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.deliveryInstructionsSections
            - identifier: us.mappings.reviewOrder.deliveryInstructions
      - click:
          identifier: us.mappings.reviewOrder.deliveryInstructions.editbutton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editDeliveryInstructions.label

  - name: us.functions.checkout.reviewOrderDetails.verifyDeliveryInstructions
    platform: ios
    flow:
      - log: 'Verify Delivery Instructions are available on review order page'
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.deliveryInstructionsSections
            - identifier: us.mappings.reviewOrder.deliveryInstructions
      - click:
          identifier: us.mappings.reviewOrder.deliveryInstructions.editbutton
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editDeliveryInstructions.label

  - name: us.functions.checkout.verifyDiscountOnReviewOrderPage
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.search.estimatedTotal 
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier: 
          present:
            - identifier: us.mappings.cart.wasPrice
            - identifier: us.mappings.cart.savingsValue
            - identifier: us.mappings.cart.discountedPrice

  - name: us.functions.reviewOrder.SubstitutionPreferencePopup
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            present:
              - identifier:  us.mappings.reviewOrderSubsituitonPopUp 
          then:
            - click:
                identifier: us.mappings.eviewOrderSubsituitonPopUpCloseButton

# Function to appy walmart cash from edit payment method/wallet
  - name: us.functions.reviewOrder.applyWalmartCash.wallet
    platform: ios
    flow:
      - scroll:
          direction: up
          untilIdentifier: us.mappings.reviewOrder.editPayment
      - click:
          identifier: us.mappings.reviewOrder.editPayment
      - if:
          identifier:           
            present:
              - identifier: us.mappings.reviewOder.walletPage
              - identifier: us.mappings.reviewOder.walmartRewardsCard 
          then:
            - log: "Wallet Page is loaded and Walmart cash card is present"
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.account.walmartCashCard.checkbox.notChecked
                then:
                  - log: "The Walmart Cash checkbox is not checked, Will select and proceed !!!"
                  - click:
                      identifier: us.mappings.account.walmartCashCard.checkbox.notChecked
                      wait: 1500
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.account.walmartCashCard.checkbox.checked
                else:
                  - log: "The Walmart Cash checkbox is already checked !!!"
            - click:
                identifier: us.mappings.account.walmartCashCard.confirmButton
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} wallet page load ERROR"
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cart.wplus.rewardsEligibilityButton
          then:
            - log: "Walmart cash got applied successfully"
          else:
           - failTest:
              message: "Walmart cash was NOT applied"

  - name: us.functions.reviewOrder.switchToDifferentCard
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.capOne.changePaymentsButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.capOne.changePaymentsButton
          wait: 1500
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOder.creditAndDebitCards
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOder.creditAndDebitCardsTile
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - click:
          identifier: us.mappings.reviewOrder.editPaymentMethodCardEndingwith
          wait: 1500
      - click:
          identifier: us.mappings.reviewOrder.editPaymentMethodCardEndingwithRadioButton
          wait: 5000
      - click:
          identifier: us.mappings.reviewOrder.editPaymentMethod.ContinueButton
          wait: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOder.selectedCardVerify
      - log: "Alternative Card Ending with 7777 has been selected !!!"

  - name: us.functions.checkout.reviewOrder.verify.greymessages
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.editPaymentMethod
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.grey.message
          then: 
            - click:
                identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.grey.message
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.grey.message
            - click:
                identifier: us.mappings.paymentMethod.checkout.addNewPaymentMethodButton    
            - executeFunction:
                name: us.functions.account.paymentMethod.addCardDetails
                params:
                  - name: number
                    string: us.data.flow005.payment.creditCard
                  - name: firstName
                    string: us.data.flow005.payment.firstName
                  - name: lastName
                    string: us.data.flow005.payment.lastName
                  - name: expiration
                    string: us.data.flow028.expiration
                  - name: cvv
                    string: us.data.flow004.payment.cvv
                  - name: phoneNumber
                    string: us.data.flow004.phoneNumber 
            - click:
                identifier: us.mappings.item.continue          
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.covertotal
          then: 
            - click:
                identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.covertotal
            - executeFunction:
                name: us.functions.account.paymentMethod.addCardDetails
                params:
                  - name: number
                    string: us.data.flow005.payment.creditCard
                  - name: firstName
                    string: us.data.flow005.payment.firstName
                  - name: lastName
                    string: us.data.flow005.payment.lastName
                  - name: expiration
                    string: us.data.flow028.expiration
                  - name: cvv
                    string: us.data.flow004.payment.cvv
                  - name: phoneNumber
                    string: us.data.flow004.phoneNumber

            #Verify grey messages for EBT substitutions
            - executeFunction:
                name: us.functions.checkout.wallet.verify.greymessages

  - name: us.functions.checkout.enterEBTPin
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.verifyCheckoutSkipBagFeeRadioButton
          then:
              - executeFunction: 
                  name: us.functions.reviewOrder.verifyBagsDetailsOurSustainabilityPledge
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.placeOrderButton
      - click:
          identifier: us.mappings.reviewOrder.placeOrderButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.paymentMethod.checkout.continueButton
      - click:
          identifier: us.mappings.paymentMethod.checkout.continueButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebt.verifypurchase.popupwindow
          then:
            - click:
                identifier: us.mappings.reviewOrder.enter.ebtpindigit1
            - click:
                identifier: us.mappings.reviewOrder.enter.ebtpindigit2
            - click:
                identifier: us.mappings.reviewOrder.enter.ebtpindigit3
            - click:
                identifier: us.mappings.reviewOrder.enter.ebtpindigit4
            - click:
                identifier: us.mappings.reviewOrder.submitEBTOrder
      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - executeFunction:
          name: us.functions.orderConfirmation.orderCreationValidation

  - name: us.functions.checkout.wallet.verify.greymessages
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.ebt.subs.wallet.grey.message
      - click:
          identifier: us.mappings.item.continue

  - name: us.functions.checkout.reviewOrder.verify.greymessages
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.paymentMethod.checkout.wallet.title
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.grey.message
          then: 
            - click:
                identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.grey.message
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.grey.message
            - click:
                identifier: us.mappings.paymentMethod.checkout.wallet.addNewPaymentMethodButton
            - executeFunction:
                name: us.functions.checkout.newpaymentMethod.addCardDetails
                params:
                  - name: number
                    string: us.data.flow005.payment.creditCard
                  - name: firstName
                    string: us.data.flow005.payment.firstName
                  - name: lastName
                    string: us.data.flow005.payment.lastName
                  - name: expirationMonth
                    string: us.data.flow005.payment.expirationMonth
                  - name: expirationYear
                    string: us.data.flow005.payment.expirationYear
                  - name: cvv
                    string: us.data.flow004.payment.cvv
                  - name: phoneNumber
                    string: us.data.flow004.phoneNumber
            - click:
                identifier: mapings.capOne.paymentsOptionsContinueButton       
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.covertotal
          then: 
            - click:
                identifier: us.mappings.reviewOrder.ebt.subs.addcreditcard.covertotal
            - executeFunction:
                name: us.functions.checkout.newpaymentMethod.addCardDetails
                params:
                  - name: number
                    string: us.data.flow005.payment.creditCard
                  - name: firstName
                    string: us.data.flow005.payment.firstName
                  - name: lastName
                    string: us.data.flow005.payment.lastName
                  - name: expirationMonth
                    string: us.data.flow005.payment.expirationMonth
                  - name: expirationYear
                    string: us.data.flow005.payment.expirationYear
                  - name: cvv
                    string: us.data.flow004.payment.cvv
                  - name: phoneNumber
                    string: us.data.flow004.phoneNumber

            #Verify grey messages for EBT substitutions
            - executeFunction:
                name: us.functions.checkout.wallet.verify.greymessages

  - name: us.functions.checkout.wallet.verify.greymessages
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.ebt.subs.wallet.grey.message
      - click:
          identifier: mapings.capOne.paymentsOptionsContinueButton

  - name: us.functions.checkout.reviewOrder.Textupdates
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
    #  Scroll to Text updates for the order in review order page
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.tryWalmartPlusButton 
            - name: direction
              string: down
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.mobileContactText
          then: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox
                  - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Disclaimer
          # checked:
          #   - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox
          #     value: false
            # Workaround for warning during placing order with checkbox selected
            - if:
                identifier:
                  checked:
                    - identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox
                      value: true
                then:
                  - click:
                      identifier: us.mappings.reviewOrder.sendTextUpdatesToPhone.Checkbox

  - name: us.functions.checkout.reviewOrder.Textupdates
    platform: ios
    flow:
    #  Scroll to Text updates for the order in review order page
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.mobileContactText
            - name: direction
              string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.getTextInfo
            - identifier: us.mappings.reviewOrder.textdisclaimerTextbox
          notPresent:
            - identifier: us.mappings.reviewOrder.OptinCheckboxTextboxChecked


 # Verify Substitutions on Review Order
  - name: us.functions.reviewOrder.chooseVPItem.substitutions
    platform: android
    flow: 
      - sleep:
          duration: 7000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
      - click:
          identifier: us.mappings.reviewOrder.viewSubstitutionPreferenceButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subsPreference.title
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreference.edit.btn.firstitem
          then:
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.edit.btn.firstitem
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.doNotReplaceRadioButton
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center

            - click:
                identifier: us.mappings.reviewOrder.subsPreference.doNotReplaceRadioButton

            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.selectButton
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
            
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreference.edit.btn.seconditem
          then:
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.edit.btn.seconditem
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.selectButton
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center

            - click:
                identifier: us.mappings.reviewOrder.subsPreference.replaceWithRadioButton
            
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectFirstItem.replaceWith
            
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectButton

      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreference.edit.btn.thirditem
          then:
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.edit.btn.thirditem
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.subsPreference.selectButton
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center

            - click:
                identifier: us.mappings.reviewOrder.subsPreference.bestMatchRadioButton
            
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectButton

      - click:
          identifier: us.mappings.reviewOrder.subsPreference.doneButton
      - sleep:
          duration: 7000

# Verify Substitutions on Review Order
  - name: us.functions.reviewOrder.chooseVPItem.substitutions
    platform: ios
    flow: 
      - sleep:
          duration: 7000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.reviewOrder.viewSubstitutionsPreferenceButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.viewSubstitutionsPreferenceButton
      - click:
          identifier: us.mappings.reviewOrder.viewSubstitutionsPreferenceButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.subsPreference.title
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreference.edit.btn.firstitem
          then:
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.edit.btn.firstitem
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.subsPreference.doNotReplaceRadioButton

            - click:
                identifier: us.mappings.reviewOrder.subsPreference.doNotReplaceRadioButton
            
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreference.edit.btn.seconditem
          then:
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.edit.btn.seconditem
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.subsPreference.selectButton

            - click:
                identifier: us.mappings.reviewOrder.subPreference.replaceWithRadioButton
                        
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectButton

      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderDetails.EditItems.checkbox
            - name: direction
              string: down
            - name: scrollPosition
              string: center

      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.subsPreference.edit.btn.thirditem
          then:
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.edit.btn.thirditem
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.subsPreference.selectButton

            - click:
                identifier: us.mappings.reviewOrder.subPreference.bestMatchRadioButton
            
            - click:
                identifier: us.mappings.reviewOrder.subsPreference.selectButton

      - click:
          identifier: us.mappings.reviewOrder.subsPreference.doneButton
      - sleep:
          duration: 7000

  - name: us.functions.checkout.verifySODBanner
    platform: android
    flow:
    #Verify SOD banner on top
      - verifyIdentifier:
          text:
            - identifier: us.mappings.checkout.verifySODPresentDeliveryTitle
              contains : You'll need to be present at delivery
      - verifyIdentifier:
          text:
            - identifier: us.mappings.checkout.verifySODPresentDeliveryBody
              contains : Some of your items require an in-person handoff.
      #Verify SOD banner in shipping details      
      - verifyIdentifier:
          text:
            - identifier: us.mappings.checkout.verifySODPresentShippingText
              contains : You'll need to be present at delivery
      #Verify SOD banner in item details
      - click:
         identifier: us.mapings.reviewOrder.viewDetails
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.itemDetails.title
      - executeFunction:
              name: us.functions.utils.scrollIfNotVisible
              params:
                  - name: identifier
                    string: us.mappings.checkout.verifySODPresentDeliveryTitle
                  - name: direction
                    string: down
      - verifyIdentifier:
          text:
            - identifier: us.mappings.checkout.verifySODPresentDeliveryTitle
              contains : You'll need to be present at delivery

  - name: us.functions.checkout.verifySODBanner
    platform: ios
    flow:
    #Verify SOD banner on top
      - verifyIdentifier:
          label:
            - identifier:  us.mappings.cart-cxo.verifySODPresentDeliveryTextios
              contains : us.data.prod.sod.cxo.deliveryHandoffText
      #Verify SOD banner in shipping details 
      - verifyIdentifier:
          label:
            - identifier:  us.mappings.cart-cxo.verifySODPresentShippingText
              contains : us.data.prod.sod.cxo.deliveryText
      #Verify SOD banner in item details
      - executeFunction:
              name: us.functions.utils.scrollIfNotVisible
              params:
                  - name: identifier
                    string: us.mappings.cart-cxo.verifySODPresentItemDetailsText
                  - name: direction
                    string: down    
      - verifyIdentifier:
          label:
            - identifier: us.mappings.cart-cxo.verifySODPresentItemDetailsText
              contains : us.data.prod.sod.cxo.deliveryText        


  - name: us.functions.checkout.placeOrderAndAcceptSubscriptionTerms
    platform: android
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.checkout.verifySubscriptionTermsBottomSheet
              - identifier: us.mappings.checkout.subscriptionBootomSheet.greyAlertMessage
              - identifier: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
        - click: 
            identifier: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
        - log: Red Alert message to scroll to the end of subscription terms appear!
        - verifyIdentifier:
            text:
              - identifier: us.mappings.checkout.subscriptionBootomSheet.greyAlertMessage
                contains: Scroll down to read the full terms
        - executeFunction:
           name: us.functions.utils.scrollIfNotVisible
           params:
              - name: identifier
                string: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
              - name: direction
                string: down
        - verifyIdentifier: 
            present: 
                - identifier: us.mappings.checkout.subscriptionBootomSheet.verifyDeliveryInfoDateAndTimeNudge
                - identifier: us.mappings.checkout.subscriptionBootomSheet.verifySubscriptionItemDetails
                - identifier: us.mappings.checkout.subscriptionBootomSheet.verifySeeFullTermsLink
        - click: 
              identifier: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
            
               
  - name: us.functions.checkout.placeOrderAndAcceptSubscriptionTerms
    platform: ios
    flow:
        - verifyIdentifier:
              present:
                  - identifier: us.mappings.checkout.verifySubscriptionTermsBottomSheet
                  - identifier: us.mappings.checkout.subscriptionBootomSheet.greyAlertMessage
                  - identifier: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
        # - click: 
        #         identifier: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
        - log: Red Alert message to scroll to the end of subscription terms appear!
        - executeFunction:
              name: us.functions.utils.scrollIfNotVisible
              params:
                  - name: identifier
                    string: us.mappings.checkout.subscriptionBootomSheet.verifySeeFullTermsLink
                  - name: direction
                    string: down
        - verifyIdentifier: 
            present: 
                - identifier: us.mappings.checkout.subscriptionBootomSheet.verifySeeFullTermsLink
        - click: 
              identifier: us.mappings.checkout.subscriptionBootomSheet.veifyIAgreeButton
            
  - name: us.functions.reviewOrder.acc.verifySelectedPackage
    platform: ios
    flow:
      - if:
          condition: ${Package} == 'valuePackage'
          then:
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.reviewOrder.selectedvaluePackage

      - if:
          condition: ${Package} == 'basicPackage'
          then:
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.reviewOrder.selectedBasicPackage
                  

  - name: us.functions.reviewOrder.acc.verifySelectedPackage
    platform: android
    flow:
      - if:
          condition: ${Package} == 'valuePackage'
          then:
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.reviewOrder.selectedvaluePackage

      - if:
          condition: ${Package} == 'basicPackage'
          then:
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.reviewOrder.selectedBasicPackage

  - name: us.functions.checkout.applianceDeliveryValidations
    platform: ios
    flow:
      - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
                - name: identifier
                  string: us.mappings.checkout.applianceDelivery.deliveryAndSetupOptionsAddedMessage
                - name: direction
                  string: down
                - name: scrollPosition
                  string: center                      
      - verifyIdentifier:
            present:
                - identifier: us.mappings.checkout.applianceDelivery.deliveryDate
                - identifier: us.mappings.checkout.applianceDelivery.youWillNeedBePresentDisclaimer
                - identifier: us.mappings.checkout.applianceDelivery.deliveryAndSetupOptionsAddedMessage
      - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
                - name: identifier
                  string: us.mappings.cart.localMarketPlace.subTotal
                - name: direction
                  string: down
                - name: scrollPosition
                  string: center     
      - verifyIdentifier:
            present:
                - identifier: us.mappings.checkout.applianceDelivery.deliveryAndInstallation
                - identifier: us.mappings.checkout.applianceDelivery.haulAway

  - name: us.functions.checkout.applianceDeliveryValidations
    platform: android
    flow:
      - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
                - name: identifier
                  string: us.mappings.checkout.applianceDelivery.deliveryAndSetupOptionsAddedMessage
                - name: direction
                  string: down
      - verifyIdentifier:
            present:
                - identifier: us.mappings.checkout.applianceDelivery.deliveryDate
                - identifier: us.mappings.checkout.applianceDelivery.youWillNeedBePresentDisclaimer
                - identifier: us.mappings.checkout.applianceDelivery.deliveryAndSetupOptionsAddedMessage

# Local Market Place

  - name: us.functions.reviewOrder.localMarketPlace.reviewOrderPageValidations
    platform: android
    flow:
      - if: 
          condition: ${fulfillment} == 'Delivery'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSellerSLA
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.deliveryInstructions
            - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                      - name: identifier
                        string: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.tippingModule
                      - name: direction
                        string: down
                      - name: scrollPosition
                        string: center
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.tippingModule
            - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                      - name: identifier
                        string: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.deliveryFromStoreCharges
                      - name: direction
                        string: down
                      - name: scrollPosition
                        string: center                        
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.deliveryFromStoreCharges
      - if: 
          condition: ${fulfillment} == 'Pickup'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSeller
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSellerSLA
                      - identifier: us.mappings.revieworder.localMarketPlace.pickuFromLocalSeller.address
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSeller.orderHoldingPeriod
                      - identifier: us.mappings.revieworder.localMarketPlace.pickuFromLocalSeller.pickupPersonOrAlternativePerson

# Local Market Place

  - name: us.functions.reviewOrder.localMarketPlace.reviewOrderPageValidations
    platform: ios
    flow:
      - if: 
          condition: ${fulfillment} == 'Delivery'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSellerSLA
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.deliveryInstructions
            - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                      - name: identifier
                        string: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.deliveryFromStoreCharges
                      - name: direction
                        string: down
                      - name: scrollPosition
                        string: center                        
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.deliveryFromLocalSeller.deliveryFromStoreCharges
      - if: 
          condition: ${fulfillment} == 'Pickup'
          then:
            - verifyIdentifier:
                  present:
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSeller
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSellerSLA
                      - identifier: us.mappings.revieworder.localMarketPlace.pickuFromLocalSeller.address
                      - identifier: us.mappings.revieworder.localMarketPlace.pickupFromLocalSeller.orderHoldingPeriod
                      - identifier: us.mappings.revieworder.localMarketPlace.pickuFromLocalSeller.pickupPersonOrAlternativePerson

# CFS Incremental Auth

  - name: us.functions.reviewOrder.incrementalAuth.verifyTemporaryHold
    platform: android
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.pos.temporaryHold.header
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.temporaryHold.description
            - identifier: us.mappings.reviewOrder.pos.temporaryHold.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.pos.temporaryHold.infoIcon
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.temporaryHold.bottomSheet.title
            - identifier: us.mappings.reviewOrder.temporaryHold.bottomSheet.description
            - identifier: us.mappings.reviewOrder.temporaryHold.bottomSheet.gotIt
      - scroll:
          direction: Up
          untilIdentifier: us.mappings.reviewOrder.editPayment
      - click:
          identifier: us.mappings.reviewOrder.editPayment
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.header
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.wallet.temporaryHold.infoIcon
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.bottomSheet.title
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.bottomSheet.description
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.bottomSheet.gotIt
      - click:
          identifier: us.mappings.cart.amendsPage.temporaryHold.bottomSheet.gotIt
      - click:
          identifier: us.mappings.global.navigateBackArrow

  # CFS - no language updates for gift card orders
  - name: us.functions.reviewOrder.incrementalAuth.adjustmentCharge
    platform: android
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.pos.adjustmentCharge.header
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.incrementalAuth.description
      - click:
          identifier: us.mappings.reviewOrder.pos.adjustmentCharge.infoIcon
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.incrementalAuth.bottomSheet.description
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.adjustmentCharge.bottomSheet.gotIt
      - click:
          identifier: us.mappings.reviewOrder.pos.adjustmentCharge.bottomSheet.gotIt

  # CFS - no language updates for gift card orders
  - name: us.functions.reviewOrder.incrementalAuth.adjustmentCharge
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.pos.adjustmentCharge.header
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.incrementalAuth.description
      - click:
          identifier: us.mappings.reviewOrder.pos.adjustmentCharge.infoIcon
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.incrementalAuth.bottomSheet.description
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.adjustmentCharge.bottomSheet.gotIt
      - click:
          identifier: us.mappings.reviewOrder.pos.adjustmentCharge.bottomSheet.gotIt

  - name: us.functions.checkout.reviewOrder.preorderItem.verifyCardDetails
    platform: ios
    flow:
      - click:
          identifier: us.mapings.reviewOrder.viewDetails
      - sleep:
          duration: 4000           
      - verifyIdentifier:
          present:
            - identifier: us.mappings.revieworder.preorderBadge
           # - identifier: us.mappings.revieworder.preorderItem.releaseDateLabel     

  - name: us.functions.checkout.reviewOrder.preorderItem.verifyCardDetails
    platform: android
    flow:
      - click:
          identifier: us.mapings.reviewOrder.viewDetails
      - sleep:
          duration: 4000           
      - verifyIdentifier:
          present:
            - identifier: us.mappings.revieworder.preorderBadge
            - identifier: us.mappings.revieworder.preorderItem.releaseDateLabel                        

  - name: us.functions.reviewOrder.incrementalAuth.verifyTemporaryHold
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.pos.temporaryHold.header
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.pos.temporaryHold.description
            - identifier: us.mappings.reviewOrder.pos.temporaryHold.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.pos.temporaryHold.infoIcon
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.temporaryHold.bottomSheet.title
            - identifier: us.mappings.reviewOrder.temporaryHold.bottomSheet.description
            - identifier: us.mappings.reviewOrder.temporaryHold.bottomSheet.gotIt
      - scroll:
          direction: Up
          untilIdentifier: us.mappings.reviewOrder.editPayment
      - click:
          identifier: us.mappings.reviewOrder.editPayment
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.header
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.wallet.temporaryHold.infoIcon
      - verifyIdentifier:
          timeout: 5000
          present:
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.bottomSheet.title
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.bottomSheet.description
            - identifier: us.mappings.reviewOrder.wallet.temporaryHold.bottomSheet.gotIt
      - click:
          identifier: us.mappings.cart.amendsPage.temporaryHold.bottomSheet.gotIt
      - click:
          identifier: us.mappings.global.navigateBackArrow
          
  #RXPD Review order validations
  - name: us.functions.reviewOrder.rxpd.item.validations
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.rxpd.item.viewDetails.link
          then:
            - click:
                identifier: us.mappings.reviewOrder.rxpd.item.viewDetails.link
          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.rxpd.item.prescription.txt
            - identifier: us.mappings.reviewOrder.rxpd.item.prescription.name
            - identifier: us.mappings.reviewOrder.rxpd.item.patient.name
            - identifier: us.mappings.reviewOrder.rxpd.item.coverage.applied
            - identifier: us.mappings.reviewOrder.rxpd.item.price
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.rxpd.item.done.button
          then:
            - click:
                identifier: us.mappings.reviewOrder.rxpd.item.done.button

  - name: us.functions.reviewOrder.validate.SODBanner
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner1
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner1.title
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner1.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.rxpd.sod.banner1.infoIcon
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.title
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.text
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.gotItButton
      - executeFunction:
          name: us.functions.cart.validate.rxpd.item
      - click:
          identifier: us.mappings.cart.rxpd.sod.bottomSheet.closeIcon
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner2
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner2.title
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner2.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.rxpd.sod.banner2.infoIcon
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.title
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.text
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.gotItButton
      - executeFunction:
          name: us.functions.cart.validate.rxpd.item
      - click:
          identifier: us.mappings.cart.rxpd.sod.bottomSheet.closeIcon

  #RXPD Review order validations
  - name: us.functions.reviewOrder.rxpd.item.validations
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.rxpd.item.viewDetails.link
          then:
            - click:
                identifier: us.mappings.reviewOrder.rxpd.item.viewDetails.link
                wait: 2000
          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.rxpd.item.prescription.txt
            - identifier: us.mappings.reviewOrder.rxpd.item.prescription.name
            
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.rxpd.item.done.button
          then:
            - click:
                identifier: us.mappings.reviewOrder.rxpd.item.done.button

  - name: us.functions.checkout.egiftCardEditPaymentPlaceholder
    platform: android
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationTitle
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationEmail
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationQty
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationSenderName
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationpersonalisedMessage
        - enterText:
                identifier: us.mappings.reviewOrder.eGiftCardCustomisationEmail
                string: ${email}
                pressEnter: true
        - sleep:
                duration: 2000

  - name: us.functions.checkout.egiftCardEditPaymentPlaceholder
    platform: ios
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationTitle
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationEmail
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationQty
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationSenderName
              - identifier: us.mappings.reviewOrder.eGiftCardCustomisationpersonalisedMessage
        - enterText:
                identifier: us.mappings.reviewOrder.eGiftCardCustomisationEmail
                string: ${email}
                pressEnter: true
        - sleep:
                duration: 2000
       
        
  - name: us.functions.checkout.editReceiptantDeatils
    platform: android
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.editLink
        - sleep:
                duration: 2000
        - enterText:
                identifier: us.mappings.reviewOrder.eGiftCardCustomisationEmail
                string: receiptant email
                clearField: true
        - sleep:
                duration: 2000
        - click: 
              identifier: us.mappings.reviewOrder.eGiftCardCustomisationContinueBtn
        - sleep:
                duration: 1000
        - click: 
              identifier: us.mappings.reviewOrder.eGiftCardCustomisationContinueBtn


  - name: us.functions.checkout.deleteReceiptant
    platform: android
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.deleteLink
        - sleep:
                duration: 2000
        - click: 
              identifier: us.mappings.reviewOrder.firstdeleteLink


  - name: us.functions.checkout.verifycustomerCanSendMultiplecardstoMultipleReceiptant
    platform: android
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.egiftCardDropDownIcon
        - sleep:
                duration: 2000
        - click: 
              identifier: us.mappings.reviewOrder.egiftCardDropDownIcon

  - name: us.functions.checkout.verifycustomerCanSendMultiplecardstoMultipleReceiptant
    platform: ios
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.egiftCardDropDownIcon
        - sleep:
                duration: 2000
        - click: 
              identifier: us.mappings.reviewOrder.egiftCardDropDownIcon


  - name: us.function.checkout.addMultipleReceiptants
    platform: android
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.reviewOrder.addNewReceiptantLink
      - loop:
          begin: 0
          end: 2
          flow:
          - click:
              identifier: us.mappings.reviewOrder.addNewReceiptantLink
          - verifyIdentifier:
             present:
              - identifier: us.mappings.reviewOrder.eGiftCardFirstEmailTextBox
              - identifier: us.mappings.reviewOrder.eGiftCardSecondEmailTextBox
              - identifier: us.mappings.reviewOrder.eGiftCardThridEmailTextBox
          - click:
             identifier: us.mappings.reviewOrder.eGiftCardFirstEmailTextBox
          - enterText:
               identifier: us.mappings.reviewOrder.eGiftCardFirstEmailTextBox
               string: ${email1}
          - click:
             identifier: us.mappings.reviewOrder.eGiftCardSecondEmailTextBox
          - enterText:
               identifier: us.mappings.reviewOrder.eGiftCardSecondEmailTextBox
               string: ${email2} 
          - click:
             identifier: us.mappings.reviewOrder.eGiftCardThridEmailTextBox
          - enterText:
              identifier: us.mappings.reviewOrder.eGiftCardThridEmailTextBox
              string: ${email3}  

  - name: us.function.checkout.addMultipleReceiptants
    platform: ios
    flow:
      - verifyIdentifier:
          timeout: 20000
          present:
            - identifier: us.mappings.reviewOrder.addNewReceiptantLink
      - loop:
          begin: 0
          end: 2
          flow:
            - click:
                identifier: us.mappings.reviewOrder.addNewReceiptantLink
            - verifyIdentifier:
               present:
                - identifier: us.mappings.reviewOrder.eGiftCardFirstEmailTextBox
                - identifier: us.mappings.reviewOrder.eGiftCardSecondEmailTextBox
                - identifier: us.mappings.reviewOrder.eGiftCardThridEmailTextBox
            - click:
               identifier: us.mappings.reviewOrder.eGiftCardFirstEmailTextBox
            - enterText:
               identifier: us.mappings.reviewOrder.eGiftCardFirstEmailTextBox
               string: ${email1}
            - click:
               identifier: us.mappings.reviewOrder.eGiftCardSecondEmailTextBox
            - enterText:
               identifier: us.mappings.reviewOrder.eGiftCardSecondEmailTextBox
               string: ${email2} 
            - click:
               identifier: us.mappings.reviewOrder.eGiftCardThridEmailTextBox
            - enterText:
                identifier: us.mappings.reviewOrder.eGiftCardThridEmailTextBox
                string: ${email3}  


  - name: us.functions.checkout.deleteOneReceiptant
    platform: android
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.deleteLink
        - sleep:
                duration: 2000
        - click: 
              identifier: us.mappings.reviewOrder.deleteLink
        - click: 
              identifier: us.mappings.reviewOrder.egiftCardModalContinueBtn

  - name: us.functions.checkout.deleteOneReceiptant
    platform: ios
    flow:
        - verifyIdentifier:
           present:
              - identifier: us.mappings.reviewOrder.deleteLink
        - sleep:
                duration: 2000
        - click: 
              identifier: us.mappings.reviewOrder.deleteLink
        - click: 
              identifier: us.mappings.reviewOrder.egiftCardModalContinueBtn

  - name: us.functions.reviewOrder.addPaypal
    platform: ios
    flow:
      - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
                - name: identifier
                  string: us.mappings.reviewOrder.paymentMethod.changePaymentpageTitle
                - name: direction
                  string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.paymentMethod.changePaymentpageTitle
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.changePaymentpageTitle
      - executeFunction:
            name: us.functions.utils.scrollIfNotVisible
            params:
                - name: identifier
                  string: us.mappings.revieworder.addPaypalModule
                - name: direction
                  string: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.revieworder.addPaypalModule      
      - click:
          identifier: us.mappings.reviewOrder.addPaypal
      - click:
          identifier: us.mappings.reviewOrder.confirmPayPal
      # Login into paypal
      - executeFunction:
          name: us.functions.paypal.logInPage 

  - name: us.functions.reviewOrder.validateViewDetailsBottomsheet
    platform: ios
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsLink
      - if:
          identifier:
            present:
              - identifier: us.mapings.search.backorderedLabel
          then:
            - log: "The backorder label is shown as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Backorder label should be show but is not"

  - name: us.functions.reviewOrder.validateViewDetailsBottomsheet
    platform: android
    flow:
      - click:
          identifier: us.mappings.reviewOrder.viewDetailsLink
      - if:
          identifier:
            present:
              - identifier: us.mapings.search.backorderedLabel
          then:
            - log: "The backorder label is shown as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Backorder label should be show but is not"
### Alcohol Order Error Checker: Logic and Error Handling
  - name: us.functions.reviewOrder.alcoholCheckbox.errorHandling
    platform: android  
    flow:
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.alcoholOrder.checkBoxFieldTitle
          position: center
      - if:
          identifier:
            present: 
              - identifier: us.mappings.reviewOrder.confirmAlcoholCheckbox
          then:
            - log: Alcohol Order Confirm Check box detected
            - click:
                identifier: us.mappings.reviewOrder.confirmAlcoholCheckbox
                wait: 3000
          else:
            - log: No Alcohol Checkbox error was Detected

  - name: us.functions.reviewOrder.verifyMixedBasketConsolidation
    platform: android
    flow:
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.mixedBasketConsolidation.title
          then:
            - log: "Mixed Basket Consolidation is happening !!!"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Mixed Basket Consolidation is NOT happening"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.mbc.deliveryFromStore
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.mbc.freeShipping
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.mbc.freeShipping
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.mbc.freeShipping
      - sleep:
          duration: 3000

  - name: us.functions.reviewOrder.verifyMixedBasketConsolidation
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.checkout.reviewOrder.scrollToTopOfReviewOrder
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.mixedBasketConsolidation.title
          then:
            - log: "Mixed Basket Consolidation is happening !!!"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Mixed Basket Consolidation is NOT happening"
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.mbc.deliveryFromStore
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.reviewOrder.mbc.freeShipping
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.reviewOrder.mbc.freeShipping
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.mbc.freeShipping
      - sleep:
          duration: 3000

  ## RXPD SOD Review order page Validations
  - name: us.functions.reviewOrder.validate.SODBanner
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner1
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner1.title
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner1.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.rxpd.sod.banner1.infoIcon
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.title
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.text
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.gotItButton
      - executeFunction:
          name: us.functions.cart.validate.rxpd.item
      - click:
          identifier: us.mappings.cart.rxpd.sod.bottomSheet.closeIcon
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner2
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner2.title
            - identifier: us.mappings.reviewOrder.rxpd.sod.banner2.infoIcon
      - click:
          identifier: us.mappings.reviewOrder.rxpd.sod.banner2.infoIcon
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.title
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.text
            - identifier: us.mappings.cart.rxpd.sod.bottomSheet.gotItButton
      - executeFunction:
          name: us.functions.cart.validate.rxpd.item
      - click:
          identifier: us.mappings.cart.rxpd.sod.bottomSheet.closeIcon

  - name: us.functions.reviewOrder.pharmacy.minOrderFeeWaiveoffValidation
    platform: android
    flow:
      - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.estimateTotalAmount
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.checkout.pharmacy.chargeWaiveOff

  - name: us.functions.reviewOrder.pharmacy.minOrderFeeWaiveoffValidation
    platform: ios
    flow:
      - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.reviewOrder.estimateTotalAmount
                  - name: direction
                    string: down
                  - name: scrollPosition
                    string: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.checkout.pharmacy.chargeWaiveOff