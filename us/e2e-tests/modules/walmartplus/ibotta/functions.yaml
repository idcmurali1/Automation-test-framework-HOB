functions:

#************************************************* iOS ******************************************************
 # Wplus ibotta flow
#************************************************* iOS ******************************************************

  - name: us.functions.wplus.verifyibottaandatc.fromhome
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.accountlable
      - click:
          identifier: us.mappings.accountlable
          wait: 1000
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.myitems.accountpage
            - name: direction
              string: down 
      - if:
          identifier:
            present:
              - identifier: us.mappings.home.popUp
          then:
            - log: tooltip present and hence closing it
            - click:
                identifier: us.mappings.home.popUpCloseButton
                wait: 2000
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.myitems.accountpage
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.myitems.rewardscenter.accountpage
      - click:
          identifier: us.mappings.myitems.rewardscenter.accountpage
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.yourrewardstext.accountspage
            - identifier: us.mappings.myitems.lifetimeearnings.accountpage
            - identifier: us.mappings.myitems.savedrewards.accountpage
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.itemslink
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.itemslink
                scrollLimit: 3
                position: center
      - click:
          identifier: us.mappings.itemslink
          wait: 3000
      - executeFunction:
          name: us.functions.search.closeHowDoYouWantYourOrderBottomTray     
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibotta.rewardAddedItem
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.ibotta.rewardAddedItem
                position: center
      - click:
          identifier: us.mappings.rewardsaddedItem.addtocart.button
          wait: 3000
      - executeFunction:
          name: us.functions.item.verifyReward.mustBuy     

  - name: us.functions.wplus.verifyibottaandatc.fromSearchPage
    platform: ios
    flow:
      - sleep:
          duration: 5000 
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsAvailableLabel 
          then:             
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.search.rewardsAvailableLabel     
          else: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.rewardsCheckBox

  - name: us.functions.wplus.verifyibottaandatc.fromSearchPage
    platform: android
    flow:
      - sleep:
          duration: 5000 
      - if:
          identifier:
            present:
              - identifier: us.mappings.search.rewardsAvailableLabel 
          then:             
              - verifyIdentifier:
                  present:
                    - identifier: us.mappings.search.rewardsAvailableLabel     
          else: 
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.search.rewardsCheckBox                                               

  - name: us.functions.wplus.verifyibottaandatc.fromItemPage
    platform: ios
    flow:
      - sleep:
          duration: 5000  
      - loop:
          begin: 0
          end: 15
          mode: increment
          storeIndex: i
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.search.rewardsCheckBox
                then:
                  - log: "Walmart Cash Checkbox Found"
                  - break: true
                else:
                  - scroll:
                      direction: down
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.rewardsCheckBox 

  - name: us.functions.wplus.verifyibottaandatc.fromItemPage
    platform: android
    flow:
      - sleep:
          duration: 5000  
      - scroll:
          untilIdentifier: us.mappings.search.rewardsCheckBox
          position: center
          direction: down
      - if:
          identifier:
            present:
              - identifier: us.mappings.rewardsItemPageTitle
          then:
            - log: "Rewards title present as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Rewards title should have been present but is not"

  - name: us.functions.wplus.verifyCash.fromCartPage
    platform: ios
    flow:
      - sleep:
          duration: 5000  
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.search.rewardsCheckBox
      - verifyIdentifier:
          present:
            - identifier: us.mappings.search.productTileRewards

  - name: us.functions.wplus.verifyCash.fromCartPage
    platform: android
    flow:
      - sleep:
          duration: 5000  
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.search.rewardsCheckBox
      - verifyIdentifier:
          present:
            - identifier: us.mappings.wplus.offerDetailsPage.componentOfferClaimedText

  - name: us.functions.wplus.verifyibottarewardslabels.oncartdetailspage
    platform: ios
    flow:
      - if:
          condition: ${mustBuy} != null
          then:
              - executeFunction:
                  name: us.functions.cart.increaseToMaxQty
                  params:
                    - name: maxQty
                      string: ${mustBuy}
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibotta.itemrewardslabel.estimatedwalmartrewards
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.ibotta.itemrewardslabel.estimatedwalmartrewards
                scrollLimit: 10
                position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.itemrewardslabel.estimatedwalmartrewards
            - identifier: us.mappings.ibotta.itemrewardstext.on.estimatesrewardssheetbottom
      - click:
          identifier: us.mappings.global.navigateBackArrow
          wait: 1500

  - name: us.functions.wplus.verifyibotta.savedrewardspage
    platform: ios
    flow:
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.ibotta.viewallsavedrewardslink.yourrewardspage
      # - click:
      #     identifier: us.mappings.ibotta.viewallsavedrewardslink.yourrewardspage
      #     wait: 2500
      # - click:
      #     identifier: us.mappings.wplus.backToAccountButton
      #     wait: 3000   
      - click:
          identifier: us.mappings.myItems.saveRewardsBackBtn
      - sleep:
          duration: 2000 
      - click:
          identifier: us.mappings.myItems.listsTab
      - sleep:
          duration: 2000                
      - click:
          identifier: us.mappings.account.myItem.list.savedRewards
      - sleep:
          duration: 2000 
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibotta.viewallsavedrewardslink.yourrewardslabel 
          then:
            - log: "Your rewards label is properly displayed"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - You rewards label was not displayed correctly" 
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.ibotta.viewallsavedrewardslink.yourrewardslabel

  - name: us.functions.wplus.validateRewardItemInSavedrewardsPage
    platform: ios
    flow:
      - click:
          identifier: us.mappings.tabBar.myItems
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.myItems.listAndFavouritesTab          
      - click:
          identifier: us.mappings.myItems.saveRewardsPage          
      - sleep:
          duration: 3000  
      - if:
          identifier:
            present:
              - identifier: us.mappings.myitems.yourRewardItemsLists 
          then:
            - log: "Rewards items listed properly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Reward items should have been listed but are not" 
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.myitems.yourRewardItemsLists

  - name: us.functions.wplus.validateRewardItemInSavedrewardsPage
    platform: android
    flow:
      - scroll:
          direction: up
          scrollLimit: 1    
      - click:
          identifier: us.mappings.tabBar.myItems
      - sleep:
          duration: 3000
      - click:
          identifier: us.mappings.myItems.listAndFavorites    
      - executeFunction:
         name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed
      - click:
          identifier: us.mappings.savedrewardspage.yoursavedrewards.text          
      - sleep:
          duration: 3000 
      - if:
          identifier:
            present:
              - identifier: us.mappings.savedrewardspage.listsItemDetails 
          then:
            - log: "Rewards items listed properly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Reward items should have been listed but are not"   
      - verifyIdentifier:
          present:
            - identifier: us.mappings.savedrewardspage.listsItemDetails

  - name: us.functions.wplus.verifyibottaandatc.fromhome
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.accountlable
      - click:
          identifier: us.mappings.accountlable
          wait: 1000
      - log: Clicked on Accounts tab
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.accountspage.myitems.text
          then:
            - log: Couldn't find the My items block, Scrolling down.
            - scroll:
                direction: down
                untilIdentifier: us.mappings.accountspage.myitems.text
                scrollLimit: 10
                position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.accountspage.rewardscenter.link
      - click:
          identifier: us.mappings.accountspage.rewardscenter.link
          wait: 1000
      - log: Clicked Rewards Center link.
      - verifyIdentifier:
          present:
            - identifier: us.mappings.rewardsitemspage.yourrewards.text
            - identifier: us.mappings.rewardsitemspage.yourrewardsbalance.text
            - identifier: us.mappings.rewardsitemspage.yourrewardslifetime.text
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.rewardspage.viewallitems.link
          then:
            - log: Couldn't find the View All Items link, Scrolling down.
            - scroll:
                direction: down
                untilIdentifier: us.mappings.rewardspage.viewallitems.link
                scrollLimit: 10
                position: center
      - click:
          identifier: us.mappings.rewardspage.viewallitems.link
          wait: 2000
      - log: Clicked View All Items link
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibotta.rewardAddedItem
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.ibotta.rewardAddedItem
                position: center
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.rewardsaddedItem.addtocart.button
          then:
            - scroll: 
                direction: down
                scrollLimit: 1
      - click:
          identifier: us.mappings.rewardsaddedItem.addtocart.button
          wait: 3000
      - log: Selected the cashback Rewards Item.
      - log: The cashback Rewards Item, added to the cart.
      - executeFunction:
          name: us.functions.item.verifyReward.mustBuy     

  - name: us.functions.wplus.verifyibottarewardslabels.oncartdetailspage
    platform: android
    flow: 
      - executeFunction:
            name: us.functions.cart.VerifyRewardsEarnedTag
            params:
               - name: mustBuy
                 string: ${maxQuantity}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cartdetailpage.earningreward.label
            - identifier: us.mappings.cartdetailpage.earningreward.text
            - identifier: us.mappings.cartdetailpage.earningreward.icon
      - log: Verified that the Earning Reward Label present for the item in the CART.
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.cartdetailpage.cartbasketrewardsbanner.text
          then:
            - log: Couldn't find the Cart Basket rewards banner, Scrolling down.
            - scroll:
                direction: down
                untilIdentifier: us.mappings.cartdetailpage.cartbasketrewardsbanner.text
                scrollLimit: 10
                position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.cartdetailpage.cartbasketrewardsbanner.text
            - identifier: us.mappings.cartdetailpage.cartbasketrewardsbanner
      - if:
          identifier:
            present:
              - identifier: us.mappings.cartdetailpage.cartbasketrewardsbanner.icon
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.cartdetailpage.cartbasketrewardsbanner.icon
      - log: Verified that the Cart Basket Reward Banner.
      - click:
          identifier: us.mappings.cart.navbar.back
          wait: 2000

  - name: us.functions.wplus.verifyibotta.savedrewardspage
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.accountlable
          then:
            - log: Couldn't find the Account tab, Scrolling Up.
            - scroll:
                direction: up
                untilIdentifier: us.mappings.accountlable
                scrollLimit: 10
                position: center
      - log: Clicked on the Account tab.
      - click:
          identifier: us.mappings.accountlable
          wait: 1500
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.rewardsitemspage.yourrewards.text
            - name: direction
              string: up  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.rewardsitemspage.yourrewards.text
            - identifier: us.mappings.rewardsitemspage.yourrewardsbalance.text
            - identifier: us.mappings.rewardsitemspage.yourrewardslifetime.text
      - click:
          identifier: us.mappings.backButton
          wait: 3000   
      - click:
          identifier: us.mappings.account.myItem.list
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.account.myItem.list.savedRewards
      - sleep:
          duration: 2000     
      - verifyIdentifier:
          present:
            - identifier: us.mappings.savedrewardspage.yoursavedrewards.text
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.savedrewardspage.listsrewardsview.label
            - name: direction
              string: down
            - name: scrollPosition
              string: center   
      - verifyIdentifier:
          present:
            - identifier: us.mappings.savedrewardspage.listsrewardsview.label
            - identifier: us.mappings.savedrewardspage.listsrewardsview.text

  - name: us.functions.ibotta.verifyIbottaRewards.on.itemSearch
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
            - identifier: us.mappings.ibottaRewards.walmartCash.rewards.text
      - if:
          condition: ${mustBuy2items} != null
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.ibottaRewards.walmartCash.mustBy2.text
  
  - name: us.functions.ibotta.verifyibottaRewards.on.cartPage
    platform: android
    flow:    
     - verifyIdentifier:
        present:
         - identifier: us.mappings.ibottaRewards.walmartCash.claimed.text
     - log: "Walmart cash claimed badge is present in cart page"

  - name: us.functions.ibotta.verifyibottaRewards.on.OrderDetailsPage
    platform: android
    flow:    
     - if:
        identifier:
         notPresent:
          - identifier: us.mappings.ibottaRewards.walmartCash.claimed.text
        then:
        - log: Couldn't find the walmart cash claimed badge, Scrolling down.
        - scroll:
            direction: down
            untilIdentifier: us.mappings.ibottaRewards.walmartCash.claimed.text
            scrollLimit: 3
            position: center
     - log: "Walmart cash claimed badge is present in cart page"

  - name: us.functions.ibotta.verifyibottaRewards.on.reviewOrderPage
    platform: android
    flow: 
     - if:
        identifier:
          present:
            - identifier: us.mappings.ibottaRewards.subscription.preference.closeButton
        then:
           - click:
              identifier: us.mappings.ibottaRewards.subscription.preference.closeButton
           - log: "Substitution preferences overlay is closed"
     - if:
        identifier:
         notPresent:
          - identifier: us.mappings.ibottaRewards.walmartCash.checkoutRewards
        then:
        - log: Couldn't find the checkoutRewards, Scrolling down.
        - scroll:
            direction: down
            untilIdentifier: us.mappings.ibottaRewards.walmartCash.checkoutRewards
            scrollLimit: 10
            position: center
        - log: "You'll get an estimated $ in Walmart Cash with this order! is present"
  
  - name: us.functions.ibotta.selectIbottaSubscription.on.itemPage.AddSubscription
    platform: android
    flow:
      - sleep:
          duration: 5000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
          then:
            - log: Couldn't find the rewards checkbox, Scrolling down.
            - scroll:
                direction: down
                untilIdentifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
                scrollLimit: 10
                position: center
      - click:
          identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.claimed
            - identifier: us.mappings.ibottaRewards.walmartCash.info.button
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.subscriptionRadioButton
          then:
            - log: Couldn't find the subscription radio button, Scrolling up.
            - scroll:
                direction: up
                untilIdentifier: us.mappings.ibottaRewards.subscriptionRadioButton
                scrollLimit: 10
                position: center
      - click:
          identifier: us.mappings.ibottaRewards.subscriptionRadioButton
      - click:
          identifier: us.mappings.ibottaRewards.setUpSubscription.button
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present: 
          - identifier: us.mappings.myItems.reorder.subscriptionPanel.addSubscription
      - click:
         identifier: us.mappings.myItems.reorder.subscriptionPanel.addSubscription
      - sleep:
          duration: 5000
      - click:
          identifier: us.mapping.item.postItemAddToCartViewOverlay.closeButton

  - name: us.functions.ibotta.selectIbottaSubscription.on.itemPage
    platform: android
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
          then:
            - log: Couldn't find the rewards checkbox, Scrolling down.
            - scroll:
                direction: down
                untilIdentifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
                scrollLimit: 10
                position: center
      - click:
          identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.claimed
            - identifier: us.mappings.ibottaRewards.walmartCash.info.button
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.subscriptionRadioButton
          then:
            - log: Couldn't find the subscription radio button, Scrolling up.
            - scroll:
                direction: up
                untilIdentifier: us.mappings.ibottaRewards.subscriptionRadioButton
                scrollLimit: 10
                position: center
      - click:
          identifier: us.mappings.ibottaRewards.subscriptionRadioButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.subscription.infoText
      - click:
          identifier: us.mappings.ibottaRewards.setUpSubscription.button
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.funtions.ibotta.subscriptionPage.addAddress
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.subscribeSheetTitle
            - identifier: us.mappings.ibottaRewards.subscribeSheet.itemName
            - identifier: us.mappings.ibottaRewards.subscribeSheet.addressBar
            - identifier: us.mappings.ibottaRewards.subscribeSheet.paymentBar
            - identifier: us.mappings.ibottaRewards.subscribeSheet.frequencySection
            - identifier: us.mappings.ibottaRewards.subscribeSheet.totalSection
            - identifier: us.mappings.ibottaRewards.subscribeSheet.subscribeNow.button
      - if:
          condition: ${mustBuy2items} != null
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.ibottaRewards.subscriptionItems.increaseQuantity
                  - identifier: us.mappings.ibottaRewards.subscriptionItems.quantity1
            - click:
                identifier: us.mappings.ibottaRewards.subscriptionItems.increaseQuantity
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.ibottaRewards.subscriptionItems.quantity2
                  - identifier: us.mappings.ibottaRewards.subscriptionItems.increaseQuantity

  - name: us.functions.ibotta.ibottaSubscription.on.subscriptionPage
    platform: android
    flow:
      - sleep:
          duration: 6000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.subscriptionConfirmationTitle
            - identifier: us.mappings.ibottaRewards.subscriptionConfirmationMessage
            - identifier: us.mappings.ibottaRewards.subscriptionRewardsTitle
            - identifier: us.mappings.ibottaRewards.subscriptions.walmartRewardsAmount
            - identifier: us.mappings.ibottaRewards.subscriptions.walmartRewardsCenter.button
            - identifier: us.mappings.ibottaRewards.subscriptionsConfirmation.rewardsLegend
            - identifier: us.mappings.ibottaRewards.subscriptions.restrictionsApply
      - click:
          identifier: us.mappings.ibottaRewards.subscriptions.restrictionsApply
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.rewardsDetailsTitle
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointOne
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointTwo
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointThree
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointFour
            - identifier: us.mappings.ibottaRewards.rewardsFAQ.button
            - identifier: us.mappings.ibottaRewards.rewardsDetails.closeButton
      - click:
          identifier: us.mappings.ibottaRewards.rewardsDetails.closeButton
          wait: 2000

  - name: us.functions.ibotta.ibottaSubscription.on.manageSubscriptionPage
    platform: android
    flow:
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.manageSubscriptions
      - click:
          identifier: us.mappings.ibottaRewards.manageSubscriptions
      - sleep:
          duration: 4000
      - executeFunction:
          name: us.functions.utils.astro.fetchCustomerId
          params:
            - name: custEmail
              string: $customerEmail
      - log: "The fetched customer ID is: "
      - log: $fetchedCustId
      - executeFunction:
          name: us.functions.utils.astro.ibotta.triggerSubscriptionOrder
          params:
            - name: payload
              string: us.data.ibottaSubscriptionOrderPayload
            - name: fetchedCustId
              string: $fetchedCustId
      - log: "Placed the subscription order through the API and Waiting for 5-6Mins for the order to get updated and showup in the Purchase History"
      - loop:
          begin: 1
          end: 7
          mode: increment
          flow:
            - sleep:
                duration: 30000
            - log: "Placed the subscription order through the API and Waiting for around 3mins for the order to get updated and showup in the Purchase History"
      - sleep:
          duration: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.clipRewardAdded
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitleFrequency
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle.arrivesBy
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle.editButton
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle.skipButton

  - name: us.funtions.ibotta.subscriptionPage.addAddress
    platform: android
    flow:
      - click:
          identifier: us.mappings.ibottaRewards.subscriptionPage.addAddressButton
      - click:
          identifier: us.mappings.reserveSlot.addressselectionButton
      - click:
          wait: 2000
          identifier: us.mappings.inHome.bookSlot.clickAddressSaveButton

  - name: us.funtions.ibotta.navigateToOrdersFromManageSubscriptionPage.verifySubscriptionSavings
    platform: android
    flow:
      - scroll:
          direction: up
          scrollLimit: 2
      - executeFunction:
          name: us.functions.global.navigation.toTab
          params:
            - name: tabName
              string: Account
      - click:
          identifier: us.mappings.purchaseHistory.headerLabel
      - sleep:
          duration: 2000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.orderViewDetails.button
          then:
            - log: "Couldn't find the View details button, looks like the subscription is not yet processed waiting for 1min more"
            - loop:
                begin: 1
                end: 4
                mode: increment
                flow:
                  - sleep:
                      duration: 30000
                  - log: "Placed the subscription order through the API and Waiting for 2 more Min for the order to get updated and showup in the Purchase History"
      - click:
          identifier: us.mappings.ibottaRewards.orderViewDetails.button
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.tagIcon
            - identifier: us.mappings.ibottaRewards.tagText
            - identifier: us.mappings.ibottaRewards.subscriptionSavings.textOnOrderDetailsPage


  ###############  ibotta for iOS  ##############

  - name: us.functions.ibotta.verifyIbottaRewards.on.itemSearch
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
            - identifier: us.mappings.ibottaRewards.walmartCash.rewards.text
      - if:
          condition: ${mustBuy2items} != null
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.ibottaRewards.walmartCash.mustBy2.text

  - name: us.functions.ibotta.selectIbottaSubscription.on.itemPage
    platform: ios
    flow:
      # - if:
      #     identifier:
      #       notPresent:
      #         - identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
      #     then:
      #       - log: Couldn't find the rewards checkbox, Scrolling down.
      #       - scroll:
      #           direction: down
      #           untilIdentifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
      #           scrollLimit: 10
      #           position: center

      - scroll:
          direction: down
          position: center
          scrollLimit: 1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
      - click:
          identifier: us.mappings.ibottaRewards.walmartCash.rewards.checkbox
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.claimed
            - identifier: us.mappings.ibottaRewards.walmartCash.info.button
      - click:
          identifier: us.mappings.ibottaRewards.walmartCash.info.button
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.walmartCash.rewardsInfoSheet
            - identifier: us.mappings.ibottaRewards.rewardsDetailsTitle
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointOne
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointTwo
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointThree
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointFour
            - identifier: us.mappings.ibottaRewards.rewardsFAQ.button
            - identifier: us.mappings.ibottaRewards.walmartCash.infoSheet.closeButton
      - click:
          identifier: us.mappings.ibottaRewards.walmartCash.infoSheet.closeButton
      - sleep:
          duration: 3000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.subscriptionRadioButton
          then:
            - log: Couldn't find the subscription radio button, Scrolling up.
            - scroll:
                direction: up
                untilIdentifier: us.mappings.ibottaRewards.subscriptionRadioButton
                scrollLimit: 10
                position: center
      - click:
          identifier: us.mappings.ibottaRewards.subscriptionRadioButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.subscription.infoText
      - click:
          identifier: us.mappings.ibottaRewards.setUpSubscription.button
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.myItems.reorder.subscriptionFREQ4Weeks
      - click:
          identifier: us.mappings.myItems.reorder.subscriptionPanel.addSubscription


  - name: us.functions.ibotta.ibottaSubscription.on.subscriptionPage
    platform: ios
    flow:
      - sleep:
          duration: 6000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.subscriptionConfirmationTitle
            - identifier: us.mappings.ibottaRewards.subscriptionConfirmationMessage
            - identifier: us.mappings.ibottaRewards.subscriptionRewardsTitle
              # Not in iOS, replace with the other rewards icon
            - identifier: us.mappings.ibottaRewards.subscriptions.walmartRewardsMoneyIcon
            - identifier: us.mappings.ibottaRewards.subscriptions.walmartRewardsCenter.button
            - identifier: us.mappings.ibottaRewards.subscriptionsConfirmation.rewardsLegend
            - identifier: us.mappings.ibottaRewards.subscriptions.restrictionsApply
      - click:
          identifier: us.mappings.ibottaRewards.subscriptions.restrictionsApply
          wait: 2000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.rewardsDetailsTitle
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointOne
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointTwo
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointThree
            - identifier: us.mappings.ibottaRewards.rewardsDetails.pointFour
            - identifier: us.mappings.ibottaRewards.rewardsFAQ.button
            - identifier: us.mappings.ibottaRewards.rewardsDetails.closeButton
      - click:
          identifier: us.mappings.ibottaRewards.rewardsDetails.closeButton
          wait: 2000

  - name: us.functions.ibotta.ibottaSubscription.on.manageSubscriptionPage
    platform: ios
    flow:
      - sleep:
          duration: 3000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.manageSubscriptions
      - click:
          identifier: us.mappings.ibottaRewards.manageSubscriptions
      - sleep:
          duration: 4000
      - executeFunction:
          name: us.functions.utils.astro.fetchCustomerId
          params:
            - name: custEmail
              string: $customerEmail
      - log: "The fetched customer ID is: "
      - log: $fetchedCustId
      - executeFunction:
          name: us.functions.utils.astro.ibotta.triggerSubscriptionOrder
          params:
            - name: payload
              string: us.data.ibottaSubscriptionOrderPayload
            - name: fetchedCustId
              string: $fetchedCustId
            - name: processDate
              string: $processDate
      #      - log: "Placed the subscription order through the API and Waiting for 5-6Mins for the order to get updated and showup in the Purchase History"
      - loop:
          begin: 1
          end: 7
          mode: increment
          flow:
            - sleep:
                duration: 30000
            - log: "Placed the subscription order through the API and Waiting for around 3mins for the order to get updated and showup in the Purchase History"
      - sleep:
          duration: 2000
      #API Call to place the subscription order
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.clipRewardAdded
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitleFrequency
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle.arrivesBy
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle.editButton
            - identifier: us.mappings.ibottaRewards.manageSubscriptionPage.productTitle.skipButton

  - name: us.funtions.ibotta.subscriptionPage.addAddress
    platform: android
    flow:
      - click:
          identifier: us.mappings.ibottaRewards.subscriptionPage.addAddressButton
      - click:
          identifier: us.mappings.reserveSlot.addressselectionButton
      - click:
          wait: 2000
          identifier: us.mappings.inHome.bookSlot.clickAddressSaveButton

  - name: us.funtions.ibotta.navigateToOrdersFromManageSubscriptionPage.verifySubscriptionSavings
    platform: android
    flow:
      - scroll:
          direction: up
          scrollLimit: 2
      - executeFunction:
          name: us.functions.global.navigation.toTab
          params:
            - name: tabName
              string: Account
      - click:
          identifier: us.mappings.purchaseHistory.headerLabel
      - sleep:
          duration: 2000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.ibottaRewards.orderViewDetails.button
          then:
            - log: "Couldn't find the View details button, looks like the subscription is not yet processed waiting for 1min more"
            - loop:
                begin: 1
                end: 4
                mode: increment
                flow:
                  - sleep:
                      duration: 30000
                  - log: "Placed the subscription order through the API and Waiting for 2 more Min for the order to get updated and showup in the Purchase History"
      - click:
          identifier: us.mappings.ibottaRewards.orderViewDetails.button
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.tagIcon
            - identifier: us.mappings.ibottaRewards.tagText
            - identifier: us.mappings.ibottaRewards.subscriptionSavings.textOnOrderDetailsPage

  - name: us.functions.wplus.verifyCashHistoryPageLoad
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.pendingRewards
          then:
              - log: "Walmart Cash Balance History Page Loaded Successfully"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Walmart Cash Balance History Page NOT Loaded Successfully"

  - name: us.functions.wplus.verfiyCashHistoryPage
    platform: android
    flow:
      - executeFunction:
          name: us.functions.wplus.verifyPendingCash
      - executeFunction:
          name: us.functions.wplus.verifyRedeemedCash
      - executeFunction:
          name: us.functions.wplus.verifyEarnedCash
      - executeFunction:
          name: us.functions.wplus.verifyReturnedCash

  - name: us.functions.wplus.verifyPendingCash
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsOntheWay
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.onlineOrder
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsOntheWay.positiveBalance
          then:
              - log: "Cash on the way | Online order (positive amount) is Displayed"
          else:
              - log: "Cash on the way | Online order (positive amount) is NOT Displayed"

  - name: us.functions.wplus.verifyRedeemedCash
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.balanceActivity
          position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.redeemedRewards
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.onlineOrder
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.redeemedRewards.negativeBalance
          then:
              - log: "Redeemed cash | Online order (negative amount) is Displayed"
          else:
              - log: "Redeemed cash | Online order (negative amount) is NOT Displayed"

  - name: us.functions.wplus.verifyEarnedCash
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards
          position: center

      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards.orderDelivered
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.onlineOrder
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsOntheWay.positiveBalance
      - log: "Earned cash | Order Delivered (positive amount) is Displayed"

  - name: us.functions.wplus.verifyReturnedCash
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.onlineOrder
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.redeemedRewards.negativeBalance
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted.madeaReturn
      - log: "Cash adjusted | Made a return (negative amount) is Displayed"


  - name: us.functions.wplus.verifyCashHistoryPageLoad
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.pendingRewards
          then:
              - log: "Walmart Cash Balance History Page Loaded Successfully"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Walmart Cash Balance History Page NOT Loaded Successfully"

  - name: us.functions.wplus.verfiyCashHistoryPage
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.wplus.verifyPendingCash
      - executeFunction:
          name: us.functions.wplus.verifyRedeemedCash
      - executeFunction:
          name: us.functions.wplus.verifyEarnedCash
      - executeFunction:
          name: us.functions.wplus.verifyReturnedCash

  - name: us.functions.wplus.verifyPendingCash
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.pendingRewards
          then:
              - log: "Cash on the way | Online order (positive amount) is Displayed"
          else:
              - log: "Cash on the way | Online order (positive amount) is NOT Displayed"

  - name: us.functions.wplus.verifyRedeemedCash
    platform: ios
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.balanceActivity
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.redeemedRewards.onlineOrder
          then:
            - log: "Redeemed cash | Online order (negative amount) is Displayed"
          else:
              - log: "Redeemed cash | Online order (negative amount) is NOT Displayed"

  - name: us.functions.wplus.verifyEarnedCash
    platform: ios
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards.orderDelivered
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards.orderDelivered
          then:
            - log: "Earned cash | Online order (positive amount) is Displayed"
          else:
              - log: "Earned cash | Online order (positive amount) is NOT Displayed"

  - name: us.functions.wplus.verifyReturnedCash
    platform: ios
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted.madeaReturn
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted.madeaReturn
          then:
            - log: "Cash adjusted | Made a return (negative amount) is Displayed"
          else:
              - log: "Cash adjusted | Made a return (negative amount) is Not Displayed"


  - name: us.functions.ibotta.validateNewBannerForNeverMember
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.homePage.walmartCashBanner.banner
            - name: direction
              string: down
      - getString:
          identifier: us.mappings.homePage.walmartCashBanner.title
          attribute: label
          storeIn: title
      - if:
          condition: ${title} == "Get Walmart Cash and save more"
          then:
            - log: "The banner for never member is displayed correctly"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Walmart banner for never member is not displayed as expected"


  - name: us.functions.ibotta.validateSignInButtonForGuestUser
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibotta.signInCTA
          then:
            - log: "User sees the log in CTA as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Sign In CTA should be visible but is not."

  - name: us.functions.ibotta.validateSingInButtonForGuestUserItemPage
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibotta.signInCTA
          position: center
      - verifyIdentifier:
            present:
              - identifier: us.mappings.search.ibottaRewards.bannerView
      - click:
            identifier: us.mappings.ibotta.signInCTA

  - name: us.functions.ibotta.validateRewardsInfoInCheckoutPage
    platform: ios
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.reviewOrder.rewardsEarnedDetails
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.rewardsEarnedDetails
          then:
            - log: "User is able to see the rewards earned in the Review Order as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - User should see the rewards earned banner in the review order page but can't see"

  - name: us.functions.ibotta.validateRewardsEarnedInThankYouPage
    platform: ios
    flow:
      - loop:
          begin: 0
          end: 15
          mode: increment
          storeIndex: i
          flow:
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.orderDetails.rewardCentertext
                then:
                  - log: View Rewards Link Found
                  - break: true
                else:
                  - scroll:
                      direction: down 
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderDetails.rewardCentertext
          then:
            - log: "Rewards banner displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Banner should have been displayed but is not."

  - name: us.functions.ibotta.validateBannerInODP
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.homePage.walmartCashBanner.title
          then:
            - log: "Updated banner is visible in the order details page"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - User should see the Walmart cash banner but can't"


  - name: us.functions.wplus.verifyRewardsBalanceActivity
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.balanceActivity
          position: center
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.redeemedRewards.onlineOrder
          then:
              - log: "Redeemed rewards | Online order (negative amount) is Displayed"
          else:
              - log: "Redeemed rewards | Online order (negative amount) is NOT Displayed"

      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted.madeaReturn
          position: center

      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.rewardsAdjusted.madeaReturn
      - log: "Rewards adjusted | Made a return (negative amount) is Displayed"

      - scroll:
          direction: down
          untilIdentifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards.orderDelivered
          position: center

      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibottaRewards.rewardsBalanceHistory.earnedRewards.orderDelivered
      - log: "Earned rewards | Order Delivered (positive amount) is Displayed"

      
  - name: us.functions.ibotta.validateRewardsEarnedOnAccountPage
    platform: ios
    flow:
      - log: "Validating that the rewards earned is being displayed on the account page"
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibotta.accountPageRewardsBanner
          then:
            - log: "User sees the earned rewards in the accounts page as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Earned rewards are not displayed in the accounts page"

  - name: us.functions.ibotta.validateCheckoutWallet
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.reviewOrder.placeOrderLegalLabel
      - if:
          identifier:
            present:
              - identifier: us.mappings.ibotta.reviewOrderPageRewardssBalance
          then:
            - log: "The rewards balance is being displayed as expected"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - The rewards balance should be shown but is not"
      - click:
          identifier: us.mappings.reviewOrder.paymentMethod.changeLink
      - if:
          identifier:
            present: 
              - identifier: us.mappings.wallet.walmartCashPaymentMethodLabel
          then:
            - log: "Walmart Cash payment method is present as expected in Checkout Wallet"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Walmart cash should be displayed as a payment method but is not"

# Validate the Sign In to Unlock CTA on iBotta items for Guest Userss on Search screen
  - name: us.functions.ibotta.validateSignInButtonForGuestUser
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.iboota.signInCTA
          then:
            - log: For Guest user Sign in CTA showing as expected
          else:
            - failTest:
               message: "ENV_FAILURE - ${env} - Sign In CTA should be visibile for Guest User"

  # Validate the Sign In to Unlock CTA on iBotta items for Guest Userss on Item Screen
  - name: us.functions.ibotta.validateSignInButtonForGuestUserItemPage
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.iboota.signInCTA
          position: center
          scrollLimit: 4
      - if:
          identifier:
            present:
              - identifier: us.mappings.iboota.signInCTA
          then:
            - log: SignIn button is present
          else:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.iboota.signInCTA
                position: center
                scrollLimit: 8
      - click:
          identifier: us.mappings.iboota.signInCTA
      - log: SignIn button clicked on Item Screen
 
 # Validate Rewards details on Review Order Screen
  - name: us.functions.ibotta.validateRewardsInfoInCheckoutPage
    platform: android
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.reviewOrder.rewardsEarnedDetails
      - if:
          identifier:
            present:
              - identifier: us.mappings.reviewOrder.rewardsEarnedDetails
          then:
            - log: "Cash Earned is showing on the Review Order screen"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - User should see the cash earned in the review order page but can't see"

  # Validate cash card details on Thank You screen
  - name: us.functions.ibotta.validateCashEarnedCardInThankYouPage
    platform: android
    flow:
      - sleep:
          duration: 5000
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderConfirmation.cashEarnedCardTitle
          position: center
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderconfirmation.viewRewardsCenter
      - log: Cash Card is showing on Thank You screen

  - name: us.functions.ibotta.navigateToCashCenterFormTYP
    platform: android
    flow:
      - click:
          identifier: us.mappings.orderconfirmation.viewRewardsCenter
          wait: 5000

  # Validate cash card details on Thank You screen
  - name: us.functions.ibotta.validateCashEarnedCardInThankYouPage
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - executeFunction:
          name: us.functions.orderConfirmation.ratings
      - scroll:
          untilIdentifier: us.mappings.orderconfirmation.viewRewardsCenterBanner
          direction: down
          position: center
          scrollLimit: 4
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderconfirmation.viewRewardsCenter
      - log: Cash Card is showing on Thank You screen

  - name: us.functions.ibotta.navigateToCashCenterFormTYP
    platform: ios
    flow:
      - click:
          identifier: us.mappings.orderconfirmation.viewRewardsCenter
          wait: 5000

  # Validate Rewards details on Account screen
  - name: us.functions.ibotta.validateRewardsEarnedOnAccountPage
    platform: android
    flow:
       - sleep:
          duration: 5000
       - scroll:
          direction: up
          untilIdentifier: us.mappings.ibotta.accountPageRewardsBanner
          position: center
       - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.accountPageRewardsBanner
       - log: Rewards are showing on Account screen 

  # Validate Rewards details on ODP screen
  - name: us.functions.ibotta.validateBannerInODP
    platform: android
    flow:
       - sleep:
          duration: 5000
       - scroll:
          direction: down
          untilIdentifier: us.mappings.ibotta.rewardsOnDDP
          position: center
       - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.rewardsOnDDP  
       - log: Rewards are showing on ODP screen

      
  # Verify the Walmart Cash Banner
  - name: us.functions.wplus.ibotta.verifyWalmartCashBanner
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
              - identifier: us.mappings.homePage.walmartCashBanner.titleHeader
          then:
              - log: "Walmart Cash Banner is displayed Successfully in cash center"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Walmart Cash Banner NOT Loaded Successfully"

   # The code below verifies the cash page of first time user - never earnings
      - verifyIdentifier:
          label:
            - identifier: us.mappings.homePage.walmartCashBanner.currentBalanceAmountLabel
              contains: $
          present:
            - identifier: us.mappings.homePage.walmartCashBanner.currentBalanceTitleLabel
            - identifier: us.mappings.homePage.walmartCashBanner.viewActivity

      # "Ways To Get Walmart Cash" section heading verification
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.homePage.walmartCashBanner.waysToGetWalmartCashHeading
            - name: direction
              string: down

      - verifyIdentifier:
          present:
            - identifier: us.mappings.homePage.walmartCashBanner.waysToGetWalmartCashHeading
            
      # Manufacturer offers heading verification
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.homePage.walmartCashBanner.manufacturerOffersHeading
            - name: direction
              string: down

      - verifyIdentifier:
          present:
            - identifier: us.mappings.homePage.walmartCashBanner.manufacturerOffersHeading

  # iOS # Verify the Walmart Cash Pending Text
  - name: us.functions.wplus.ibotta.verifyWalmartCashPending
    platform: ios
    flow:
      - verifyIdentifier:
          label:
            - identifier: us.mappings.homePage.walmartCashBanner.totalWalmartCashPendingText
              contains: Total Walmart Cash pending
            - identifier: us.mappings.homePage.walmartCashBanner.totalWalmartCashPendingAmountLabel
              contains: $

  # iOS  Verify the dashboard entry point
  - name: us.functions.wplus.ibotta.verifyDashboardEntryPoint
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.homePage.walmartCashBanner.viewWalmartCashActivityCTA
          then:
              - log: "Entry point to dashboard is displayed on Walmart Cash Banner"
          else:
              - log: "Entry point to dashboard isn't displayed on Walmart Cash Banner"
      
  # iOS  Navigate to dashboard
  - name: us.functions.wplus.ibotta.navigateToCashDashboard
    platform: ios
    flow:
        - click:
            identifier: us.mappings.homePage.walmartCashBanner.viewWalmartCashActivityCTA
        - sleep:
            duration: 5000
        - if:
            identifier:
              present:
                  - identifier: us.mappings.ibotta.cashDashboard.currentCashBalance
            then:
                - log: "Walmart Cash Dashboard is Displayed Successfully"
            else:
              - failTest:
                  message: "Functionality - Walmart Cash Dashboard NOT Loaded Successfully"

  # iOS Cash dashboard validation
  - name: us.functions.wplus.ibotta.verifyWalmartCashDashboard
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyCurrentCashBalance
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyPendingCash
      - executeFunction:
          name: us.functions.wplus.ibotta.verifySeePendingTransactionsLink
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyPieChart
      - executeFunction:
          name: us.functions.wplus.ibotta.scrollDownToBadge
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyEarnedCashSection
      - executeFunction:
          name: us.functions.wplus.ibotta.verifySeeEarnedTransactionsLink
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyBadge

  # iOS Verify the total current cash on the top of cash dashboard
  - name: us.functions.wplus.ibotta.verifyCurrentCashBalance
    platform: ios
    flow:
      - verifyIdentifier:
          label:
            - identifier: us.mappings.ibotta.cashDashboard.currentCashBalance
              contains: Available Walmart Cash
              contains: $

  # iOS Verify the pending cash section
  - name: us.functions.wplus.ibotta.verifyPendingCash
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.cashDashboardCashTransaction
            - identifier: us.mappings.ibotta.cashDashboard.cashTransactionText

  # iOS Verify the entry point to history ledger on pending cash section
  - name: us.functions.wplus.ibotta.verifySeePendingTransactionsLink
    platform: ios
    flow:
      - verifyIdentifier:
          label:
            - identifier: us.mappings.ibotta.seePendingTransactionsLink
              contains: pendi # For successful Spanish execution

  # iOS scroll down to pie chart and validate the CTAs
  - name: us.functions.wplus.ibotta.verifyPieChart
    platform: ios
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibotta.pieChartCTAs
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.pieChart
          label:
            - identifier: us.mappings.ibotta.dashboard.30days
              contains: Last 30 days
            - identifier: us.mappings.ibotta.dashboard.90days
              contains: Last 90 days
            - identifier: us.mappings.ibotta.dashboard.lifetime
              contains: Lifetime

  # iOS scroll down to post transaction section and badge section
  - name: us.functions.wplus.ibotta.scrollDownToBadge
    platform: ios
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibotta.dashBoard.badge

  # iOS Verify post transactions
  - name: us.functions.wplus.ibotta.verifyEarnedCashSection
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.cashDashboardCashTransaction
      - verifyIdentifier:
          label:
            - identifier: us.mappings.ibotta.cashDashboard.cashEarnedTransactionText
              contains: Walmart Cash # For successful spanish exexution

  # iOS Vefiry the entry point to history on earned cash section
  - name: us.functions.wplus.ibotta.verifySeeEarnedTransactionsLink
    platform: ios
    flow:
      - if:
          condition: ${memberType} == 'wplus'
          then:
            - verifyIdentifier:
                label:
                  - identifier: us.mappings.ibotta.seeEarnedTransactionsLink
                    contains: Recently posted transactions
          else:
            - log: Teflon limitation, can't validate this link on the dashboard as non member

  # iOS Verify the badge
  - name: us.functions.wplus.ibotta.verifyBadge
    platform: ios
    flow:
      - verifyIdentifier:
          value:
            - identifier: us.mappings.ibotta.dashBoard.badgeOne
              contains: $1

# Android # Verify the Walmart Cash Banner
  - name: us.functions.wplus.ibotta.verifyWalmartCashBanner
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.homePage.walmartCashBanner.titleHeader
              - identifier: us.mappings.homePage.walmartCashBanner
          then:
              - log: "Walmart Cash Banner displayed Successfully in Cash Center Page"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Walmart Cash Banner NOT Loaded Successfully"

      #  The code below verifies the cash page of first time user - never earnings
      - verifyIdentifier:
          text:
            - identifier: us.mappings.homePage.walmartCashBanner.currentBalanceAmountLabel
              contains: $
          present:
            - identifier: us.mappings.homePage.walmartCashBanner.currentBalanceTitleLabel
            - identifier: us.mappings.homePage.walmartCashBanner.viewActivity

      # "Ways To Get Walmart Cash" section heading verification
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.homePage.walmartCashBanner.waysToGetWalmartCashHeading
            - name: direction
              string: down

      - verifyIdentifier:
          present:
            - identifier: us.mappings.homePage.walmartCashBanner.waysToGetWalmartCashHeading

      # Manufacturer offers heading verification
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.homePage.walmartCashBanner.manufacturerOffersHeading
            - name: direction
              string: down

      - verifyIdentifier:
          present:
            - identifier: us.mappings.homePage.walmartCashBanner.manufacturerOffersHeading

# Android # Verify the Walmart Cash Pending Text
  - name: us.functions.wplus.ibotta.verifyWalmartCashPending
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.mappings.homePage.walmartCashBanner.totalWalmartCashPendingText
              contains: Pending # For successful spanish exexution
            - identifier: us.mappings.homePage.walmartCashBanner.totalWalmartCashPendingAmountLabel
              contains: $

# Android # Verify the dashboard entry point
  - name: us.functions.wplus.ibotta.verifyDashboardEntryPoint
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.homePage.walmartCashBanner.viewWalmartCashActivityCTA
          then:
              - log: "Entry point to dashboard is displayed on Walmart Cash Banner"
          else:
              - failTest:
                  message: "Entry point to dashboard isn't displayed on Walmart Cash Banner"

# Android # Verify the Walmart Cash EntryPoint CTA 
  - name: us.functions.wplus.ibotta.navigateToCashDashboard
    platform: android
    flow:
      - click:
          identifier: us.mappings.homePage.walmartCashBanner.viewWalmartCashActivityCTA
      - sleep:
          duration: 5000
      - if:
          identifier:
            present:
                - identifier: us.mappings.ibotta.cashDashboard.currentCashBalance
          then:
              - log: "Walmart Cash Dashboard is Displayed Successfully"  
          else:
            - failTest:
                message: "Functionality - Walmart Cash Dashboard NOT Loaded Successfully"

# Android cash dashboard validation
  - name: us.functions.wplus.ibotta.verifyWalmartCashDashboard
    platform: android
    flow:
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyCurrentCashBalance
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyPendingCash
      - executeFunction:
          name: us.functions.wplus.ibotta.verifySeePendingTransactionsLink
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyPieChart
      - executeFunction:
          name: us.functions.wplus.ibotta.scrollDownToBadge
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyEarnedCashSection
      - executeFunction:
          name: us.functions.wplus.ibotta.verifySeeEarnedTransactionsLink
      - executeFunction:
          name: us.functions.wplus.ibotta.verifyBadge

# Android verify the total earned cash text on the top of cash dashboard
  - name: us.functions.wplus.ibotta.verifyCurrentCashBalance
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.mappings.ibotta.cashDashboard.currentCashBalance
              contains: Available Walmart Cash
              contains: $

# Android verify the pending cash section
  - name: us.functions.wplus.ibotta.verifyPendingCash
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.cashDashboardCashTransaction
            - identifier: us.mappings.ibotta.cashDashboard.cashTransactionText

# Android verify the entry point to history ledger on pending cash section
  - name: us.functions.wplus.ibotta.verifySeePendingTransactionsLink
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.mappings.ibotta.seeTransactionsLink
              contains: pendi # For successful spanish exexution

# Andorid scroll down to pie chart and verify the CTAs
  - name: us.functions.wplus.ibotta.verifyPieChart
    platform: android
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibotta.pieChartImage
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.dashboard.30days
            - identifier: us.mappings.ibotta.dashboard.90days
            - identifier: us.mappings.ibotta.dashboard.lifetime
            - identifier: us.mappings.ibotta.pieChartImage

# Android scroll down to post transaction section and badge section
  - name: us.functions.wplus.ibotta.scrollDownToBadge
    platform: android
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibotta.dashBoard.badge

# Android verify post transaction
  - name: us.functions.wplus.ibotta.verifyEarnedCashSection
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.ibotta.cashDashboardCashTransaction
      - verifyIdentifier:
          text:
            - identifier: us.mappings.ibotta.cashDashboard.cashTransactionText
              contains: Walmart Cash

# Android verify the entry point to history on earned cash section
  - name: us.functions.wplus.ibotta.verifySeeEarnedTransactionsLink
    platform: android
    flow:
      - if:
          condition: ${memberType} == 'wplus'
          then:
            - verifyIdentifier:
                text:
                  - identifier: us.mappings.ibotta.seeTransactionsLink
                    contains: See all recent transactions
          else:
            - log: Teflon limitation, can't validate this link on the dashboard as non member

# Android verify badge
  - name: us.functions.wplus.ibotta.verifyBadge
    platform: android
    flow:
      - scroll:
          direction: down
          position: center
          untilIdentifier: us.mappings.ibotta.dashBoard.badgeOne
      - verifyIdentifier:
          text:
            - identifier: us.mappings.ibotta.dashBoard.badgeOne
              contains: $1


  
      
