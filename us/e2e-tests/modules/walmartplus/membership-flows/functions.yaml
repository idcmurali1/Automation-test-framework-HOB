functions:

#************************************************* iOS ******************************************************

  - name: us.functions.wplus.nonMemberToTrial
    platform: ios
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.signup.trywalmartplusforFree
          then:
            - log: "tryWalmartPlus button present as expected"
           # - verifyIdentifier:
           #     present:
           #       - identifier: us.mappings.wplus.mlp.walmartplusLogo  Content on mlp keep on changing so commenting out this validation
            - click:
                identifier: us.mappings.wplus.signup.trywalmartplusforFree
                wait: 10000
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Try Walmart Plus for free button not displayed as expected"
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.wplus.signup.trywalmartplusforFree
      #       - identifier: us.mappings.wplus.mlp.walmartplusLogo
      # - click:
      #     identifier: us.mappings.wplus.signup.trywalmartplusforFree
      #     wait: 10000
      - verifyIdentifier:
          present:
           # - identifier: us.mapppings.wplus.rxForLess.unlockRxForLessText
            - identifier: us.mappings.wplus.annualTenurePlan 
            - identifier: us.mappings.wplus.monthlyTenurePlan 
            - identifier: us.mappings.paymentMethod.addNewPaymentButton
            - identifier: us.mappings.wplus.signup.trywalmartplusforFree
      - verifyIdentifier: 
          timeout: 10000
          present: 
            - identifier: us.mappings.wplus.annualTenurePlan
      - if: 
          condition: ${tenure} == 'annual'
          then:
            - click: 
                identifier: us.mappings.wplus.annualTenurePlan
            - log: 'Annual Plan selected'
          else:
            - click: 
                identifier: us.mappings.wplus.monthlyTenurePlan
            - log: 'Monthly Plan selected' 

      - if: 
          condition: ${payment} == 'Added'
          then:
            - click:
                identifier: us.mappings.wplus.signup.trywalmartplusforFreeButton
                wait: 8000   
            - if:
                identifier:
                  present:
                     - identifier: us.mappings.wlus.switchToOriginalApp.startShopping
                then:
                  - click:
                     identifier: us.mappings.wlus.switchToOriginalApp.startShopping
            - verifyIdentifier:
                 present:
                  - identifier: us.mappings.wplus.rxForLess.trialToPaidBottomSheet.walmartPlusLogoBlueLogo
                  - identifier: us.mappings.wplus.membershipBottomsheetTitle
                  - identifier: us.mappings.wplus.walmartPlusFreeBenefitUntil
                  - identifier: us.mappings.wplus.startUsingwplusBenefitsButton
                  - identifier: us.mappings.wplus.walmartPlusEnableNotificationsToggle 
                  - identifier: us.mappings.wplus.walmartPlusMemberShipNotificationBannerMainLabel
                  - identifier: us.mappings.wplus.walmartPlusMemberShipNotificationBannerSecondaryLabel
                  - identifier: us.mappings.wlus.membershipBottomsheetClose
              #Close Welcome Bottom Sheet
            - executeFunction:
                name: us.functions.wplus.WelcomeBottomSheetClose
          else:

            - verifyIdentifier:
                present:
                   - identifier: us.mappings.paymentMethod.addNewPaymentButton

            - click:
                identifier: us.mappings.paymentMethod.addNewPaymentButton
                wait: 8000

            - if:
                identifier:
                 present:
                    - identifier: us.mappings.paymentMethod.addPaymentButton
                then:
                  - click:
                       identifier: us.mappings.paymentMethod.addPaymentButton
          
            - executeFunction:
               name: us.functions.account.paymentMethod.addCardDetailsAndAddress
               params:
                 - name: firstName
                   string: us.data.flow005.payment.firstName
                 - name: lastName
                   string: us.data.flow005.payment.lastName
                 - name: number
                   string: us.data.flow005.payment.creditCard
                 - name: expirationMonth
                   string: us.data.flow005.payment.expirationMonth
                 - name: expirationYear
                   string: us.data.flow005.payment.expirationYear
                 - name: cvv
                   string: us.data.flow005.payment.cvv
                 - name: streetAddress
                   string: us.data.flow005.streetAddress
                 - name: city
                   string: us.data.flow005.city
                 - name: state
                   string: us.data.flow005.state
                 - name: zipcode
                   string: us.data.flow005.zipcode
                 - name: phoneNumber
                   string: us.data.flow005.phoneNumber

            - click:
               identifier: us.mappings.wplus.signup.trywalmartplusforFree
               wait: 5000 
              
            - executeFunction:
                name: us.functions.wplus.phoneVerificationPage

            - executeFunction:
                name: us.functions.wplus.aquisition.legalErrorAlertCheck

            - if:
                identifier:
                  present:
                    - identifier: us.mappings.wplus.signup.trywalmartplusforFreeButton
                then:
                  - click:
                      identifier: us.mappings.wplus.signup.trywalmartplusforFreeButton
                      wait: 5000
            
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.wlus.switchToOriginalApp.startShopping
                then:
                  - click:
                      identifier: us.mappings.wlus.switchToOriginalApp.startShopping
                      wait: 5000
            - verifyIdentifier:
                 timeout: 10000
                 present:
                  #- identifier: us.mappings.wplus.rxForLess.trialToPaidBottomSheet.walmartPlusLogoBlueLogo
                  - identifier: us.mappings.wplus.membershipBottomsheetTitle
                  # - identifier: us.mappings.wplus.walmartPlusFreeBenefitUntil
                  # - identifier: us.mappings.wplus.startUsingwplusBenefitsButton
                  # - identifier: us.mappings.wplus.walmartPlusEnableNotificationsToggle 
                  # - identifier: us.mappings.wplus.walmartPlusMemberShipNotificationBannerMainLabel
                  # - identifier: us.mappings.wplus.walmartPlusMemberShipNotificationBannerSecondaryLabel
                  - identifier: us.mappings.wlus.membershipBottomsheetClose
      #Close Welcome Bottom Sheet
            - executeFunction:
                name: us.functions.wplus.WelcomeBottomSheetClose


#Check for Legal check box to agree Terms Error Message
  - name: us.functions.wplus.aquisition.legalErrorAlertCheck
    platform: ios
    flow:
      #Check for Legal check box to agree Terms Error Message
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.signup.tryWPlusforFreeButton 
          then:
           - click:
              identifier: us.mappings.wplus.signup.tryWPlusforFreeButton
      - scroll:
          direction: down

      # - executeFunction:
      #             name: us.functions.utils.scrollIfNotVisible
      #             params:
      #               - name: identifier
      #                 string: us.mappings.wplus.aquisition.legalCheckBox

      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.aquisition.legalCheckBox
         
          then:
              - log: "Legal Error Alert Message is displayed"
              - click:
                  identifier: us.mappings.wplus.aquisition.legalCheckBox
              - log: "check box to Agree Terms is checked"
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.signup.trywalmartplusforFreeButton
          then:
            - click:
               identifier: us.mappings.wplus.signup.trywalmartplusforFreeButton
      - if:
          identifier:
            present: 
              - identifier: us.mappings.wplus.assist.membership.signUpBtn
          then:
            - click:
                identifier: us.mappings.wplus.assist.membership.signUpBtn


     

  # To scroll and select Join Walmart+ memerbship link from Review Order
  - name: us.functions.wplus.revieworder.scrollAndClickJoinWplusCta
    platform: ios
    flow:
      - sleep:
          duration: 5000
      - log: Clicking Join Walmart + CTA on search 
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.functions.wplus.revieworder.joinWalmartPlusCta
            - name: direction
              string: down      
      - click: 
          identifier: us.functions.wplus.revieworder.joinWalmartPlusCta
          wait: 1000          


  # To accept terms and confirm plan from the walmart+ subscription bottom dialog
  - name:  us.functions.wplus.revieworder.confirmWalmartPlusPlan
    platform: ios
    flow:
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.wplus.dialog.confirmPlan
          then:
            - executeFunction:
                name: us.functions.wplus.revieworder.scrollAndClickJoinWplusCta
      - verifyIdentifier:
          timeout: 10000
          present:
            - identifier: us.mappings.wplus.dialog.confirmPlan

      # clicking on confirm plan button to scroll to terms checkbox, as we have are unable to scroll using checkbox identifier 
      # and this will also act as verification for error thrown when Legal checkbox is not selected.
      - click: 
          identifier: us.mappings.wplus.dialog.confirmPlan
            
      # using coordinates as temporary fix as there is an issue with element identifier.
      # Below coordinates click on consent checkbox.
      - click:
          coordinates: 28, 632 

      # - executeFunction:
      #     name: us.functions.wplus.aquisition.legalErrorAlertCheck

      - log: Confirming annual plan on W+ bottom dialog
      - click: 
          identifier: us.mappings.wplus.dialog.confirmPlan
      - sleep:
          duration: 5000

# Verify the 'Last Step' screen when no phonenumber on account
  - name: us.functions.wplus.aquisition.lastStepNoPhoneNumberOnAccount
    platform: android
    flow:   
      - if:
          identifier:
            present:
              - identifier: us.maappings.wplus.lastStepBottomSheet.header  
          then:
            - log: "Last Step bottomsheet is displayed"
            - verifyIdentifier:
                 present:
                  - identifier: us.maappings.wplus.lastStepBottomSheet.subText
                  # - identifier: us.maappings.wplus.lastStepBottomSheet.phoneNumberSection
                  # - identifier: us.maappings.wplus.lastStepBottomSheet.phoneNumberTextField
                  # - identifier: us.maappings.wplus.lastStepBottomSheet.messageText
                  - identifier: us.maappings.wplus.lastStepBottomSheet.sendCodeCTA
                  - identifier: us.maappings.wplus.lastStepBottomSheet.cancelLink
            - click:
               identifier: us.maappings.wplus.lastStepBottomSheet.sendCodeCTA      

# Enter Phone number and validate OTP on the 'Last Step' screen 
  - name: us.functions.wplus.aquisition.lastStepEnterPhoneNumber
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.maappings.wplus.lastStepBottomSheet.phoneNumberTextField
      - enterText:
          identifier: us.maappings.wplus.lastStepBottomSheet.phoneNumberTextField
          string: ${phoneNumber}
      - click:
          identifier: us.maappings.wplus.lastStepBottomSheet.sendCodeCTA

# Verify the 'Last Step' screen when no phonenumber on account
  - name: us.functions.wplus.aquisition.lastStepNoPhoneNumberOnAccount
    platform: ios
    flow:   
      - if:
          identifier:
            present:
              - identifier: us.maappings.wplus.lastStepBottomSheet.header  
          then:
            - log: "Last Step bottomsheet is displayed"
            - verifyIdentifier:
                 present:
                  - identifier: us.maappings.wplus.lastStepBottomSheet.subText
                  - identifier: us.maappings.wplus.lastStepBottomSheet.sendCodeCTA
                  - identifier: us.maappings.wplus.lastStepBottomSheet.cancelLink
            - click:
               identifier: us.maappings.wplus.lastStepBottomSheet.sendCodeCTA

# Enter Phone number and validate OTP on the 'Last Step' screen 
  - name: us.functions.wplus.aquisition.lastStepEnterPhoneNumber
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.maappings.wplus.lastStepBottomSheet.phoneNumberTextField
      - enterText:
          identifier: us.maappings.wplus.lastStepBottomSheet.phoneNumberTextField
          string: ${astroPhoneNumber} 
      - click:
          identifier: us.maappings.wplus.lastStepBottomSheet.sendCodeCTA   


  - name: us.functions.wplus.clickContinueShopping
    platform: ios
    flow:
      - sleep:
          duration: 2000  
      - if:
          identifier:
            present:
              - identifier: us.mappings.buyNow.continueButton
          then:
            - click:
                identifier: us.mappings.buyNow.continueButton
      - sleep:
          duration: 2000


  - name: us.functions.wplus.clickContinueShopping
    platform: android
    flow:
      - sleep:
          duration: 2000  
      - if:
          identifier:
            present:
              - identifier: us.mappings.item.continueShopping
          then:
            - click:
                identifier: us.mappings.item.continueShopping
      - sleep:
          duration: 2000

  - name: us.functions.wplus.buyNow.EmailOTP
    platform: ios
    flow:
      - sleep:
          duration: 2000  
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.buyNow.confirmYourEmailHeader
          then:
            - executeFunction:
                name: us.functions.utils.astro.fetchPasscode.emailOTP
                params:
                  - name: email
                    string: ${email}
            - log: "The OTP generated is: "
            - log: ${otpFromEmail}
            - log: "The Request Verification Code button is clicked"    
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.global.authentication.signIn.textBoxForOTP
            - enterText:
                identifier: us.mappings.global.authentication.signIn.textBoxForOTP
                string: ${otpFromEmail}
            - log: "Entered the OTP from Customer's email" 
            - click:
                identifier: us.mappings.global.authentication.ValidateOTPView.button


  - name: us.functions.wplus.buyNow.EmailOTP
    platform: android
    flow:
      - sleep:
          duration: 2000  
      - if:
          identifier:
            present:
              - identifier: us.mappings.wplus.buyNow.confirmYourEmailHeader
          then:
            - executeFunction:
                name: us.functions.utils.astro.fetchPasscode.emailOTP
                params:
                  - name: email
                    string: ${email}
            - log: "The OTP generated is: "
            - log: ${otpFromEmail}
            - log: "The Request Verification Code button is clicked"    
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.global.authentication.signIn.textBoxForOTP
            - enterText:
                identifier: us.mappings.global.authentication.signIn.textBoxForOTP
                string: ${otpFromEmail}
            - log: "Entered the OTP from Customer's email" 
            - click:
                identifier: us.mappings.global.authentication.ValidateOTPView.button