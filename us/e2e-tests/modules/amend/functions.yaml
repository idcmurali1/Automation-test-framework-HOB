functions:

  - name: us.functions.amend.addQuantityFromOrderDetailsPage
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.orderDetails.editOrderButton.delivery
          then:
            - executeFunction:
                  name: us.functions.utils.scrollIfNotVisible
                  params:
                    - name: identifier
                      string: us.mappings.orderDetails.editOrderButton.delivery
                    - name: direction
                      string: down
      - click:
          identifier: us.mappings.orderDetails.editOrderButton.delivery
      - click:
          identifier: us.mappings.orderDetails.addItem
      - sleep:
          duration: 3000 
      - getString:
          identifier: us.mappings.item.zeekit.chooseMyModelChooseHeightCount 
          attribute: value
          storeIn: amendQty
      - log: ${amendQty}         
      - click:
          identifier: us.mappings.item.editItem.Save
      - sleep:
          duration: 6000 
      - if:
          identifier:
            present: 
              - identifier: us.mappings.popup.technicalError
          then:
            - click:
                identifier: us.mappings.error.dismissButton
            - sleep: 
                duration: 6000
            - if:
                identifier:
                  present: 
                    - identifier: us.mappings.item.editItem.Save
                then:
                  - click:
                      identifier: us.mappings.item.editItem.Save
                  - sleep: 
                      duration: 4000    
      - executeFunction:
          name: us.functions.utils.handleTechnicalErrorPopup         
      - if:
          identifier:
            present:
              - identifier: us.mappings.paymentMethod.checkout.wallet.title
          then:
            - click:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField            
            - enterText:
                identifier: us.mappings.reviewOrder.confirmCvv.cvvField
                string: ${cvv}
            - click:
                identifier: us.mappings.default.keyboardDoneButton    
            - click:
                identifier: us.mappings.paymentMethod.addPayment.overlay.saveButton                                          
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.confirmation

  - name: us.functions.amend.addToExistingOrderFlow
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.timeLeftForAmendBanner
            # - identifier: us.mappings.cart.scheduledDelivery.cardTitle
            - identifier: us.mappings.amend.addItemsToExistingOrderButton
      - click:
          identifier: us.mappings.amend.addItemsToExistingOrderButton

  - name: us.functions.amend.verify.itemAddedToOrder
    platform: ios
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - sleep:
          duration: 10000
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.itemAddedConfimationMessage
          then:
            - sleep:
                duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.itemAddedConfimationMessage
            - identifier: us.mappings.amend.viewDetailsLink
      - click:
          wait: 30000
          identifier: us.mappings.amend.viewDetailsLink
      # - if:
      #     identifier:
      #       notPresent:
      #         - identifier: us.mappings.orderDetails.navBarTitle
      #     then: 
      #       - click: 
      #           identifier: us.mappings.amend.viewDetailsLink
      #           coordinates: 75%,50%   
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.navBarTitle
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.noOfitems
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.noOfitems
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.amend.noOfitems
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.amend.noOfitems 

  - name: us.functions.amend.editPickupSlot
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.reviewOrder.editSlotLink
      - click:
          identifier: us.mappings.reviewOrder.editSlotLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookSlotTitle
            # - identifier: us.mappings.editSlot.oneTimeEditCopy
      - executeFunction:
          name: us.functions.amend.switchToDeliveryTab.verifyMessage
      - executeFunction:
          name: us.functions.amend.selectNewSlotandSave
      - executeFunction:
          name: us.functions.amend.verifySlotAmended

  - name: us.functions.amend.editDeliverySlot
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.changeSlotButton
      - click:
          identifier: us.mappings.editSlot.changeSlotButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSLot.bookSlot.reserveTime
            #- identifier: us.mappings.editSlot.currentSlotInfo
      - executeFunction:
          name: us.functions.amend.switchToPickupTab.verifyMessage
      - executeFunction:
          name: us.functions.amend.selectNewSlotandSave
      - sleep:
          duration: 10000          
      - executeFunction:
          name: us.functions.amend.verifySlotAmended

  - name: us.functions.amend.verifySlotAmended
    platform: ios
    flow:
      - verifyIdentifier:
          label:
            - identifier: us.mappings.orderDetails.statusMsgLabel
              notEquals: today
      - verifyIdentifier:
          label:
            - identifier: us.mappings.orderDetails.statusMsgLabel
              notEquals: tomorrow
      # - verifyIdentifier:
      #     notPresent:
      #       - identifier: us.mappings.editSlot.bookslotLink
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.editSlot.bookslotLink
          then:
            - log: "Slot was successfully amended"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - SLOT NOT AMENDED"

  - name: us.functions.amend.switchToDeliveryTab.verifyMessage
    platform: ios
    flow:
      - click:
          identifier: us.mappings.editSlot.deliveryTab
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.weAreSorry
            - identifier: us.mappings.editSlot.cannotSwitchToDelivery
      - click:
          identifier: us.mappings.editSlot.pickupTab
      - executeFunction:
          name: us.functions.utils.handleTechnicalErrorPopup
      

  - name: us.functions.amend.switchToPickupTab.verifyMessage
    platform: ios
    flow:
      - click:
          identifier: us.mappings.editSlot.pickupTab
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.weAreSorry
            - identifier: us.mappings.editSlot.cannotSwitchToPickup
      - click:
          identifier: us.mappings.editSlot.deliveryTab
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.saveButton

  - name:  us.functions.amend.selectNewSlotandSave
    platform: ios
    flow:
      - executeFunction:
          name: us.functions.selectDayForSlotDisplay  
      - executeFunction:
          name: us.functions.selectTimeSlot  
          params:
            - name: slotIndex
              string: 2
            - name: timeSlot
              string: generic
      # - if: 
      #     identifier:
      #       present:
      #         - identifier: us.mappings.reserveSlot.firstSlot
      #     then:   
      #       - click:
      #           identifier: us.mappings.reserveSlot.firstSlot 
      #     else:
      #       - click:
      #           identifier: us.mappings.reserveSlot.lastday
      #       - click:
      #           identifier: us.mappings.reserveSlot.secondSlot                         
      - click:
          identifier: us.mappings.editSlot.saveButton
          wait: 6000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.orderNumberText

  - name: us.functions.amend.verifyAmendedQtyOnOrderDetails
    platform: ios
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.item.amendedItemText1
      # - verifyIdentifier:
      #     timeout: 50000
      #     present:
      #       - identifier: us.mappings.item.amendedItemText1
      - if:
          identifier:
            present:
              - identifier: us.mappings.item.amendedItemText1
          then:
            - log: "Item quantity successfully amended"
          else:
            - failTest:
                message: "ENV_FAILURE - ${env} - Item quantity not amended"

   # amending alcohol item to the existing scPickup order by accepting disclaimer and reserving a new slot
  - name: us.functions.amend.alcoholItemToSCPickup.changeSlot.alcoholRestrictedToAllowed     # modified on 6th July 2021 for flow054
    platform: ios
    flow:
      - verifyIdentifier: 
          present: 
            - identifier: us.mappings.cart.amend.alcoholDisclosure.bottomSheet.navigationBar
            - identifier: us.mappings.cart.amend.alcoholDisclosure.bottomSheet.disclaimerReadLabel
            - identifier: us.mappings.cart.amend.alcoholDisclosure.bottomSheet.checkBox
      - click:
          wait: 2000
          identifier: us.mappings.cart.amend.alcoholDisclosure.bottomSheet.checkBox
      - click:
          wait: 2000
          identifier: us.mappings.cart.amend.alcoholDisclosure.bottomSheet.continueButton
      - if:
          condition: ${reserveNewSlot} == true
          then:
            - verifyIdentifier: 
                timeout: 40000
                present: 
                  - identifier: us.mappings.cart.unavailableItem.titleNavigationBar
                  - identifier: us.mappings.cart.unavailableItem.oosWarningText
                  - identifier: us.mappings.cart.amend.alcoholDisclosure.unavailableItem.reserveNewTimeButton
                  - identifier: us.mappings.cart.oneItemOOS.itemNameLabel
                # label:
                #   - identifier: us.mappings.cart.unavailableItem.oosWarningText
                #     equals: 1 item cannot be added to your order as your reserved time does not comply with local alcohol regulations. Please pick another time.
            - getString:
                identifier: us.mappings.cart.oneItemOOS.itemNameLabel
                attribute: label
                storeIn: itemName
            - log: ${itemName} # Dark Horse Sauvignon Blanc Wine, 750 mL
            - click: 
                wait: 2000
                identifier: us.mappings.cart.amend.alcoholDisclosure.unavailableItem.reserveNewTimeButton
            # - verifyIdentifier: 
            #     timeout: 40000
            #     present: 
            #       - identifier: us.mappings.editSLot.bookSlot.reserveTime
            #       - identifier: us.mappings.reserveSlot.alcoholRestrictedSlot
            #       - identifier: us.mappings.reserveSlot.nonAlcoholRestrictedSlot
                # label:
                #   - identifier: us.mappings.reserveSlot.alcoholRestrictedSlot
                #     contains: Alcohol restricted
                #   - identifier: us.mappings.reserveSlot.nonAlcoholRestrictedSlot
                #     notContains: Alcohol restricted
            - if: 
                identifier:
                  visible:
                    - identifier: us.mappings.reserveSlot.nonAlcoholRestrictedSlot
                      value: true
                then:
                  - click: 
                      wait: 2000
                      identifier: us.mappings.reserveSlot.nonAlcoholRestrictedSlot
                else:
                  - scroll:
                      direction: down
                      untilIdentifier: us.mappings.reserveSlot.nonAlcoholRestrictedSlot
                      position: center
                  - click: 
                      wait: 2000
                      identifier: us.mappings.reserveSlot.nonAlcoholRestrictedSlot
            - click: 
                wait: 2000
                identifier: us.mappings.reserveSlot.saveButton
            - storeIn:
                key: reserveNewSlot
                value: false
      - if:
          identifier:
            present:
              - identifier: us.mappings.reserveSlot.amendOrderInProgress
          then:
            - click: 
                identifier: us.mappings.popup.cartMergeOkayButton

  - name: us.functions.amend.verify.altPickupPerson
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.editPickupPerson
      - click:
          identifier: us.mappings.amend.editPickupPerson
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.pickupfname
      - click:
          identifier: us.mappings.amend.pickupfname
      - enterText:
          identifier: us.mappings.amend.pickupfname
          string: ${fname}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.pickuplname
      - click:
          identifier: us.mappings.amend.pickuplname
      - enterText:
          identifier: us.mappings.amend.pickuplname
          string: ${lname}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.pickupEmail
      - click:
          identifier: us.mappings.amend.pickupEmail
      - enterText:
          identifier: us.mappings.amend.pickupEmail
          string: edit.pickupPerson@test.com
      - if:
          identifier:
            present:
              - identifier: us.mappings.default.keyboardDoneButton
          then:
            - click:
                identifier: us.mappings.default.keyboardDoneButton
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.save
      - click:
          identifier: us.mappings.amend.save
      - verifyIdentifier:
          present:
           - identifier: us.mappings.amend.person
      - log: Pickup person is edited        

################################################## Android ########################################################

  - name: us.functions.amend.addToExistingOrderFlow
    platform: android
    flow:
      - scroll:
          direction: up
          untilIdentifier: us.mappings.orderConfirmation.amendsBanner  
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderConfirmation.amendsBanner
            # - identifier: us.mappings.cart.scheduledDelivery.cardTitle
            - identifier: us.mappings.cart.startNewOrderButton
      - sleep:
          duration: 6000
      - if:
          identifier:
            present:
              - identifier: us.mappings.cart.addToExistingOrderButton
          then:
            - click:
                identifier: us.mappings.cart.addToExistingOrderButton
          else:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.cart.addToExistingOrderButton
            - click:
                identifier: us.mappings.cart.addToExistingOrderButton
                wait: 60000


  - name: us.functions.amend.verify.itemAddedToOrder
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Transactions
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.itemAddedConfimationMessage
          then:
            - scroll:
                direction: up
                untilIdentifier: us.mappings.amend.itemAddedConfimationMessage
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.itemAddedConfimationMessage
            - identifier: us.mappings.amend.viewDetailsLink
      - sleep:
          duration: 5000
      - click:
          identifier: us.mappings.amend.viewDetailsLink
      - sleep:
          duration: 5000
      - verifyIdentifier:
          present:
            - identifier: us.mappings.orderDetails.navBarTitle
      - if:
          identifier:
            text:
              - identifier: us.mappings.orderDetails.amendText
                contains: Your order has been updated successfully, and the changes will be reflected shortly.
          then:
            - sleep:
                duration: 60000
            - scroll:
                direction: up
      - if:
          identifier:
            notPresent:
              - identifier: us.mappings.amend.noOfitems
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.noOfitems
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.amend.noOfitems
          else:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.amend.noOfitems

  - name: us.functions.amend.editOrderdetails
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.orderDetails.editOrderButton.delivery

      - click:
          identifier: us.mappings.orderDetails.editOrderButton.delivery  
      - click: 
          identifier: us.mappings.orderDetails.addItem
      - click:
          identifier: us.mappings.orderDetails.addItem    

      - verifyIdentifier:
          present:
            - identifier: us.mappings.cancellation.editItem.saveButton 

      - click:
          identifier: us.mappings.orderDetails.editOrder.removeButton 
      - click:
          identifier: us.mappings.cancellation.editItem.saveButton    

  - name: us.functions.amend.editPickupSlot
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookslotLink
      - click:
          identifier: us.mappings.editSlot.bookslotLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookSlotTitle
         #   - identifier: us.mappings.editSlot.oneTimeEditCopy commenting out as text changes and fails the script
      - executeFunction:
          name: us.functions.amend.switchToDeliveryTab.verifyMessage
      - executeFunction:
          name: us.functions.amend.selectNewSlotandSave

  - name: us.functions.amend.editDeliverySlot
    platform: android
    flow:
      - if:
          identifier:
            present:
              - identifier: us.mappings.editSlot.bookslotLink
          then:
            - click:
                identifier: us.mappings.editSlot.bookslotLink
      - executeFunction:
          name: us.functions.utils.handleTechnicalErrorPopup
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookSlotTitle
           # - identifier: us.mappings.editSlot.currentSlotInfo
      # - executeFunction:
      #     name: us.functions.amend.switchToPickupTab.verifyMessage
      - executeFunction:
          name: us.functions.amend.selectNewSlotandSave
      # - executeFunction:
      #     name: us.functions.amend.verifySlotAmended

  - name: us.functions.amend.verifySlotAmended
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.mappings.orderDetails.statusMsgLabel
              notEquals: today
      - verifyIdentifier:
          text:
            - identifier: us.mappings.orderDetails.statusMsgLabel
              notEquals: tomorrow
      - if:
          identifier:
            text:
              - identifier: us.mappings.orderDetails.amendText
                contains: Your order has been updated successfully, and the changes will be reflected shortly.
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.editSlot.bookslotLink
          else:
            - if:
                identifier:
                  notPresent:
                    - identifier: us.mappings.editSlot.bookslotLink
                then:
                  - log: "Slot was successfully amended"
                else:
                  - failTest:
                      message: "ENV_FAILURE - ${env} - SLOT NOT AMENDED"               

  - name: us.functions.amend.switchToDeliveryTab.verifyMessage
    platform: android
    flow:
      - click:
          identifier: us.mappings.editSlot.deliveryTab
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.weAreSorry
            - identifier: us.mappings.editSlot.cannotSwitchToDelivery
      - click:
          identifier: us.mappings.editSlot.pickupTab
      - executeFunction:
          name: us.functions.utils.handleTechnicalErrorPopup


  - name: us.functions.amend.switchToPickupTab.verifyMessage
    platform: android
    flow:
      - click:
          identifier: us.mappings.editSlot.pickupTab
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.weAreSorry
            - identifier: us.mappings.editSlot.cannotSwitchToPickup
      - click:
          identifier: us.mappings.editSlot.deliveryTab

  - name: us.functions.amend.selectNewSlotandSave
    platform: android
    flow:
      - executeFunction:
          name: us.functions.slotDataSetUp
      - executeFunction:
          name: us.functions.selectDayForSlotDisplay  
      - executeFunction:
          name: us.functions.selectTimeSlot 
      # - click:
      #     identifier: us.mappings.editSlot.thirdDay
      # - if: 
      #     identifier:
      #       present:
      #         - identifier: us.mappings.editSlot.thirdSlot
      #     then:   
      #       - click:
      #           identifier: us.mappings.editSlot.thirdSlot
      #     else:
      #       - click:
      #           identifier: us.mappings.reserveSlot.lastday
      #       - if:
      #           identifier:
      #             present:
      #               - identifier: us.mappings.reserveSlot.secondSlot
      #           then:
      #             - click:
      #                 identifier: us.mappings.reserveSlot.secondSlot
      - click:
          identifier: us.mappings.editSlot.saveButton
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.orderDetails.orderNumber

  - name: us.functions.amend.addQuantityFromOrderDetailsPage
    platform: android
    flow:
      - storeIn:
          key: executionStage
          value: Post-transactions
      - executeFunction:
          name: us.functions.utils.scrollIfNotVisible
          params:
            - name: identifier
              string: us.mappings.orderDetails.editOrderButton
            - name: direction
              string: down
            - name: scrollPosition
              string: center
      # - scroll:
      #     direction: down
      #     wait: 50000
      #     untilIdentifier: us.mappings.orderDetails.editOrderButton
      #     position: center
      - click:
          identifier: us.mappings.orderDetails.editOrderButton
      - if:
          identifier:
            present:
              - identifier: us.mappings.orderDetails.addItem
              #us.mappings.amend.amendItemButton
          then:
            - click:
                identifier: us.mappings.orderDetails.addItem
                #us.mappings.amend.amendItemButton
      - click:
          identifier: us.mappings.amend.editItem.saveButton
      - sleep:
          duration: 15000
      - executeFunction:
          name: us.functions.utils.handleTechnicalErrorPopup

      - sleep:
          duration: 10000    
      # - scroll:  #Joel updated 11/30/21  extraneous step, and failing to scroll
      #     direction: down
      #     wait: 10000         
      #     untilIdentifier: us.mappings.orderDetails.editOrderButton
      #     position: center  
      # - verifyIdentifier:
      #     timeout: 50000
      #     present:
      #       - identifier: us.mappings.orderDetails.editOrderButton

  - name: us.functions.amend.verifyAmendedQtyOnOrderDetails
    platform: android
    flow:
      - scroll:
          direction: down
          untilIdentifier: us.mappings.item.amendedItemText4
      - verifyIdentifier:
          timeout: 50000
          present:
            - identifier: us.mappings.item.amendedItemText3
            - identifier: us.mappings.item.amendedItemText4

      - scroll:
          direction: down
          untilIdentifier: us.mappings.item.amendedItemText1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.item.amendedItemText1

  - name: us.functions.amend.verifyRestrictedSlotAndeditDeliverySlot
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.scheduleSlot.bookslotLink
      - click:
          identifier: us.mappings.scheduleSlot.bookslotLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookSlotTitle
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.resreveSlot.bookAlcoholRestrictedSlot
      - executeFunction:
          name: us.functions.amend.switchToPickupTab.verifyMessage
      - executeFunction:
          name: us.functions.amend.selectNewSlotandSave      
      - scroll:
          direction: up
          untilIdentifier: us.mappings.orderDetails.orderNumber

  - name: us.functions.amend.verifyRestrictedSlotAndeditDeliverySlot
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookslotLink
      - click:
          identifier: us.mappings.editSlot.bookslotLink
      - verifyIdentifier:
          present:
            - identifier: us.mappings.editSlot.bookSlotTitle
            #- identifier: us.mappings.editSlot.currentSlotInfo
      - verifyIdentifier:
          notPresent:
            - identifier: us.mappings.resreveSlot.bookAlcoholRestrictedSlot
      - executeFunction:
          name: us.functions.amend.switchToPickupTab.verifyMessage
      - executeFunction:
          name: us.functions.amend.selectNewSlotandSave
          
  - name: us.functions.amend.verifySlotDetails
    platform: android
    flow:
      - verifyIdentifier:
          text:
            - identifier: us.mappings.orderDetails.statusMsgLabel
              notContains: 8am-9am

  - name: us.functions.amend.creditCard
    platform: ios
    flow:
      - if:
          condition: ${card} == 'select'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.paymentMethodText
            - click:
                identifier: us.mappings.amend.cc.editButton  
            - click:
                identifier: us.mappings.amend.cc.cardSelect 
            - click:
                identifier: us.mappings.amend.cc.cardRadioButton 
            - click:
                identifier: us.mappings.amend.cc.cardSave     
            - if: 
                identifier:
                  present:
                    - identifier: us.mappings.amend.cc.ccv
                then:
                  - click:
                      identifier: us.mappings.amend.cc.ccv 
                  - enterText:
                      identifier: us.mappings.amend.cc.ccv
                      string: ${cvv}
                  - click:
                      identifier: Done                      
                  - click:
                      identifier: us.mappings.amend.cc.cardSave
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.amend.cc.paymentUpdateText  
                  - log: payment method updated       
                else:        
                  - verifyIdentifier:
                      present:
                        - identifier: us.mappings.amend.cc.paymentUpdateText    
                  - log: payment method updated 
      - if:
          condition: ${card} == 'newcard'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.paymentMethodText
            - click:
                identifier: us.mappings.amend.cc.editButton
            - click:
                identifier: us.mappings.paymentMethod.addPayment.overlay.title  
            - executeFunction:
                name: us.functions.account.paymentMethod.addCardDetails
            - sleep:
                duration: 10000
            - click:
                identifier: us.mappings.amend.cc.cardSelectOne 
            - if: 
                identifier:
                  present:
                    - identifier: us.mappings.amend.cc.cardRadioButtonOne
                then:
                  - click:
                      identifier: us.mappings.amend.cc.cardRadioButtonOne
            - if: 
                identifier:
                  present:
                    - identifier: us.mappings.amend.cc.ccv
                then:
                  - click:
                      identifier: us.mappings.amend.cc.ccv 
                  - enterText:
                      identifier: us.mappings.amend.cc.ccv
                      string: ${cvv}
                  - click:
                      identifier: Done                      
                  - sleep:
                      duration: 5000    
            - click:
                identifier: us.mappings.amend.cc.cardSave  
            - sleep:
                duration: 10000  
            - log: payment method updated       

      - if:
          condition: ${card} == 'editcard'
          then:
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.paymentMethodText
            - click:
                identifier: us.mappings.amend.cc.editButton 
            - sleep:
                duration: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.amend.cc.paymentChangeText 
            - log: you can only make changes to this order's payment method once  
            - sleep:
                duration: 3000    
            - click:
                identifier: us.mappings.amend.cc.cardSelect 
            - click:
                identifier: us.mappings.amend.cc.cardEdit
            - executeFunction:
                name: us.functions.account.paymentMethod.editExistingCard       
            - click:
                identifier: us.mappings.paymentMethod.creditCard.saveCardFromEdit  
            - sleep:
                duration: 5000  
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.paymentMethod.creditCard.cardUpdatedText    
            - log: card updated  
            - click:
                identifier: us.mappings.amend.cc.cardSave  
            - sleep:
                duration: 10000  
            - log: payment method updated    

      - sleep:
          duration: 10000
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo  
                  
      - if: 
          identifier:
            present:
              - identifier: us.mappings.amend.cc.amendMessage
          then: 
            - log: changes will be reflected shortly
          else:            
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.paymentMethodText
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.amend.cc.editButton
            - log: no edit link


  - name: us.functions.amend.creditCard
    platform: android
    flow:
      - if:
          condition: ${card} == 'select'
          then:
            - verifyIdentifier:
                timeout: 8000
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.amend.paymentMethodText
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.amend.cc.editButton
            - sleep:
                duration: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderDetailse.verifyOnetimeCardChangeText  
            - log: you can only make changes to this order's payment method once                       
            - sleep:
                duration: 3000      
            - click:
                identifier: us.mappings.amend.cc.cardSelect
            - click:
                identifier: us.mappings.amend.cc.cardRadioButton
            - sleep:
                duration: 3000                
            - click:
                identifier: us.mappings.amend.cc.confirmbutton
            - log: Your payment method was updated sucessfully         

      - if:
          condition: ${card} == 'newcard'
          then:
            - verifyIdentifier:
                timeout: 8000
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.amend.paymentMethodText
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.amend.cc.editButton
            - sleep:
                duration: 3000
            - log: you can only make changes to this order's payment method once 
            - if: 
                identifier:
                  present:
                    - identifier: us.mappings.amend.addnewcardbutton
                then:
                  - click:
                      identifier: us.mappings.amend.addnewcardbutton                  
            - executeFunction:
                name: us.functions.account.paymentMethod.addCardDetails
            - sleep:
                duration: 10000
            # - click:
            #     identifier: us.mappings.amend.cc.cardSelectOne
            # - if: 
            #     identifier:
            #       present:
            #         - identifier: us.mappings.amend.cc.cardRadioButtonOne
            #     then:
            #       - click:
            #           identifier: us.mappings.amend.cc.cardRadioButtonOne
            - if: 
                identifier:
                  present:
                    - identifier: us.mappings.amend.cc.ccv
                then:
                  - click:
                      identifier: us.mappings.amend.cc.ccv 
                  - enterText:
                      identifier: us.mappings.amend.cc.ccv
                      string: ${cvv}
                  - goBack: true                      
                  - sleep:
                      duration: 2000
                  # - if: 
                  #     identifier:
                  #       present:
                  #         - identifier: us.mappings.amend.cc.cardSelectOne
                  #     then:
                  #       - click:
                  #           identifier: us.mappings.amend.cc.cardSelectOne
                  - sleep:
                      duration: 5000
                  - click:
                      identifier: us.mappings.amend.cc.confirmbutton                                                                                                    
                  - sleep:
                      duration: 10000  
                  - log: Your payment method was updated sucessfully
                else:
                  - click:
                      identifier: us.mappings.amend.cc.confirmbutton 
                  - sleep:
                      duration: 10000
                  - if:
                      identifier:
                        present:
                          - identifier: us.mappings.amend.cc.error
                      then:
                        - log: Trying again to update payment method
                        - click:
                            identifier: us.mappings.amend.cc.confirmbutton 
                  - log: Your payment method was updated sucessfully

      - if:
          condition: ${card} == 'editcard'
          then:
            - verifyIdentifier:
                timeout: 8000
            - executeFunction:
                name: us.functions.utils.scrollIfNotVisible
                params:
                  - name: identifier
                    string: us.mappings.amend.paymentMethodText
                  - name: direction
                    string: down
            - click:
                identifier: us.mappings.amend.cc.editButton
            - sleep:
                duration: 3000
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.orderDetailse.verifyOnetimeCardChangeText  
            - log: you can only make changes to this order's payment method once                       
            - sleep:
                duration: 3000      
            - click:
                identifier: us.mappings.amend.cc.cardSelect
            - sleep:
                duration: 3000      
            - click:
                identifier: us.mappings.amend.cc.cardEdit                             
            - executeFunction:
                name: us.functions.account.paymentMethod.editExistingCreditCard
            - sleep:
                duration: 10000                
            - sleep:
                duration: 5000  
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.paymentMethod.creditCard.cardUpdatedText    
            - log: card updated
            - if: 
                identifier:
                  present:
                    - identifier: us.mappings.amend.cc.ccv
                then:
                  - click:
                      identifier: us.mappings.amend.cc.ccv 
                  - enterText:
                      identifier: us.mappings.amend.cc.ccv
                      string: ${cvv}
                  - sleep:
                      duration: 5000
                  - click:
                      identifier: us.mappings.amend.cc.confirmbutton                    
                  - sleep:
                      duration: 10000  
                  - log: Your payment method was updated sucessfully
                else:
                  - click:
                      identifier: us.mappings.amend.cc.confirmbutton 
                  - sleep:
                      duration: 10000
                  - log: Your payment method was updated sucessfully

      - sleep:
          duration: 60000
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
                  
      - if: 
          identifier:
            present:
              - identifier: us.mappings.amend.verifyPaymentMethodUpdatedText
          then: 
            - log: 
                message: changes will be reflected shortly
          else:            
            - scroll:
                direction: down
                untilIdentifier: us.mappings.amend.paymentMethodText
            - verifyIdentifier:
                notPresent:
                  - identifier: us.mappings.amend.cc.editButton
            - log: no edit link

  - name: us.functions.amend.rescheduleInstallation
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.odp.acctext
      - verifyIdentifier:
          present:
            - identifier: us.mappings.odp.accRescheduleCTA
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.odp.accRescheduleCTA
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.cart.scheduleInstallation
          params:
            - name: slotIndex
              string: 3
      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.odp.accRescheduleVerifyText
      - sleep:
          duration: 5000


  - name: us.functions.amend.rescheduleInstallation
    platform: ios
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.odp.acctext
      - verifyIdentifier:
          present:
            - identifier: us.mappings.odp.accRescheduleCTA
      - sleep:
          duration: 2000
      - click:
          identifier: us.mappings.odp.accRescheduleCTA
      - sleep:
          duration: 2000
      - executeFunction:
          name: us.functions.cart.scheduleInstallation
          params:
            - name: slotIndex
              string: 1
      - verifyIdentifier:
          present:
            - identifier: us.mappings.odp.accRescheduleVerifyText
      - sleep:
          duration: 5000  
      - log : Installation rescheduled

  - name: us.functions.amend.verify.altPickupPerson
    platform: android
    flow:
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.editPickupPerson
      - click:
          identifier: us.mappings.amend.editPickupPerson
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.pickupfname
      - click:
          identifier: us.mappings.amend.pickupfname
      - enterText:
          identifier: us.mappings.amend.pickupfname
          string: ${fname}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.pickuplname
      - click:
          identifier: us.mappings.amend.pickuplname
      - enterText:
          identifier: us.mappings.amend.pickuplname
          string: ${lname}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.save
      - click:
          identifier: us.mappings.amend.save
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.pickupeml
      - click:
          identifier: us.mappings.amend.pickupeml
      - enterText:
          identifier: us.mappings.amend.pickupeml
          string: ${pickupEmail}
      - verifyIdentifier:
          present:
            - identifier: us.mappings.amend.save
      - click:
          identifier: us.mappings.amend.save
      - verifyIdentifier:
          present:
           - identifier: us.mappings.amend.person
      - log: pickup person is edited

 # Functions to handle CVV during Amend flow
  - name: us.functions.amend.creditCard.InCart
    platform: android
    flow:
      - if: 
          identifier:
            present:
              - identifier: us.mappings.amend.cc.ccv
          then:
            - click:
                identifier: us.mappings.amend.cc.ccv 
            - enterText:
                identifier: us.mappings.amend.cc.ccv
                string: ${cvv}
            - goBack: true                      
            - click:
                identifier: us.mappings.amend.cc.confirmbutton                                                                                                    
            - sleep:
                duration: 2000  
            - log: Your payment method was updated sucessfully
      - if:
          identifier:
            present:
              - identifier: us.mappings.popup.technicalError
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.popup.okButton
            - click:
                identifier: us.mappings.popup.okButton

    # Functions to handle CVV during Amend flow
  - name: us.functions.amend.creditCard.InCart
    platform: ios
    flow:
      - if: 
          identifier:
            present:
              - identifier: us.mappings.amend.cc.ccv
          then:
            - click:
                identifier: us.mappings.amend.cc.ccv 
            - enterText:
                identifier: us.mappings.amend.cc.ccv
                string: ${cvv}
            - click:
                identifier: Done
            - sleep:
                duration: 2000
            - if:
                identifier:
                  present:
                    - identifier: us.mappings.amend.cc.confirmbutton
                then:
                  - click:
                      identifier: us.mappings.amend.cc.confirmbutton                                                                                                                      
            - sleep:
                duration: 5000  
            - log: Your payment method was updated sucessfully
      - if:
          identifier:
            present:
              - identifier: us.mappings.popup.technicalError
          then:
            - verifyIdentifier:
                present:
                  - identifier: us.mappings.popup.okButton
            - click:
                identifier: us.mappings.popup.okButton

