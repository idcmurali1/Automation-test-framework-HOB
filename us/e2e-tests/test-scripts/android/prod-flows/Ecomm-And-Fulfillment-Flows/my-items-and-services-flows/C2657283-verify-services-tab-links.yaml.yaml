# Author : Vineetha Manusani

general:
  platform: android
  tags: C2657283, prod-e2e, p1-ecomm-prod-e2e, EC042
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  testCaseId: C2657283
  metadata:
    - name: scenarioId
      string: EC042 #110

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:
      - log: Start Main

      # Navigate onboarding to home
      - executeFunction:
          name: us.functions.global.onboarding.navigateOnboardingToHome

      - storeIn:
          key: scrollNotRequired
          value: true

      - executeFunction:
          name: us.functions.global.navigation.goToServicesFromTabBar

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Pharmacy

      - executeFunction:
          name: us.function.services.pharmacy.dashboardvalidation
          params:
            - name: account
              string: Guest

      - goBack: true


      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Auto Services

      # - click:
      #     identifier: us.mappings.item.closeButton

      - executeFunction:
          name: us.functions.global.authentication.handleSignInAnotherWayPopup

      - verifyIdentifier:
          present:
            - identifier: us.mappings.global.authentication.emailField

      - goBack: true

      - verifyIdentifier:
          present:
            - identifier: us.mappings.services.autoCareCenterHeader

      - goBack: true

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Custom Cakes

      - executeFunction:
          name: us.function.servicesCustomCakes.continueOnWebsitePopup

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Walmart Pay

      - executeFunction:
          name: us.functions.global.authentication.handleSignInAnotherWayPopup

      - verifyIdentifier:
          present:
            - identifier: us.mappings.global.authentication.emailField

      - goBack: true
      #Guest User
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Store map

      - executeFunction:
          name: us.functions.storeMaps.services.storeMap.mapView

      - goBack: true

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Check a price

      - verifyIdentifier:
          present:
            - identifier: us.mappings.services.allowButton

      - goBack: true

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Scan & go

      - executeFunction:
          name: us.functions.global.authentication.handleSignInAnotherWayPopup

      - verifyIdentifier:
          present:
            - identifier: us.mappings.global.authentication.emailField

      - goBack: true

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Member prices on fuel

      - verifyIdentifier:
          present:
            - identifier: us.mappings.wplus.walmartPlusLogo

      - goBack: true

      - executeFunction:
          name: us.functions.services.walmartLive

      - goBack: true

      - executeFunction:
          name: us.functions.global.navigation.toTab
          params:
            - name: tabName
              string: Shop

      - executeFunction:
          name: us.functions.home.navigateHomeToSignIn

      - executeFunction:
          name: us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: us.data.prod.popularSevices.androidUser
            - name: password
              string: us.data.prod.popularservices.storeTools.ios.password

      - scroll:
          direction: up

      - executeFunction:
          name: us.functions.global.navigation.goToServicesFromTabBar

      - executeFunction:
          name: us.functions.services.handleJoinOnePopup

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Pharmacy

      - executeFunction:
          name: us.function.services.pharmacy.dashboardvalidation
          params:
            - name: account
              string: Existing user

      - goBack: true

      - verifyIdentifier:
          present:
            - identifier: us.mappings.home.searchBarSelected


      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Auto Services
            - name: scrollNotRequired
              string: true

      - verifyIdentifier:
          present:
            - identifier: us.mappings.services.autoCareCenterHeader

      - goBack: true

      # Commenting out due to an environment issue in the flow GPMNETE-150129
      # - executeFunction: 
      #     name: us.functions.services.naviagteToServices
      #     params:
      #       - name: servicesName
      #         string: Custom Cakes

      # - executeFunction:
      #     name: us.function.servicesCustomCakes.continueOnWebsitePopup

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Walmart Pay

      - executeFunction:
          name: us.functions.services.clickAllowButton

      - executeFunction:
          name: us.functions.services.verifyWalmartPayPage

      - executeFunction:
          name: us.functions.services.walmartPay.closeAddPaymentPage

      - goBack: true

      #Signedin User
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Store map

      - executeFunction:
          name: us.functions.storeMaps.services.storeMap.mapView

      - goBack: true

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Check a price

      - executeFunction:
          name: us.functions.services.verifyCheckAPricePage

      - goBack: true

      - executeFunction:
          name: us.functions.home.closeWPlusPromotionPopUpIfDisplayed

      # - scroll:
      #     direction: up

          # commenting as in new service page layout does not have  Scan & go &  Member prices on fuel

      # - executeFunction:
      #     name: us.functions.services.naviagteToServices
      #     params:
      #       - name: servicesName
      #         string: Scan & go

      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.wplus.signup.scanAndGoSignuptitle

      # - executeFunction:
      #     name: us.functions.wplus.clickCloseButton

      # - executeFunction:
      #     name: us.functions.services.naviagteToServices
      #     params:
      #       - name: servicesName
      #         string: Member prices on fuel

      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.wPlus.hub

      # - goBack: true

      # - executeFunction:
      #     name: us.functions.services.walmartLive

      # - goBack: true

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: us.functions.utils.afterSteps
