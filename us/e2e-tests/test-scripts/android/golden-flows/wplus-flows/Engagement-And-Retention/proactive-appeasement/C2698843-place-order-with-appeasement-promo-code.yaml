general:
  platform: android 
  tags: '' #(Currently feature is turn off on prod. Will enable the tags once feature is enabled on prod) us-golden-flows-wplus, C2698843, p1-wplus-teflon-e2e
  testCaseId: C2698843
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: 500, WP044
scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  - name: Main  
    flow:
      - log: Start Main
      - try:
          flow:
            - getTimestamp:
                asDate: false
                storeIn: timestamp

            - storeIn:
                key: customerEmail
                value: wmtuser${timestamp}@walmart.com

            - storeIn:
                 key: password
                 value: E2epassword$ 

             # Create Wplus Trial Account and convert to Paid using astro api
            - executeFunction:
                 name: us.functions.utils.astro.createTrialAccountConvertToPaid
                 params:
                   - name: email
                     string: $customerEmail
                   - name: payload
                     string: us.data.createWplusAccountPayload.annual.appeasement
#***************************************************************************************************************

  # Astro - Create an order and cancel the order

#***************************************************************************************************************
      - executeFunction:
            name: us.functions.utils.getSearchableItem 
            params:
              - name: storeId
                string: 32144      
              - name: itemType
                string: FC_DELIVERY
              - name: itemFilter
                string: lessThan35
      - storeIn:
          key: item1
          value: $itemFetched

      - executeFunction:
          name: us.functions.utils.astro.createOrder
          params:
            - name: payload
              string: us.data.proactive.appeasement.createOrderPayload

      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus

      - executeFunction:
              name: us.functions.utils.astro.cancelOrder
              params:
                - name: orderNo
                  string: ${orderNo}
                - name: payload
                  string: us.data.ios.cancelorderPayload

      - executeFunction:
          name: us.functions.global.onboarding.navigateOnboardingToHome

      # Navigate to sign in page
      - executeFunction:
            name: us.functions.home.navigateHomeToSignIn

      # Sign in with default account
      - executeFunction:
          name: us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: ${customerEmail}
            - name: password
              string: E2epassword$

      # Navigate to home page
      - executeFunction:
                name: us.functions.global.navigation.toTab
                params:
                  - name: tabName
                    string: Shop


      - executeFunction:
                name: us.functions.home.setStore
                params:
                    - name: store
                      string: 32144
                    - name: storeName
                      string: San Jose Supercenter

      # Function to fetch working items from the item array list using API.
      - executeFunction:
                name: us.functions.utils.fetchFromDataList
                params:
                  - name: email
                    string: ${customerEmail}
                  - name: storeId
                    string: 32144      
                  - name: itemType
                    string: STORE_SCHEDULED_DELIVERY
                  - name: itemList
                    string: us.data.lessThan35.itemLists

      # Add item to cart from deeplink
      - executeFunction:
                name: us.functions.global.navigation.goToDeepLink
                params:
                  - name: deepLinkUrl
                    string: ${deeplinkURl} 
                    
      - executeFunction:
            name: us.functions.item.addItemToCart
      
      # Navigate to Purchase History
      - executeFunction:
          name: us.functions.global.navigation.homeToOrderHistory

      # Verify PH banner and navigate to ODP of the cancelled order
      - executeFunction:
            name: us.functions.orderDetails.verifyAppeasementBanner
      
      # Verify ODP ondemand appeasement splash
      - executeFunction:
            name: us.functions.orderDetails.verifyAppeasementSplash

      # Verify ODP appeasement banner
      - executeFunction:
            name: us.functions.orderDetails.verifyAppeasementBanner

      # Verify ODP ondemand appeasement splash
      - executeFunction:
            name: us.functions.orderDetails.verifyAppeasementSplash
            
      - executeFunction:
            name: us.functions.global.navigation.toCartFromNavBar 

      # proceeding to checkout/Review order page
      - executeFunction:
                name: us.functions.cart.continueToCheckout

      # Verify if promo is auto applied
      - executeFunction: 
            name: us.functions.reviewOrder.verifyAppeasementPromo

      # placing order and navigating to order confirmation page
      - executeFunction:
                name: us.functions.checkout.confirmCvvAndPlaceOrder
                params:               
                 - name: cvv
                   string: 111  
      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    useTestConfigErrors: false
    flow:
      - executeFunction:
          name: us.functions.utils.afterSteps             
