#=======================================================================================================
#Test Script #C2663327-reactivate-membership-paid-annual
# Author - Gopal Tikare
#======================================================================================================

general:
  platform: android 
  tags: us-golden-flows-wplus, C2663327, p0-wplus-teflon-e2e
  testCaseId: C2663327  
  inherit:
    filesRunAll:
     - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: "325, 322, WP003"
           
scenarios:

    - name: Before
      before: true
      endTestOnFailure: true
      flow:
        
        # Get timestamp
        - getTimestamp:
            asDate: false
            storeIn: timestamp

        - storeIn:
            key: customerEmail
            value: wplususer${timestamp}@walmart.com

        # Create Wplus Paid Anually Account and convert to Paid using astro api
        - executeFunction:
            name: us.functions.utils.astro.createTrialAccountConvertToPaid
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createWplusAccountPayload.annual

        #Cancel membership using Astro api
        - executeFunction:
            name: us.functions.utils.astro.cancelPaidMembership
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createWplusAccountPayload.annual

#   # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#         - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
    - name: Main
      flow:
        - log: Start Main

        # Navigate onboarding to home
        - executeFunction:
            name: us.functions.global.onboarding.navigateOnboardingToHome

        # Navigate to SignIn
        - click:
            identifier: us.mappings.home.signInButton
        # Signin
        - executeFunction:
            name: us.functions.global.authentication.signInAccount
            params:
              - name: email
                string: ${customerEmail}
              - name: password
                string: E2epassword$

        - executeFunction:
            name: us.functions.global.navigation.goToAccountFromTabBar

         # Navigate to Walmart+
        - executeFunction:
            name: us.functions.wplus.account.navigateToWalmartPlus

        # Reactivate Wplus 
        - executeFunction:
             name: us.functions.wplus.account.reactivateWplusFromBenefitsPage

        - sleep:
            duration: 5000

        - verifyIdentifier:
             timeout: 30000
             present:
             - identifier: us.mappings.wplus.manageMembership.gearIcon

            
        #Navigate to Manage membership
        - executeFunction:
            name: us.functions.wplus.navigateToManageMembershipFromBenefitsPage
 
        # Verify annual Plan Activation on Manage Membership
        - executeFunction:
            name: us.functions.wplus.membership.verifyMyMembershipDetails
            params:
            - name: tenure
              string: annual
            - name: membershipType
              string: paid

        # storing testrun result as passed
        - storeIn:
            key: testStatus
            value: passed
            
    - name: After
      after: true
      useTestConfigErrors: false
      flow:
        - executeFunction:
            name: us.functions.utils.afterSteps