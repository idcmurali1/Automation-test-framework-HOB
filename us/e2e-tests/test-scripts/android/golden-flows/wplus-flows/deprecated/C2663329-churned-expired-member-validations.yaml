general:
  platform: android
  tags: '' # (Deprecated as part of Regression Optimization) us-golden-flows-wplus, C2663329, p2-wplus-teflon-e2e 
  testCaseId: C2663329  
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: 164
           
scenarios:
    - name: Before
      before: true
      endTestOnFailure: true
      flow:

        # Get timestamp
        - getTimestamp:
            asDate: false
            storeIn: timestamp

        - storeIn:
            key: customerEmail
            value: wplususer${timestamp}@walmart.com

        # Create Wplus Trial annually Account using astro api
        - executeFunction:
            name: us.functions.utils.astro.createAccount
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createWplusAccountPayload.annual
    
        #Cancel membership using Astro api
        - executeFunction:
            name: us.functions.utils.astro.cancelPaidMembership
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createWplusAccountPayload.annual


  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
        - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
    - name: Main
      flow:
        - log: Start Main

        # Navigate onboarding to home
        - executeFunction:
            name: us.functions.global.onboarding.navigateOnboardingToHome

        # Navigate to SignIn
        - click:
            identifier: us.mappings.home.signInButton
        # Signin
        - executeFunction:
            name: us.functions.global.authentication.signInAccount
            params:
              - name: email
                string: ${customerEmail}
              - name: password
                string: E2epassword$

        - executeFunction:
            name: us.functions.global.navigation.goToAccountFromTabBar

         # Navigate to Walmart+
        - executeFunction:
            name: us.functions.wplus.account.navigateToWalmartPlus

        - executeFunction:
            name: us.functions.wplus.account.clickOnJoinWplusFromMlp
            

        # storing testrun result as passed
        - storeIn:
            key: testStatus
            value: passed
            
    - name: After
      after: true
      useTestConfigErrors: false
      flow:
        - executeFunction:
            name: us.functions.utils.afterSteps