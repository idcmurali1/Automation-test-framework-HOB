general:
  platform: android
  tags: p2-ecomm-teflon-e2e, C2671875
  testCaseId: C2671875
  metadata:    
    - name: scenarioId      
      string: EC096

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

  - name: Main
    flow:

      - log: Start main


    # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      # Navigate onboarding to home
      - executeFunction:
          name: us.functions.global.onboarding.navigateOnboardingToHome

    # Create Account
      - executeFunction:
          name: us.functions.utils.astro.createAccount
          params:          
            - name: email
              string: us.data.ostHome.email
            - name: payload
              string: us.data.createAccountPayload.generic
    # Navigate to SignIn
      - click:
          identifier: us.mappings.home.signInButton
    #Signin
      - executeFunction:
          name: us.functions.global.authentication.signInAccount
          params:
              - name: email
                string: us.data.ostHome.email
              - name: password
                string: E2epassword$

      - executeFunction:
          name: us.functions.utils.getSearchableItem
          params:
            - name: source
              string: astro          
            - name: itemType
              string: STORE_UNSCHEDULED_PICKUP
            - name: store
              string: 32144
            - name: backupItem
              string: 499312381  

      - storeIn:
          key: item1
          value: $itemFetched

      - executeFunction:
          name: us.functions.utils.astro.createOrder
          params:
            - name: payload
              string: us.data.flowVerifyOST.createOrderPayload.scUnScheduledPickup
              
    # Move Order to PO Pick Complete
      
      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: STORE_UNSCHEDULED_PICKUP
            - name: status
              string: PO Pick Complete

      # Deeplink into order details page
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
      
      # go to order details
      - executeFunction:
          name: us.functions.orderDetails.ost.pickup.verifyOrderStatus
          params:
            - name: fulfillmentType
              string: pickup
            - name: orderStatus
              string: Preparing


    # Move Order to PO Ready For Pickup
      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: STORE_UNSCHEDULED_PICKUP
            - name: status
              string: PO Ready For Pickup

      # Deeplink into order details page
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo

      # go to order details
      - executeFunction:
          name: us.functions.orderDetails.ost.pickup.verifyOrderStatus
          params:
            - name: fulfillmentType
              string: pickup
            - name: orderStatus
              string: Ready
      
      - executeFunction:
          name: us.functions.global.navigation.backNavigation

    # Move Order to Customer Picked
      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderNo
              string: ${orderNo}
            - name: orderType
              string: STORE_UNSCHEDULED_PICKUP
            - name: status
              string: Customer Picked
              
      # Deeplink into order details page
      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://orders/$orderNo
      
      # go to order details
      - executeFunction:
          name: us.functions.orderDetails.ost.pickup.verifyOrderStatus
          params:
            - name: fulfillmentType
              string: pickup
            - name: orderStatus
              string: Picked up

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    useTestConfigErrors: false
    flow:
      - executeFunction:
          name: us.functions.utils.afterSteps