# Author : Suneetha Vemana

general:
  platform: ios
  tags: C2657283, prod-e2e,  p1-ecomm-prod-e2e, EC042
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  testCaseId: C2657283
  metadata:
    - name: scenarioId
      string: EC042 #110

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

      # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:
      - log: Start Main

      # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      # Navigate onboarding to home
      - executeFunction:
          name: us.functions.global.onboarding.navigateOnboardingToHome

      - executeFunction:
          name: us.functions.global.navigation.goToServicesFromTabBar

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Pharmacy

      - executeFunction:
          name: us.function.pharmacy.dashboardvalidation
          params:
            - name: account
              string: Guest

      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.home.searchBarSelected
      - click:
          identifier: us.mappings.popularServices.pharamcy.backButton
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Auto Services

      - verifyIdentifier:
          present:
            - identifier: us.mappings.popularServices.autoCareCenterHeader

      - click:
          identifier: us.mappings.popularServices.autoCareCenter.backButton

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Custom Cakes

      - verifyIdentifier:
          present:
            - identifier: us.mappings.popularServices.customcakesHeader

      - click:
          identifier: us.mappings.popularServices.customCakes.backButton

      # Verify walmart pay as guest user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Walmart Pay

      - executeFunction:
          name: us.functions.global.authentication.dismissSelectSavedPasswordDialog

      - verifyIdentifier:
          present:
            - identifier: us.mappings.global.authentication.emailField

      - click:
          identifier: us.mappings.home.signView.closeButon

      # Verify Check a price as guest user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Check a price

      # Validate Are you at the store bottom overlay
      - executeFunction:
          name: us.functions.scanner.validateAreYouAtTheStoreBottomOverlay

      # Validate Are you get accurate prices bottom overlay
      - executeFunction:
          name: us.functions.scanner.validateGetAccuratePriceBottomOverlay

      #Validate allow location
      - executeFunction:
          name: us.functions.scanner.allowLocation

      # Validate Are you get shop smart with scanner bottom overlay
      - executeFunction:
          name: us.functions.scanner.shopSmartWithScannerBottomOverlay

      - click:
          identifier: us.mappings.home.ScannerCloseButton

      # Verify store map for guest user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Store map

      # Validate store map is displayed
      - executeFunction:
          name: us.functions.storeMaps.services.storeMap.mapView

      # Verify Scan & go as guest user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Scan & go

      #Allow Camera Access
      - executeFunction:
          name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption

      #Validate allow location
      - executeFunction:
          name: us.functions.scanner.allowLocation

      - executeFunction:
          name: us.functions.services.cancelOrValidateScanAndGo

      #Verify Member prices on fuel as guest user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Member prices on fuel

      - executeFunction:
          name: us.functions.global.authentication.dismissSelectSavedPasswordDialog

      - verifyIdentifier:
          present:
            - identifier: us.mappings.global.authentication.emailField

      - click:
          identifier: us.mappings.home.signView.closeButon

      - executeFunction:
          name: us.functions.services.walmartLive

      - executeFunction:
          name: us.functions.global.navigation.goToAccountFromTabBar
      - executeFunction:
          name: us.functions.home.navigateHomeToSignIn
      #Sign in with default account
      - executeFunction:
          name: us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: us.data.prod.popularSevices.storeToolsUser
            - name: password
              string: us.data.prod.popularservices.storeTools.ios.password

      - executeFunction:
          name: us.functions.global.navigation.accountToHome

      - executeFunction:
          name: us.functions.global.navigation.goToServicesFromTabBar

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Pharmacy

      - executeFunction:
          name: us.function.pharmacy.dashboardvalidation
          params:
            - name: account
              string: Existing user

      # - verifyIdentifier:
      #     present:
      #       - identifier: us.mappings.home.searchBarSelected
      - click:
          identifier: us.mappings.popularServices.pharamcy.backButton

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Auto Services

      - verifyIdentifier:
          present:
            - identifier: us.mappings.popularServices.autoCareCenterHeader

      - click:
          identifier: us.mappings.popularServices.autoCareCenter.backButton

      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Custom Cakes

      - verifyIdentifier:
          present:
            - identifier: us.mappings.popularServices.customcakesHeader

      - click:
          identifier: us.mappings.popularServices.customCakes.backButton

      #Verify check a price as a signedin user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Check a price

      # Validate Are you at the store bottom overlay
      - executeFunction:
          name: us.functions.scanner.validateAreYouAtTheStoreBottomOverlay

      # Validate Are you get accurate prices bottom overlay
      - executeFunction:
          name: us.functions.scanner.validateGetAccuratePriceBottomOverlay

      #Validate allow location
      - executeFunction:
          name: us.functions.scanner.allowLocation

      # Validate Are you get shop smart with scanner bottom overlay
      - executeFunction:
          name: us.functions.scanner.shopSmartWithScannerBottomOverlay

      - click:
          identifier: us.mappings.home.ScannerCloseButton
  
        # Verify store map for signedin user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Store map

      # Validate store map is displayed
      - executeFunction:
          name: us.functions.storeMaps.services.storeMap.mapView

      # Verify Scan & go as a signedin user
      - executeFunction:
          name: us.functions.services.naviagteToServices
          params:
            - name: servicesName
              string: Claim offer now

      # commenting due to service page layout is changed

      # - executeFunction:
      #     name: us.functions.scanner.allowLocation

      # #Allow Camera Access
      # - executeFunction:
      #     name: us.functions.scanner.allowWouldYouLikeToAccessYourCameraOption

      # - executeFunction:
      #     name: us.functions.services.cancelOrValidateScanAndGo

      # # Verify Member prices on fuel as a signedin user
      # - executeFunction:
      #     name: us.functions.services.naviagteToServices
      #     params:
      #       - name: servicesName
      #         string: Member prices on fuel

      - verifyIdentifier:
          present:
            - identifier: us.mappings.wplus.promotion.PopUpTrialButton

      - click:
          identifier: us.mappings.wplus.promotion.PopUpTrialButtonClose

      - executeFunction:
          name: us.functions.services.walmartLive

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: us.functions.utils.afterSteps
