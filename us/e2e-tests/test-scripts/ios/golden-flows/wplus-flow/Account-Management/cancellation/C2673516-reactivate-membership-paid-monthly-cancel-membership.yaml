#=======================================================================================================
#Test Script #C2673516-reactivate-membership-paid-monthly-cancel-membership
# Author - Usha Amisetty
#======================================================================================================

general:
  platform: ios 
  tags: C2673516, us-golden-flows-wplus, p1-wplus-teflon-e2e
  testCaseId: C2673516
  inherit:
    filesRunAll:
     - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: 387
      
scenarios:

    - name: Before
      before: true
      endTestOnFailure: true
      flow:

       
  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
        - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
    - name: Main
      flow:
        - log: Start Main

        # Navigate onboarding to home
        - executeFunction:
            name: us.functions.global.onboarding.navigateOnboardingToHome

        # Navigate to SignIn
        - click:
            identifier: us.mappings.home.signInButton
        # Signin
        - executeFunction:
            name: us.functions.global.authentication.signInAccount
            params:
              - name: email
                string: us.data.C2673516.email
              - name: password
                string: us.data.C2673516.password

        - executeFunction:
            name: us.functions.global.navigation.goToAccountFromTabBar
    
        #Capture user savings details
        - executeFunction:
            name: us.functions.wplus.account.captureSavingsDetails 

         # Navigate to Walmart+
        - executeFunction:
            name: us.functions.wplus.account.navigateToWalmartPlus        
        
        #Verify manage membership gearIcon
        - verifyIdentifier:
            timeout: 3000
            present:
            - identifier: us.mappings.wplus.manageMembership.gearIcon

            
        #Navigate to Manage membership Page
        - executeFunction:
            name: us.functions.wplus.navigateToManageMembershipFromBenefitsPage
  
 
        # Navigate to Cancel Membership or Free trial page from Membership settings page on IOS
        - executeFunction:
            name: us.functions.wplus.managemembership.navigateToCancelPaidMemberFromMemberShipPage

        #  Navigate to updated variantA W+Plus benefits on cancel membership confirmation page on IOS 
        - executeFunction:
            name : us.functions.wplus.cancelConfirmation.verifyVariantACancelFreeTrialOrCancelWalmartPlusDetails

        # Verify 'see savings details' disclaimer
        - executeFunction:
            name : us.functions.wplus.cancelConfirmation.verifyVariantASeeSavingsDetailsDisclaimer  

        # Click Cancel membership and verify Survey page
        - executeFunction:
            name : us.functions.wplus.cancelConfirmation.verifyVariantACancelConfirmationSurveyPage

        # Keep membership from cancel confirmation survey page on IOS
        - executeFunction:
            name: us.functions.wplus.cancelConfirmation.keepMembershipNGoBackFromSurveyPage
            
        # storing testrun result as passed
        - storeIn:
            key: testStatus
            value: passed

    - name: After
      after: true
      useTestConfigErrors: false
      flow:
        - executeFunction:
            name: us.functions.utils.afterSteps

