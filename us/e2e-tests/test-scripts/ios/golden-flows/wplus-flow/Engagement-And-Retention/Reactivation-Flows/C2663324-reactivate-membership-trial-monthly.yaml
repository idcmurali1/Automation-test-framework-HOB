#=======================================================================================================
#Test Script #C2663324-reactivate-membership-trial-monthly
# Author - Gopal Tikare
# Updated the script based on the new flow 
#======================================================================================================

general:
  platform: ios 
  tags: us-golden-flows-wplus, C2663324, p0-wplus-teflon-e2e
  testCaseId: C2663324
  inherit:
    filesRunAll:
     - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: "322, WP011"

scenarios:
    - name: Before
      before: true
      endTestOnFailure: true
      flow:

        # Get timestamp
        - getTimestamp:
            asDate: false
            storeIn: timestamp

        - storeIn:
            key: customerEmail
            value: wplususer${timestamp}@walmart.com

        # Create Wplus Trial Monthly Account using astro api
        - executeFunction:
            name: us.functions.utils.astro.createAccount
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createAccountPayloadPayPal.monthly
    
    #Cancel membership using Astro api
        - executeFunction:
            name: us.functions.utils.astro.cancelPaidMembership
            params:
              - name: email
                string: $customerEmail
              - name: payload
                string: us.data.createAccountPayloadPayPal.monthly


  # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
        - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  
    - name: Main
      flow:
        - log: Start Main

        # Navigate onboarding to home
        - executeFunction:
            name: us.functions.global.onboarding.navigateOnboardingToHome

        # Navigate to SignIn
        - click:
            identifier: us.mappings.home.signInButton
        # Signin
        - executeFunction:
            name: us.functions.global.authentication.signInAccount
            params:
              - name: email
                string: ${customerEmail}
              - name: password
                string: E2epassword$

        - executeFunction:
            name: us.functions.home.closeWplusBottomSheetNewBannerIfDisplayed

        - executeFunction:
            name: us.functions.global.navigation.goToAccountFromTabBar
      
        - executeFunction:
            name: us.functions.home.closeWplusBottomSheetNewBannerIfDisplayed

         # Navigate to Walmart+
        - executeFunction:
            name: us.functions.wplus.account.navigateToWalmartPlus


        # Click on the CTA from MLP 
        - executeFunction:
            name: us.functions.wplus.account.clickOnJoinWplusFromMlp
            params:
              - name: flow
                string: reactivate

        # Choose monthly plan
        - executeFunction:
            name: us.functions.wplus.account.chooseWplusPlan
            params:
              - name: plan
                string: monthly

        # Running this function to scroll to the top on selecting the account tab
        - executeFunction:
            name: us.functions.global.navigation.goToAccountFromTabBar

        # Navigate to Walmart Plus
        - executeFunction:
            name: us.functions.wplus.account.navigateToWalmartPlus

        - verifyIdentifier:
            timeout: 1000
            present:
            - identifier: us.mappings.wplus.manageMembership.gearIcon
      
        #Navigate to Manage membership
        - executeFunction:
            name: us.functions.wplus.navigateToManageMembershipFromBenefitsPage
 
        # Verify Monthly Plan Activation on Manage Membership
        - executeFunction:
            name: us.functions.wplus.membership.verifyMyMembershipDetails
            params:
            - name: tenure
              string: monthly
            - name: membershipType
              string: paid

        # storing testrun result as passed
        - storeIn:
            key: testStatus
            value: passed


    - name: After
      after: true
      useTestConfigErrors: false
      flow:
        - executeFunction:
            name: us.functions.utils.afterSteps