general:
  platform: ios
  tags: p1-ecomm-teflon-e2e, C2672475, p1-fulcrum-teflon-e2e
  testCaseId: C2672475
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml

  metadata:
    - name: scenarioId
      string: EC097

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true

    flow:
      - log: Execute before steps

  - name: Main
    flow:
      - log: Start

      #Workaround to correctly restart app with Teflon settings
      - executeFunction:
          name: us.functions.utils.restartapp

      # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

      - storeIn:
          key: customerEmail
          value: ostscd${timestamp}@walmart.com

      - storeIn:
          key: password
          value: E2epassword$

      # Create Accountusing astro api
      - executeFunction:
          name: us.functions.utils.astro.createAccount
          params:
            - name: email
              string: $customerEmail
            - name: payload
              string: us.data.createAccountPayload.genericChallengeAccount

      # signing in to the account
      - executeFunction:
          name: us.functions.home.navigateHomeToSignIn

      - executeFunction:
          name: us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: ${customerEmail}
            - name: password
              string: $password

      # Fetch stock available items using fetch API
      - executeFunction:
           name: us.functions.utils.fetchFulcrumAvailableItem
           params:
            - name: itemType
              string: STORE_SCHEDULED_DELIVERY
            - name: store
              string: 32144
     
      - storeIn:
          key: item1
          value: $itemFetched

      - executeFunction:
          name: us.functions.utils.astro.createOrder
          params:
            - name: payload
              string: us.data.storeDelivery.createOrderPayload
            - name: skipOrderWait
              string: true

      - executeFunction:
          name: us.functions.global.navigation.accountToHome

# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_POST_TRANSACTION'
# # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

      - executeFunction:
          name: us.functions.homepage.redesign.verify.ost.storeDelivery
          params:
            - name: option
              string: placed
            - name: ostHeaderLabel
              string: We've received your order
            - name: ostSubHeaderLabel
              string: Arrives
            - name: orderStatusLink
              string: View order
            - name: orderNo
              string: ${orderNo}

      - executeFunction:
          name: us.functions.global.navigation.backNavigation

      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderType
              string: STORE_SCHEDULED_DELIVERY
            - name: status
              string: PO Pick Complete

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://home

      - scroll:
          direction: up

      - executeFunction:
          name: us.functions.homepage.redesign.verify.ost.storeDelivery
          params:
            - name: option
              string: inprogress
            - name: ostHeaderLabel
              string: We're preparing your order
            - name: ostSubHeaderLabel
              string: Arrives
            - name: orderStatusLink
              string: View order
            - name: orderNo
              string: ${orderNo}

      - executeFunction:
          name: us.functions.global.navigation.backNavigation

      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderType
              string: STORE_SCHEDULED_DELIVERY
            - name: status
              string: PO Out for Delivery

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://home

      - scroll:
          direction: up

      - executeFunction:
          name: us.functions.homepage.redesign.verify.ost.storeDelivery
          params:
            - name: option
              string: On the way
            - name: ostHeaderLabel
              string: Your order is on the way
            - name: ostSubHeaderLabel
              string: Estimated arrival
            - name: orderStatusLink
              string: Track

      - executeFunction:
          name: us.functions.utils.astro.getOrderStatus

      - executeFunction:
          name: us.functions.utils.astro.setOrderStatus
          params:
            - name: orderType
              string: STORE_SCHEDULED_DELIVERY
            - name: status
              string: Delivered

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://home

      - scroll:
          direction: up

      - executeFunction:
          name: us.functions.homepage.redesign.verify.ost.storeDelivery
          params:
            - name: option
              string: delivered
            - name: ostHeaderLabel
              string: Your order was delivered
            - name: ostSubHeaderLabel
              string: Left at front door #Ready to rate
            - name: orderStatusLink
              string: View order #Rate driver

      - storeIn:
          key: testStatus
          value: passed
          
  - name: After
    after: true
    useTestConfigErrors: false
    flow:
      - executeFunction:
          name: us.functions.utils.afterSteps