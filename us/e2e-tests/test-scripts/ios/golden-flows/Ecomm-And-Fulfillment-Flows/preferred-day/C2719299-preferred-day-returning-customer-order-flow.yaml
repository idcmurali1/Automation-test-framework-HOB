general:
  platform: ios
  tags: C2719299, us-golden-flows, us-golden-flows-ecom-p1, p1-ecomm-teflon-e2e
  inherit:
    filesRunAll:
      - us-errors-helpers.yaml
  metadata:
    - name: scenarioId
      string: EC144
  testCaseId: C2719299

scenarios:
  - name: Before
    before: true
    endTestOnFailure: true
    flow:
      - log: Execute before steps

# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      - log: 'R2_SUBFLOW_PRE_TRANSACTION'
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  - name: Main
    flow:
      - log: Start main

      # Get timestamp
      - getTimestamp:
          asDate: false
          storeIn: timestamp

# Navigate onboarding to home
      - executeFunction:
          name: us.functions.global.onboarding.navigateOnboardingToHome

# Navigate to sign in page
      - executeFunction:
          name: us.functions.home.navigateHomeToSignIn

# Sign in with default account
      - executeFunction:
          name: us.functions.global.authentication.signInAccount
          params:
            - name: email
              string: us.data.prefDay.email
            - name: password
              string: us.data.prefDay.password

      - executeFunction:
          name: us.functions.global.navigation.accountToHome

      - executeFunction:
          name: us.functions.home.setStore
          params:
            - name: store
              string: 72712
            - name: storeName
              string: Bentonville Supercenter

      - executeFunction:
          name: us.functions.gic.changeFulfillment
          params:
            - name: option
              string: Shipping

      - executeFunction:
          name: us.functions.gic.module.selectAdress.fromSelector
          params:
            - name: deliveryAddress
              string: ${STREET_ADDR:406 SW 28th St, Bentonville, AR 72712}
            - name: deliveryAddressCard
              string: ${STREET_ADDR:406 SW 28th St, Bentonville, AR, 72712}

#            #Fetch stock available items using fetch API
#      - executeFunction:
#          name: us.functions.utils.fetchFromDataList
#          params:
#            - name: email
#              string: ${customerEmail}
#            - name: itemType
#              string: FC_DELIVERY
#            - name: itemList
#              string: us.data.gepFlow01.preferredDay.itemLists
#      - storeIn:
#          key: item1
#          value: $itemFetched

      - executeFunction:
          name: us.functions.global.navigation.goToDeepLink
          params:
            - name: deepLinkUrl
              string: walmart://item/5013880085

      - sleep:
          duration: 5000

      # Add Item to the Cart
      - executeFunction:
          name: us.functions.item.addItemToCart

      - executeFunction:
          name: us.functions.global.navigation.toCartFromNavBar

      - executeFunction:
          name: us.functions.cart.continueToCheckout

      - executeFunction:
          name: us.functions.cart.selectPreferredDay
          params:
            - name: savePreferredDay
              string: false
            - name: dateSlot
              string: 1

      #Place order
      - executeFunction:
          name: us.functions.checkout.placeOrder

## # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
#      - log: 'R2_SUBFLOW_POST_TRANSACTION'
## # * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

     # Validate order confirmation page
      - executeFunction:
          name: us.functions.orderConfirmation.getOrderNumber

      - log: ${orderNo}

      - executeFunction:
          name: us.functions.cart.verifySelectPreferredDay.messageOnOrderSuccessPage
          params:
            - name: verifySavePrefDayMessageOnOrderSuccessPage
              string: false

      - storeIn:
          key: testStatus
          value: passed

  - name: After
    after: true
    flow:
      - executeFunction:
          name: us.functions.utils.afterSteps
